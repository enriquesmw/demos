(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[1],{536:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(32),a=n(50),o=function(){function e(){this._eventSource=new a.a}var t=e.prototype;return t.add_onEditHappened=function(e){this._eventSource.addHandler("OnEditHappenedEvent",e)},t.remove_onEditHappened=function(e){this._eventSource.removeHandler("OnEditHappenedEvent",e)},t.raiseEditHappenedEvent=function(){this._eventSource.raiseEvent("OnEditHappenedEvent")},e}();Object(i.a)(o,"EditNotificationEventSource",null,[]);var s=n(1),l=n(78),c=n(102),u=n(43),d=n(26),h=n(7),p=n(2);function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var m=function(){function e(e,t,n,i,a,o,s){void 0===s&&(s=0),this._editHappenedInTimeWindow=!1,this._notificationTask=null,this._editDocumentTelemetryReportingTask=null,this._userEverEdited=!1,this._taskManager=t,this._notificationIntervalInMs=e,this._hostPostmessengerTask=n,this._editNotificationEventSource=i,this._userActivityHostNotificationManager=a,this._editNotificationPostMessageIsEnabled=o,this._editDocumentUserActionReportingIntervalInMs=0,this._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport=!1;try{s>0&&(this._editDocumentUserActionReportingIntervalInMs=s,this._editDocumentUserActionReportingIntervalInMs<3e5&&(this._editDocumentUserActionReportingIntervalInMs=3e5),this._taskManager&&!this._editDocumentTelemetryReportingTask&&(this._editDocumentTelemetryReportingTask=new u.a(3,2,this._editDocumentUserActionReportingIntervalInMs,Object(r.a)(this,this.reportEditDocumentUserActionTelemetryIfNecessary,"reportEditDocumentUserActionTelemetryIfNecessary")),this._taskManager.addTask(this._editDocumentTelemetryReportingTask)))}catch(e){p.ULS.sendTraceTag(51246176,383,50,"Hit an exception while trying to queue up the EditDocument user action reporting interval: "+e)}}var t,n,i,a=e.prototype;return a.editHappened=function(){this.userEverEdited?this._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport=!0:(this._userEverEdited=!0,l.Health.instance.addQosPillar("Save"),l.Health.instance.addQosPillar("Authoring"),c.c(h.a.editDocument)),this._editHappenedInTimeWindow=!0,this._userActivityHostNotificationManager&&this._userActivityHostNotificationManager.activityHappened(),this._editNotificationEventSource&&this._editNotificationEventSource.raiseEditHappenedEvent(),s.AFrameworkApplication.dataPlumber&&s.AFrameworkApplication.dataPlumber.markAsRealEditSession(),this._editNotificationPostMessageIsEnabled&&(this._notificationTask||(this.sendPostMessageIfNecessary(null),this._notificationTask=new u.a(3,2,this._notificationIntervalInMs,Object(r.a)(this,this.sendPostMessageIfNecessary,"sendPostMessageIfNecessary"),113),this._taskManager.addTask(this._notificationTask)))},a.sendPostMessageIfNecessary=function(e){var t=this;this._editHappenedInTimeWindow&&(this._hostPostmessengerTask.CWR((function(e){return t._hostPostmessengerTask.result.sendMessage(d.a.editNotification,null)})),p.ULS.sendTraceTag(38086292,209,50,"EditNotificationManager: sending post message to the host."),this._editHappenedInTimeWindow=!1)},a.reportEditDocumentUserActionTelemetryIfNecessary=function(e){try{this._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport&&(c.c(h.a.editDocument),this._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport=!1)}catch(e){this._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport=!1,p.ULS.sendTraceTag(51246177,383,50,"Hit an exception while trying to send the EditDocument user action: "+e)}},t=e,(n=[{key:"userEverEdited",get:function(){return this._userEverEdited}}])&&g(t.prototype,n),i&&g(t,i),e}();Object(i.a)(m,"EditNotificationManager",null,[310]);var f=n(3);function _(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v=function(){function e(e,t,n,i,r){this._notificationTask=null,this._handlerTask=null,this._activityHappenedInTimeWindow=!1,this._userWasEverActive=!1,this._handlerRegistered=!1,this._taskManager=t,this._notificationIntervalInMs=e,this._hostPostmessengerTask=n,this._mouseInputManager=i,this._onBeforeShutdownSubscriber=r,this.registerHandlerTask(null)}var t,n,i,a=e.prototype;return a.registerHandlerTask=function(e){var t=this,n=document.getElementById(s.AFrameworkApplication.applicationOuterContainerId);!this._handlerRegistered&&this._mouseInputManager&&n&&(this._mouseInputManager.registerHandler(f.a.mouseOver,n,Object(r.a)(this,this.mouseActivityHandler,"mouseActivityHandler"),null),this._handlerRegistered=!0),this._onBeforeShutdownSubscriber((function(e,n){t.dispose()}))},a.mouseActivityHandler=function(e){return this._handlerRegistered&&(this._mouseInputManager.unregisterHandler(f.a.mouseOver,document.getElementById(s.AFrameworkApplication.applicationOuterContainerId),Object(r.a)(this,this.mouseActivityHandler,"mouseActivityHandler")),this._handlerRegistered=!1),this.activityHappened(),!1},a.activityHappened=function(){this._userWasEverActive=!0,this._activityHappenedInTimeWindow=!0,this._handlerTask||(this._handlerTask=new u.a(3,2,this._notificationIntervalInMs,Object(r.a)(this,this.registerHandlerTask,"registerHandlerTask"),112),this._taskManager.addTask(this._handlerTask)),this._notificationTask||(this.sendPostMessageIfNecessary(null),this._notificationTask=new u.a(3,2,this._notificationIntervalInMs,Object(r.a)(this,this.sendPostMessageIfNecessary,"sendPostMessageIfNecessary"),111),this._taskManager.addTask(this._notificationTask))},a.sendPostMessageIfNecessary=function(e){var t=this;this._activityHappenedInTimeWindow&&(this._hostPostmessengerTask.CWR((function(e){return t._hostPostmessengerTask.result.sendMessage(d.a.userActivity,null)})),p.ULS.sendTraceTag(38405446,209,50,"UserActivityHostNotificationManager: sending post message to the host."),this._activityHappenedInTimeWindow=!1)},a.dispose=function(){this._handlerRegistered&&(this._mouseInputManager.unregisterHandler(f.a.mouseOver,document.getElementById(s.AFrameworkApplication.applicationOuterContainerId),Object(r.a)(this,this.mouseActivityHandler,"mouseActivityHandler")),this._handlerRegistered=!1)},t=e,(n=[{key:"userWasEverActive",get:function(){return this._userWasEverActive}}])&&_(t.prototype,n),i&&_(t,i),e}();Object(i.a)(v,"UserActivityHostNotificationManager",null,[407,4]);var y=n(75),S=n(69),b=n(60),C=n(554),A=function(){function e(){}return e.taskFromFuture=function(e){var t=new C.a;return e.execute(Object(r.a)(t,t.setResult,"setResult")),t.task},e.toTask=function(t){return e.taskFromFuture(t)},e}();function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(A,"ContainerUtils",null,[]);var w=function(){function e(){this._container=null}var t,n,i,a=e.prototype;return a.init=function(){s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(Object(r.a)(this,this.onFullAppSettingsReady,"onFullAppSettingsReady"))},a.onFullAppSettingsReady=function(){var t=this;e.editNotificationIsEnabled&&e.editNotificationInterval>0&&(this._container.register(o,"Common.App.HostNotification.EditNotificationEventSource").singleInstance(),this._container.register(v,"Common.App.HostNotification.UserActivityHostNotificationManager").as("Common.Interface.IUserActivityHostNotificationManager").singleInstance().usingFactory((function(){return new v(6e4,b.a.instance,A.taskFromFuture(t._container.resolveFuture("Postmessage.IHostPostmessenger")),y.a.instance,s.AFrameworkApplication.subscribeToBeforeAppShutDown)})),this._container.register(m,"Common.App.HostNotification.EditNotificationManager").as("Common.Interface.IEditNotificationManager").singleInstance().usingFactory((function(){return new m(e.editNotificationInterval,b.a.instance,A.taskFromFuture(t._container.resolveFuture("Postmessage.IHostPostmessenger")),t._container.resolve("Common.App.HostNotification.EditNotificationEventSource"),t._container.tryResolve("Common.Interface.IUserActivityHostNotificationManager"),e.editNotificationPostMessageIsEnabled,e.editDocumentUserActionTelemetryReportingIntervalInMilliseconds)})),this._container.resolve("Common.Interface.IEditNotificationManager"),p.ULS.shipAssertTag(38086291,209,e.editNotificationInterval>0,"EditNotification Interval is less than or equal to 0."))},a.configure=function(e){this._container=e},a.dispose=function(){},e.main=function(){S.a.instance.registerPackage(new e)},t=e,i=[{key:"editNotificationInterval",get:function(){return s.AFrameworkApplication.appSettingsManager?parseInt(s.AFrameworkApplication.appSettingsManager.appSettings.EditNotificationTimeIntervalMs||"300000"):3e5}},{key:"editDocumentUserActionTelemetryReportingIntervalInMilliseconds",get:function(){return s.AFrameworkApplication.appSettingsManager?parseInt(s.AFrameworkApplication.appSettingsManager.appSettings.EditDocumentUserActionTelemetryReportingIntervalInMilliseconds||"0"):0}},{key:"editNotificationIsEnabled",get:function(){return!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("EditNotificationIsEnabled")}},{key:"editNotificationPostMessageIsEnabled",get:function(){return!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("EditNotificationPostMessageIsEnabled")}}],(n=[{key:"name",get:function(){return"Common.App.EditNotification"}}])&&T(t.prototype,n),i&&T(t,i),e}();Object(i.a)(w,"CommonHostNotificationPackage",null,[20,21]);var k,I=n(534),F=n(535),E=n(326),P=n(93);!function(e){e[e.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler",e[e.cloudPolicySettings=1]="cloudPolicySettings"}(k||(k={})),Object(i.b)("ApplicationFeatureHelperRequestType",k);var O=function(){this.message=null,this.httpStatusCode=0};Object(i.a)(O,"HttpRequstToPromiseRejectData",null,[]);var R=n(173);function M(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var x=function(){function e(e,t){this._appSettingsManager=e,this._clientRequestManager=t}var t=e.prototype;return t.createHttpResponsePromise=function(e,t,n,i,r,a,o,s){var c=this;void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null);var u=k[n],d=u+"RequestFailure";return l.Health.instance.recordKpiUsage(d,0,"jpittsdirects",null),new Promise((function(h,g){p.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",u);var m=null!=o?o:c._appSettingsManager.getIntAppSetting("ApplicationFeatureHelperRequestQueueTimeout",15e3),f=null!=s?s:c._appSettingsManager.getIntAppSetting("ApplicationFeatureHelperRequestSentTimeout",3e4);c._clientRequestManager.addRequestWithHeaderForwarding(e,1,null,c.getHeaders(n,i),a,!1,1,(function(e){p.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",u);try{if(null==e||void 0===e.data||null===e.data||void 0===e.data.responseData||null===e.data.responseData){l.Health.instance.recordKpiFailure(d,"Invalid RequestSucceededEventArgs",!1,!0,null);var n=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",u);return void g(c.getRejectData(n,e))}if(e.data.httpStatus!==R.a.OK_200){l.Health.instance.recordKpiFailure(d,"HttpStatusCode_"+e.data.httpStatus.toString(),!1,!0,null);var i=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",e.data.httpStatus,u);return void g(c.getRejectData(i,e))}null!=r&&void 0!==e.data.responseHeaders&&null!==e.data.responseHeaders&&r(e.data.responseHeaders);var a=t(e.data.responseData);if(!a){l.Health.instance.recordKpiFailure(d,"Parse Failure",!1,!0,null);var o=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",u);return void g(c.getRejectData(o,e))}p.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",u),h(a)}catch(t){l.Health.instance.recordKpiFailure(d,"Unexpected Failure",!1,!0,null);var s=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",t,u);g(c.getRejectData(s,e))}}),(function(e){p.ULS.sendTraceTag(50622691,3004,10,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} failed.",u);var t="";if(!e.data)return l.Health.instance.recordKpiFailure(d,"Invalid RequestFailedEventArgs",!1,!0,null),t=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",u),void g(c.getRejectData(t,e));l.Health.instance.recordKpiFailure(d,"HttpStatusCode_"+e.data.httpStatus.toString(),!1,!0,null),t=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",e.data.httpStatus,e.data.responseData||"No Data",u),g(c.getRejectData(t,e))}),null,void 0,void 0,m,f)}))},t.getRejectData=function(e,t){var n=new O;return n.message=e,t&&t.data?n.httpStatusCode=t.data.httpStatus:n.httpStatusCode=-1,n},t.getHeaders=function(e,t){var n={};if(n["x-UserDataSignature"]=this._appSettingsManager.getStringAppSetting("UserDataSignature"),n["x-LicensingIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingIsEnabled").toString(),n["x-CacheIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingRedisIsEnabled").toString(),n["x-OcpsIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("OcpsIsEnabled").toString(),n["x-LicensingAADIdIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingAadIdIsEnabled").toString(),e||(n["x-LicensingEduIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingEduIsEnabled").toString(),n["x-LicenseCheckOnTenantEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingForSafeLinksIsEnabled").toString()),t)for(var i,r=M(t.keys);!(i=r()).done;){var a=i.value;n[a]=t.get_item(a)}return n},e}();Object(i.a)(x,"HttpRequestToPromiseUtility",null,[]);var L=function(e,t,n){this.featureName=null,this.isEnabled=!1,this.tierName=0,this.featureName=e,this.isEnabled=t,this.tierName=n};Object(i.a)(L,"FeatureStateChangeArgs",null,[]);var B=n(34),U=n(161),H=n(9),N=n(54),W=n(116),j=n(19),V=n(269);function q(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return G(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var K=function(){function e(e,t,n,i,r){void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=null),this._stopWatchBuiler=null,this._licensingStopWatch=null,this._requestTime=null,this._responseTime=null,this.featuresPromise=null,this._httpRequestToPromise=new x(e,t),this._appSettingsManager=e,this._licensingMaxRetryAttempts=e.getIntAppSetting("LicensingMaxRetryAttempts",0),this._isO365ConsumerHost=e.getBooleanAppSetting("IsO365ConsumerHost"),this._isO365CommercialHost=e.getBooleanAppSetting("IsO365CommercialHost"),this._isFreemiumUpsellSettingEnabled=e.getBooleanAppSetting("PremiumUpsellIsEnabled"),this._cloudPolicySettingsHelper=n,this._userPrivacySettingsHelper=i,this._actionManager=r,this._licensingIsEnabled=e.getBooleanAppSetting("LicensingIsEnabled"),this._ocpsIsEnabled=e.getBooleanAppSetting("OcpsIsEnabled")&&this._isO365CommercialHost,this._userPrivacySettingsEnabled=e.getBooleanAppSetting("ShowPrivacyDialog")&&!!i,this._isAnonymousUser=e.getBooleanAppSetting("IsAnonymousUser"),this.falseBooleanPromise=new Promise((function(e,t){e(!1)})),this.trueBooleanPromise=new Promise((function(e,t){e(!0)})),this.featureStateChangeCallbacks=new I.a(F.a.get_ordinalIgnoreCase()),this._licensedControlledFeatureSet=this.getLicensedControlledFeatures(),this.isO365Host()&&!this._isAnonymousUser?(void 0!==s.AFrameworkApplication.activeFrame&&null!==s.AFrameworkApplication.activeFrame&&(this._stopWatchBuiler=s.AFrameworkApplication.activeFrame.theStopwatchBuilder,void 0!==this._stopWatchBuiler&&null!==this._stopWatchBuiler&&(this._licensingStopWatch=this._stopWatchBuiler.makeStopwatch("WebServiceCall","ApplicationFeatureHelperService"))),this.featuresPromise=this.tryInitializeLicensing()):this.featuresPromise=new Promise((function(e){e({})})),this.featuresPromise.catch((function(e){p.ULS.sendTraceTag(42513088,3004,10,JSON.stringify(e))}))}var t=e.prototype;return t.getLicensedControlledFeatures=function(){for(var e=this._appSettingsManager.containsAppSetting("AllLicensedFeatures")?this._appSettingsManager.getListAppSetting("AllLicensedFeatures"):new Array(0),t=new E.a,n=0;n<e.length;n++)t.add(e[n]);return t},t.isO365Host=function(){return this._isO365CommercialHost||this._isO365ConsumerHost},t.tryInitializeLicensing=function(e,t){var n=this;void 0===e&&(e=0),void 0===t&&(t=!1),p.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",t);var i=this.createExtendedPropertiesMap();i&&(i.set("retryAttempt",e.toString()),i.set("forceRefresh",t.toString()),i.set("isO365ConsumerHost",this._isO365ConsumerHost.toString()),i.set("isO365CommercialHost",this._isO365CommercialHost.toString()),i.set("isFreemiumUpsellEnabled",this._isFreemiumUpsellSettingEnabled.toString())),l.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",i),l.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",1,"waclicensing",i),void 0!==this._licensingStopWatch&&null!==this._licensingStopWatch&&this._licensingStopWatch.start();var a=null;return t&&(a=new I.a(F.a.get_ordinalIgnoreCase())).set_item("x-LicensingForceRefresh","true"),this._requestTime=new Date,(this._licensingIsEnabled?this._httpRequestToPromise.createHttpResponsePromise(this.getEndpointUrl("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(r.a)(this,this.parseApplicationFeatureHelperResponse,"parseApplicationFeatureHelperResponse"),0,a,Object(r.a)(this,this.processApplicationFeatureHelperResponseHeaders,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then((function(e){var t=Object.assign(new V.a,{durationMs:n.stopAndGetDurationInMsFromLicensingStopwatch()});return t.extendedProperties=i,t.extendedProperties&&e&&(t.extendedProperties.set("featureCount",N.a.count(e).toString()),t.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in e).toString()),t.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in e).toString()),n._responseTime&&t.extendedProperties.set("fromCache",(n._responseTime<n._requestTime).toString())),l.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",t),e}),(function(t){var r=Object.assign(new V.a,{durationMs:n.stopAndGetDurationInMsFromLicensingStopwatch()}),a=Object(P.a)(O,t);return a?(r.extendedProperties=i,r.extendedProperties&&r.extendedProperties.set("status",a.httpStatusCode.toString()),l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","RequestFailed",!1,!0,r),408===a.httpStatusCode&&++e<=n._licensingMaxRetryAttempts?n.tryInitializeLicensing(e):new Promise((function(e,t){t(a)}))):(p.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,r),new Promise((function(e,n){n(t)})))}))},t.parseApplicationFeatureHelperResponse=function(e){var t=B.a(e);return t?(p.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),p.ULS.sendTraceTag(50938594,3004,50,"{0}",t)):p.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set. Response was {0}",e),t.Features},t.getEndpointUrl=function(t){var n=String.format("{0}{1}",this._appSettingsManager.getStringAppSetting("WebServiceBase"),t);if(this._appSettingsManager.containsAppSetting("ApplicationFeatureHelperHttpCachingEnabled")&&this._appSettingsManager.getBooleanAppSetting("ApplicationFeatureHelperHttpCachingEnabled")){var i=e.getLocalStorageCacheKey(this._appSettingsManager);if(i&&i.length>0){var r=new U.QueryStringBuilder(n);r.addParam("afhskey",i),n=r.toString()}}return n},t.isFeatureEnabled=function(e,t){var n=this;if(!this._ocpsIsEnabled&&!this._userPrivacySettingsEnabled&&!this._licensingIsEnabled)return this.trueBooleanPromise;if(p.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",e),"ConnectedServices"===e){var i=this._ocpsIsEnabled?this._cloudPolicySettingsHelper.getBooleanPolicySetting("ControllerConnectedServicesEnabled"):this.trueBooleanPromise,r=this._userPrivacySettingsEnabled?this._userPrivacySettingsHelper.getSettings().then((function(e){return 2!==e.controllerServicesStateRoaming}),(function(e){return t})):this.trueBooleanPromise;return i.then((function(e){return e?r:n.falseBooleanPromise}))}var a=null;a=this._ocpsIsEnabled?this._cloudPolicySettingsHelper.isFeatureEnabled(e):this.trueBooleanPromise;var o=null;o=this._licensingIsEnabled?this.isFeatureAllowedByUserLicense(e,t):this.trueBooleanPromise;var s=null;return s=this._userPrivacySettingsEnabled?this._userPrivacySettingsHelper.isFeatureEnabled(e):this.trueBooleanPromise,a.then((function(e){return e?s.then((function(e){return e?o:n.falseBooleanPromise})):n.falseBooleanPromise})).then((function(e){return e}),(function(e){return t}))},t.getFeatureTier=function(e,t){var n=this;return this._licensingIsEnabled?(p.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",e),this.featuresPromise.then((function(i){return e in i?n.parseTierName(i[e],t):t}),(function(e){return t}))):new Promise((function(e,t){e(2)}))},t.isFreemiumUpsellEnabled=function(){return this._isFreemiumUpsellSettingEnabled&&this._isO365ConsumerHost&&!this._isAnonymousUser},t.launchUpsellExperience=function(e,t){void 0===t&&(t=null),p.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",e));var n=this.createExtendedPropertiesMap();n&&(n.set("experienceId",e),t&&n.set("campaignId",t)),l.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",n);var i=j.a.instance.tryResolve("Common.IInProductMessagingUIManager");if(i){var a=Object(r.a)(this,this.handleDimeTaskComplete,"handleDimeTaskComplete");i.launchDimeExperience(e,a,t)}else{var o;p.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this._actionManager.processActionWithData(h.a.freemiumUpsellEligible,2,((o={}).experience=e,o))}},t.registerFeatureStateChangeCallback=function(e,t){if(!this._licensingIsEnabled)return null;if(!e||!t)return p.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),null;var n=W.a.create().toString();return this.featureStateChangeCallbacks.containsKey(e)||this.featureStateChangeCallbacks.set_item(e,new I.a(F.a.get_ordinalIgnoreCase())),this.featureStateChangeCallbacks.get_item(e).add(n,t),p.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",n,e)),n},t.removeFeatureStateChangeCallback=function(e,t){return!!this._licensingIsEnabled&&(e&&this.featureStateChangeCallbacks.containsKey(e)?t&&W.a.isValid(t)?this.featureStateChangeCallbacks.get_item(e).containsKey(t)?(p.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",t,e)),this.featureStateChangeCallbacks.get_item(e).remove(t)):(p.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",t,e)),!1):(p.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",t,e)),!1):(p.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",e)),!1))},t.parseTierName=function(e,t){switch(e.toLowerCase()){case"unknown":return 0;case"basic":return 1;case"premium":return 2;default:return t}},t.handleDimeTaskComplete=function(){var e=this;p.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete"),this.featuresPromise.then((function(t){e.refreshLicensingAndNotifyUpdatedFeatures(t)})).catch((function(t){e.refreshLicensingAndNotifyUpdatedFeatures({})}))},t.refreshLicensingAndNotifyUpdatedFeatures=function(e){var t=this;p.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");var n=this.tryInitializeLicensing(0,!0);n.then((function(i){t.featuresPromise=n,N.a.count(i)>N.a.count(e)?l.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(var r,a=q(t.featureStateChangeCallbacks.keys);!(r=a()).done;){var o=r.value;if(o in i){var s=t.parseTierName(i[o],0);if(o in e)t.parseTierName(e[o],0)!==s&&t.notifyFeatureStateChanged(o,!0,s);else t.notifyFeatureStateChanged(o,!0,s)}else o in e&&t.notifyFeatureStateChanged(o,!1,t.parseTierName(e[o],0))}})).catch((function(e){l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null),p.ULS.sendTraceTag(594051086,3004,10,JSON.stringify(e))}))},t.notifyFeatureStateChanged=function(e,t,n){p.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",e,t,n);for(var i,r=new L(e,t,n),a=q(this.featureStateChangeCallbacks.get_item(e));!(i=a()).done;){var o=i.value;try{o.value(r)}catch(t){p.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",e,o.key,t.message))}}},t.isFeatureAllowedByUserLicense=function(e,t){return this._licensingIsEnabled?this._licensedControlledFeatureSet.contains(e)?this.featuresPromise.then((function(t){return e in t}),(function(e){return t})):(p.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",e),this.trueBooleanPromise):this.trueBooleanPromise},t.processApplicationFeatureHelperResponseHeaders=function(e){try{e&&"Date"in e&&(this._responseTime=new Date(e.Date),p.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this._responseTime.toString()))}catch(e){p.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",e)}},t.createExtendedPropertiesMap=function(){try{return new Map}catch(e){return null}},t.stopAndGetDurationInMsFromLicensingStopwatch=function(){if(void 0!==this._licensingStopWatch&&null!==this._licensingStopWatch){var e=this._licensingStopWatch.ageInMilliseconds;return this._licensingStopWatch.stop(),e}return null},e.getLocalStorageCacheKey=function(e){try{if(H.a.supportsWindowAtob){var t=e.getStringAppSetting("UserDataSignature").split(".");if(t.length>1){var n=window.self.atob(t[1]),i=JSON.parse(n).LocalStorageKey;if(null!=i&&i.length>0)return i}}}catch(e){p.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",e.toString())}return null},e}();Object(i.a)(K,"ApplicationFeatureHelper",null,[375]);var z=n(138),X=function(e,t){this.PolicySettings=null,this.ExpirationTime=0,this.PolicySettings=e.PolicySettings;var n=new Date;n.setMinutes(n.getMinutes()+t),this.ExpirationTime=n.getTime()};function J(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(X,"CloudPolicySettingsCacheData",null,[]);var Q=function(){function e(){this._localStorageNotWorking=!1}var t,n,i,r=e.prototype;return r.getItem=function(t){try{if(e.isValidKey(t)&&this.localStorage)return this.localStorage.getItem(t)}catch(e){p.ULS.sendTraceTag(593512200,306,15,"LocalStorageWrapper Exception: {0} ",e.message)}return null},r.setItem=function(t,n){try{e.isValidKey(t)&&this.localStorage&&this.localStorage.setItem(t,n)}catch(e){p.ULS.sendTraceTag(593512199,306,15,"LocalStorageWrapper Exception: {0} ",e.message)}},r.removeItem=function(t){try{e.isValidKey(t)&&this.localStorage&&this.localStorage.removeItem(t)}catch(e){p.ULS.sendTraceTag(593512198,306,15,"LocalStorageWrapper Exception: {0} ",e.message)}},e.isValidKey=function(e){return!(null==e||e.length<=0)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}],(n=[{key:"localStorage",get:function(){var e=null;if(!this._localStorageNotWorking)try{localStorage&&(e=localStorage)}catch(e){this._localStorageNotWorking=!0}return e}}])&&J(t.prototype,n),i&&J(t,i),e}();Q._instance=null,Object(i.a)(Q,"LocalStorageWrapper",null,[298]);var Z=n(132),Y=n(129),$=function(){function e(){}return e.sideCarIsAvailable=function(){return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SideCarIsEnabled")?e.scriptResourceWithAction&&e.isDownloaded?new Promise((function(e){e(!0)})):new Promise((function(t,n){e.scriptResourceWithAction=Y.a.create(s.AFrameworkApplication.appSettingsManager.getStringAppSetting("SideCarUrl")),Z.a.enqueueResourceWithoutEnabling(e.scriptResourceWithAction),e.scriptResourceWithAction.add_loadFinished((function(i,r){e.isDownloaded=r.succeeded,r.succeeded?t(r.succeeded):n(r.succeeded)}))})):new Promise((function(e){e(!1)}))},e}();$.isDownloaded=!1,$.scriptResourceWithAction=null,Object(i.a)($,"SideCarLoader",null,[]);var ee=function(){this.PolicySettings=null,this.ControllerConnectedServicesFeatureNames=null};function te(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ne(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ne(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}Object(i.a)(ee,"CloudPolicySettingsData",null,[]);var ie=function(){function e(e,t){this._checkInInterval=0,this.cloudPolicySettingsPromise=null,this._httpRequestToPromise=new x(e,t),this._appSettingsManager=e;var n=e.getStringAppSetting("HostAuthType");this._ocpsIsEnabled=e.getBooleanAppSetting("OcpsIsEnabled")&&e.getBooleanAppSetting("IsO365CommercialHost")&&!(null==n)&&"aad"===n.toLowerCase(),this._ocpsPolicyDefaults=B.b(e.getStringAppSetting("OcpsDefaultSettings")||"{}"),this._localStorageCacheKey=this.getLocalStorageCacheKey();var i=this._appSettingsManager.containsAppSetting("ServicesControlsMicrosoftControllerServicesList")&&this._appSettingsManager.getListAppSetting("ServicesControlsMicrosoftControllerServicesList")||new Array(0);this._controllerConnectedServicesSet=new E.a;for(var a=0;a<i.length;a++)this._controllerConnectedServicesSet.add(i[a]);var o=this._ocpsIsEnabled&&!e.getBooleanAppSetting("IsAnonymousUser")&&e.getBooleanAppSetting("SideCarIsEnabled");this.cloudPolicySettingsPromise=o?this.tryInitializeWithSideCar():this.tryInitialize(this._ocpsIsEnabled,this.getEndpointUrl("/afhs/CloudPolicySettings.ashx"),Object(r.a)(this,this.parseCloudPolicySettingsResponse,"parseCloudPolicySettingsResponse")),this.cloudPolicySettingsPromise.then((function(e){return null})).catch((function(e){p.ULS.sendTraceTag(50622685,3004,10,JSON.stringify(e))}))}var t=e.prototype;return t.getBooleanPolicySetting=function(e,t){if(void 0===t&&(t=!0),!this._ocpsIsEnabled){var n=this;return new Promise((function(t,i){t(n.getOcpsBooleanPolicyDefault(e))}))}var i=this,r=this,a=this.cloudPolicySettingsPromise.then((function(n){try{var r=null,a="unknown".toLowerCase();if(n.PolicySettings&&a in n.PolicySettings&&(r=n.PolicySettings[a]),r){if(e in r&&void 0!==r[e]&&null!==r[e])return new Promise((function(t,n){t("0"!==r[e])}));var o=e.toLowerCase();return o in r&&void 0!==r[o]&&null!==r[o]?new Promise((function(e,t){e("0"!==r[o])})):(p.ULS.sendTraceTag(51512667,3004,50,"Policy"+e+" not found, using default"),new Promise((function(t,n){t(i.getOcpsBooleanPolicyDefault(e))})))}return new Promise((function(t,n){t(i.getOcpsBooleanPolicyDefault(e))}))}catch(n){return p.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+e+" policy value. Error Message: {0}",n.message),i.handleError(n.toString(),t,i.getOcpsBooleanPolicyDefault(e))}}),(function(n){return r.handleError(n,t,r.getOcpsBooleanPolicyDefault(e))}));return a.then((function(t){return p.ULS.sendTraceTag(50651667,3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",e,t),null})),a},t.isFeatureEnabled=function(e,t){if(void 0===t&&(t=!0),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.isFeatureEnabledV2(e,t);var n=new Promise((function(e,t){e(!0)})),i="";return this._controllerConnectedServicesSet.contains(e)&&(i="ControllerConnectedServicesEnabled",n=this.getBooleanPolicySetting(i,t)),n.then((function(t){return p.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",e,t,i),null})),n},t.isFeatureEnabledV2=function(e,t){void 0===t&&(t=!0);var n=new Promise((function(e,t){e(!0)})),i="";return"mso_sendASmile"===e?i="Enabled":"Survey"===e?i="SurveyEnabled":this._controllerConnectedServicesSet.contains(e)&&(i="ControllerConnectedServicesEnabled"),""!==i&&(n=this.getBooleanPolicySetting(i,t)),n.then((function(t){return p.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",e,t,i),null})),n},t.handleError=function(e,t,n){return new Promise(t?function(e,t){e(n)}:function(t,n){n(e)})},t.tryInitialize=function(e,t,n){var i=this;if(!e)return Promise.resolve(new ee);var a=!1,o=null;l.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);var s=this.createAndStartStopwatch("GetCloudPolicySettings");return new Promise((function(e,o){if(void 0!==i._localStorageCacheKey&&null!==i._localStorageCacheKey&&i._localStorageCacheKey.length>0){var s=i.tryGetCloudPolicySettingsDataFromCache();if(null!=s)return a=!0,void e(s)}i._httpRequestToPromise.createHttpResponsePromise(t,n,1,null,Object(r.a)(i,i.processCloudPolicySettingsResponseHeaders,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],i._appSettingsManager.getIntAppSetting("CloudPolicySettingsRequestQueueTimeout",15e3),i._appSettingsManager.getIntAppSetting("CloudPolicySettingsRequestSentTimeout",3e4)).then((function(t){return p.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS"),i.trySetCloudPolicySettingsDataIntoCache(t),e(t),t}),(function(e){return o(e),null}))})).then((function(e){var t=i.stopAndGetDurationInMsFromStopwatch(s);s=t.stopwatch,o=t.returnValue;var n=i.createMap();n&&n.set("FromCache",a.toString());var r=Object.assign(new V.a,{durationMs:o,extendedProperties:n});return l.Health.instance.recordKpiSuccess("GetCloudPolicySettings",r),e}))},t.tryInitializeWithSideCar=function(){return $.sideCarIsAvailable().then((function(e){return p.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar"),sidecar.cloudPolicy.GetCloudPolicySettingsData()}))},t.getEndpointUrl=function(e){return String.format("{0}{1}",this._appSettingsManager.getStringAppSetting("WebServiceBase"),e)},t.parseCloudPolicySettingsResponse=function(e){var t=null;return t=B.d(e,t).deserialized,p.ULS.sendTraceTag(50622687,3004,t?50:10,"ParseCloudPolicySettingsResponse: fetched CloudPolicySettingsData from {0}",e),t},t.processCloudPolicySettingsResponseHeaders=function(e){try{if(null==e)return;if("CheckIn-Interval"in e){var t=parseInt(e["CheckIn-Interval"]);null!=t&&t>0&&(this._checkInInterval=t)}}catch(e){p.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",e)}},t.getOcpsBooleanPolicyDefault=function(e){return!(e in this._ocpsPolicyDefaults)||"0"!==this._ocpsPolicyDefaults[e]},t.tryGetCloudPolicySettingsDataFromCache=function(){try{var e=Q.instance.getItem(this._localStorageCacheKey);if(null==e)return p.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),null;p.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",e);var t=JSON.parse(e);if(null==t)return p.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===t.ExpirationTime||null===t.ExpirationTime)return p.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),null;if(new Date(t.ExpirationTime).getTime()<Date.now())return p.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),null;var n=new ee;n.PolicySettings=t.PolicySettings,n.ControllerConnectedServicesFeatureNames=new z.a;this._appSettingsManager.containsAppSetting("ServicesControlsMicrosoftControllerServicesList")?this._appSettingsManager.getListAppSetting("ServicesControlsMicrosoftControllerServicesList"):new Array(0);for(var i,r=te(this._controllerConnectedServicesSet);!(i=r()).done;){var a=i.value;n.ControllerConnectedServicesFeatureNames.add(a)}return p.ULS.sendTraceTag(51662941,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved"),n}catch(e){return p.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",e.toString()),null}},t.trySetCloudPolicySettingsDataIntoCache=function(e){try{if(null==e||void 0===e.PolicySettings||null===e.PolicySettings)p.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(this._checkInInterval<=0)p.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");else{var t=new X(e,this._checkInInterval),n=JSON.stringify(t);p.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",n),Q.instance.setItem(this._localStorageCacheKey,n),p.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(e){p.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",e.toString())}},t.getLocalStorageCacheKey=function(){var e=K.getLocalStorageCacheKey(this._appSettingsManager);return e&&e.length>0?"OCPS"+e:null},t.createMap=function(){try{return new Map}catch(e){return null}},t.createAndStartStopwatch=function(e){var t=j.a.instance.tryResolve("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");return null!=t?t.makeAndStartStopwatch("WebServiceCall",e):null},t.stopAndGetDurationInMsFromStopwatch=function(e){if(null!=e){var t=e.ageInMilliseconds;return e.stop(),{returnValue:t,stopwatch:e=null}}return{returnValue:null,stopwatch:e}},e}();function re(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ie,"CloudPolicySettingsHelper",null,[373]);var ae=function(){function e(){this.controllerServicesStateRoaming=0,this.userContentStateRoaming=0,this.downloadContentStateRoaming=0,this.controllerServicesTimeRoaming="",this.userContentTimeRoaming="",this.downloadContentTimeRoaming="",this.userPrivacySettingsRoamedNoticeShown=2,this._src=2}var t,n,i,r=e.prototype;return r.clone=function(){var t=new e;return t.controllerServicesStateRoaming=this.controllerServicesStateRoaming,t.userContentStateRoaming=this.userContentStateRoaming,t.downloadContentStateRoaming=this.downloadContentStateRoaming,t.controllerServicesTimeRoaming=this.controllerServicesTimeRoaming,t.userContentTimeRoaming=this.userContentTimeRoaming,t.downloadContentTimeRoaming=this.downloadContentTimeRoaming,t.userPrivacySettingsRoamedNoticeShown=this.userPrivacySettingsRoamedNoticeShown,t._src=this.src,t},r.serialize=function(t){void 0===t&&(t=null);var n={};return t&&!t.contains(e.officePrivacyControllerConnectedServicesKey)||(n[e.officePrivacyControllerConnectedServicesKey]=this.controllerServicesStateRoaming),t&&!t.contains(e.officePrivacyControllerConnectedServicesTimeKey)||(n[e.officePrivacyControllerConnectedServicesTimeKey]=this.controllerServicesTimeRoaming),t&&!t.contains(e.officePrivacyRoamedNoticeShownKey)||(n[e.officePrivacyRoamedNoticeShownKey]=this.userPrivacySettingsRoamedNoticeShown),JSON.stringify(n)},e.create=function(t,n){void 0===n&&(n=null);var i=new e;return i._src=t,null!=n&&(e.officePrivacyControllerConnectedServicesKey in n&&(i.controllerServicesStateRoaming=n[e.officePrivacyControllerConnectedServicesKey]),e.officePrivacyControllerConnectedServicesTimeKey in n&&(i.controllerServicesTimeRoaming=n[e.officePrivacyControllerConnectedServicesTimeKey]),e.officePrivacyRoamedNoticeShownKey in n&&(i.userPrivacySettingsRoamedNoticeShown=n[e.officePrivacyRoamedNoticeShownKey])),i},e.deserialize=function(t,n){try{var i=JSON.parse(t);if(null!=i)return e.create(n,i);throw p.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",t),Error.argument("settingsData")}catch(e){throw p.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",e.toString()),e}},t=e,(n=[{key:"src",get:function(){return this._src}}])&&re(t.prototype,n),i&&re(t,i),e}();ae.officePrivacyControllerConnectedServicesKey="CCS",ae.officePrivacyControllerConnectedServicesTimeKey="CCSTime",ae.officePrivacyRoamedNoticeShownKey="OfficePrivacyRoamedNoticeShown",Object(i.a)(ae,"UserPrivacySettings",null,[]);var oe=n(79),se=function(){function e(e,t){if(null==e||null==t)throw Error.argumentNull("appSettingsManager/clientRequestManager");this._appSettingsManager=e,this._clientRequestManager=t,this._settings=null,this._settingsPromise=null}var t=e.prototype;return t.getEndpointUrl=function(e){var t=this._appSettingsManager.appSettings.RoamingServiceHandlerWebServiceBase||"",n=String.format("{0}RoamingServiceHandler.ashx?action=",t),i=new Sys.StringBuilder(n);return i.append(e),i.append("&"),i.append(s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),i.toString()},t.executeRequest=function(e,t,n,i){return void 0===i&&(i=null),this._clientRequestManager.addRequestWithTaskAndStopWatch(e,t,i,null,!1,2,null,n,"33",!1,null,6e4)},t.saveSettings=function(e){var t=this;return new Promise((function(n,i){try{if(void 0===t._settings||null===t._settings||null==e)return p.ULS.sendTraceTag(51258443,3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),void i("Can't determine setting changes to save");var r=t._settings.controllerServicesStateRoaming!==e.controllerServicesStateRoaming;if(2===t._settings.src&&r)return t.saveSettingsToQueryParam(e),void n(!0);var a=t.serializeSettingUpdates(e);if(null==a||!a.length)return p.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),void i("No changes to save");if(1===t._settings.src)return void n(t.trySaveSettingsToCookie(a));if(!t._settings.src){p.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",a);var o=t.executeRequest(t.getEndpointUrl("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",a);o.continueWith((function(e){if(o.isCanceled||o.isFaulted)return p.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),void n(!1);var t=o.result;void 0!==t.args&&null!==t.args&&void 0!==t.args.data&&null!==t.args.data&&t.args.data.httpStatus===R.a.OK_200?(p.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),n(!0)):(p.ULS.sendTraceTag(51258446,3004,10,"SaveUserPrivacySettings: Roaming Request Failed"),n(!1))}))}}catch(e){p.ULS.sendTraceTag(50860930,3004,10,"SaveUserPrivacySettings: Exception = {0}",e.toString()),n(!1)}}))},t.serializeSettingUpdates=function(e){if(void 0===this._settings||null===this._settings||null==e)throw Error.invalidOperation("User Privacy settings have not been initialized");var t=new z.a;return e.src?1===e.src&&this._settings.controllerServicesStateRoaming!==e.controllerServicesStateRoaming&&t.add(ae.officePrivacyControllerConnectedServicesKey):(this._settings.controllerServicesStateRoaming!==e.controllerServicesStateRoaming&&(t.add(ae.officePrivacyControllerConnectedServicesKey),t.add(ae.officePrivacyControllerConnectedServicesTimeKey)),this._settings.userPrivacySettingsRoamedNoticeShown!==e.userPrivacySettingsRoamedNoticeShown&&t.add(ae.officePrivacyRoamedNoticeShownKey)),t.count?e.serialize(t):(p.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),null)},t.getSettings=function(){if(!this._settingsPromise){var e=this;this._settingsPromise=new Promise((function(t,n){try{if(e._settings)return void t(e._settings.clone());e.tryGetSettingsFromRoaming().then((function(n){return e._settings=n,t(e._settings.clone()),null}),(function(n){return e.tryGetSettingsFromCookie().then((function(n){return e._settings=n,t(e._settings.clone()),null}),(function(n){return e.tryGetSettingsFromQueryParams().then((function(n){return e._settings=n,t(e._settings.clone()),null}),(function(n){return p.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)"),e._settings=new ae,t(e._settings.clone()),null})),null})),null}))}catch(n){p.ULS.sendTraceTag(50860932,3004,10,"UserPrivacySettings GetSettings: Exception = {0}",n.toString()),e._settings=new ae,t(e._settings.clone())}}))}return this._settingsPromise},t.tryGetSettingsFromRoaming=function(){var t=this;return new Promise((function(n,i){try{var r=-1!==window.location.href.indexOf("&wd_pn=2");if(!t._appSettingsManager.getBooleanAppSetting("PrivacyDialogShouldCheckRoaming")&&!r)return p.ULS.sendTraceTag(50860933,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),void i("Roaming should not be used");var a=t.executeRequest(t.getEndpointUrl("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");a.continueWith((function(t){try{if(!a.isCanceled&&!a.isFaulted){var r=a.result;if(r&&r.args&&r.args.data)if(r.args.data.httpStatus!==R.a.OK_200)p.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",r.args.data.httpStatus);else{if(r.args.data.responseData)return n(e.parse(r.args.data.responseData,0)),void p.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",r.args.data.responseData);p.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else p.ULS.sendTraceTag(50860935,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");return void i("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}p.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure")}catch(e){return p.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",e.toString()),void i("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}}))}catch(e){return p.ULS.sendTraceTag(50860939,3004,10,"TryGetSettingsFromRoaming Exception = {0}",e.toString()),void i("UserPrivacySettings TryGetSettingsFromRoaming Exception")}}))},t.tryGetSettingsFromCookie=function(){var t=this;return new Promise((function(n,i){try{var r=oe.a.get("WacUPToggleState"),a=null;if(null!=r&&r.length>0&&(a=decodeURIComponent(r)),null!=a&&a.length>0){var o=e.parse(a,1);return p.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",o.toString()),void n(o)}var s=ae.create(1),l=new z.a;l.add(ae.officePrivacyControllerConnectedServicesKey);var c=s.serialize(l);return t.trySaveSettingsToCookie(c)?(p.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",c),void n(s)):(p.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",c),void i("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}catch(e){p.ULS.sendTraceTag(50860941,3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",e.toString()),i("UserPrivacySettings TryGetSettingsFromCookie Eception")}}))},t.tryGetSettingsFromQueryParams=function(){return new Promise((function(e,t){try{var n=-1!==window.location.href.indexOf("&wdccsoff=1"),i=ae.create(2);return n?(i.controllerServicesStateRoaming=2,s.AFrameworkApplication.disableControllerServicesViaQueryParam(),p.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",i.toString())):(i.controllerServicesStateRoaming=1,p.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",i.toString())),void e(i)}catch(t){p.ULS.sendTraceTag(50967431,3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",t.toString());var r=ae.create(2);r.controllerServicesStateRoaming=1,e(r)}}))},t.saveSettingsToQueryParam=function(e){return p.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam"),2===e.controllerServicesStateRoaming?s.AFrameworkApplication.disableControllerServicesViaQueryParam():s.AFrameworkApplication.enableControllerServicesViaQueryParam(),p.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",e),!0},t.trySaveSettingsToCookie=function(e){try{p.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",e);var t=this._appSettingsManager.getStringAppSetting("PrivacyCookieDomain")||"";if(!t||!t.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");return p.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",e),oe.a.setWithAllTheThings("WacUPToggleState",e,oe.a.maxComplianceAllowedRetentionInDays,"/",t)}catch(e){return p.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",e.toString()),!1}},t.isFeatureEnabled=function(e){var t=this;return this.getSettings().then((function(n){for(var i=t._appSettingsManager.containsAppSetting("ServicesControlsMicrosoftControllerServicesList")?t._appSettingsManager.getListAppSetting("ServicesControlsMicrosoftControllerServicesList"):new Array(0),r=new E.a,a=0;a<i.length;a++)r.add(i[a]);return!r.contains(e)||2!==n.controllerServicesStateRoaming}),(function(t){return p.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",e),!0}))},e.parse=function(e,t){try{return p.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",e,t),ae.deserialize(e,t)}catch(e){throw p.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",e.toString()),e}},e}();function le(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(se,"UserPrivacySettingsHelper",null,[374]);var ce=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.configure=function(e){var t=this;this._container=e,this._container.register(373,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").singleInstance().usingFactory((function(){return new ie(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager)})),this._container.register(374,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").singleInstance().usingFactory((function(){return new se(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager)})),this._container.register(375,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").singleInstance().usingFactory((function(){return new K(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager,t._container.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),t._container.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),s.AFrameworkApplication.theActionManager)}))},r.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){var t=e._container.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("LicensingIsEnabled")&&(t.isFeatureEnabled("LicensingTestFeature",!1).then((function(e){return p.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",e,s.AFrameworkApplication.appSettingsManager.getStringAppSetting("IsAnonymousUser")),null})),t.getFeatureTier("LicensingTestFeature",0).then((function(e){return p.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",e,s.AFrameworkApplication.appSettingsManager.getStringAppSetting("IsAnonymousUser")),null}))),e.temporarySideCarVerifier()}))},r.dispose=function(){},r.temporarySideCarVerifier=function(){try{s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SideCarIsEnabled")&&$.sideCarIsAvailable().then((function(e){return p.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",e),e}))}catch(e){return}},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}}])&&le(t.prototype,n),i&&le(t,i),e}();Object(i.a)(ce,"ApplicationFeatureHelperPackage",null,[20,21]);var ue=n(37),de=n(219),he=n(44),pe=function(){function e(e,t){this._environmentString=null,this._actionManager=e,this._appSettingsManager=t}var t=e.prototype;return t.registerActions=function(){this._environmentString=this._appSettingsManager.getStringAppSetting("StatusBarEnvironmentNameToUse"),this._environmentString&&""!==this._environmentString&&this._actionManager.addActionWithFlags(h.a.queryEnvironmentName,ue.a.frame,Object(r.a)(this,this.updateEnvironmentName,"updateEnvironmentName"),96)},t.updateEnvironmentName=function(e,t,n,i,r){if(1===n)return 32;var a=r;return a[de.a.Value]=this._environmentString,a[he.a.labelText]=this._environmentString,a[de.a.Visible]=!0,32},e}();function ge(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(pe,"DisplayEnvironmentName",null,[]);var me=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.configure=function(e){this._container=e,this._container.register(pe,"Common.App.DisplayEnvironmentName.DisplayEnvironmentName").singleInstance().usingFactory((function(){return new pe(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.appSettingsManager)}))},r.init=function(){this._container.resolve("Common.App.DisplayEnvironmentName.DisplayEnvironmentName").registerActions()},r.dispose=function(){},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.DisplayEnvironmentName"}}])&&ge(t.prototype,n),i&&ge(t,i),e}();Object(i.a)(me,"DisplayEnvironmentNamePackage",null,[20,21]);var fe=function(){this.x=0,this.y=0};function _e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(fe,"HammerPoint",null,[]);var ve=function(){function e(e,t,n,i,r){this._initialPinchScale=1,this._initialDocumentScale=1,this._lastRelativeScale=1,this._unscaledAbsolutePinchStartX=0,this._unscaledAbsoluteLeftPageMargin=0,this._unscaledAbsolutePinchStartY=0,this._containerBounds=null,this._nextUiUpdateTime=null,this._promoteLayerPinchToZoomIsEnabled=!1,this._finalizeWithInitialPinchScaleIsEnabled=!1,this._adjustPinchStartXWithPageMarginIsEnabled=!1,this._futureZoomManager=e,this._scrollContainer=t,this._scrollable=n,this._actionManager=i,r&&(this._promoteLayerPinchToZoomIsEnabled=r.getBooleanAppSetting("PromoteLayerPinchToZoomIsEnabled"),this._finalizeWithInitialPinchScaleIsEnabled=r.getBooleanAppSetting("FinalizeWithInitialPinchScaleIsEnabled"),this._adjustPinchStartXWithPageMarginIsEnabled=r.getBooleanAppSetting("AdjustPinchStartXWithPageMarginIsEnabled"))}var t,n,i,r=e.prototype;return r.isGesturePossible=function(e){return!!this._futureZoomManager.instance},r.onGestureStart=function(e){this._actionManager&&this._actionManager.processAction(h.a.startPinchToZoom,2);var t=this.getZoomManager();if(this._promoteLayerPinchToZoomIsEnabled&&t.raisePinchStartEvent(),this._initialDocumentScale=t.currentZoom,this._initialPinchScale=e.gestureData.scale,this._lastRelativeScale=1,this._nextUiUpdateTime=this.calculateNextUiControlUpdateTime(),this._containerBounds=this._scrollContainer.getBounds(),!this._containerBounds)return p.ULS.sendTraceTag(42821145,353,15,"Unexpected null bounds"),!1;var n=this.getPinchCenterRelativeToContainer(e);return this._adjustPinchStartXWithPageMarginIsEnabled?this.setOrUpdatePinchStartX(this._scrollContainer.scrollWidth,this._containerBounds.width,n,this._initialDocumentScale,t):this._unscaledAbsolutePinchStartX=this._scrollContainer.scrollWidth>this._containerBounds.width?this.calculateAbsolutePinchStartPos(this._scrollable.scrollLeft,n.x,this._initialDocumentScale):null,this._unscaledAbsolutePinchStartY=this._scrollContainer.scrollHeight>this._containerBounds.height?this.calculateAbsolutePinchStartPos(this._scrollable.scrollTop,n.y,this._initialDocumentScale):null,!0},r.resetPinchStartX=function(){this._unscaledAbsolutePinchStartX=null,this._unscaledAbsoluteLeftPageMargin=0},r.setOrUpdatePinchStartX=function(e,t,n,i,r){if(e>t)if(this._unscaledAbsolutePinchStartX){var a=r.leftPageMargin;if(a!==this._unscaledAbsoluteLeftPageMargin){var o=this._unscaledAbsoluteLeftPageMargin-a;this._unscaledAbsolutePinchStartX=this._unscaledAbsolutePinchStartX-o,this._unscaledAbsoluteLeftPageMargin=a}}else this._unscaledAbsolutePinchStartX=this.calculateAbsolutePinchStartPos(this._scrollable.scrollLeft,n.x,i),this._unscaledAbsoluteLeftPageMargin=r.leftPageMargin;else this.resetPinchStartX()},r.onGestureEvent=function(e){var t=this.getPinchCenterRelativeToContainer(e);if(!t)return p.ULS.sendTraceTag(42821147,353,15,"Unexpected null pinch center"),!1;var n=this.setFilteredRelativeScale(e.gestureData.scale/this._initialPinchScale)*this._initialDocumentScale;return this.updateScrollLeft(t,n),this.updateScrollTop(t,n),!0},r.updateScrollLeft=function(e,t){var n=this._scrollContainer.scrollWidth,i=this._containerBounds.width;this._adjustPinchStartXWithPageMarginIsEnabled?this.setOrUpdatePinchStartX(n,i,e,t,this.getZoomManager()):!this._unscaledAbsolutePinchStartX&&n>i&&(this._unscaledAbsolutePinchStartX=this.calculateAbsolutePinchStartPos(this._scrollable.scrollLeft,e.x,t));var r=this.calculateScrollPosition(e.x,this._unscaledAbsolutePinchStartX,n,i,t);r&&(this._scrollable.scrollLeft=r)},r.updateScrollTop=function(e,t){var n=this._scrollContainer.scrollHeight,i=this._containerBounds.height;!this._unscaledAbsolutePinchStartY&&n>i&&(this._unscaledAbsolutePinchStartY=this.calculateAbsolutePinchStartPos(this._scrollable.scrollTop,e.y,t));var r=this.calculateScrollPosition(e.y,this._unscaledAbsolutePinchStartY,n,i,t);r&&(this._scrollable.scrollTop=r)},r.calculateScrollPosition=function(e,t,n,i,r){if(n<=i||!t||!i)return null;var a=t*r-e,o=n-i;return Math.max(0,Math.min(a,o))},r.calculateAbsolutePinchStartPos=function(e,t,n){return(e+t)/n},r.onGestureEnd=function(e){var t=e.gestureData.scale;this._finalizeWithInitialPinchScaleIsEnabled&&(t/=this._initialPinchScale),this.finalizeRelativeScale(t),this._promoteLayerPinchToZoomIsEnabled&&this.getZoomManager().raisePinchEndEvent(),this._actionManager&&this._actionManager.processAction(h.a.endPinchToZoom,2),this._adjustPinchStartXWithPageMarginIsEnabled&&this.resetPinchStartX()},r.onGestureCancel=function(e){var t=e.gestureData.scale;this._finalizeWithInitialPinchScaleIsEnabled&&(t/=this._initialPinchScale),this.finalizeRelativeScale(t,!0),this._promoteLayerPinchToZoomIsEnabled&&this.getZoomManager().raisePinchEndEvent(),this._actionManager&&this._actionManager.processAction(h.a.endPinchToZoom,2),this._adjustPinchStartXWithPageMarginIsEnabled&&this.resetPinchStartX()},r.getZoomManager=function(){return this._futureZoomManager.instance},r.setFilteredRelativeScale=function(e){var t=this.getZoomManager(),n=new Date>=this._nextUiUpdateTime;return n&&(this._nextUiUpdateTime=this.calculateNextUiControlUpdateTime()),Math.abs(e-this._lastRelativeScale)>=.01*e&&t.setZoomDuringResize(e*this._initialDocumentScale,n),t.currentZoom/this._initialDocumentScale},r.finalizeRelativeScale=function(e,t){void 0===t&&(t=!1);var n=e*this._initialDocumentScale;this.getZoomManager().setZoom(n,!1);var i={};i.initialScale=this._initialDocumentScale,i.finalScale=n,i.cancelled=t,p.ULS.sendTraceTag(42821150,353,50,"Pinch zoom ended: {0}",i)},r.getPinchCenterRelativeToContainer=function(e){var t=e.gestureData.center;return t?Object.assign(new fe,{x:t.x-this._containerBounds.x,y:t.y-this._containerBounds.y}):null},r.calculateNextUiControlUpdateTime=function(){var e=(new Date).getTime();return new Date(e+1e3)},t=e,(n=[{key:"scrollContainer",get:function(){return this._scrollContainer}},{key:"scrollable",get:function(){return this._scrollable}}])&&_e(t.prototype,n),i&&_e(t,i),e}();function ye(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ve,"PinchZoomAdapter",null,[422]);var Se=function(){function e(e){this._element=e}var t,n,i;return e.prototype.getBounds=function(){return Sys.UI.DomElement.getBounds(this._element)},t=e,(n=[{key:"scrollWidth",get:function(){return this._element.scrollWidth}},{key:"scrollHeight",get:function(){return this._element.scrollHeight}}])&&ye(t.prototype,n),i&&ye(t,i),e}();function be(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ce(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}Object(i.a)(Se,"ScrollContainerElement",null,[416]);var Ae=function(){function e(e,t,n,i,r,a){this._gestureInputManager=null,this._stopwatchForRegister=null,this._container=e,this._stopwatchBuilder=t,this._isMultiTouchGestureEnabled=n,this._isPinchZoomEnabled=i,this._isPinchZoomOnlyPointerEventsEnabled=r,this._hammerJsPerformanceTimersIsEnabled=a,this._containerElements=new z.a}var t=e.prototype;return t.register=function(e,t){var n=this;this._isMultiTouchGestureEnabled&&this._container.resolveFuture("Common.IGestureInputManager").execute((function(i){if(n.startRegisterTimer(),n._gestureInputManager=i,n._containerElements.add(e),n._isPinchZoomEnabled){if(n._isPinchZoomOnlyPointerEventsEnabled&&i.getGestureBrowserEvents())return void n.stopRegisterTimer();var r=n._container.resolveFuture("Common.IZoomManager"),a=(n._container.resolve("Common.IAppSettingsManager"),new Se(e)),o=s.AFrameworkApplication.theActionManager,l=s.AFrameworkApplication.appSettingsManager,c=new ve(r,a,t,o,l);i.registerGestureAdapter(0,e,c)}n.stopRegisterTimer()}))},t.unregister=function(){if(this._gestureInputManager&&this._containerElements){if(this._isPinchZoomEnabled){for(var e,t=be(this._containerElements);!(e=t()).done;){var n=e.value;this._gestureInputManager.unregisterGestureAdapter(0,n)}this._containerElements.clear()}this._gestureInputManager=null}},t.startRegisterTimer=function(){this._hammerJsPerformanceTimersIsEnabled&&(this._stopwatchBuilder?this._stopwatchForRegister=this._stopwatchBuilder.makeAndStartStopwatch("Task","Register"):p.ULS.sendTraceTag(590387076,310,10,"_stopwatchBuilder is null"))},t.stopRegisterTimer=function(){this._hammerJsPerformanceTimersIsEnabled&&(this._stopwatchForRegister?this._stopwatchForRegister.stop():p.ULS.sendTraceTag(590387077,310,10,"_stopwatchForRegister is null"))},e}();function Te(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Ae,"GestureInputRegistrar",null,[372]);var we=function(){function e(){this._container=null,this._isInitialized=!1}var t,n,i,r=e.prototype;return r.init=function(){this._isInitialized||(this._container.resolve("Common.IGestureInputRegistrar"),this._isInitialized=!0)},r.dispose=function(){},r.configure=function(e){this._container=e,e.register(372,"Common.IGestureInputRegistrar").singleInstance().usingFactory((function(){return new Ae(e,s.AFrameworkApplication.activeFrame.theStopwatchBuilder,s.AFrameworkApplication.isMultiTouchGestureEnabled(),s.AFrameworkApplication.isPinchToZoomEnabled(),!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PinchZoomOnlyPointerEventsIsEnabled"),!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("HammerJsPerformanceTimersIsEnabled"))}))},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.GestureInput"}}])&&Te(t.prototype,n),i&&Te(t,i),e}();Object(i.a)(we,"GestureInputPackage",null,[20,21]);var ke=n(239),Ie=n(96),Fe=n(16),Ee=function(){this.gestureAdapter=null,this.recognizer=null};function Pe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Ee,"GestureAdapterInfo",null,[]);var Oe=function(){function e(){this._dependenciesTask=null}var t,n,i;return e.prototype.loadDependenciesAsync=function(){if(!this._dependenciesTask){var t=s.AFrameworkApplication.scriptUrlFromName(String.format("{0}",e.hammerJSName),5),n=Y.a.create(t,null,null);Z.a.enqueueResourceWithoutEnabling(n),this._dependenciesTask=n.loadFinishedTask}return this._dependenciesTask},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}],(n=null)&&Pe(t.prototype,n),i&&Pe(t,i),e}();Oe.hammerJSName="hammer.min.js",Oe._instance=null,Object(i.a)(Oe,"HammerJsDependencyLoader",null,[421]);var Re,Me=function(e,t,n){if(void 0===n&&(n=null),null==t)throw p.ULS.sendTraceTag(42256258,310,10,"manager cannot be null"),Error.argumentNull("manager can not be null");var i=null;switch(e){case f.a.pinch:i=new Hammer.Pinch(n);break;case f.a.pan:i=new Hammer.Pan(n)}return i&&(i.manager=t),i};!function(e){e[e.none=-1]="none",e[e.pinch=0]="pinch",e[e.pan=1]="pan",e[e.swipe=2]="swipe"}(Re||(Re={})),Object(i.b)("GestureEvent",Re);var De=n(40);function xe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Le(e,t){return(Le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Be=function(e){var t,n,i,r,a;function o(t,n,i,r,a,o,s,l,c){var u;return(u=e.call(this,t,i,r,o)||this)._clientPoint=n,u._shiftKey=s,u._ctrlKey=l,u._isPointerEvent=c,u._gestureData=a,u}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,Le(t,n),o.create=function(e,t,n,i,r,a){var s;if(n.rawEvent)if(a){var l=n.rawEvent;s=new Sys.UI.Point(l.clientX,l.clientY)}else s=De.a.getClientPointFromTouchEvent(n);else s=new Sys.UI.Point(n.clientX,n.clientY);return new o(e,s,t,n,i,r,n.shiftKey,n.ctrlKey,a)},i=o,(r=[{key:"shiftKey",get:function(){return this._shiftKey}},{key:"ctrlKey",get:function(){return this._ctrlKey}},{key:"clientPoint",get:function(){return this._clientPoint}},{key:"gestureData",get:function(){return this._gestureData}},{key:"isPointerEvent",get:function(){return this._isPointerEvent}}])&&xe(i.prototype,r),a&&xe(i,a),o}(De.a);Object(i.a)(Be,"GestureEventArgs",De.a,[]);var Ue=function(){this.pointers=null,this.changedPointers=null,this.pointerType=null,this.srcEvent=null,this.overallVelocityX=0,this.overallVelocityY=0,this.overallVelocity=0,this.distance=0,this.angle=0,this.scale=0,this.rotation=0,this.maxPointers=0,this.target=null,this.center=null,this.additionalEvent=null,this.isFirst=!1,this.isFinal=!1,this.eventType=0,this.deltaX=0,this.deltaY=0,this.timeStamp=0,this.deltaTime=0,this.offsetDirection=null};Object(i.a)(Ue,"GestureManagerData",null,[]);var He=function(){};He.STATE_POSSIBLE=1,He.STATE_BEGAN=2,He.STATE_CHANGED=4,He.STATE_ENDED=8,He.STATE_RECOGNIZED=8,He.STATE_CANCELLED=16,He.STATE_FAILED=32,Object(i.a)(He,"HammerConstants",null,[]);var Ne=n(46),We=n(112),je=n(11),Ve=n(89);function qe(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ge(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ze(e,t){return(ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xe=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this)._inputDataName=ke.a.gestureAdapterCache,i._pointerEventsEnabled=!!window.PointerEvent,i._touchEventsEnabled=window.hasOwnProperty("ontouchstart"),i._onGestureEvent=null,i._gestureEvents=null,i._handled=!1,i._pointerEventsCache=new Ie.a,i._pointerTargetCache=new Ie.a,i._gestureRegions=new z.a,i._currentGestureTarget=null,i._usePointerCaptureIsEnabled=!1,i._clearCacheOnPrimaryPointerIsEnabled=!1,i._resetHandledBeforeInputHandlerIsEnabled=!1,i._logCoalescedEventsIsEnabled=!1,i._checkExistenceOfGetCoalescedEventsIsEnabled=!1,i._checkIfHammerExistsAfterDownloadIsEnabled=!1,i._hammerJsPerformanceTimersIsEnabled=!1,i._cancelDragFromGestureInputManagerIsEnabled=!1,i._maxCoalescedEvents=-1,i._stopwatchForRegisterGestureAdapterAfterLoad=null,i.session=null,i.handlers=null,i.element=null,i.curRecognizer=null,i._eventHandlerManager=Ne.EventHandlerManager.instance,i._pointerEventsEnabled?(p.ULS.sendTraceTag(593893141,310,50,"Using pointer events"),i._onGestureEvent=Object(r.a)(Ke(i),i.onPointerEvent,"onPointerEvent"),i._gestureEvents=f.a.gesturePointerEvents):i._touchEventsEnabled?(p.ULS.sendTraceTag(593893140,310,50,"Using touch events"),i._onGestureEvent=Object(r.a)(Ke(i),i.onTouchEvent,"onTouchEvent"),i._gestureEvents=f.a.touchEvents):(p.ULS.sendTraceTag(593893139,310,50,"Using mouse events"),i._onGestureEvent=Object(r.a)(Ke(i),i.onMouseEvent,"onMouseEvent"),i._gestureEvents=f.a.gestureMouseEvents),i._stopwatchBuilder=n,i._dragInputManager=t,s.AFrameworkApplication.appSettingsManager&&(i._usePointerCaptureIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UsePointerCaptureIsEnabled"),i._clearCacheOnPrimaryPointerIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ClearCacheOnPrimaryPointerIsEnabled"),i._resetHandledBeforeInputHandlerIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ResetHandledBeforeInputHandlerIsEnabled"),i._logCoalescedEventsIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("LogCoalescedEventsIsEnabled"),i._checkExistenceOfGetCoalescedEventsIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CheckExistenceOfGetCoalescedEventsIsEnabled"),i._checkIfHammerExistsAfterDownloadIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CheckIfHammerExistsAfterDownloadIsEnabled"),i._hammerJsPerformanceTimersIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("HammerJsPerformanceTimersIsEnabled"),i._cancelDragFromGestureInputManagerIsEnabled=i._usePointerCaptureIsEnabled&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CancelDragFromGestureInputManagerIsEnabled")&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UseGestureInputManagerPointerCacheIsEnabled")),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ze(t,n);var a=i.prototype;return a.getGestureBrowserEvents=function(){return this._pointerEventsEnabled?0:this._touchEventsEnabled?1:2},a.initializeForElement=function(t){e.prototype.initializeForElement.call(this,t),this._eventHandlerManager.initializeListForElement(this._gestureEvents,t,0,this._onGestureEvent)},a.deinitializeForElement=function(t){e.prototype.deinitializeForElement.call(this,t),this._eventHandlerManager.deinitializeListForElement(t,this._gestureEvents)},a.registerGestureAdapter=function(e,t,n,i,r){var a=this;void 0===i&&(i=null),void 0===r&&(r=null),s.AFrameworkApplication.isMultiTouchGestureEnabled()?Oe.instance.loadDependenciesAsync().continueWith((function(o){if(a.startRegisterGestureAdapterAfterLoadTimer(),o.isFaulted||o.isCanceled)return p.ULS.sendTraceTag(591192778,310,10,"Hammer did not download correctly: {0}",o.status),void a.stopRegisterGestureAdapterAfterLoadTimer();if(p.ULS.sendTraceTag(591192779,310,50,"Hammer download status: {0}",o.status),a._checkIfHammerExistsAfterDownloadIsEnabled){var s=window.Hammer;if("undefined"==typeof s)return p.ULS.sendTraceTag(590901389,310,10,"Hammer does not exist"),void a.stopRegisterGestureAdapterAfterLoadTimer();if("undefined"==typeof s.inputHandler)return p.ULS.sendTraceTag(590901390,310,10,"Hammer.inputHandler does not exist"),void a.stopRegisterGestureAdapterAfterLoadTimer()}if(!t)throw a.stopRegisterGestureAdapterAfterLoadTimer(),Error.argumentNull("source element can not be null");var l=We.a.getObject(t,a._inputDataName);null==l&&(l=new Ie.a,We.a.setObject(t,a._inputDataName,l),a.registerGestureRegion(t));var c=null;if(l.containsKey(Re[e])||(c=Object.assign(new Ee,{recognizer:Me(Re[e],a,r),gestureAdapter:n}),l.add(Re[e],c)),null!=i)for(var u=0;u<i.length;u++)if(l.containsKey(Re[i[u]])){var d=l.get_item(Re[i[u]]);c.recognizer.recognizeWith(d.recognizer)}else 0;a.stopRegisterGestureAdapterAfterLoadTimer()})):p.ULS.sendTraceTag(42256219,310,10,"Multi Touch is not enabled either from common BRS or from your app BRS")},a.startRegisterGestureAdapterAfterLoadTimer=function(){this._hammerJsPerformanceTimersIsEnabled&&(this._stopwatchBuilder?this._stopwatchForRegisterGestureAdapterAfterLoad=this._stopwatchBuilder.makeAndStartStopwatch("Task","RegisterGestureAdapterAfterLoad"):p.ULS.sendTraceTag(590387074,310,10,"_stopwatchBuilder is null"))},a.stopRegisterGestureAdapterAfterLoadTimer=function(){this._hammerJsPerformanceTimersIsEnabled&&(this._stopwatchForRegisterGestureAdapterAfterLoad?this._stopwatchForRegisterGestureAdapterAfterLoad.stop():p.ULS.sendTraceTag(590387075,310,10,"_stopwatchForRegisterGestureAdapterAfterLoad is null"))},a.unregisterGestureAdapter=function(e,t){p.ULS.sendTraceTag(42256223,310,t?100:10,"source element {0} ",t.id);var n=We.a.getObject(t,this._inputDataName);null!=n&&(n.remove(Re[e]),n.count||this.unregisterGestureRegion(t))},a.registerGestureRegion=function(e){this._gestureRegions.add(e),this._eventHandlerManager.initializeListForElement(this._gestureEvents,e,0,this._onGestureEvent)},a.unregisterGestureRegion=function(e){this._gestureRegions.remove(e),this._eventHandlerManager.deinitializeListForElement(e,this._gestureEvents)},a.recognize=function(e){for(var t=new Array(e.pointers.length),n=0;n<e.pointers.length;n++)t[n]=e.pointers[n].target;var i=null;for(this._currentGestureTarget=this.getLowestCommonAncestor(t);void 0!==this._currentGestureTarget&&null!==this._currentGestureTarget&&null==(i=We.a.getObject(this._currentGestureTarget,this._inputDataName));this._currentGestureTarget=this._currentGestureTarget.parentNode);if(null!=i){this.curRecognizer&&this.curRecognizer.state===He.STATE_RECOGNIZED&&(this.curRecognizer=null);for(var r,a=qe(i.keys);!(r=a()).done;){var o=r.value,s=i.get_item(o);null!=s&&void 0!==s.recognizer&&null!==s.recognizer&&(void 0===this.curRecognizer||null===this.curRecognizer||s.recognizer===this.curRecognizer||s.recognizer.canRecognizeWith(this.curRecognizer))&&s.recognizer.recognize(e);var l=s.recognizer.state;this.curRecognizer||He.STATE_BEGAN!==l&&He.STATE_CHANGED!==l&&He.STATE_ENDED!==l||(this.curRecognizer=s.recognizer)}}},a.emit=function(e,t){if("hammer.input"!==e){this._handled=!1;var n=null,i=Be.create(e,this._currentGestureTarget,t.srcEvent,t,3,this._pointerEventsEnabled),r=We.a.getObject(this._currentGestureTarget,this._inputDataName),a=-1;if(this.isPinchEvent(e))a=0;else if(this.isPanEvent(e))a=1;else{if(!this.isSwipeEvent(e))return void p.ULS.sendTraceTag(42256256,310,15,"Event can not be recognized by current manager");a=2}if(null!=(n=r.tryGetValue(Re[a],n).value)){var o=n.gestureAdapter;o.isGesturePossible(i)?e.endsWith("start")?this._handled=o.onGestureStart(i):e.endsWith("end")?(o.onGestureEnd(i),this._handled=!0):e.endsWith("cancel")?(o.onGestureCancel(i),this._handled=!0):e.endsWith("move")&&(this._handled=o.onGestureEvent(i)):p.ULS.sendTraceTag(42256257,310,50,"App rejected to perform gesture now : {0}",e)}}},a.get=function(e){return Object(P.a)(Hammer.Recognizer,e)},a.getLowestCommonAncestor=function(e){if(e.length<1)return null;if(1===e.length)return e[0];for(var t=e[0],n=!0,i=1;i<e.length;i++){if(!e[i])return null;if(t!==e[i]){n=!1;break}}if(n)return t;for(var r,a=this.getAncestryList(e[0]),o=0,s=qe(e);!(r=s()).done;){var l=r.value,c=this.getAncestryList(l);if(a.get_item(a.count-1)!==c.get_item(c.count-1))return null;for(var u=a.count-2,d=c.count-2;u>=o&&d>=0;u--,d--)if(a.get_item(u)!==c.get_item(d)){o=u+1;break}}return a.get_item(o)},a.getAncestryList=function(e){for(var t=new z.a;null!=e;e=e.parentNode)t.add(e);return t},a.getInputType=function(e){switch(e){case f.a.touchStart:case f.a.browserPointerDown:return 1;case f.a.touchMove:case f.a.browserPointerMove:return 2;case f.a.touchEnd:case f.a.browserPointerUp:return 4;case f.a.touchCancel:case f.a.browserPointerCancel:return 8}return 0},a.onTouchEvent=function(e,t,n){var i=this.getInputType(e),r=this.getInputDataFromTouchEvents(n,i);return Hammer.inputHandler(this,i,r),this._handled&&n.preventDefault(),this._handled},a.handlingMultiTouchPointerGesture=function(){return this._pointerEventsCache.count>1},a.cancelPendingPointerEvents=function(){if(p.ULS.sendTraceTag(594055960,310,50,"CancelPendingPointerEvents"),this._usePointerCaptureIsEnabled)for(var e,t=qe(this._pointerEventsCache);!(e=t()).done;){var n=e.value;this.removePointerFromCaches(n.key)}else this._pointerEventsCache=new Ie.a;this.session=null},a.addOrReplacePointerInCaches=function(e,t,n){if(p.ULS.sendTraceTag(594055959,310,50,"AddOrReplacePointerInCaches: pointerId: {0}",e),!this._pointerTargetCache.containsKey(e)){try{t.setPointerCapture(e)}catch(e){p.ULS.sendTraceTag(594055958,310,10,"Exception: {0}",e)}this._pointerTargetCache.add(e,t)}this._pointerEventsCache.set_item(e,n),this._cancelDragFromGestureInputManagerIsEnabled&&this._pointerEventsCache.count>1&&this._dragInputManager&&!this._dragInputManager.cancelDragForMultiTouchPointerGesture&&(this._dragInputManager.cancelDragForMultiTouchPointerGesture=!0)},a.removePointerFromCaches=function(e){if(p.ULS.sendTraceTag(594055957,310,50,"RemovePointerFromCaches: pointerId: {0}",e),this._pointerTargetCache.containsKey(e)){try{this._pointerTargetCache.get_item(e).releasePointerCapture(e)}catch(e){p.ULS.sendTraceTag(594055956,310,10,"Exception: {0}",e)}this._pointerTargetCache.remove(e)}else p.ULS.sendTraceTag(594055955,310,10,"RemovePointerFromCaches: pointerId should be in cache: {0}",e);this._pointerEventsCache.remove(e),this._cancelDragFromGestureInputManagerIsEnabled&&this._pointerEventsCache.count<=1&&this._dragInputManager&&this._dragInputManager.cancelDragForMultiTouchPointerGesture&&(this._dragInputManager.cancelDragForMultiTouchPointerGesture=!1)},a.onPointerEvent=function(e,t,n){var i=n.rawEvent.pointerType.toString(),r=n.rawEvent.pointerId.toString();if("touch"!==i)return!1;var a=this.getInputType(e);if(1!==a&&!this._pointerEventsCache.containsKey(r))return!1;if((this._clearCacheOnPrimaryPointerIsEnabled&&1===a&&n.rawEvent.isPrimary&&this._pointerEventsCache.count&&(p.ULS.sendTraceTag(593839564,310,10,"Pointer cache should be empty"),this.cancelPendingPointerEvents()),this._usePointerCaptureIsEnabled?this.addOrReplacePointerInCaches(r,t,n):this._pointerEventsCache.set_item(r,n),this._logCoalescedEventsIsEnabled&&2===a)&&(!this._checkExistenceOfGetCoalescedEventsIsEnabled||this._checkExistenceOfGetCoalescedEventsIsEnabled&&"function"==typeof n.rawEvent.getCoalescedEvents)){var o=n.rawEvent.getCoalescedEvents();o&&this.handlingMultiTouchPointerGesture()&&(this._maxCoalescedEvents=Math.max(this._maxCoalescedEvents,o.length))}this._resetHandledBeforeInputHandlerIsEnabled&&(this._handled=!1);var s=this.getInputDataFromPointerEvents(this._pointerEventsCache,n,i);return Hammer.inputHandler(this,a,s),4!==a&&8!==a||(this._usePointerCaptureIsEnabled?this.removePointerFromCaches(r):this._pointerEventsCache.remove(r),this._pointerEventsCache.count||(this.session=null,this._logCoalescedEventsIsEnabled&&-1!==this._maxCoalescedEvents&&(p.ULS.sendTraceTag(593597138,310,50,"Max number of coalesced events: {0}",this._maxCoalescedEvents),this._maxCoalescedEvents=-1))),this._handled&&n.preventDefault(),this._handled},a.onMouseEvent=function(e,t,n){return!1},a.getInputDataFromTouchEvents=function(e,t){var n=new Ue,i=e.rawEvent,r=i.touches,a=i.changedTouches;n.pointers=Array.clone(r);var o=r.length>0?r:a;return n.pointers=Array.clone(o),n.changedPointers=Array.clone(a),n.srcEvent=e,n.pointerType="touch",n},a.getInputDataFromPointerEvents=function(e,t,n){var i=new Ue;e.keys;return i.pointers=Ve.toArray(e.values),i.changedPointers=[t],i.pointerType=n,i.srcEvent=t,i},a.isPinchEvent=function(e){return je.a.startsWith(e,f.a.pinch)},a.isPanEvent=function(e){return je.a.startsWith(e,f.a.pan)},a.isSwipeEvent=function(e){return je.a.startsWith(e,f.a.swipe)},i}(Fe.a);Object(i.a)(Xe,"GestureInputManager",Fe.a,[392,393]);var Je=n(181);function Qe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ze=function(){function e(){this._container=null,this._isInitialized=!1}var t,n,i,r=e.prototype;return r.configure=function(e){e.register(Xe,"Common.App.GestureManager.GestureInputManager").as("Common.IGestureInputManager").singleInstance().usingFactory((function(){return new Xe(Je.a.instance,s.AFrameworkApplication.activeFrame.theStopwatchBuilder)})),this._container=e},r.init=function(){this._isInitialized||(this._container.resolve("Common.App.GestureManager.GestureInputManager"),this._isInitialized=!0)},r.dispose=function(){},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.GestureInputManager"}}])&&Qe(t.prototype,n),i&&Qe(t,i),e}();Object(i.a)(Ze,"GestureInputManagerPackage",null,[20,21]);var Ye=function(e,t,n,i,r,a){this.IsSafeLinksEnabled=null,this.WebAffinitizedUrl=null,this.PolicyCookie=null,this.PolicyCookieTTL=0,this.WasServiceDown=!1,this.AffinitizedUrl=null,this.IsSafeLinksEnabled=e,this.WebAffinitizedUrl=t,this.PolicyCookie=n,this.PolicyCookieTTL=i,this.WasServiceDown=r,this.AffinitizedUrl=a};Object(i.a)(Ye,"SafeLinksData",null,[]);var $e=function(e,t){this.targetUrl=e,this.stopwatch=t};Object(i.a)($e,"SafeLinksGetUrlReputationRequestData",null,[]);var et,tt,nt=n(15),it=function(){function e(t,n,i,r){this._appSettingsManager=t,this._clientRequestManager=n,this._getUrlReputationHandlerUrl=i,e._stopwatchBuilder=r}var t=e.prototype;return t.tryNavigate=function(t,n,i){try{var a=null;e._stopwatchBuilder&&(a=e._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","SafeLinksGetUrlReputation"));var o=new $e(n,a),s={};s.AffinitizedUrl=t,s.TargetUrl=n,s.PolicyCookie=i;var l=B.c(s);return this._clientRequestManager.addRequest(this._getUrlReputationHandlerUrl,2,l,null,!1,2,Object(r.a)(this,this.onGetUrlReputationSuccessCallback,"onGetUrlReputationSuccessCallback"),Object(r.a)(this,this.onGetUrlReputationFailureCallback,"onGetUrlReputationFailureCallback"),o,void 0,void 0,3e3,3e3,"36"),!0}catch(e){p.ULS.sendTraceTag(588788033,378,10,e.message)}return!1},t.onGetUrlReputationSuccessCallback=function(e){var t="OnGetUrlReputationSuccessCallback: ",n=10,i=e.data.state;try{var r=B.b(e.data.responseData).reputationResults[0],a=r.navigateUrl.length,o=i.targetUrl.length,s=r.navigateUrl===i.targetUrl;r.navigateUrl&&r.navigateUrl.length>0&&(i.targetUrl=r.navigateUrl),t+=String.format("HttpStatus {0}, verdict {1}, clickedUrlLength = {2} navigateUrlLength {3}, navigateUrlSameAsClickedUrl {4}",e.data.httpStatus,r.verdict,o.toString(),a.toString(),s.toString()),n=50}catch(e){t+=String.format("Exception {0}",e.message)}this.handleGetUrlReputationCompletion(i,t,n)},t.onGetUrlReputationFailureCallback=function(e){var t="OnGetUrlReputationFailureCallback: ",n=e.data.state;try{t+=String.format("HttpStatus {0}",e.data.httpStatus)}catch(e){t+=String.format("Exception {0}",e.message)}this.handleGetUrlReputationCompletion(n,t,10)},t.handleGetUrlReputationCompletion=function(e,t,n){e.stopwatch&&(e.stopwatch.stop(),e.stopwatch=null),p.ULS.sendTraceTag(588788034,378,n,t),nt.a.safelyOpenWindow(e.targetUrl,void 0,"noopener,noreferrer","SafeLinksNav")},e}();function rt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}it._stopwatchBuilder=null,Object(i.a)(it,"SafeLinksNavigationHelper",null,[]),function(e){e[e.enabledByPolicy=0]="enabledByPolicy",e[e.disabledByPolicy=1]="disabledByPolicy",e[e.disabled_GetPolicyFailure=2]="disabled_GetPolicyFailure",e[e.disabled_PendingGetPolicyRequest=3]="disabled_PendingGetPolicyRequest"}(et||(et={})),Object(i.b)("SafeLinksNavigationState",et),function(e){e[e.waiting=0]="waiting",e[e.executing=1]="executing",e[e.succeeded=2]="succeeded",e[e.failed=3]="failed",e[e.notFound=4]="notFound",e[e.preConditionFailed=5]="preConditionFailed",e[e.socketConnectionError=6]="socketConnectionError",e[e.timeOut=7]="timeOut",e[e.offlineMode=8]="offlineMode",e[e.serverError=9]="serverError",e[e.cancelled=10]="cancelled",e[e.clientError=11]="clientError",e[e.serverAuthenticationError=12]="serverAuthenticationError",e[e.expiredWithoutSending=13]="expiredWithoutSending",e[e.accessTokenExpired=14]="accessTokenExpired"}(tt||(tt={})),Object(i.b)("RequestStatus",tt);var at=function(){function e(t,n,i,r,a,o){var s=this;if(void 0===r&&(r=!1),void 0===a&&(a=null),void 0===o&&(o=null),this._getPolicyOnBootRetries=0,this._getPolicyOnLinkClickRetries=0,this._getPolicyRequestPending=!1,this.isGetPolicyBootRequest=!1,this._pendingUrlToFollow=null,this._isUserLicensedForSafeLinks=!0,this._sessionCacheSafeLinksData=null,p.ULS.sendTraceTag(26019598,378,100,"Initializing SafeLinksManager."),this._appSettingsManager=t,this._clientRequestManager=n,this._appName=i,e._stopwatchBuilder=o,this._webServiceBaseUrl=r?this._appSettingsManager.getStringAppSetting("SafeLinksHandlerWebServiceBase"):this._appSettingsManager.getStringAppSetting("WebServiceBase"),this._userId=this._appSettingsManager.getStringAppSetting("SafeLinksHashedUserId"),this.workloadId=this._appSettingsManager.getStringAppSetting("SafeLinksWorkloadIdHeaderValue"),this._maxGetPolicyBootRetries=this._appSettingsManager.getIntAppSetting("SafeLinksMaxGetPolicyBootRetries",2),this._maxGetPolicyOnLinkClickRetries=this._appSettingsManager.getIntAppSetting("SafeLinksMaxGetPolicyOnLinkClickRetries",1),this._isEnabledForUser=this.isSafeLinksEnabledForUser(),this._isEnabledForBrowser=this.isSafeLinksEnabledForBrowser(),p.ULS.sendTraceTag(26019599,378,50,"SafeLinksManager _isEnabledForUser={0}, _isEnabledForBrowser={1}",this._isEnabledForUser,this._isEnabledForBrowser),this._isEnabledForUser&&this._isEnabledForBrowser){var c=this.getCachedData(),u=c?c.IsSafeLinksEnabled.toLowerCase():"",d=this.isPolicyCookieExpired();p.ULS.sendTraceTag(36231312,378,50,"Cached values for IsSafeLinksEnabled: {0}, IsPolicyCookieExpired: {1}.",u,d);var h=!c||"unknown"===u||c.WasServiceDown||d,g=this.createMap();g&&(g.set("shouldGetSafeLinksDataFromServer",h.toString()),g.set("isSafeLinksEnabledCacheValue",u.toString())),l.Health.instance.recordKpiUsage("SafeLinksGetPolicy1",0,"jpittsdirects",g),!!this._appSettingsManager.containsAppSetting("LicensingForSafeLinksIsEnabled")&&this._appSettingsManager.getBooleanAppSetting("LicensingForSafeLinksIsEnabled")&&a?(this._isUserLicensedForSafeLinks=!1,a.execute((function(e){e.isFeatureEnabled("MsoUrlreputation",!0).then((function(e){return s._isUserLicensedForSafeLinks=e,s._isUserLicensedForSafeLinks&&h&&s.getSafeLinksDataFromServerAsync(!0),null}))}))):h&&this.getSafeLinksDataFromServerAsync(!0)}}var t,n,i,a=e.prototype;return a.tryNavigate=function(e){var t;if(!e)return p.ULS.sendTraceTag(593367827,378,10,"SafeLinksManager.TryNavigate: Null/Empty targetUrl"),!1;var n=this.isHyperLinkTypeSupportedBySafeLinks(e);if(p.ULS.sendTraceTag(594830615,378,50,"SafeLinksManager.TryNavigate: isSupportedHyperLinkType={0},_isEnabledForUser={1},_isEnabledForBrowser={2},_isUserLicensedForSafeLinks={3}",n,this._isEnabledForUser,this._isEnabledForBrowser,this._isUserLicensedForSafeLinks),!(n&&this._isEnabledForUser&&this._isEnabledForBrowser&&this._isUserLicensedForSafeLinks))return!1;l.Health.instance.recordKpiUsage("SafeLinksNavigations",0,"jpittsdirects",null);var i=0,r=(t=this.shouldTryUsingSafeLinksService(i),i=t.state,t).returnValue;return p.ULS.sendTraceTag(595079385,378,50,"ShouldTryUsingSafeLinksService returned NavigationState={0}",et[i]),r?(p.ULS.sendTraceTag(26019601,378,50,"Using safelinks to navigate hyperlink"),this.shouldUseNavigationHelper()?!this.isPolicyCookieExpired()&&this.navigationHelper.tryNavigate(this.getAffinitizedUrlFromCache(),e,this.getPolicyCookieFromCache()):this.isPolicyCookieExpired()?(this._pendingUrlToFollow=e,p.ULS.sendTraceTag(24462627,378,50,"Refreshing the cache as policy cookie expired."),this.isGetPolicyBootRequest=!1,this.getSafeLinksDataFromServerAsync(),!0):(this.tryNavigateInternal(e),!0)):(l.Health.instance.recordKpiFailure("SafeLinksNavigations",et[i],1===i,!0,null),!1)},a.isHyperLinkTypeSupportedBySafeLinks=function(e){e=e.toLowerCase();var t=this._appSettingsManager.getListAppSetting("SafeLinksUnsupportedProtocols");if(t)for(var n=0;n<t.length;n++)if(e.startsWith(t[n]))return!1;return!0},a.getSafeLinksDataFromServerAsync=function(e){void 0===e&&(e=!1);var t=this.createMap();t&&t.set("isOnBootRequest",e.toString()),l.Health.instance.recordKpiUsage("SafeLinksGetPolicySuccessfulRequest",1,"jpittsdirects",t),l.Health.instance.recordKpiUsage("SafeLinksGetPolicyFailedRequest",0,"jpittsdirects",t);var n=this.createAndStartStopwatch("SafeLinksGetPolicy");this._clientRequestManager.addRequest(this.getPolicyHandlerUrl,1,null,null,!0,2,Object(r.a)(this,this.getSafeLinksDataFromServer_OnSuccessCallback,"getSafeLinksDataFromServer_OnSuccessCallback"),Object(r.a)(this,this.getSafeLinksDataFromServer_OnFailureCallback,"getSafeLinksDataFromServer_OnFailureCallback"),n,void 0,void 0,void 0,void 0,"23"),this.isGetPolicyBootRequest=e,this._getPolicyRequestPending=!0,e?this._getPolicyOnBootRetries++:this._getPolicyOnLinkClickRetries++},a.getSafeLinksDataFromServer_OnSuccessCallback=function(t){var n=R.a.notAcceptable_406,i="";try{var r;this.isGetPolicyBootRequest=!1,this._getPolicyRequestPending=!1;var a=t.data.state,o=(r=this.stopAndGetDurationInMsFromStopwatch(a),a=r.stopwatch,r).returnValue,s=Object.assign(new V.a,{durationMs:o});if(l.Health.instance.recordKpiSuccess("SafeLinksGetPolicySuccessfulRequest",s),p.ULS.sendTraceTag(594830614,378,50,"GetSafeLinksDataFromServer_OnSuccessCallback: HttpStatus {0}, data length {1}, Duration {2}",t.data.httpStatus,t.data.responseData.length,o),t.data.httpStatus!==R.a.OK_200)return void(i="Unexpected httpStatus: "+t.data.httpStatus.toString());var c=null;try{c=B.b(t.data.responseData)}catch(e){return void(i="Exception:"+e.toString()+" deserializing response")}if(!c)return void(i="Error when serializing response into SafeLinksData. SafeLinksData is null.");var u=c.IsSafeLinksEnabled;if(null==u||u.length<=0)return void(i="Invalid isSafeLinksEnabledString");p.ULS.sendTraceTag(594830613,378,50,"Retrieved isSafeLinksEnabledString {0}",u);var d=e.parseSafeLinksEnabledForUser(u);if(void 0===c.WebAffinitizedUrl||null===c.WebAffinitizedUrl||c.WebAffinitizedUrl.length<=0)return void(i="Invalid WebAffinitizedUrl");if(void 0===c.PolicyCookie||null===c.PolicyCookie||c.PolicyCookie.length<=0)return void(i="Invalid PolicyCookie");if(void 0===c.PolicyCookieTTL||null===c.PolicyCookieTTL)return void(i="Invalid PolicyCookieTTL");var h=c.WebAffinitizedUrl,g=c.PolicyCookie,m=c.AffinitizedUrl,f=new Date,_=c.PolicyCookieTTL>5?c.PolicyCookieTTL-5:0;f.setMinutes(f.getMinutes()+_);var v=f.getTime(),y=new Ye(u,h,g,v,!1,m);this.setCachedData(y),n=t.data.httpStatus,this._pendingUrlToFollow&&(d?(this.tryNavigateInternal(this._pendingUrlToFollow),this._getPolicyOnBootRetries=0,this._getPolicyOnLinkClickRetries=0):(p.ULS.sendTraceTag(26019602,378,50,"SafeLinks is disabled by admin; Navigating without SafeLinks"),l.Health.instance.recordKpiFailure("SafeLinksNavigations","disabledByPolicy",!0,!0,null),nt.a.followHyperlinkWithNoReferrer(this._pendingUrlToFollow)),this._pendingUrlToFollow=null)}catch(e){i="GetSafeLinksDataFromServer_OnSuccessCallback: Exception:  "+e.toString()}finally{n!==R.a.OK_200&&this.handleGetPolicyRequestError(n,i)}},a.getSafeLinksDataFromServer_OnFailureCallback=function(e){this._getPolicyRequestPending=!1;var t=500,n="";try{var i,r=e.data.state,a=(i=this.stopAndGetDurationInMsFromStopwatch(r),r=i.stopwatch,i).returnValue,o=Object.assign(new V.a,{durationMs:a});t=e.data.httpStatus,l.Health.instance.recordKpiFailure("SafeLinksGetPolicyFailedRequest","HttpStatusCode_"+t.toString(),!1,!0,o),n="Request Failed, Status="+tt[e.data.status]+" Duration: "+a}catch(e){n="GetSafeLinksDataFromServer_OnFailureCallback Exception: "+e.toString()}finally{this.handleGetPolicyRequestError(t,n)}},a.handleGetPolicyRequestError=function(e,t){void 0===t&&(t="");try{if(p.ULS.sendTraceTag(594830612,378,10,"HandleGetPolicyRequestError: HttpStatus {0}, Error {1}",e,t),this._getPolicyOnBootRetries<this._maxGetPolicyBootRetries&&this._getPolicyOnLinkClickRetries<this._maxGetPolicyOnLinkClickRetries)this.getSafeLinksDataFromServerAsync(this.isGetPolicyBootRequest);else{this.isGetPolicyBootRequest=!1,p.ULS.sendTraceTag(24462656,378,10,"Exhausted all retries for SafeLinks GetPolicy call. OnBootRetries: {0}, OnClickRetries: {1}, HttpStatus: {2}, Error: {3}",this._getPolicyOnBootRetries,this._getPolicyOnLinkClickRetries,e,t);var n=null,i=this.createMap();i&&(i.set("HttpStatus",e.toString()),n=Object.assign(new V.a,{extendedProperties:i})),l.Health.instance.recordKpiFailure("SafeLinksGetPolicy1","GetPolicyRequestError",!1,!0,n);var r=new Ye("false","","",0,!0,"");this.setCachedData(r),this._pendingUrlToFollow&&(p.ULS.sendTraceTag(26019603,378,50,"Error occurred during at-click GetPolicy call, NavigationState = {0}","disabled_GetPolicyFailure"),l.Health.instance.recordKpiFailure("SafeLinksNavigations","disabled_GetPolicyFailure",!1,!0,null),nt.a.followHyperlinkWithNoReferrer(this._pendingUrlToFollow),this._pendingUrlToFollow=null)}}catch(e){p.ULS.sendTraceTag(594830611,378,10,"HandleGetPolicyRequestError: Exception {0}",e.toString())}},a.tryNavigateInternal=function(e){var t=this.getPolicyCookieFromCache(),n=this.getWebAffinitizedUrlFromCache(),i={};i.Url=e,i.SafeLinksCookie=t,i.CorrelationId=W.a.create().toString(),i.WorkloadId=this.workloadId,i.UserAgentInfo=H.a.browserNameForlogging+"|"+this.appName,p.ULS.sendTraceTag(23900187,378,50,"Validating hyperlink with request correlation: {0}",i.CorrelationId),nt.a.postToWindow(nt.a.windowTargetToString(4),n,i)},a.isSafeLinksEnabledForUser=function(){var t=this._appSettingsManager.getStringAppSetting("IsSafeLinksEnabledForUser");return!!t&&e.parseSafeLinksEnabledForUser(t)},a.isSafeLinksEnabledForBrowser=function(){var e=this._appSettingsManager.getListAppSetting("SafeLinksDisabledBrowsers");if(H.a.isElectron){if(this._appSettingsManager.containsAppSetting("SafeLinksForTeamsIsEnabled")&&this._appSettingsManager.getBooleanAppSetting("SafeLinksForTeamsIsEnabled"))return!0;if(Array.contains(e,"Electron"))return!1}else if(Array.contains(e,H.a.browserNameForlogging))return!1;return"officecomhwa"!==(this._appSettingsManager.getStringAppSetting(s.AFrameworkApplication.uiHostSettingName)||"").toLowerCase()},a.shouldUseNavigationHelper=function(){return!(-1===window.location.href.indexOf("&wd_slnh=1"))||H.a.isElectron},a.shouldTryUsingSafeLinksService=function(t){t=0;var n=this.getCachedData(),i=n?n.IsSafeLinksEnabled:"";if(""!==i)return n.WasServiceDown?(p.ULS.sendTraceTag(51663971,378,50,"Failed to retrieve policy data"),{returnValue:!1,state:t=2}):"false"===i.toLowerCase()?(p.ULS.sendTraceTag(51664e3,378,50,"SafeLinks disabled for the user"),{returnValue:!1,state:t=1}):{returnValue:e.parseSafeLinksEnabledForUser(i),state:t};if(this._getPolicyRequestPending)return t=3,p.ULS.sendTraceTag(595079384,378,50,"Currently getting SafeLinks policy"),{returnValue:!1,state:t};if(this._getPolicyOnBootRetries>=this._maxGetPolicyBootRetries||this._getPolicyOnLinkClickRetries>=this._maxGetPolicyOnLinkClickRetries)return t=2,p.ULS.sendTraceTag(51664001,378,50,"Exhausted all retries- Failure in GetPolicy for SafeLinks ({0}/{1} boot, {2}/{3} onClick)",this._getPolicyOnBootRetries,this._maxGetPolicyBootRetries,this._getPolicyOnLinkClickRetries,this._maxGetPolicyOnLinkClickRetries),{returnValue:!1,state:t};var r=this._getPolicyOnBootRetries+this._getPolicyOnLinkClickRetries;return p.ULS.sendTraceTag(23900182,378,10,"Inconsistent SafeLinks state: SafeLinks cache data is null with no on boot request pending, and {0} retries left over. Perhaps LocalStorage is inaccessable.",this._maxGetPolicyBootRetries+this._maxGetPolicyOnLinkClickRetries-r),{returnValue:!0,state:t}},a.getPolicyCookieFromCache=function(){var e=this.getCachedData();return e?e.PolicyCookie:""},a.getWebAffinitizedUrlFromCache=function(){var e=this.getCachedData();return e?e.WebAffinitizedUrl:""},a.getAffinitizedUrlFromCache=function(){var e=this.getCachedData();return e?e.AffinitizedUrl:""},a.getExpirationTimeFromCache=function(){var e=new Date;try{var t=this.getCachedData(),n=t?t.PolicyCookieTTL:0;e.setTime(n)}catch(e){p.ULS.sendTraceTag(24462658,378,10,"Exception occured while fetching expiration time from cache: {0}",e)}return e},a.isPolicyCookieExpired=function(){var e=this.getExpirationTimeFromCache();return!!e&&e.getTime()<Date.now()},a.getCachedData=function(){if(!this._sessionCacheSafeLinksData){var e=Q.instance.getItem(this.userId);if(!e||""===e)return null;this._sessionCacheSafeLinksData=JSON.parse(e)}return this._sessionCacheSafeLinksData},a.setCachedData=function(e){if(null==e)throw Error.argumentNull("safeLinksData");if(void 0===e.IsSafeLinksEnabled||null===e.IsSafeLinksEnabled||e.IsSafeLinksEnabled.length<=0)throw Error.argumentNull("safeLinksData.IsSafeLinksEnabled");this._sessionCacheSafeLinksData=e,e.WasServiceDown||this.writeValuesToLocalStorage(e)},a.writeValuesToLocalStorage=function(e){var t=JSON.stringify(e);Q.instance.setItem(this.userId,t)},a.createAndStartStopwatch=function(t){return void 0!==e._stopwatchBuilder&&null!==e._stopwatchBuilder?e._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall",t):null},a.stopAndGetDurationInMsFromStopwatch=function(e){if(null!=e){var t=e.ageInMilliseconds;return e.stop(),{returnValue:t,stopwatch:e=null}}return{returnValue:null,stopwatch:e}},a.createMap=function(){try{return new Map}catch(e){return null}},e.parseSafeLinksEnabledForUser=function(e){return"false"!==e.toLowerCase()},t=e,(n=[{key:"appName",get:function(){return this._appName}},{key:"webServiceBaseUrl",get:function(){return this._webServiceBaseUrl}},{key:"userId",get:function(){return this._userId}},{key:"getPolicyHandlerUrl",get:function(){var e=this.webServiceBaseUrl?this.webServiceBaseUrl+"/":"",t=new U.QueryStringBuilder("SafeLinksHandler.ashx");return t.addParam("app",this.appName),this._appSettingsManager.getBooleanAppSetting("SafeLinksUseDebugHeader")&&t.addParam("action","debug"),String.format("{0}{1}&{2}",e,t.toString(),s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion)}},{key:"getUrlReputationHandlerUrl",get:function(){var e=this.webServiceBaseUrl?this.webServiceBaseUrl+"/":"",t=new U.QueryStringBuilder("SafeLinksHandler.ashx");return t.addParam("app",this.appName),this._appSettingsManager.getBooleanAppSetting("SafeLinksUseDebugHeader")&&t.addParam("action","debug"),t.addParam("slrt","GetUrlReputation"),String.format("{0}{1}&{2}",e,t.toString(),s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion)}},{key:"navigationHelper",get:function(){return e._safeLinksNavigationHelper||(e._safeLinksNavigationHelper=new it(this._appSettingsManager,this._clientRequestManager,this.getUrlReputationHandlerUrl,e._stopwatchBuilder)),e._safeLinksNavigationHelper}}])&&rt(t.prototype,n),i&&rt(t,i),e}();at._stopwatchBuilder=null,at._safeLinksNavigationHelper=null,Object(i.a)(at,"SafeLinksManager",null,[391]);function ot(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var st=function(){function e(){this._container=null}var t,n,i,a=e.prototype;return a.configure=function(e){this._container=e},a.init=function(){s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(Object(r.a)(this,this.onFullAppSettingsReady,"onFullAppSettingsReady"))},a.dispose=function(){},a.onFullAppSettingsReady=function(){var e=this;s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WACSafeLinksIsEnabled")&&(this._container.register(at,"Common.App.SafeLinks.SafeLinksManager").as("Common.App.SafeLinks.ISafeLinksManager").singleInstance().usingFactory((function(){return new at(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager,String.format("{0}-{1}",function(e){switch(e){case 3:return"Word";case 1:return"Excel";case 2:return"PowerPoint";case 4:return"OneNote";case 5:return"Visio";default:return"Unknown"}}(s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType),function(e){switch(e){case 1:return"Edit";case 2:return"View";case 3:return"InstantView";default:return"Unknown"}}(s.AFrameworkApplication.activeFrame.applicationInstance.officeAppMode)),!1,e._container.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),s.AFrameworkApplication.activeFrame.theStopwatchBuilder)})),this._container.tryResolve("Common.App.SafeLinks.ISafeLinksManager"))},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.SafeLinks"}}])&&ot(t.prototype,n),i&&ot(t,i),e}();Object(i.a)(st,"SafeLinksPackage",null,[20,21]);var lt=n(41),ct=n(253);function ut(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function dt(e,t){return(dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ht=function(e){var t,n;function i(t){return e.call(this,t)||this}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,dt(t,n);var r,a,o,s=i.prototype;return s.createElement=function(){var e=document.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",this.resourceUrl),e},s.createHighPriorityResourceElement=function(){return null},s.reloadReference=function(){this.element.setAttribute("href",""),this.element.setAttribute("href",this.retryBehavior.resourceUrl)},r=i,(a=[{key:"couldGenerateLayout",get:function(){return!1}}])&&ut(r.prototype,a),o&&ut(r,o),i}(ct.a);Object(i.a)(ht,"CssResource",ct.a,[]);var pt=n(111),gt=function(){function e(){this._firstRunExperienceDependenciesTask=null,this._premiumMessagingDependenciesTask=null}var t=e.prototype;return t.loadFirstRunExperienceDependenciesAsync=function(){return this._firstRunExperienceDependenciesTask||(p.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this._firstRunExperienceDependenciesTask=pt.Task.WAA(e.loadJavaScriptAsync("inproductmessaging.js"),e.loadCssAsync("inproductmessaging.css")),this._firstRunExperienceDependenciesTask.continueWith((function(e){p.ULS.sendTraceTag(21030599,324,10,"{0}",je.a.getExceptionMessage(e.exception))}),5)),this._firstRunExperienceDependenciesTask},t.loadFreemiumDependenciesAsync=function(){if(!this._premiumMessagingDependenciesTask)try{p.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage");var t=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("DimeUrl");this._premiumMessagingDependenciesTask=pt.Task.WAA(e.enqueDownload(Y.a.create(t,null,null))),this._premiumMessagingDependenciesTask.continueWith((function(e){p.ULS.sendTraceTag(39978391,324,10,"{0}",je.a.getExceptionMessage(e.exception))}),5)}catch(e){p.ULS.sendTraceTag(594874951,324,10,"{0}",je.a.getExceptionMessage(e))}return this._premiumMessagingDependenciesTask},e.loadJavaScriptAsync=function(t){var n=e.getUrl(t),i=Y.a.create(n,null,null);return e.enqueDownload(i)},e.loadCssAsync=function(t){var n=e.getUrl(t),i=new ht(n);return e.enqueDownload(i)},e.getUrl=function(e){return lt.a.commonScripts(String.format("ipm/{0}",e))},e.enqueDownload=function(e){return Z.a.enqueueResourceWithoutEnabling(e),e.loadFinishedTask},e}();Object(i.a)(gt,"DependencyDownloader",null,[398]);var mt=function(){};function ft(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}mt.overlayDiv="inProductMessagingOverlayDiv",mt.welcomeVideoKey="WelcomeVideoKey",mt.suggestedVideo1Key="SuggestedVideo1Key",mt.suggestedVideo2Key="SuggestedVideo2Key",mt.welcomeVideoTranscript="WelcomeVideoTranscript",mt.suggestedVideo1Transcript="SuggestedVideo1Transcript",mt.suggestedVideo2Transcript="SuggestedVideo2Transcript",mt.mainDivLogo="MainDivLogo",mt.playButtonImage="PlayButtonImage",mt.replayButtonImage="ReplayButtonImage",mt.welcomeVideoImage="WelcomeVideoImage",mt.welcomeVideoTitle="WelcomeVideoTitle",mt.suggestedVideo1Image="SuggestedVideo1Image",mt.suggestedVideo1Title="SuggestedVideo1Title",mt.suggestedVideo2Image="SuggestedVideo2Image",mt.suggestedVideo2Title="SuggestedVideo2Title",mt.landingPageTitle="LandingPageUpperMessageTitle",mt.appThemeActiveColor="AppThemeActiveColor",mt.appThemePrimaryColor="AppThemePrimaryColor",mt.appThemeSecondaryBackgroundColor="AppThemeSecondaryBackgroundColor",mt.appThemeSecondaryHoverColor="AppThemeSecondaryHoverColor",Object(i.a)(mt,"Constants",null,[]);var _t=function(){function e(){this._autoPlay=!0,this._modernPlayerSupported=!0,this._showLandingPage=!0,this.playIcon=null,this.replayIcon=null,this.mutePlayer=!1,this.locale=null,this.uiResources={}}var t,n,i,r=e.prototype;return r.addMainDivLogo=function(e){this.addUIResource(mt.mainDivLogo,e)},r.addLandingPageTitle=function(e){this.addUIResource(mt.landingPageTitle,e)},r.addAppThemeColors=function(e,t,n,i){this.addUIResource(mt.appThemeActiveColor,e),this.addUIResource(mt.appThemePrimaryColor,t),this.addUIResource(mt.appThemeSecondaryBackgroundColor,n),this.addUIResource(mt.appThemeSecondaryHoverColor,i)},r.addWelcomeVideo=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this.addUIResource(mt.welcomeVideoKey,e),this.addUIResource(mt.welcomeVideoTranscript,t),this.addUIResource(mt.welcomeVideoImage,n),this.addUIResource(mt.welcomeVideoTitle,i)},r.addSuggestedVideo1=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this.addUIResource(mt.suggestedVideo1Key,e),this.addUIResource(mt.suggestedVideo1Transcript,t),this.addUIResource(mt.suggestedVideo1Image,n),this.addUIResource(mt.suggestedVideo1Title,i)},r.addSuggestedVideo2=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this.addUIResource(mt.suggestedVideo2Key,e),this.addUIResource(mt.suggestedVideo2Transcript,t),this.addUIResource(mt.suggestedVideo2Image,n),this.addUIResource(mt.suggestedVideo2Title,i)},r.addPlayReplayIcons=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.playIcon=e,this.replayIcon=t},r.setPlayReplayIcons=function(){this.addUIResource(mt.playButtonImage,this.playIcon),this.addUIResource(mt.replayButtonImage,this.replayIcon)},r.addUIResource=function(e,t){t&&(this.uiResources[e]=t)},t=e,(n=[{key:"autoPlay",get:function(){return this._autoPlay},set:function(e){this._autoPlay=e}},{key:"modernPlayerSupported",get:function(){return this._modernPlayerSupported},set:function(e){this._modernPlayerSupported=e}},{key:"showLandingPage",get:function(){return this._showLandingPage},set:function(e){this._showLandingPage=e,e&&this.setPlayReplayIcons()}}])&&ft(t.prototype,n),i&&ft(t,i),e}();Object(i.a)(_t,"FirstRunExperienceUISettings",null,[397]);var vt=function(){this.remindMeLater=!1,this.completed=!1};Object(i.a)(vt,"FirstRunExperienceViewData",null,[396]);var yt=n(68),St=function(){function e(e,t,n){this._actionManager=e,this._activeFrame=t,this._inProductMessagingUIManager=n}var t=e.prototype;return t.registerActions=function(){this._actionManager.addActionWithFlags(h.a.firstRunExperienceShowUI,ue.a.frame,Object(r.a)(this,this.firstRunExperienceHandler,"firstRunExperienceHandler"),64),this._actionManager.addAction(h.a.firstRunExperienceFocusForward,ue.a.frame,Object(r.a)(this,this.inProductMessagingTabHandler,"inProductMessagingTabHandler")),this._actionManager.addAction(h.a.firstRunExperienceFocusBackward,ue.a.frame,Object(r.a)(this,this.inProductMessagingShiftTabHandler,"inProductMessagingShiftTabHandler")),this._actionManager.addAction(h.a.dimeLaunch,ue.a.frame,Object(r.a)(this,this.dimeLaunchHandler,"dimeLaunchHandler")),this._actionManager.addAction(h.a.reportFreemiumUpsellDialogDisplayed,ue.a.frame,yt.ActionManager.doNothingButReportHandler),this._actionManager.addAction(h.a.reportFreemiumUpsellDialogClicked,ue.a.frame,yt.ActionManager.doNothingButReportHandler),this._actionManager.addAction(h.a.reportFreemiumUpsellDialogDismissed,ue.a.frame,yt.ActionManager.doNothingButReportHandler),this._activeFrame&&this._activeFrame.updateCommandUI()},t.firstRunExperienceHandler=function(e,t,n,i,r){return 2===n&&this._inProductMessagingUIManager.launchInProductMessagingControl(r),32},t.dimeLaunchHandler=function(e,t,n,i,r){return 2===n&&this._inProductMessagingUIManager.launchFreemiumUpsellDialog(r),32},t.inProductMessagingTabHandler=function(e,t,n,i,r){return 2===n?this._inProductMessagingUIManager.moveForwardOnTab():32},t.inProductMessagingShiftTabHandler=function(e,t,n,i,r){return 2===n?this._inProductMessagingUIManager.moveBackwardOnShiftTab():32},e}();Object(i.a)(St,"InProductMessagingActor",null,[]);var bt=function(){this.instance=null,this.launchConfig=null,this.taskCompleteAction=null,this.resolveAction=null,this.rejectAction=null};Object(i.a)(bt,"DimeExperienceUISettings",null,[]);var Ct=n(55),At=n(308),Tt=function(){function e(e,t,n,i,r){this.freemiumDependenciesLoaded=!1,this.dimeInstance=null,this._actionManager=e,this._uiWrapper=t,this._resourceDownloadManager=n,this._appType=i,this._appMode=r}var t=e.prototype;return t.initializeGoPremiumButton=function(e){if(Ct.apiExtensionExists("getHeaderApi")){var t=e.isFreemiumUpsellEnabled();t&&e.isFeatureEnabled("MsoPremiumBadge",!0).then((function(n){return appChrome.getHeaderApi().then((function(e){return e.updatePremiumStatus(n,t),null})),e.registerFeatureStateChangeCallback("MsoPremiumBadge",(function(e){appChrome.getHeaderApi().then((function(n){return n.updatePremiumStatus(e.isEnabled,t),null}))})),null}))}else p.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")},t.launchInProductMessagingControl=function(e){var t=this;this._resourceDownloadManager.loadFirstRunExperienceDependenciesAsync().continueWith((function(n){t._uiWrapper.showUI(e)}))},t.launchFreemiumUpsellDialog=function(e){var t=e,n="gopremium",i=null,r=function(){};t?(t.experience&&""!==Object(P.a)(String,t.experience)&&(n=Object(P.a)(String,t.experience)),t.onTaskComplete&&(r=t.onTaskComplete),t.campaignId&&""!==Object(P.a)(String,t.campaignId)&&(i=Object(P.a)(String,t.campaignId))):p.ULS.sendTraceTag(51675402,324,50,"Experience not given, using default experience"),this.launchDimeExperience(n,r,i)},t.launchDimeExperience=function(e,t,n){var i=this;if(void 0===n&&(n=null),this.freemiumDependenciesLoaded&&this.dimeInstance){var r={};r.experience=e||"gopremium",r.campaignId=n||At.b(this._appType,this._appMode,Object(P.a)(String,r.experience),!0),this._actionManager.processAction(h.a.reportFreemiumUpsellDialogDisplayed,2),p.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+r.experience);try{var a=Object.assign(new bt,{instance:this.dimeInstance,launchConfig:r,taskCompleteAction:t||function(){},resolveAction:function(e){p.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+e.status)},rejectAction:function(e){p.ULS.sendTraceTag(51675406,324,10,"Dime launch error"),i.freemiumDependenciesLoaded=!1,i.dimeInstance=null}});this._uiWrapper.showFreemiumUI(a)}catch(e){var o;p.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+e.message),this.freemiumDependenciesLoaded=!1,this.dimeInstance=null,this._actionManager.processActionWithData(h.a.freemiumUpsellEligible,2,((o={}).experience=r.experience,o))}}else{var s;p.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),this._actionManager.processActionWithData(h.a.freemiumUpsellEligible,2,((s={}).experience=e,s))}},t.loadFreemiumUpsellDialogDependencies=function(){var e=this;this._resourceDownloadManager.loadFreemiumDependenciesAsync().continueWith((function(t){try{var n=je.a.toLower(s.AFrameworkApplication.uiCulture),i=At.c(e._appType);if(!i)return void p.ULS.sendTraceTag(51675409,324,15,"App not supported");var r={};r.partnerId=i,r.language=n,r.sessionId=s.AFrameworkApplication.userSessionId,r.authHint=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("UserPrincipalName");var a=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("Puid")||"";if(""!==a){var o={};o.puid=a,r.userInfo=o}e.dimeInstance=new Dime(r),e.freemiumDependenciesLoaded=!0,p.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}catch(e){p.ULS.sendTraceTag(51675410,324,10,"FreemiumUpsellDialogDependencies failed: "+e.message)}}),3)},t.moveForwardOnTab=function(){return this._uiWrapper.moveForwardOnTab()},t.moveBackwardOnShiftTab=function(){return this._uiWrapper.moveBackwardOnShiftTab()},e}();Object(i.a)(Tt,"InProductMessagingUIManager",null,[395]);var wt=function(){function e(){this._traceCategory=0,this._levelMap=new Array(5),this._levelMap[0]=10,this._levelMap[1]=15,this._levelMap[2]=50,this._levelMap[3]=100,this._levelMap[4]=200}var t=e.prototype;return t.Init=function(e){this._traceCategory=e},t.SendTrace=function(e,t){p.ULS.sendTraceTag(34182235,this._traceCategory,this._levelMap[e],"{0}",t)},e}();Object(i.a)(wt,"DefaultNetworkingManager",null,[417]);var kt=n(33),It=n(81),Ft=n(23);function Et(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Pt=function(){function e(e){this._isFreOverlayVisible=!1,this._focusManager=e}var t,n,i,a=e.prototype;return a.showUI=function(e){var t=e;t&&(InProductMessaging.Networking.NetworkingMgr=new wt,InProductMessaging.Networking.NetworkingMgr.Init(387),this._isFreOverlayVisible=!0,InProductMessaging.Init(t.showLandingPage,t.modernPlayerSupported,t.autoPlay,t.mutePlayer,t.locale,Object(r.a)(this,this.onDismissFirstRunExperience,"onDismissFirstRunExperience"),t.uiResources),this.setFocusScope(mt.overlayDiv,!0))},a.showFreemiumUI=function(e){var t=this,n=e;if(!(n&&n.instance&&n.launchConfig))throw Error.argument("DimeExperienceUISettings");var i=document.getElementById("wacDimeContainer");i||((i=document.createElement("div")).id="wacDimeContainer",document.body.appendChild(i)),this.setFocusScope("wacDimeContainer",!1),n.launchConfig.parentElementId="wacDimeContainer",n.instance.launch(n.launchConfig,n.taskCompleteAction).then((function(e){t.removeFocus(),document.body.removeChild(i),n.resolveAction(e)})).catch((function(e){t.removeFocus(),document.body.removeChild(i),n.rejectAction(e)}))},a.setFocusScope=function(e,t){if(this._focusManager&&e){var n=document.getElementById(e);this.initializeFocusLoop("InProductMessagingFocusId",n,!1);var i=this._focusManager.getRegion("InProductMessagingFocusId");if(i){var r=this._focusManager.currentScope;r&&"InProductMessagingFocusId"===r.name||this._focusManager.pushScope("InProductMessagingFocusId",!1),t&&this.rebindTabNavigationHandlers(i.scope)}}},a.initializeFocusLoop=function(e,t,n){void 0===n&&(n=!0);var i=this._focusManager.getScope(e);i.parent=kt.AFrame.appFocusId;var r=new It.DOMFocusListing((function(){return t}));r.rememberFirstElement=n,r.addValidTag(3),r.addValidTag(2),r.addValidTag(4);var a=this._focusManager.buildRegionWithDelegate((function(){return t}),i,r);a.rememberFocusStealers(),a.looped=!0,a.contained=!0},a.rebindTabNavigationHandlers=function(e){e.unBindAction(Ft.FocusManager.instance()._tabInput),e.unBindAction(Ft.FocusManager.instance()._tabShiftInput),e.bindAction(Ft.FocusManager.instance()._tabInput,h.a.firstRunExperienceFocusForward),e.bindAction(Ft.FocusManager.instance()._tabShiftInput,h.a.firstRunExperienceFocusBackward)},a.removeFocus=function(){this._focusManager&&(this._focusManager.popScope("InProductMessagingFocusId"),this._focusManager.removeScope("InProductMessagingFocusId"))},a.onDismissFirstRunExperience=function(e,t){this._isFreOverlayVisible=!1,this.removeFocus();var n=Object.assign(new vt,{completed:e,remindMeLater:t});s.AFrameworkApplication.theActionManager.processActionWithData(h.a.firstRunExperienceCompleted,2,n)},a.onDismissFreemiumDialog=function(e){this._isFreOverlayVisible=!1,this.removeFocus(),e?s.AFrameworkApplication.theActionManager.processAction(h.a.reportFreemiumUpsellDialogClicked,2):s.AFrameworkApplication.theActionManager.processAction(h.a.reportFreemiumUpsellDialogDismissed,2)},a.moveForwardOnTab=function(){var e=document.activeElement,t=this._focusManager.getCurrentRegion();return e&&t&&t.listing&&e===t.listing.lastElement?(t.listing.trySetCurrentElement(e),t.moveForward()?32:8):4},a.moveBackwardOnShiftTab=function(){var e=document.activeElement,t=this._focusManager.getCurrentRegion();return e&&t&&t.listing&&e===t.listing.firstElement?(t.listing.trySetCurrentElement(e),t.moveBackward()?32:8):4},t=e,(n=[{key:"isFreOverlayVisible",get:function(){return this._isFreOverlayVisible}}])&&Et(t.prototype,n),i&&Et(t,i),e}();Object(i.a)(Pt,"InProductMessagingUIWrapper",null,[394]);var Ot=n(71);function Rt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Mt=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.configure=function(e){e.register(gt,"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").singleInstance().usingFactory((function(){return new gt})),e.register(Pt,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").singleInstance().usingFactory((function(){return new Pt(Ft.FocusManager.instance())})),e.register(Tt,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").singleInstance().usingFactory((function(){return new Tt(s.AFrameworkApplication.theActionManager,e.resolve("Common.IInProductMessagingUIWrapper"),e.resolve("Common.App.InProductMessaging.IDependencyDownloader"),s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType,s.AFrameworkApplication.activeFrame.applicationInstance.officeAppMode)})),e.register(St,"Common.App.InProductMessaging.InProductMessagingActor").singleInstance().usingFactory((function(){return new St(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.activeFrame,e.resolve("Common.IInProductMessagingUIManager"))})),e.register(_t,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").singleInstance().usingFactory((function(){return new _t})),e.register(vt,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").singleInstance().usingFactory((function(){return new vt})),this._container=e},r.init=function(){var e=this;this._container.resolve("Common.App.InProductMessaging.InProductMessagingActor").registerActions(),s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){s.AFrameworkApplication.activeFrame.applicationInstance.isReactSharedHeaderUxEnabled&&Ot.a.get_instance().executeWhen(15,(function(){e._container.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute((function(t){e._container.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").initializeGoPremiumButton(t)}))})),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("FreemiumUpsellShowDialogIsEnabled")&&At.a()&&!H.a.isInternetExplorer&&1!==s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType&&e._container.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute((function(t){t.isFeatureEnabled("MsoPremiumBadge",!0).then((function(n){return!n&&t.isFreemiumUpsellEnabled()&&e._container.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").loadFreemiumUpsellDialogDependencies(),null}))}))}))},r.dispose=function(){},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.InProductMessaging"}}])&&Rt(t.prototype,n),i&&Rt(t,i),e}();Object(i.a)(Mt,"InProductMessagingPackage",null,[20,21]);var Dt=n(25),xt=function(){function e(e){this._allowedDomainEndings=e}return e.prototype.isDomainAllowed=function(e){if(!this._allowedDomainEndings)return!0;var t=Dt.a.getHost(e);if(!t)return!1;t=t.toLowerCase();for(var n=0;n<this._allowedDomainEndings.length;n++)if(t.endsWith(this._allowedDomainEndings[n]))return!0;return!1},e}();function Lt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(xt,"DomainAllowListManager",null,[]);var Bt=function(){function e(e,t){this.customText=null,this._timings=e,this.url=t}var t,n,i,r=e.prototype;return r.toUsageData=function(){var e={},t=this.timings;return e.a=this.usageReadyUrl,e.b=this.round(t.navigationStart),e.c=this.round(t.unloadEventStart),e.d=this.round(t.unloadEventEnd),e.e=this.round(t.redirectStart),e.f=this.round(t.redirectEnd),e.g=this.round(t.fetchStart),e.h=this.round(t.domainLookupStart),e.i=this.round(t.domainLookupEnd),e.j=this.round(t.connectStart),e.k=this.round(t.connectEnd),e.l=void 0!==t.secureConnectionStart&&null!==t.secureConnectionStart?this.round(t.secureConnectionStart):0,e.m=this.round(t.requestStart),e.n=this.round(t.responseStart),e.o=this.round(t.responseEnd),e.q=this.round(t.domInteractive),e.r=this.round(t.domContentLoadedEventStart),e.s=this.round(t.domContentLoadedEventEnd),e.t=this.round(t.domComplete),e.u=this.round(t.loadEventStart),e.v=this.round(t.loadEventEnd),e.w=this.customText,e},r.round=function(e){return Math.round(1e3*e)/1e3},t=e,(n=[{key:"usageReadyUrl",get:function(){return Dt.a.removeAllUrlParameters(this.url)}},{key:"timings",get:function(){return this._timings}}])&&Lt(t.prototype,n),i&&Lt(t,i),e}();Object(i.a)(Bt,"PerformanceTimingEntry",null,[]);var Ut=function(e,t){var n={},i=function(e,t){null!=t&&(n[e]=t)},r=null;switch(e){case 0:var a=t;r="ResourceTiming",i("Url",a.a),i("InitiatorType",a.b),i("RedirectStart",null==a.c?null:a.c.toString()),i("RedirectEnd",null==a.d?null:a.d.toString()),i("FetchStart",null==a.e?null:a.e.toString()),i("DomainLookupStart",null==a.f?null:a.f.toString()),i("DomainLookupEnd",null==a.g?null:a.g.toString()),i("ConnectStart",null==a.h?null:a.h.toString()),i("ConnectEnd",null==a.i?null:a.i.toString()),i("SecureConnectionStart",null==a.j?null:a.j.toString()),i("RequestStart",null==a.k?null:a.k.toString()),i("ResponseStart",null==a.l?null:a.l.toString()),i("ResponseEnd",null==a.m?null:a.m.toString()),i("CustomText",a.n),i("DecodedBodySize",null==a.o?null:a.o.toString()),i("EncodedBodySize",null==a.p?null:a.p.toString()),i("TransferSize",null==a.q?null:a.q.toString());break;case 1:var o=t;r="PerformanceTiming",i("Url",o.a),i("NavigationStart",null==o.b?null:o.b.toString()),i("UnloadEventStart",null==o.c?null:o.c.toString()),i("UnloadEventEnd",null==o.d?null:o.d.toString()),i("RedirectStart",null==o.e?null:o.e.toString()),i("RedirectEnd",null==o.f?null:o.f.toString()),i("FetchStart",null==o.g?null:o.g.toString()),i("DomainLookupStart",null==o.h?null:o.h.toString()),i("DomainLookupEnd",null==o.i?null:o.i.toString()),i("ConnectStart",null==o.j?null:o.j.toString()),i("ConnectEnd",null==o.k?null:o.k.toString()),i("SecureConnectionStart",null==o.l?null:o.l.toString()),i("RequestStart",null==o.m?null:o.m.toString()),i("ResponseStart",null==o.n?null:o.n.toString()),i("ResponseEnd",null==o.o?null:o.o.toString()),i("DomLoading",null==o.p?null:o.p.toString()),i("DomInteractive",null==o.q?null:o.q.toString()),i("DomContentLoadedEventStart",null==o.r?null:o.r.toString()),i("DomContentLoadedEventEnd",null==o.s?null:o.s.toString()),i("DomComplete",null==o.t?null:o.t.toString()),i("LoadEventStart",null==o.u?null:o.u.toString()),i("LoadEventEnd",null==o.v?null:o.v.toString()),i("CustomText",o.w)}return n.Table=r,Sys.Serialization.JavaScriptSerializer.serialize(n)},Ht=n(29),Nt=n(117),Wt=n(67);function jt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Vt=function(){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),this._pageLoadPerfRecorder=e,this.usageLogger=this,this._getCurrentUrlDelegate=t||function(){return window.location.href},this._domainAllowListManager=new xt(n)}var t,n,i,r=e.prototype;return r.run=function(){if(e.browserSupportsPerformanceTiming(window.performance))try{var t,n=this._getCurrentUrlDelegate();if(!e._transportRegEx.exec(n))return;if(!this._domainAllowListManager.isDomainAllowed(n))return;var i=new Bt(window.performance.timing,n);Wt.a.instance.recordBrowserFetchStart(i.timings.fetchStart),Wt.a.instance.recordBrowserNavigationStart(i.timings.navigationStart),Wt.a.instance.measureMarks(Ht.a.frameConnect,"connectStart","requestStart"),Wt.a.instance.measureMarks(Ht.a.frameRequest,"requestStart","responseStart"),Wt.a.instance.measureMarks(Ht.a.frameResponse,"responseStart","responseEnd"),this.usageLogger.logData(1,i.toUsageData()),this._pageLoadPerfRecorder.addMetric(Ht.a.frameFetchStart,i.timings.fetchStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameDomainLookupStart,i.timings.domainLookupStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameDomainLookupEnd,i.timings.domainLookupEnd),this._pageLoadPerfRecorder.addMetric(Ht.a.frameConnectStart,i.timings.connectStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameSecureConnectionStart,i.timings.secureConnectionStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameConnectEnd,i.timings.connectEnd),this._pageLoadPerfRecorder.addMetric(Ht.a.frameRequestStart,i.timings.requestStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameResponseStart,i.timings.responseStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameDownloadDuration,i.timings.responseEnd-i.timings.responseStart),this._pageLoadPerfRecorder.addMetric(Ht.a.frameRequestStartToFirstByteDuration,i.timings.responseStart-i.timings.requestStart);var r=0,a=0,o=0;(t=this.tryNavigationSize(n,r,a,o),r=t.transferSize,a=t.encodedSize,o=t.decodedSize,t).returnValue&&(this._pageLoadPerfRecorder.addMetric(Ht.a.frameTransferSize,r),this._pageLoadPerfRecorder.addMetric(Ht.a.frameDecodedSize,o),this._pageLoadPerfRecorder.addMetric(Ht.a.frameEncodedSize,a)),this._pageLoadPerfRecorder.addMetric(Ht.a.frameNavigationStart,i.timings.navigationStart)}catch(e){p.ULS.sendTraceTag(4551814,306,10,"Exception caught in PerformanceTimingLogger.Run: {0}",e)}},r.tryNavigationSize=function(e,t,n,i){if(t=-1,n=-1,i=-1,void 0===window.performance.getEntriesByName||null===window.performance.getEntriesByName)return{returnValue:!1,transferSize:t,encodedSize:n,decodedSize:i};var r=window.performance.getEntriesByName(e,"navigation");if(null==r||1!==r.length)return{returnValue:!1,transferSize:t,encodedSize:n,decodedSize:i};var a=r[0],o=a.transferSize;null!=t&&(t=o);var s=a.decodedBodySize;null!=s&&(i=s);var l=a.encodedBodySize;return null!=l&&(n=l),{returnValue:!0,transferSize:t,encodedSize:n,decodedSize:i}},r.logData=function(e,t,n){void 0===n&&(n=!1),p.ULS.sendTraceTag(4551815,306,50,Ut(e,t))},e.browserSupportsPerformanceTiming=function(e){return!(null==e||void 0===e.timing||null===e.timing)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e(Nt.a.instance,null,s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PerfTimingLoggerFilterDomainsIsEnabled")?s.AFrameworkApplication.appSettingsManager.getListAppSetting("ResourceLoggerDomainAllowList"):null))}}],(n=null)&&jt(t.prototype,n),i&&jt(t,i),e}();function qt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Vt._instance=null,Vt._transportRegEx=new RegExp("^https?://.*","i"),Object(i.a)(Vt,"PerformanceTimingLogger",null,[399]);var Gt=function(){function e(e,t){this.customText=null,this._timings=e,this.behavior=t,this.url=this.timings.name}var t,n,i,r=e.prototype;return r.toUsageData=function(){var t={},n=this.timings;return t.a=this.usageReadyUrl,t.b=n.initiatorType,t.c=this.round(n.redirectStart),t.d=this.round(n.redirectEnd),t.e=this.round(n.fetchStart),t.f=this.round(n.domainLookupStart),t.g=this.round(n.domainLookupEnd),t.h=this.round(n.connectStart),t.i=this.round(n.connectEnd),t.j=void 0!==n.secureConnectionStart&&null!==n.secureConnectionStart?this.round(n.secureConnectionStart):0,t.k=this.round(n.requestStart),t.l=this.round(n.responseStart),t.m=this.round(n.responseEnd),t.o=this.round(e.getRawField(n,"decodedBodySize")),t.p=this.round(e.getRawField(n,"encodedBodySize")),t.q=this.round(e.getRawField(n,"transferSize")),t.n=this.customText,t},r.round=function(e){return Math.round(1e3*e)/1e3},e.getRawField=function(e,t){return e[t]},t=e,(n=[{key:"usageReadyUrl",get:function(){return 2===this.behavior?this.url:Dt.a.removeAllUrlParameters(this.url)}},{key:"timings",get:function(){return this._timings}}])&&qt(t.prototype,n),i&&qt(t,i),e}();Object(i.a)(Gt,"ResourceTimingEntry",null,[420]);var Kt=function(){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n=100),this._appMonitoredStaticResources=e,this._staticResourceHostAllowList=t,this._aggregatedStaticResourceMetrics={},this._cacheThresholdInMs=n}var t=e.prototype;return t.tryAggregateResourceTiming=function(e){var t=e.name.toLowerCase(),n=Dt.a.getPageName(t);if(this.resourceTimingShouldBeAggregated(n,t)){if(n in this._aggregatedStaticResourceMetrics)return p.ULS.sendTraceTag(51652509,306,50,"AppStaticResourceManager: file downloaded multiple times {0}",n),!1;var i={};return i.fetchstart=e.fetchStart,i.responseend=e.responseEnd,i.iscached=this.isTimingCached(e),i.encodedsize=Gt.getRawField(e,"encodedBodySize"),i.decodedsize=Gt.getRawField(e,"decodedBodySize"),this._aggregatedStaticResourceMetrics[n]=i,!0}return!1},t.resourceTimingShouldBeAggregated=function(e,t){if(this._appMonitoredStaticResources)return Array.contains(this._appMonitoredStaticResources,e);if(this._staticResourceHostAllowList)for(var n=Dt.a.getHostname(t),i=0;i<this._staticResourceHostAllowList.length;i++)if(this._staticResourceHostAllowList[i]&&n.endsWith(this._staticResourceHostAllowList[i]))return!0;return!1},t.isTimingCached=function(e){try{var t=Gt.getRawField(e,"transferSize");return t?!t:(p.ULS.sendTraceTag(51652510,306,50,"AppStaticResourceManager: No transfersize found, basing cache status from duration"),e.responseEnd-e.fetchStart<this._cacheThresholdInMs)}catch(e){p.ULS.sendTraceTag(51652511,306,50,"AppStaticResourceManager: Error attempting to get cache value of resource [error: {0}]",e.message)}return!1},t.getAggregatedResourceMetrics=function(){return this._aggregatedStaticResourceMetrics},t.recordStaticResourcesMetricsInKpi=function(){if(N.a.isNullOrEmpty(this._aggregatedStaticResourceMetrics))p.ULS.sendTraceTag(575931855,306,15,"Aggregated Static Resource Metric Dictionary is null or empty");else{var e=s.AFrameworkApplication.flightId?s.AFrameworkApplication.flightId.split(";"):new Array(0),t=Object.assign(new V.a,{extendedProperties:new Map});t.extendedProperties.set("Flights",B.c(e)),this.logKpi(t,this._aggregatedStaticResourceMetrics,l.Health.instance)}},t.logKpi=function(e,t,n){if(t){var i=0,r=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,h=0,g=0;for(var m in t){var f={key:m,value:t[m]};try{var _=Object(P.a)(Object,f.value);if(!_)continue;var v=!!_.iscached&&Boolean.parse(_.iscached.toString()),y=this.parseFloat(_.fetchstart.toString()),S=this.parseFloat(_.responseend.toString())-y,b=this.parseFloat(_.encodedsize.toString()),C=this.parseFloat(_.decodedsize.toString());i+=S,o+=b,c+=C,h++,v?(a+=S,l+=b,d+=C,g++):(r+=S,s+=b,u+=C)}catch(e){p.ULS.sendTraceTag(575931856,306,10,"AppStaticResourceManager: Error attempting to log KPI [error: {0}]",e.message)}}e.extendedProperties.set("StaticResources",B.c(t)),e.extendedProperties.set("TotalResourceDownloadLatency",i.toString()),e.extendedProperties.set("TotalResourceDownloadLatencyForCacheMiss",r.toString()),e.extendedProperties.set("TotalResourceDownloadLatencyForCacheHit",a.toString()),e.extendedProperties.set("TotalSizeOfEncodedDataDownloaded",o.toString()),e.extendedProperties.set("TotalSizeOfEncodedDataDownloadedForCacheMiss",s.toString()),e.extendedProperties.set("TotalSizeOfEncodedDataDownloadedForCacheHit",l.toString()),e.extendedProperties.set("TotalSizeOfDecodedDataDownloaded",c.toString()),e.extendedProperties.set("TotalSizeOfDecodedDataDownloadedForCacheMiss",u.toString()),e.extendedProperties.set("TotalSizeOfDecodedDataDownloadedForCacheHit",d.toString()),e.extendedProperties.set("TotalNumberOfResourcesDownloaded",h.toString()),e.extendedProperties.set("TotalNumberOfCachedResourcesDownloaded",g.toString()),n.recordKpiUsageForAlertableKpi("StaticResourceDownloadLatencyAggregated","wacbootmonitoring",null),n.recordKpiSuccess("StaticResourceDownloadLatencyAggregated",e)}},t.parseFloat=function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){if(!e)return 0;var t=parseFloat(e);return isNaN(t)?0:t})),e}();function zt(e,t){return(zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Kt,"AppStaticResourceManager",null,[]);var Xt=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).entries=t,n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,zt(t,n),i}(Sys.EventArgs);function Jt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Xt,"EntriesAvailableEventArgs",Sys.EventArgs,[]);var Qt=function(){function e(e,t,n,i,r){void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=100),this._isTaskSet=!1,this._task=null,this._currentEntryIndex=0,this._eventSource=new a.a,this._appStaticResourceManager=null,this._isActive=!1,this._timerInterval=0,this._taskManager=e,this._defaultBehavior=0,this.usageLogger=this,this._domainAllowListManager=new xt(n),this._performance=t,i&&(this._appStaticResourceManager=new Kt(null,i,r))}var t,n,i,r=e.prototype;return r.add_entriesAvailable=function(t){this._eventSource.addHandler(e.entriesAvailableEventKey,t)},r.remove_entriesAvailable=function(t){this._eventSource.removeHandler(e.entriesAvailableEventKey,t)},r.configure=function(e,t){var n=this.timerInterval!==e;this._timerInterval=e,this.isActive&&this._taskManager&&n&&(this.deleteTask(),this.addTask()),this._defaultBehavior=t},r.activate=function(){this.isActive||this.browserSupportsPerformanceTimeline&&(this.addTask(),this._isActive=!0)},r.deactivate=function(e){this.isActive&&(this.deleteTask(),e&&this.flush(),this._isActive=!1)},r.flush=function(){if(this.isActive&&this.browserSupportsPerformanceTimeline)try{var t=window.performance.getEntriesByType("resource");t.length-this._currentEntryIndex>0&&p.ULS.sendTraceTag(19506833,306,100,"ResourceTimingLogger.Flush: Start executing command. Number of new entries to flash: {0}",t.length-this._currentEntryIndex);var n=!(void 0===window.performance.clearResourceTimings||null===window.performance.clearResourceTimings);n&&(window.performance.clearResourceTimings(),this._currentEntryIndex=0);for(var i=[],r=this._currentEntryIndex;r<t.length;r++)this._domainAllowListManager.isDomainAllowed(t[r].name)&&(this._appStaticResourceManager&&this._appStaticResourceManager.tryAggregateResourceTiming(t[r]),i.push(new Gt(t[r],this.defaultBehavior)));n||(this._currentEntryIndex=t.length),this._eventSource.raiseEvent(e.entriesAvailableEventKey,new Xt(i));for(var a=0;a<i.length;a++)i[a].behavior&&2!==i[a].behavior||this.usageLogger.logData(0,i[a].toUsageData());i.length>0&&p.ULS.sendTraceTag(19506834,306,100,"ResourceTimingLogger.Flush: Successfully ended. Number of new logged entries: {0}",i.length)}catch(e){p.ULS.sendTraceTag(4310803,306,10,"Exception caught in ResourceTimingLogger.Flush: {0}",e)}},r.logData=function(e,t,n){void 0===n&&(n=!1),p.ULS.sendTraceTag(4310804,306,50,Ut(e,t))},r.getAppResourceTimingMetrics=function(){return this._appStaticResourceManager.getAggregatedResourceMetrics()},r.recordAppResourceTimingMetricsToKpi=function(){this._appStaticResourceManager.recordStaticResourcesMetricsInKpi()},r.addTask=function(){var e=this;this._taskManager&&this.timerInterval>0&&(this._task=new u.a(3,2,1e3*this.timerInterval,(function(){e.flush()}),5),this._taskManager.addTask(this._task),this._isTaskSet=!0)},r.deleteTask=function(){this._isTaskSet&&(this._taskManager.deleteTask(this._task),this._task=null,this._isTaskSet=!1)},t=e,(n=[{key:"browserSupportsPerformanceTimeline",get:function(){try{return!(void 0===this._performance||null===this._performance||void 0===this._performance.getEntriesByType||null===this._performance.getEntriesByType)}catch(e){return p.ULS.sendTraceTag(50873240,306,10,"Exception caught in ResourceTimingLogger.BrowserSupportsPerformanceTimeline: {0}",e),!1}}},{key:"defaultBehavior",get:function(){return this._defaultBehavior}},{key:"isActive",get:function(){return this._isActive}},{key:"timerInterval",get:function(){return this._timerInterval}}])&&Jt(t.prototype,n),i&&Jt(t,i),e}();function Zt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Qt.entriesAvailableEventKey="EntriesAvailable",Object(i.a)(Qt,"ResourceTimingLogger",null,[371,399]);var Yt=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){this._container.resolve("Common.NetworkTiming.IResourceTimingLogger"),Vt.instance.run()},r.dispose=function(){},r.configure=function(e){this._container=e;var t=null;if(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ResourceLoggerFilterDomainsIsEnabled"))try{t=s.AFrameworkApplication.appSettingsManager.getListAppSetting("ResourceLoggerDomainAllowList")}catch(e){p.ULS.sendTraceTag(51652512,306,50,"ResourceTimingPackage - failed to get logger domain allowlist")}var n=[];n.push(Dt.a.getHostname(lt.a.staticContentHost).toLowerCase()),n.push(Dt.a.getHostname(lt.a.sharedStaticContentHost).toLowerCase());var i=s.AFrameworkApplication.appSettingsManager.getIntAppSetting("AppStaticResourceMonitorCacheThresholdInMs",100);e.register(371,"Common.NetworkTiming.IResourceTimingLogger").singleInstance().usingFactory((function(){return new Qt(s.AFrameworkApplication.theTaskManager,window.performance,t,n,i)}))},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.ResourceTiming"}}])&&Zt(t.prototype,n),i&&Zt(t,i),e}();Object(i.a)(Yt,"ResourceTimingPackage",null,[20,21]);var $t,en=n(432),tn=function(){function e(){this._activeEventReceivers={}}var t=e.prototype;return t.activateEventReceiver=function(e){this._activeEventReceivers[e.id.toString()]=e},t.notifyAndDeactivateActiveEventReceivers=function(e){var t=this._activeEventReceivers;for(var n in t){({key:n,value:t[n]}).value.notify(e,!1)}this._activeEventReceivers={}},t.queryForResult=function(e,t){return t&&this.activateEventReceiver(t),this.onResultRequested(e,t)},t.emitDeferredResultToWaitingReceivers=function(e){this.notifyAndDeactivateActiveEventReceivers(e)},t.emitAvailableResultToReceiver=function(e,t){e.notify(t,!0)},e}();function nn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(tn,"AEventEmitter",null,[389]),function(e){e[e.notStarted=0]="notStarted",e[e.waiting=1]="waiting",e[e.shouldRetry=2]="shouldRetry",e[e.complete=3]="complete"}($t||($t={})),Object(i.b)("EventResultState",$t);var rn=function(){function e(){this._state=0}var t,n,i;return t=e,(n=[{key:"state",get:function(){return this._state},set:function(e){var t;p.ULS.sendTraceTag(5849616,202,50,"Changing event result state. {0}",((t={}).OldState=$t[this._state],t.NewState=$t[e],t),"ResultType",this.getResultLogString()),this._state=e}}])&&nn(t.prototype,n),i&&nn(t,i),e}();function an(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function on(e,t){return(on=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(rn,"AEventResult",null,[429]);var sn=function(e){var t,n,i,r,a;function o(){var t;return(t=e.call(this)||this)._personalFileStorageUrl=null,t._storageServiceDisplayName=null,t.state=0,t._instantiatingPersonalStorage=!1,t._invalidResponse=!1,t}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,on(t,n),o.prototype.getResultLogString=function(){return"GetMoreInfo Result"},i=o,(r=[{key:"personalFileStorageUrl",get:function(){return this._personalFileStorageUrl}},{key:"storageServiceDisplayName",get:function(){return this._storageServiceDisplayName}},{key:"instantiatingPersonalStorage",get:function(){return this._instantiatingPersonalStorage}},{key:"invalidResponse",get:function(){return this._invalidResponse}}])&&an(i.prototype,r),a&&an(i,a),o}(rn);Object(i.a)(sn,"GetMoreInfoResult",rn,[428,429]);var ln=n(51),cn=n(431),un=n(428);function dn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var hn=function(){function e(e,t,n,i,r,a,o,s){this._actionManager=e,this._clientRequestManager=t,this._appFrame=n,this._appType=i,this._taskManager=r,this._getCurrentTime=a,this._handlerUrlPrefix=o,this._supportsGetMoreInfoForPersonalStorage=s}var t,n,i,a=e.prototype;return a.registerCommonActions=function(){this.newAndOpenActionManager.addAction(h.a.openUrlInNewTab,ue.a.frame,Object(r.a)(this,this.openUrlInNewTab,"openUrlInNewTab")),this.newAndOpenActionManager.addAction(h.a.openDocumentUrl,ue.a.frame,Object(r.a)(this,this.openDocumentUrl,"openDocumentUrl")),s.AFrameworkApplication.documentLoadedTime?this.logNewAndOpenPerfStats():this.newAndOpenActionManager.addActionWithFlags(h.a.documentLoaded,ue.a.frame,Object(r.a)(this,this.documentLoaded,"documentLoaded"),96)},a.openUrlInNewTab=function(e,t,n,i,r){var a=r;if(r&&a.MenuItemId){var o;p.ULS.sendTraceTag(5849678,202,50,"Opening new tab {0}",((o={}).Id=a.SourceControlId,o.AppType=un.a[this.newAndOpenOfficeAppType],o));var s=a.MenuItemId.toString();nt.a.safelyOpenWindow(s,"_blank",void 0,"NewAndOpenCommonHelpers:OpenUrlInNewTab")}return 32},a.openDocumentUrl=function(e,t,n,i,r){var a=r;if(r&&a.MenuItemId){var o=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WacInTabOpenMRUIsEnabledForUiHost"),l=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UiHostSupportsDocRebootFeatures");if(p.ULS.sendTraceTag(592237459,202,50,"[InTabOpenMRUIsEnabledForUiEmbed: {0}][UiEmbedSupportsDocReboot: {1}]",o,l),o&&l){var c;p.ULS.sendTraceTag(592237458,202,50,"Opening new tab {0}",((c={}).Id=a.SourceControlId,c.AppType=un.a[this.newAndOpenOfficeAppType],c));var u=a.MenuItemId.toString(),h={};h[ln.a.rebootMode]="1",h[ln.a.documentUrl]=u,h[ln.a.reason]=cn.a.open,p.ULS.sendTraceTag(592237460,202,50,"Send PostMessage to the Ui host to reboot a document"),s.AFrameworkApplication.get_hostPostmessengerFuture().execute((function(e){e.sendMessage(d.a.documentRefresh,h)}))}else this.openUrlInNewTab(e,t,n,i,r)}return 32},a.documentLoaded=function(e,t,n,i,r){return this.logNewAndOpenPerfStats(),32},a.logRequest=function(e,t,n){if(void 0===n&&(n=""),t&&t.invokedTime){var i,r=tt[t.status],a=t.invokedTime.getTime(),o=this.getCurrentTime()-a;p.ULS.sendTraceTag(5849679,202,50,"Making request to the WAC server {0}",((i={}).Caller=e,i.RequestStatus=r,i.ElapsedMs=o,i.StartTime=a,i.Notes=n,i))}else{var s;p.ULS.sendTraceTag(5849680,202,50,"Attempted to make a request to the WAC server with null request item {0}",((s={}).Caller=e,s))}},a.logNewAndOpenPerfStats=function(){var e=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("QPGVCI"),t=Dt.a.getParameterValue(document.URL,"wdNewAndOpenCt",e);if(t){var n=parseInt(t),i=Dt.a.getParameterValue(document.URL,"wdPreviousSession",e),r=Dt.a.getParameterValue(document.URL,"wdPreviousCorrelation",e),a=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("NAOPLP");if(s.AFrameworkApplication.documentLoadedTime){var o,l,c=s.AFrameworkApplication.documentLoadedTime.getTime();if(!n||n>c)p.ULS.sendTraceTag(5849682,202,15,"NewAndOpenCommonHelpers.LogNewAndOpenPerfStats: Invalid timestamp {0}",((o={}).ClickTimestamp=n,o.DocumentLoadedTime=c,o.SessionId=i,o.Correlation=r,o));else p.ULS.sendTraceTag(5849683,202,a?15:50,"NewAndOpenCommonHelpers.LogNewAndOpenPerfStats: Click-to-load perf {0}",((l={}).ClickToLoadTime=c-n,l.ClickTimestamp=n,l.SessionId=i,l.Correlation=r,l))}else{var u;p.ULS.sendTraceTag(5849681,202,a?15:50,"NewAndOpenCommonHelpers.LogNewAndOpenPerfStats: Not logging because document loaded time has not been set {0}",((u={}).ClickTimestamp=n,u.SessionId=i,u.Correlation=r,u))}}},e.getAnInstanceWithResolvedDependencies=function(){return new e(new en.a((function(){return s.AFrameworkApplication.theActionManager})),new en.a((function(){return s.AFrameworkApplication.theClientRequestManager})),new en.a((function(){return s.AFrameworkApplication.activeFrame})),new en.a((function(){return s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType})),new en.a((function(){return s.AFrameworkApplication.theTaskManager})),(function(){return(new Date).getTime()}),new en.a((function(){return s.AFrameworkApplication.activeFrame.applicationInstance.newAndOpenHandlerUrlPrefix})),new en.a((function(){return s.AFrameworkApplication.supportsGetMoreInfoForPersonalStorage})))},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getAnInstanceWithResolvedDependencies())}}],(n=[{key:"newAndOpenActionManager",get:function(){return this._actionManager.value}},{key:"newAndOpenClientRequestManager",get:function(){return this._clientRequestManager.value}},{key:"newAndOpenAppFrame",get:function(){return this._appFrame.value}},{key:"newAndOpenOfficeAppType",get:function(){return this._appType.value}},{key:"newAndOpenTaskManager",get:function(){return this._taskManager.value}},{key:"getCurrentTime",get:function(){return this._getCurrentTime}},{key:"newAndOpenHandlerUrlPrefix",get:function(){return this._handlerUrlPrefix.value}},{key:"supportsGetMoreInfoForPersonalStorage",get:function(){return this._supportsGetMoreInfoForPersonalStorage.value}}])&&dn(t.prototype,n),i&&dn(t,i),e}();function pn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}hn._instance=null,Object(i.a)(hn,"NewAndOpenCommonHelpers",null,[388]);var gn=function(){function e(e,t,n){this._task=null,this._serverRetryIntervalsInMsIntList=null,this._retryIndex=0,this._serverRetryIntervalsInMsString=e,this._taskManager=t,this._descriptionString=n}var t,n,i,r=e.prototype;return r.advanceRetryIndex=function(){this._retryIndex=this.retryIndex+1},r.resetRetryState=function(e){this._task&&(this._taskManager.deleteTask(this._task),this._task=null),e&&(this._retryIndex=0)},r.startNextRetryTask=function(e){var t,n=this.timeUntilNextRetryInMs,i=n>=0;i?(this.advanceRetryIndex(),this.resetRetryState(!1),this._task=new u.a(4,1,n,e,107),this._taskManager.addTask(this._task)):(this.resetRetryState(!0),p.ULS.sendTraceTag(5849676,202,50,"Retries exhausted {0}",((t={}).Action=this._descriptionString,t)));return i},t=e,(n=[{key:"retryIndex",get:function(){return this._retryIndex}},{key:"timeUntilNextRetryInMs",get:function(){return this.retryIndex>=this.serverRetryIntervalsInMsIntList.length?-1:this.serverRetryIntervalsInMsIntList[this.retryIndex]}},{key:"serverRetryIntervalsInMsIntList",get:function(){if(!this._serverRetryIntervalsInMsIntList){var e=(this._serverRetryIntervalsInMsString.value||"0").split(",");this._serverRetryIntervalsInMsIntList=[];for(var t=0;t<e.length;t++){var n,i=parseInt(e[t]);isNaN(i)?p.ULS.sendTraceTag(5849677,202,15,"Retry interval list contains non-number element {0}",((n={}).Action=this._descriptionString,n.Entry=e[t],n)):Array.add(this._serverRetryIntervalsInMsIntList,i)}}return this._serverRetryIntervalsInMsIntList}}])&&pn(t.prototype,n),i&&pn(t,i),e}();function mn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function fn(e,t){return(fn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(gn,"RetryHelper",null,[]);var _n=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this)._newAndOpenCommonHelpers=t,i._retryHelper=new gn(n,i.moreInfoNewAndOpenCommonHelpers.newAndOpenTaskManager,"GetMoreInfo"),i._result=new sn,i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,fn(t,n);var r,a,o,l=i.prototype;return l.makeGetMoreInfoRequestOpenDocumentTrigger=function(){this.makeGetMoreInfoRequestInternal("Document opened")},l.createMakeGetMoreInfoRequestRetryTask=function(e){var t=this;return function(n){t.makeGetMoreInfoRequestInternal(e,!0)}},l.onResultRequested=function(e,t){var n,i;(void 0===t&&(t=null),p.ULS.sendTraceTag(5849617,202,50,"Attempting to get GetMoreInfo properties {0}",((n={}).Trigger=e,n)),3===this._result.state)?(t&&this.emitAvailableResultToReceiver(t,this._result),p.ULS.sendTraceTag(5849619,202,50,"GetMoreInfo already populated. {0}",((i={}).Trigger=e,i))):this.makeGetMoreInfoRequestInternal(e);return this._result},l.makeGetMoreInfoRequestInternal=function(e,t){var n;if(void 0===t&&(t=!1),this._retryHelper.resetRetryState(!t),1!==this._result.state){p.ULS.sendTraceTag(5849621,202,50,"Making GetMoreInfo request {0}",((n={}).Trigger=e,n.RetryIndex=this._retryHelper.retryIndex,n)),this._result.state=1;var r=String.format("{0}GetMoreInfoHandler.ashx?{1}",this.moreInfoNewAndOpenCommonHelpers.newAndOpenHandlerUrlPrefix,s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion);this.moreInfoNewAndOpenCommonHelpers.newAndOpenClientRequestManager.addRequestWithHeaderForwarding(r,1,null,null,[i._personalFileStorageUrlHeaderName,i._storageServiceDisplayNameHeaderName],!1,4,this.createGetMoreInfoFromServerSuccessCallback(e),this.createGetMoreInfoFromServerFailureCallback(e),null)}else{var a;p.ULS.sendTraceTag(5849620,202,50,"Not starting new request, because one is already in progress {0}",((a={}).Trigger=e,a.RetryIndex=this._retryHelper.retryIndex,a))}},l.createGetMoreInfoFromServerSuccessCallback=function(e){var t=this;return function(e){var n,r=!1,a=!1,o=!1,l=null;if(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("GetMoreInfoDataFromResponseBody"))if(e.data.responseData)if((n=B.d(e.data.responseData,l),l=n.deserialized,n).returnValue){var c=l;c?(o=!0,t._result._storageServiceDisplayName=c.StorageServiceDisplayName,t._result._personalFileStorageUrl=i.isValidStorageHostUrl(c.PersonalFileStorageUrl)?c.PersonalFileStorageUrl:"",r=""===t._result.personalFileStorageUrl&&""!==t._result.storageServiceDisplayName):p.ULS.sendTraceTag(25298113,202,15,"Response body could not be casted into a GetMoreInfoResponseData type. Will fallback to reading the data from the headers")}else p.ULS.sendTraceTag(25298112,202,15,"Failed to deserialize GetMoreInfo response body. Will fallback to reading the data from the headers");else p.ULS.sendTraceTag(25298083,202,15,"Could not find GetMoreInfo data on the response body. Will fallback to reading the data from the headers");if(!o){var u=e.data.responseHeaders;if(u){t._result._storageServiceDisplayName=(u[i._storageServiceDisplayNameHeaderName]||"").toString();var d=(u[i._personalFileStorageUrlHeaderName]||"").toString();t._result._personalFileStorageUrl=i.isValidStorageHostUrl(d)?d:"",r=""===d&&""!==t._result.storageServiceDisplayName}else p.ULS.sendTraceTag(5849622,202,50,"Null response headers received."),a=!0}var h=String.format("Success at RetryIndex: {0}, InvalidResponse: {1}, InstantiatingPersonalStorage: {2}, InfoFoundInResponseBody: {3}",t._retryHelper.retryIndex,a,r,o);t.moreInfoNewAndOpenCommonHelpers.logRequest("GetMoreInfoActor.CreateGetMoreInfoFromServerSuccessCallback",e.data,h),t.setAndEmitResultState(3,r,a)}},l.createGetMoreInfoFromServerFailureCallback=function(e){var t=this;return function(n){t.moreInfoNewAndOpenCommonHelpers.logRequest("GetMoreInfoActor.CreateGetMoreInfoFromServerFailureCallback",n.data,"Failure"),t.setAndEmitResultState(2),t._retryHelper.startNextRetryTask(t.createMakeGetMoreInfoRequestRetryTask(e))}},l.setAndEmitResultState=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),this._result.state=e,this._result._instantiatingPersonalStorage=t,this._result._invalidResponse=n,this.emitDeferredResultToWaitingReceivers(this._result)},i.getAnInstanceWithResolvedDependencies=function(){return new i(new en.a((function(){return hn.instance})),new en.a((function(){return s.AFrameworkApplication.getMoreInfoRetryIntervalsInMs})))},i.isValidStorageHostUrl=function(e){return e?!!je.a.toLower(e).startsWith("https://")||(p.ULS.sendTraceTag(5849625,202,10,"StorageUrl has invalid scheme."),!1):(p.ULS.sendTraceTag(5849624,202,50,"Attempted to check an empty url for validity as a StorageHostUrl."),!1)},r=i,o=[{key:"instance",get:function(){return i._instance||(i._instance=i.getAnInstanceWithResolvedDependencies())}}],(a=[{key:"moreInfoNewAndOpenCommonHelpers",get:function(){return this._newAndOpenCommonHelpers.value}}])&&mn(r.prototype,a),o&&mn(r,o),i}(tn);function vn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}_n._personalFileStorageUrlHeaderName="PersonalFileStorageUrl",_n._storageServiceDisplayNameHeaderName="StorageServiceDisplayName",_n._instance=null,Object(i.a)(_n,"GetMoreInfoActor",tn,[]);var yn=function(){function e(e,t,n,i,r){this._inactivityCheckInterval=6e4,this.inactiveActionId="inactive",this.activeActionId="active",this._isActive=!0,this._taskManager=e,this._getLatestActivityTime=t,this._getCurrentTime=n,this._timeUntilInactiveInMs=i,this._eventSource=new a.a,r&&this.startInactiveLoop(),this._lastActivityTime=this.getLatestActivityTime()}var t,n,i,o=e.prototype;return o.addBackFromInactiveAction=function(e){this._eventSource.addHandler(this.activeActionId,e)},o.addOnInactiveAction=function(e){this._eventSource.addHandler(this.inactiveActionId,e)},o.startInactiveLoop=function(){var e=new u.a(4,2,this._inactivityCheckInterval,Object(r.a)(this,this.inactiveLoop,"inactiveLoop"),108);this.inactivityTaskManager.addTask(e)},o.inactiveLoop=function(e){var t,n=this.getLatestActivityTime(),i=this.getCurrentTime()-n;i>this.timeUntilInactiveInMs&&this._isActive&&(p.ULS.sendTraceTag(5849626,202,50,"User went inactive {0}",((t={}).TimeSinceLastActive=i,t)),this._isActive=!1,this._eventSource.raiseEvent(this.inactiveActionId));n-this._lastActivityTime>this.timeUntilInactiveInMs&&(this._isActive=!0,this._eventSource.raiseEvent(this.activeActionId)),this._lastActivityTime=n},e.getAnInstanceWithResolvedDependencies=function(){return new e(new en.a((function(){return b.a.instance})),(function(){return s.AFrameworkApplication.latestActivityTime.getTime()}),(function(){return(new Date).getTime()}),new en.a((function(){return s.AFrameworkApplication.timeUntilInactiveInMs})),!0)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getAnInstanceWithResolvedDependencies())}}],(n=[{key:"inactivityTaskManager",get:function(){return this._taskManager.value}},{key:"getLatestActivityTime",get:function(){return this._getLatestActivityTime}},{key:"getCurrentTime",get:function(){return this._getCurrentTime}},{key:"timeUntilInactiveInMs",get:function(){return this._timeUntilInactiveInMs.value}}])&&vn(t.prototype,n),i&&vn(t,i),e}();yn._instance=null,Object(i.a)(yn,"InactivityManager",null,[]);var Sn=function(e){if(!e)return null;var t;try{t=B.b(e)}catch(e){t=null,p.ULS.sendTraceTag(578352835,202,15,"MruActor.TryDeserializeMruV2Response: SecureDeserialize Exception: {0}",e)}return t},bn=function(e,t){var n=null,i=e.service_info;i?n=i.friendly_service_name:p.ULS.sendTraceTag(578352836,202,15,"empty friendly service name");var r=e.display_path;if(!r)return n;for(var a=0;a<r.length;a++){var o=r[a];o&&(n?n+=String.format("{0}{1}",t?" \xab ":" \u200f\xbb ",o):n=o)}return n};function Cn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function An(e,t){return(An=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tn=function(e){var t,n,i,r,a;function o(){var t;return(t=e.call(this)||this)._mruEntries=null,t._mruPlaces=null,t._timestampOfLastUpdate=0,t.state=0,t._invalidResponse=!1,t}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,An(t,n),o.prototype.getResultLogString=function(){return"MruActor Result"},i=o,(r=[{key:"mruEntries",get:function(){return this._mruEntries}},{key:"mruPlaces",get:function(){return this._mruPlaces}},{key:"timestampOfLastUpdate",get:function(){return this._timestampOfLastUpdate}},{key:"invalidResponse",get:function(){return this._invalidResponse}}])&&Cn(i.prototype,r),a&&Cn(i,a),o}(rn);function wn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Tn,"MruResult",rn,[430,429]);var kn=function(){function e(e,t,n){this.task=null,this.initialRetryInterval=e,this.maxRetries=t,this.taskManager=n,this.internalRetryCount=0,this.retryCount=0,this.lastHttpStatusCode=null,this._previousError=null}var t,n,i,r=e.prototype;return r.isPermanentError=function(e,t){return e===R.a.forbidden_403||20===t||18===t||3===t},r.isRetriableOnceError=function(e){return 3===e||5===e||6===e||7===e||9===e||10===e||11===e||12===e||13===e||14===e||15===e||16===e||23===e||26===e},r.reset=function(){this.retryCount=0,this.internalRetryCount=0,this.lastHttpStatusCode=null,this._previousError=null,this.task&&(this.taskManager.deleteTask(this.task),this.task=null)},r.initiateRetry=function(e,t,n,i){if(this._previousError=String.format("{0}_{1}",n,i),this.retryCount>=this.maxRetries)return p.ULS.sendTraceTag(562656907,202,50,"Max retries exceeded"),!1;if(this.isPermanentError(n,i))return p.ULS.sendTraceTag(562656908,202,50,"Encountered permanent error. Not retrying"),!1;if(this.isRetriableOnceError(i)&&this.internalRetryCount>=1)return this.lastHttpStatusCode=n,!1;var r=Math.max(t,this.initialRetryInterval*Math.pow(2,this.internalRetryCount));return 26===i&&(r=3e4),9===i||412===n&&(null==this.lastHttpStatusCode||412!==this.lastHttpStatusCode)?r=500:this.internalRetryCount=this.internalRetryCount+1,this.lastHttpStatusCode=n,this.retryCount=this.retryCount+1,this.task&&this.taskManager.deleteTask(this.task),p.ULS.sendTraceTag(562656909,202,50,"Scheduling next retry after {0} ms.",r),this.task=new u.a(2,1,r,e,107),this.taskManager.addTask(this.task),!0},t=e,(n=[{key:"previousError",get:function(){return this._previousError}}])&&wn(t.prototype,n),i&&wn(t,i),e}();Object(i.a)(kn,"RetryManager",null,[]);var In=function(){this.documentUrl=null,this.folderName=null,this.documentName=null,this.documentExt=null,this.app=null,this.mruItemId=null};Object(i.a)(In,"WriteOptions",null,[]);var Fn=n(195);function En(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Pn(e,t){return(Pn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var On=function(e){var t,n;function i(t,n,i,r,a,o,l){var c;return(c=e.call(this)||this)._newAndOpenCommonHelpers=t,c._localeName=n,c._readRetryManager=new kn(s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.SharedOnline.MruReadRetryIntervalMs",5e3),s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.SharedOnline.MruMaxReadRetry",3),c.openMenuNewAndOpenCommonHelpers.newAndOpenTaskManager),c._writeRetryManager=new kn(s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.SharedOnline.MruWriteRetryIntervalMs",15e3),s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.SharedOnline.MruMaxWriteRetry",3),c.openMenuNewAndOpenCommonHelpers.newAndOpenTaskManager),c._readPlacesFromMru=i,c._writeFileIdInHeader=r,c._writeHeaders={},c._mruResult=new Tn,c._getClientUrl=a,c._mruItemId="",c._docPropertiesProvider=o,c._encodeUrl=l,c}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Pn(t,n);var a,o,c,u=i.prototype;return u.registerWriteMruActions=function(){this.openMenuNewAndOpenCommonHelpers.newAndOpenActionManager.addAction(h.a.renameMostRecentlyUsedFileEntry,ue.a.frame,Object(r.a)(this,this.renameMruEntry,"renameMruEntry"))},u.renameMruEntry=function(e,t,n,i,r){return this.writeToMruV2Internal("Rename")},u.makeUpdateMruRequestOpenTrigger=function(){this.makeUpdateMruRequestInternal("File Opened")},u.makeUpdateMruTask=function(e){this.makeUpdateMruRequestInternal("IntervalUpdate")},u.makeUpdateMruRequestInternal=function(e){var t;p.ULS.sendTraceTag(5849670,202,50,"Starting update of MRU entry {0}",((t={}).Trigger=e,t)),this.writeToMruV2Internal(e)},u.getFileExtension=function(e){var t=je.a.getFileExtension(e);return t&&t.startsWith(".")&&(t=t.substring(1,t.length)),t},u.getAppName=function(){switch(this.openMenuNewAndOpenCommonHelpers.newAndOpenOfficeAppType){case 3:return"Word";case 1:return"Excel";case 2:return"PowerPoint";case 5:return"Visio";case 4:return"OneNote";default:return"Unknown"}},u.getV2WriteBody=function(e){var t=this._getClientUrl();if(!t)return null;var n=new In;this._encodeUrl.value?n.documentUrl=encodeURI(t):n.documentUrl=t,n.mruItemId=this._mruItemId,n.app=this.getAppName();var i=this._docPropertiesProvider();if(i){n.folderName=i.breadcrumbFolderName;var r=i.breadcrumbDocName;n.documentName=je.a.getFileNameWithoutExtension(r),n.documentExt=this.getFileExtension(r)}return e&&(n.documentName?n.documentName.length?n.documentName.length>=255?e.set("DocumentNameLength","Long"):n.documentName.length>=2084&&e.set("DocumentNameLength","VeryLong"):e.set("DocumentNameLength","0"):e.set("DocumentNameLength","Null")),JSON.stringify(n)},u.writeToMruV2Internal=function(e,t){if(void 0===t&&(t=!1),4===this.openMenuNewAndOpenCommonHelpers.newAndOpenOfficeAppType&&!s.AFrameworkApplication.documentIsFolder)return 2;var n=this.createMap();n&&(n.set("Trigger",e),n.set("IsRetry",t?"true":"false"),n.set("MruIdSent",this._mruItemId?"true":"false"),n.set("URLEncoded",this._encodeUrl.value?"true":"false")),l.Health.instance.recordKpiUsage("WriteMru",0,"smartfio",n);var i=this.getV2WriteBody(n);if(!i){var a=!s.AFrameworkApplication.webEditingEnabled;return n&&(n.set("WebEditingIsEnabled",s.AFrameworkApplication.webEditingEnabled?"true":"false"),n.set("ProtectedFile",s.AFrameworkApplication.protectFile?"true":"false")),l.Health.instance.recordKpiFailure("WriteMru","MissingDocumentUrl",a,!1,Object.assign(new V.a,{extendedProperties:n})),2}this._writeRetryManager&&!t&&this._writeRetryManager.reset();var o=String.format("{0}MruV2ServiceHandler.ashx?rs={1}",this.openMenuNewAndOpenCommonHelpers.newAndOpenHandlerUrlPrefix,this.localeName);return this._writeFileIdInHeader?this.writeHeaders["X-FileId"]=s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion:o+=String.format("&{0}",s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),s.AFrameworkApplication.sessionStartInfoSettings&&(this.writeHeaders["X-Office-AudienceGroup"]=Object(P.a)(String,s.AFrameworkApplication.sessionStartInfoSettings.AudienceGroup)||""),this.writeHeaders["X-Timeout"]=s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.SharedOnline.MruWriteTimeout",1e4),this.openMenuNewAndOpenCommonHelpers.newAndOpenClientRequestManager.addRequest(o,2,i,this.writeHeaders,!0,4,Object(r.a)(this,this.writeMruV2EntryOnServerSuccessCallback,"writeMruV2EntryOnServerSuccessCallback"),Object(r.a)(this,this.createWriteMruV2EntryOnServerFailureCallback,"createWriteMruV2EntryOnServerFailureCallback"),null,void 0,void 0,void 0,void 0,"4")},u.writeMruV2EntryOnServerSuccessCallback=function(e){this.handleMruV2WriteSuccess(e.data)},u.handleMruV2WriteSuccess=function(e){var t=this.createMap();this._writeRetryManager&&(t&&this._writeRetryManager.previousError&&(t.set("LastError",this._writeRetryManager.previousError),t.set("NumRetries",this._writeRetryManager.retryCount.toString())),this._writeRetryManager.reset());var n=Sn(e.responseData);n&&n.diagnostics_data&&(this._mruItemId=n.diagnostics_data.mru_id);var i=+e.completedTime-+e.invokedTime;t&&t.set("RequestDuration",i.toString()),l.Health.instance.recordKpiSuccess("WriteMru",Object.assign(new V.a,{extendedProperties:t}))},u.createWriteMruV2EntryOnServerFailureCallback=function(e){if(e.data.httpStatus!==R.a.created_201){var t=e.data.httpStatus===R.a.preconditionFailed_412,n=this.createMap();this.handleRetryOnFailure(this._writeRetryManager,e,this.createV2WriteRetryTask(),n),n&&(n.set("StatusCode",e.data.httpStatus.toString()),t||this.addDiagnosticDataToKpi(e.data,n)),l.Health.instance.recordKpiFailure("WriteMru",String.format("RequestFailed_{0}",e.data.httpStatus),t,!1,Object.assign(new V.a,{extendedProperties:n}))}else this.handleMruV2WriteSuccess(e.data)},u.createV2WriteRetryTask=function(){var e=this;return function(t){e.writeToMruV2Internal("Retry",!0)}},u.getMruFromServerTask=function(e){this.makeGetMruRequestInternal("Polling")},u.getMruFromServerRetryTask=function(e){this.makeGetMruRequestInternal("Retry",!0)},u.makeGetMruRequestOpenTrigger=function(){this.makeGetMruRequestInternal("Open")},u.makeGetMruRequestActivityTrigger=function(){this.makeGetMruRequestInternal("Activity")},u.makeGetMruRequestInternal=function(e,t){var n;void 0===t&&(t=!1),p.ULS.sendTraceTag(5849674,202,50,"Making GetMru request {0}",((n={}).Trigger=e,n));var i=this.createMap();i&&(i.set("Trigger",e),i.set("IsRetry",t?"true":"false")),l.Health.instance.recordKpiUsage("GetMru",0,"smartfio",i),this._readRetryManager&&!t&&this._readRetryManager.reset(),this.createGetMruServerRequest(Object(r.a)(this,this.getMruV2FromServerSuccessCallback,"getMruV2FromServerSuccessCallback"),Object(r.a)(this,this.getMruFromServerFailureCallback,"getMruFromServerFailureCallback"))},u.addDiagnosticDataToKpi=function(e,t){if(e&&e.responseHeaders){var n=e.responseHeaders["X-CorrelationId"];n&&t.set("ServerCorrelationId",n)}},u.createMap=function(){try{return new Map}catch(e){return null}},u.logGetMruKpiSuccess=function(e,t){if(e){if(t){var n=+e.completedTime-+e.invokedTime;t.set("RequestDuration",n.toString())}l.Health.instance.recordKpiSuccess("GetMru",Object.assign(new V.a,{extendedProperties:t}))}},u.getMruV2FromServerSuccessCallback=function(e){var t="",n=null,i=null,r=Sn(e.data.responseData);r&&(n=r.places?r.places.items:[],(i=function(e){if(!e)return[];if(!e.documents)return p.ULS.sendTraceTag(578352838,202,15,"missing documents object"),[];if(!e.documents.items)return p.ULS.sendTraceTag(578352839,202,15,"missing items object"),[];for(var t,n,i=e.documents.items,r=new z.a,a=0;a<i.length;a++){var o=i[a],l=o.web_url;if(!l){if(p.ULS.sendTraceTag(578320064,202,15,"Empty web_url"),!o.url){p.ULS.sendTraceTag(578140248,202,15,"Empty url");continue}l=String.format("{0}?web=1",o.url)}var c={};c.DocumentUrl=l,c.MruId=o.mru_id,c.FileName=(n=void 0,(n=(t=o).title)?(t.extension&&(n=String.format("{0}.{1}",n,t.extension)),n):(p.ULS.sendTraceTag(578352837,202,15,"empty file title"),"")),c.IsPinned=o.is_pinned,c.Path=bn(o,s.AFrameworkApplication.isRtl),r.add(c)}return r.toArray()}(r))&&(t=B.c(i))),s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactFileMenuUxEnabled&&Ct.appChromeAlreadyLoaded()&&appChrome.api.dispatch(appChrome.actions.setFileMenuMRUJson(t,!0));var a=this.createMap();this._readRetryManager&&(a&&this._readRetryManager.previousError&&(a.set("LastError",this._readRetryManager.previousError),a.set("NumRetries",this._readRetryManager.retryCount.toString())),this._readRetryManager.reset()),i||n?(this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.GetMruV2FromServerSuccessCallback",e.data,"Success"),this.updateMruResultState(3,i,n),this.logGetMruKpiSuccess(e.data,a)):(this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.GetMruV2FromServerSuccessCallback",e.data,"Failure: Invalid JSON"),a&&this.addDiagnosticDataToKpi(e.data,a),l.Health.instance.recordKpiFailure("GetMru","JsonParseFailed",!1,!1,Object.assign(new V.a,{extendedProperties:a})),this.updateMruResultState(3,null,null,!0)),this.emitDeferredResultToWaitingReceivers(this._mruResult)},u.handleRetryOnFailure=function(e,t,n,i){var r=0,a=0,o=Sn(t.data.responseData);if(o&&(null!=o.response_code&&(r=o.response_code,i&&i.set("MruResponseCode",r.toString()),9===r&&(this._mruItemId="")),o.error_data&&null!=o.error_data.retry_after_ms&&(a=o.error_data.retry_after_ms,i&&i.set("ExpectedRetryAfter",a.toString()))),e){var s=e.initiateRetry(n,a,t.data.httpStatus,r);i&&(i.set("CurrentRetryCount",e.retryCount.toString()),i.set("RetryScheduled",s?"true":"false"))}},u.getMruFromServerFailureCallback=function(e){var t=e.data.httpStatus===R.a.preconditionFailed_412,n=this.createMap();n&&(n.set("StatusCode",e.data.httpStatus.toString()),t||this.addDiagnosticDataToKpi(e.data,n)),this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.GetMruFromServerFailureCallback",e.data,"Failure"),this.updateMruResultState(2),this.handleRetryOnFailure(this._readRetryManager,e,Object(r.a)(this,this.getMruFromServerRetryTask,"getMruFromServerRetryTask"),n),l.Health.instance.recordKpiFailure("GetMru",String.format("RequestFailed_{0}",e.data.httpStatus),t,!1,Object.assign(new V.a,{extendedProperties:n})),this.emitDeferredResultToWaitingReceivers(this._mruResult),s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactFileMenuUxEnabled&&Ct.appChromeAlreadyLoaded()&&appChrome.api.dispatch(appChrome.actions.setFileMenuMRUJson("",!1))},u.updateMruResultState=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=!1),3===this._mruResult.state&&3!==e||(this._mruResult._mruEntries=t,this._mruResult._mruPlaces=n,this._mruResult.state=e,this._mruResult._invalidResponse=i,this._mruResult._timestampOfLastUpdate=this.openMenuNewAndOpenCommonHelpers.getCurrentTime())},u.onResultRequested=function(e,t){var n;return p.ULS.sendTraceTag(6029918,202,50,"MRU result requested {0}",((n={}).Trigger=e,n.ResultState=this._mruResult.state,n)),t&&3===this._mruResult.state&&this.emitAvailableResultToReceiver(t,this._mruResult),this._mruResult},u.createGetMruServerRequest=function(e,t){var n;this.updateMruResultState(1);var i={};n=String.format(this.openMenuNewAndOpenCommonHelpers.newAndOpenHandlerUrlPrefix+"MruV2ServiceHandler.ashx?sort=Date&show={0}&apps={1}&rs={2}",10,this.getAppName(),this.localeName),this._readPlacesFromMru.value||(n+="&entity=docs"),s.AFrameworkApplication.sessionStartInfoSettings&&(i["X-Office-AudienceGroup"]=Object(P.a)(String,s.AFrameworkApplication.sessionStartInfoSettings.AudienceGroup)||""),this._writeFileIdInHeader?i["X-FileId"]=s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion:n+=String.format("&{0}",s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),this.openMenuNewAndOpenCommonHelpers.newAndOpenClientRequestManager.addRequest(n,1,null,i,!0,4,e,t,null)},u.tryDeserializeJson=function(e){var t;try{t=B.b(e)}catch(e){t=null,p.ULS.sendTraceTag(5849675,202,10,"MruActor.TryDeserializeJson: Exception thrown from JsonSerializer.SecureDeserialize Exception: {0}",e)}return t},i.getAnInstanceWithResolvedDependencies=function(){return new i(new en.a((function(){return hn.instance})),new en.a((function(){return Fn.a.getCultureInfo(s.AFrameworkApplication.lcid).name})),new en.a((function(){return s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled})),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("MruWriteFileIdInHeader"),(function(){return s.AFrameworkApplication.activeFrame.applicationInstance.clientUrl}),(function(){return s.AFrameworkApplication.docPropertiesProvider}),new en.a((function(){return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICEncodeUrlIsEnabled")})))},a=i,c=[{key:"instance",get:function(){return i._instance||(i._instance=i.getAnInstanceWithResolvedDependencies())}}],(o=[{key:"writeHeaders",get:function(){return this._writeHeaders}},{key:"openMenuNewAndOpenCommonHelpers",get:function(){return this._newAndOpenCommonHelpers.value}},{key:"localeName",get:function(){return this._localeName.value}}])&&En(a.prototype,o),c&&En(a,c),i}(tn);function Rn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}On.currentDocumentDAVUrlHeaderName="CurrentDocumentDAVUrl",On.newDocumentDAVUrlHeaderName="NewDocumentDAVUrl",On.newFileNameHeaderName="NewFileName",On._instance=null,Object(i.a)(On,"MruActor",tn,[]);var Mn=function(){function e(){this._container=null,this._readFromMruTask=null,this._updateMruTask=null,this._isDisposed=!1}var t,n,i,a=e.prototype;return a.configure=function(e){this._container=e,e.register(388,"Common.INewAndOpenCommonHelpers").singleInstance().usingFactory((function(){return hn.instance})),e.register(389,"Common.IEventEmitter<Common.IGetMoreInfoResult>").singleInstance().usingFactory((function(){return _n.instance})),e.register(389,"Common.IEventEmitter<Common.IMruResult>").singleInstance().usingFactory((function(){return On.instance}))},a.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){e.initOnFullAppSettingsReady()}))},a.initOnFullAppSettingsReady=function(){this._container.resolve("Common.INewAndOpenCommonHelpers"),this._container.resolve("Common.IEventEmitter<Common.IGetMoreInfoResult>"),this._container.resolve("Common.IEventEmitter<Common.IMruResult>");var e=!1;if(hn.instance.registerCommonActions(),s.AFrameworkApplication.newDocumentDestinationHost&&(e=!0),s.AFrameworkApplication.readFromMruIsEnabled&&(On.instance.makeGetMruRequestOpenTrigger(),s.AFrameworkApplication.mruPollingIntervalInMs>0&&this.addGetMruFromServerTask(),this.setupReadFromMruInactivityActions(),e=!0),s.AFrameworkApplication.supportsGetMoreInfoForPersonalStorage&&e&&_n.instance.makeGetMoreInfoRequestOpenDocumentTrigger(),s.AFrameworkApplication.updateMruIsEnabled){var t=On.instance;t.registerWriteMruActions(),t.makeUpdateMruRequestOpenTrigger(),b.a.instance.addTask(this.updateMruTask)}},a.setupReadFromMruInactivityActions=function(){yn.instance.addBackFromInactiveAction(Object(r.a)(On.instance,On.instance.makeGetMruRequestActivityTrigger,"makeGetMruRequestActivityTrigger")),yn.instance.addBackFromInactiveAction(Object(r.a)(this,this.addGetMruFromServerTask,"addGetMruFromServerTask")),yn.instance.addOnInactiveAction(Object(r.a)(this,this.deleteGetMruFromServerTask,"deleteGetMruFromServerTask"))},a.deleteGetMruFromServerTask=function(){b.a.instance.deleteTask(this.mruReadTask)},a.addGetMruFromServerTask=function(){b.a.instance.addTask(this.mruReadTask)},a.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._updateMruTask&&(b.a.instance.deleteTask(this._updateMruTask),this._updateMruTask=null))},t=e,(n=[{key:"name",get:function(){return"Common.App.NewAndOpen.Core"}},{key:"mruReadTask",get:function(){return this._readFromMruTask||(this._readFromMruTask=new u.a(4,2,s.AFrameworkApplication.mruPollingIntervalInMs,Object(r.a)(On.instance,On.instance.getMruFromServerTask,"getMruFromServerTask"),109))}},{key:"updateMruTask",get:function(){return this._updateMruTask||(this._updateMruTask=new u.a(2,2,6e4*s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.SharedOnline.MruUpdateIntervalInMinutes",1440),Object(r.a)(On.instance,On.instance.makeUpdateMruTask,"makeUpdateMruTask"),197))}}])&&Rn(t.prototype,n),i&&Rn(t,i),e}();Object(i.a)(Mn,"CorePackageManager",null,[20,21,4]);var Dn=function(){};Object(i.a)(Dn,"ShellRenderData",null,[]);var xn=function(){function e(){}return e.truncateIfNecessary=function(e){if(!e)return"{NULL}";var t=e.length;if(t<=600)return e;var n=t-195;return e.substring(0,400)+"[...]"+e.substring(n,t)},e}();function Ln(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(xn,"LogUtils",null,[]);var Bn=function(){function e(t,n,i){this._o365ShellJsLoaded=!1,this._o365ShellCssLoaded=!1,this._shellDataJsonStr=null,this._shellDataObject=null,this._switcherDomElement=null,this._shellServiceInfoStringAsyncTcs=new C.a,this._clientRequestManager=t,this._officeAppType=i,this._webServiceBase=n.appSettings[e.webServiceBaseSettingName]||""}var t,n,i,a=e.prototype;return a.requestShellServiceInfo=function(){this._switcherDomElement=document.getElementById(e.switcherContainerId);var t={};t[e.handlerQuerySigatureHeaderName]=s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion,t["Content-Type"]="application/json; charset=utf-8",p.ULS.sendTraceTag(6612806,215,50,"Client is sending a request to get the code for the O365 switcher");var n=Dt.a.addOrReplaceParameterValue(this._webServiceBase+e.shellServiceProxyName,e.officeAppTypeParameterName,s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType.toString());this.clientRequestManager.addRequest(n,1,"",t,!0,2,Object(r.a)(this,this.onSuccessCallback,"onSuccessCallback"),Object(r.a)(this,this.onFailureCallback,"onFailureCallback"),null,void 0,void 0,void 0,void 0,"20")},a.logNavBarData=function(e){try{var t={};t.FlightName=e.FlightName,t.SessionID=e.SessionID,p.ULS.sendTraceTag(594883776,215,50,B.c(t))}catch(e){p.ULS.sendTraceTag(594883747,215,10,"Unable to log NavBarData")}},a.onSuccessCallback=function(e){var t;if(!(t=e.data.responseData)||!t.length)return this.showFailureMessage(),void p.ULS.sendTraceTag(6362369,215,10,"Response from O365ShellServiceProxy is null.");try{var n,i,r=B.a(t);if(s.AFrameworkApplication.activeFrame.applicationInstance.isReactSharedHeaderUxEnabled?(this._shellDataJsonStr=r.NavBarDataJson,p.ULS.sendTraceTag(41551899,215,50,"Skipping call to TryLoadResources for React Shared Header.")):this.tryLoadResources(r)&&(this._shellDataJsonStr=r.NavBarDataJson),!this._shellDataJsonStr)return p.ULS.sendTraceTag(9000737,215,15,"ShellData is null"),void this._shellServiceInfoStringAsyncTcs.setCanceled();if(!(n=B.d(r.NavBarDataJson,this._shellDataObject),this._shellDataObject=n.deserialized,n).returnValue)return p.ULS.sendTraceTag(7660113,215,10,"Failed to deserialize : {0}",((i={}).ShellData=xn.truncateIfNecessary(this._shellDataJsonStr),i)),void this._shellServiceInfoStringAsyncTcs.setCanceled();this.logNavBarData(this._shellDataObject),this._shellServiceInfoStringAsyncTcs.setResult(this._shellDataObject)}catch(e){this.showFailureMessage(),p.ULS.sendTraceTag(6362370,215,10,"Unable to parse the response from O365ShellServiceProxy."),this._shellServiceInfoStringAsyncTcs.setCanceled()}},a.onFailureCallback=function(e){this._switcherDomElement&&this.showFailureMessage(),this._shellServiceInfoStringAsyncTcs.setCanceled(),p.ULS.sendTraceTag(7608091,215,10,"Call to O365ShellServiceProxy failed.")},a.tryLoadResources=function(e){if(!e.JsUrl||!e.JsUrl.length)return this.showFailureMessage(),p.ULS.sendTraceTag(6387854,215,10,"Empty or null JS URL."),!1;var t=Y.a.create(e.JsUrl);if(t.add_loadFinished(Object(r.a)(this,this.o365ShellJs_LoadFinished,"o365ShellJs_LoadFinished")),Z.a.enqueueResourceWithoutEnabling(t),!e.CssUrl||!e.CssUrl.length)return this.showFailureMessage(),p.ULS.sendTraceTag(6387855,215,10,"Empty or null CSS URL."),!1;var n=new ht(e.CssUrl);return n.add_loadFinished(Object(r.a)(this,this.o365ShellCss_LoadFinished,"o365ShellCss_LoadFinished")),Z.a.enqueueResourceWithoutEnabling(n),!0},a.o365ShellCss_LoadFinished=function(e,t){t.succeeded?(this._o365ShellCssLoaded=!0,this.renderO365ShellIfReady()):(p.ULS.sendTraceTag(7608092,215,10,"CSS failed to load"),this.showFailureMessage())},a.o365ShellJs_LoadFinished=function(e,t){t.succeeded?(this._o365ShellJsLoaded=!0,this.renderO365ShellIfReady()):(p.ULS.sendTraceTag(7608093,215,10,"JS failed to load"),this.showFailureMessage())},a.renderO365ShellIfReady=function(){if(this._o365ShellCssLoaded&&this._o365ShellJsLoaded){if(!this._switcherDomElement)return void p.ULS.shipAssertTag(7608280,215,!1);Sys.UI.DomElement.removeCssClass(this._switcherDomElement,e.loadingCssClass);var t=document.createElement("div");t.id=e.shellContainerId,this._switcherDomElement.appendChild(t),this.renderO365ShellInternal()}},a.renderO365ShellInternal=function(){var t=window.self.O365Shell;if(!t)return this.showFailureMessage(),void p.ULS.shipAssertTag(6613128,215,!1);if(!t.SetData)return this.showFailureMessage(),void p.ULS.shipAssertTag(6613129,215,!1);if(!this._shellDataJsonStr)return this.showFailureMessage(),void p.ULS.shipAssertTag(6613130,215,!1);if(this._shellDataObject){t.SetData(this._shellDataObject);var n=Object.assign(new Dn,{launcher:e.shellContainerId,switcher:e.switcherContainerId});if(!t.RenderAsync)return this.showFailureMessage(),void p.ULS.shipAssertTag(6613131,215,!1);t.RenderAsync(n,Object(r.a)(this,this.onSwitcherRendered,"onSwitcherRendered"))}else this.showFailureMessage()},a.onSwitcherRendered=function(){if(this._switcherDomElement){var e=this._switcherDomElement.getElementsByTagName("a");e&&e.length>0&&e[0]&&"none"!==this._switcherDomElement.style.display&&e[0].focus(),s.AFrameworkApplication.theActionManager.processAction(h.a.o365SwitcherReady,2),p.ULS.sendTraceTag(6612807,215,50,"O365 switcher tiles added to the DOM.")}else p.ULS.sendTraceTag(41551900,215,15,"Switcher DOM element is null. Cannot append shell container.")},a.showFailureMessage=function(){this._switcherDomElement&&!Sys.UI.DomElement.containsCssClass(this._switcherDomElement,e.errorCssClass)&&(Sys.UI.DomElement.removeCssClass(this._switcherDomElement,e.loadingCssClass),Sys.UI.DomElement.addCssClass(this._switcherDomElement,e.errorCssClass),p.ULS.sendTraceTag(7129104,215,10,"Failed to display O365 Shell Switcher."))},e.getAnInstanceWithResolvedDependecies=function(){return new e(new en.a((function(){return s.AFrameworkApplication.theClientRequestManager})),s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getAnInstanceWithResolvedDependecies())}}],(n=[{key:"shellServiceDataAsync",get:function(){return this._shellServiceInfoStringAsyncTcs.task}},{key:"clientRequestManager",get:function(){return this._clientRequestManager.value}}])&&Ln(t.prototype,n),i&&Ln(t,i),e}();function Un(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Bn.handlerQuerySigatureHeaderName="X-qs",Bn.officeAppTypeParameterName="at",Bn.shellServiceProxyName="O365ShellServiceProxy.ashx",Bn._instance=null,Bn.switcherContainerId="sw_bar",Bn.loadingCssClass="SwitcherLoading",Bn.errorCssClass="SwitcherError",Bn.shellContainerId="ShellContainer",Bn.webServiceBaseSettingName="ShellWebServiceBase",Object(i.a)(Bn,"O365ShellActor",null,[401]);var Hn=function(){function e(){this._container=null}var t,n,i,a=e.prototype;return a.configure=function(e){this._container=e,this._container.register(Bn,"Common.App.O365Shell.O365ShellActor").as("Common.App.O365Shell.IO365ShellActor").singleInstance().usingFactory((function(){return new Bn(new en.a((function(){return s.AFrameworkApplication.theClientRequestManager})),s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType)}))},a.init=function(){s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(Object(r.a)(this,this.onFullAppSettingsReady,"onFullAppSettingsReady"))},a.onFullAppSettingsReady=function(){s.AFrameworkApplication.useO365ShellService&&(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("AppSwitcherMitigationIsEnabled")&&!s.AFrameworkApplication.activeFrame.applicationInstance.isReactSharedHeaderUxEnabled||this._container.resolve("Common.App.O365Shell.O365ShellActor").requestShellServiceInfo())},a.dispose=function(){},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.O365Shell"}}])&&Un(t.prototype,n),i&&Un(t,i),e}();Object(i.a)(Hn,"PackageManager",null,[20,21]);var Nn=n(59);function Wn(e,t){return(Wn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var jn=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).buttonsOption=0,t.setButtonText(1,CommonUIStrings.l_DialogClose),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Wn(t,n);var r=i.prototype;return r.displayError=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_OneDriveContactError,null)},r.displayWarning=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_OneDriveContactError,null,!0)},i}(Nn.StandardDialog);Object(i.a)(jn,"ErrorDialog",Nn.StandardDialog,[410]);var Vn=function(){function e(){}return e.prototype.getApiEndpoint=function(){p.ULS.sendTraceTag(24134234,352,50,"Returning endpoint for ODC");var e=new C.a;return e.setResult("api.onedrive.com"),e.task},e}();Object(i.a)(Vn,"OneDriveConsumerEndpointHelper",null,[368]);var qn=n(21);function Gn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Kn=function(){function e(e,t,n,i){this.onFilePickerClosedCallback=null,this._onApiReadyCallback=null,this._setup=!1,this._settingUp=!1,this._oneDriveApiScript=null,this._appSettingsManager=e,this._appEnvironment=t,this._limitedEdit=n,this._errorDialogFactory=i}var t,n,i,a=e.prototype;return a.getOneDriveApi=function(){return this._oneDriveApiScript||(this._oneDriveApiScript=this.oneDriveApiUrl?Y.a.create(this.oneDriveApiUrl,null,null,null,!1):null),this._oneDriveApiScript},a.setup=function(e){var t=this;if(this._onApiReadyCallback=e,this._setup||this._settingUp)this._setup&&this._onApiReadyCallback&&this._onApiReadyCallback(!0);else{var n=this.getOneDriveApi();if(!n)return p.ULS.sendTraceTag(20509837,352,15,"Failure with OneDrive API download as the onedrive url received is empty."),void this._onApiReadyCallback(!1);this._settingUp=!0,n.loadFinishedTask.continueWith((function(e){t.onOneDriveApiScriptLoaded(e)})),Z.a.enqueueResourceWithoutEnabling(n)}},a.onJsDownloadFail=function(e){p.ULS.sendTraceTag(20509838,352,15,"Failure during OneDrive API download: {0}",e.exception?e.exception.toString():"No error detail.")},a.onOneDriveApiScriptLoaded=function(e){if(this._settingUp=!1,e.isFaulted)return this.onJsDownloadFail(e),void this._onApiReadyCallback(!1);try{this._setup=!0,p.ULS.sendTraceTag(17909022,352,50,"Initializing OneDrive API"),this.initializeApi(),p.ULS.sendTraceTag(17909023,352,50,"OneDrive API is initialized."),this._onApiReadyCallback(!0)}catch(e){p.ULS.sendTraceTag(20555412,352,10,"Failed during OneDrive API init: {0}",e.toString()),this._onApiReadyCallback(!1)}},a.startPicker=function(e){this.onFilePickerClosedCallback=e,this._limitedEdit?p.ULS.sendTraceTag(23881878,216,50,"In limited edit mode, will not show Picker."):(p.ULS.sendTraceTag(23881877,216,50,"Not in limited edit mode, will show file picker."),this.setup(Object(r.a)(this,this.onApiReady,"onApiReady")))},a.onApiReady=function(e){e?this.launchFilePicker():this.showErrorDialog()},a.showErrorDialog=function(){this._errorDialogFactory().displayError(qn.a.oneDriveFilePickerNotJSON)},a.onSuccess=function(e){p.ULS.sendTraceTag(17909057,352,50,"Success Callback called. Calling callback function."),this.onFilePickerClosedCallback&&this.onFilePickerClosedCallback(!0,e)},a.dispose=function(){this._oneDriveApiScript&&this._oneDriveApiScript.dispose()},t=e,(n=[{key:"appEnvironment",get:function(){return this._appEnvironment}},{key:"appSettingsManager",get:function(){return this._appSettingsManager}}])&&Gn(t.prototype,n),i&&Gn(t,i),e}();function zn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Xn(e,t){return(Xn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Kn,"AOneDriveFilePickerApiManager",null,[376,4]);var Jn=function(e){var t,n;function i(t,n,i,r,a,o){var s;return(s=e.call(this,n,i,r,o)||this)._options=null,s._signOutResponse=t,s._showRequireSignInDialog=a,s}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Xn(t,n);var a,o,s,l=i.prototype;return l.start=function(e,t){this._options=e,this.startPicker(t)},l.initializeApi=function(){var e,t,n=1===this.appEnvironment||2===this.appEnvironment?((e={}).client_id=this.appSettingsManager.appSettings.UploadToSkyDriveClientId,e):((t={}).client_id=this.appSettingsManager.appSettings.UploadToSkyDriveClientId,t.env="INT",t);WL.init(n)},l.startPicker=function(e){this.onFilePickerClosedCallback=e,!this._limitedEdit&&this._signOutResponse.isAuthenticated?(p.ULS.sendTraceTag(17909025,352,50,"User is signed in. We will show file picker."),this.setup(Object(r.a)(this,this.onApiReady,"onApiReady"))):(p.ULS.sendTraceTag(17909026,352,50,"User is not signed in. show need to sign in dialog."),this._showRequireSignInDialog())},l.launchFilePicker=function(){try{p.ULS.sendTraceTag(17909027,352,50,"Launching file dialogue"),WL.fileDialog(this._options).then(Object(r.a)(this,this.onSuccess,"onSuccess"),Object(r.a)(this,this.onFailure,"onFailure"))}catch(e){p.ULS.sendTraceTag(17909056,352,10,"OneDrive API Failure. [Exception:{0}] [Stack:{1}]",e,e.stack),this.showErrorDialog()}},l.onFailure=function(e){var t=e;if(e&&t.error){if("user_canceled"===t.error.code)return void p.ULS.sendTraceTag(17909058,352,50,"User canceled.");p.ULS.sendTraceTag(17909059,352,50,"File Dialog returned with error code:{0}, and error message: {1}",t.error.code,t.error.message)}else p.ULS.sendTraceTag(17909060,352,50,"File Dialog returned with no response");this.onFilePickerClosedCallback&&this.onFilePickerClosedCallback(!1,e),this.showErrorDialog()},a=i,(o=[{key:"oneDriveApiUrl",get:function(){return this.appSettingsManager.getStringAppSetting("OneDriveApiUrl")}}])&&zn(a.prototype,o),s&&zn(a,s),i}(Kn);function Qn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Zn(e,t){return(Zn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Jn,"OneDriveFilePickerApiManagerV5",Kn,[]);var Yn=function(e){var t,n;function i(t,n,i,a,o){var s;return(s=e.call(this,t,n,i,a)||this)._oneDriveApiEndpoint=null,s._hostDivElement=null,s._endpointHelper=o,s.options={},s.options.clientId=s.appSettingsManager.getStringAppSetting("OneDriveApiV7ClientId"),s.options.cancel=Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(s),s.toggleHostDivVisibility,"toggleHostDivVisibility"),s}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Zn(t,n);var a,o,s,l=i.prototype;return l.start=function(e,t){var n=this;this._hostDivElement=t;var i=this._endpointHelper.getApiEndpoint();i.continueWith((function(t){p.ULS.sendTraceTag(24134241,352,50,"Fetch endpoint task completed, attempting to start OneDrive picker"),n._oneDriveApiEndpoint=i.result,n.startPicker((function(t,i){n.toggleHostDivVisibility(),e(t,i)}))}),3),i.continueWith((function(e){p.ULS.sendTraceTag(24134242,352,15,i.exception.message),n.toggleHostDivVisibility()}),5)},l.initializeApi=function(){var e=this;this.options.success=function(t){var n={};n.data=t,e.onSuccess(n)},this.options.error=function(t){var n={};n.error=t,e.onFailure(n)},this.options.advanced={},this.options.advanced.linkType="share",this.options.advanced.endpointHint=this._oneDriveApiEndpoint,this.options.advanced.iframeParentDiv=this._hostDivElement},l.launchFilePicker=function(){try{p.ULS.sendTraceTag(22090007,352,50,"Launching OneDrive file picker dialog"),this.toggleHostDivVisibility(),OneDrive.open(this.options)}catch(e){p.ULS.sendTraceTag(22090008,352,10,"Opening OneDrive file picker threw an exception: {0}",e.message),this.showErrorDialog()}},l.onFailure=function(e){this.onFilePickerClosedCallback&&this.onFilePickerClosedCallback(!1,e),this.showErrorDialog()},l.toggleHostDivVisibility=function(){this._hostDivElement.style.visibility="hidden"===this._hostDivElement.style.visibility?"":"hidden"},a=i,(o=[{key:"oneDriveApiUrl",get:function(){return this.appSettingsManager.getStringAppSetting("OneDriveApiV72Url")}}])&&Qn(a.prototype,o),s&&Qn(a,s),i}(Kn);function $n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ei(e,t){return(ei=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Yn,"OneDriveFilePickerApiManagerV7",Kn,[]);var ti=function(e){var t,n;function i(t,n,i,r){var a;return(a=e.call(this,t,n,i,r)||this).options={},a.options.advanced={},a.options.action="query",a.options.clientId=a.appSettingsManager.getStringAppSetting("OneDriveApiV72ClientId"),a.options.advanced.trapFocus=!0,a}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ei(t,n);var a,o,s,l=i.prototype;return l.start=function(e,t,n,i){this.options.advanced.iframeParentDiv=n,this.options.advanced.endpointHint=i,this.options.cancel=t,this.options.advanced.navigation={},this.startPicker(e)},l.startPicker=function(e){this.onFilePickerClosedCallback=e,this._limitedEdit?p.ULS.sendTraceTag(24391838,216,50,"In limited edit mode, will not show Picker."):(p.ULS.sendTraceTag(24391837,216,50,"Not in limited edit mode, will show file picker."),this.setup(Object(r.a)(this,this.onApiReady,"onApiReady")))},l.initializeApi=function(){var e=this;this.options.success=function(t){var n={};n.data=t,e.onSuccess(n)},this.options.error=function(t){var n={};n.error=t,e.onFailure(n)}},l.launchFilePicker=function(){try{p.ULS.sendTraceTag(23881879,216,50,"Launching OneDrive file picker dialog"),OneDrive.save(this.options)}catch(e){p.ULS.sendTraceTag(23881880,216,10,"Opening OneDrive file picker fail. Exception: {0}, Callstack: {1}.",e.message,e.stack),this.showErrorDialog()}},l.onJsDownloadFail=function(e){p.ULS.sendTraceTag(25180160,216,15,"Failure during OneDrive API download: {0}",e.exception?e.exception.toString():"No error detail."),Z.a.removeReferenceForRetryDownload(this.oneDriveApiUrl),this._oneDriveApiScript=null},l.showErrorDialog=function(){this._errorDialogFactory().displayWarning(qn.a.saveAsToOneDriveFailed_FilePicker)},l.onFailure=function(e){this.onFilePickerClosedCallback&&this.onFilePickerClosedCallback(!1,e)},a=i,(o=[{key:"oneDriveApiUrl",get:function(){return this.appSettingsManager.getStringAppSetting("OneDriveApiV72Url")}}])&&$n(a.prototype,o),s&&$n(a,s),i}(Kn);Object(i.a)(ti,"OneDriveFilePickerApiManagerV72",Kn,[]);var ni=function(e){this.key=null,this.value=null,this.olsSessionId=null,this.olsSessionId=e};function ii(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ri(e,t){return(ri=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ni,"IExtraData",null,[]);var ai=function(e){var t,n,i,r,a;function o(t,n,i,r){var a;return(a=e.call(this,t,n,i,r)||this).options.advanced.filter=t.getStringAppSetting("OneDriveApiV72Filter")||"folder,photo",a.options.advanced.linkType="download",a.options.multiSelect=s.AFrameworkApplication.appSupportsMultiInsertOnlinePictureFromHost,t.getBooleanAppSetting("OneDriveApiV72CommandModeEnabled")&&(a.options.commandMode=t.getStringAppSetting("OneDriveApiV72CommandMode")||"none"),t.getBooleanAppSetting("OneDriveApiV72QosExtraDataEnabled")&&(a.options.qosExtradata=new ni(s.AFrameworkApplication.userSessionId)),a}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,ri(t,n),o.prototype.launchFilePicker=function(){try{var e=this.options.qosExtradata?this.options.qosExtradata.olsSessionId:"";p.ULS.sendTraceTag(26071182,352,50,"Launching OneDrive file picker dialog with filter: {0}, commandMode: {1}, QosExtraData: {2} officeSessionId: {3}",this.options.advanced.filter,this.options.commandMode,e,s.AFrameworkApplication.userSessionId),OneDrive.open(this.options)}catch(e){p.ULS.sendTraceTag(26071183,352,10,"Opening OneDrive file picker fail. Exception: {0}, Callstack: {1}.",e.message,e.stack),this.showErrorDialog()}},i=o,(r=[{key:"oneDriveApiUrl",get:function(){return this.appSettingsManager.getStringAppSetting("OneDriveApiV72Url")}}])&&ii(i.prototype,r),a&&ii(i,a),o}(ti);Object(i.a)(ai,"OneDriveFilePickerApiOpenManagerV72",ti,[]);var oi=function(){function e(e){this._tcs=null,this._clientRequestManager=e,this._retriesRemaining=3}var t=e.prototype;return t.getApiEndpoint=function(){return this._tcs=new C.a,p.ULS.sendTraceTag(24134235,352,50,"Sending initial request for OneDrive for Business Endpoint"),this.sendGetMoreInfoRequest(),this._tcs.task},t.sendGetMoreInfoRequest=function(e){void 0===e&&(e=null);var t=String.format("GetMoreInfoHandler.ashx?{0}",s.AFrameworkApplication.currentFileBaseDocQuerySignatureWithoutVersion);this._clientRequestManager.addRequestWithHeaderForwarding(t,1,null,e,["PersonalFileStorageUrl","X-NewKey"],!1,2,Object(r.a)(this,this.getMoreInfoSucceeded,"getMoreInfoSucceeded"),Object(r.a)(this,this.getMoreInfoFailed,"getMoreInfoFailed"),null,void 0,void 0,void 0,void 0,"21")},t.getMoreInfoFailed=function(e){if(e.data.httpStatus===R.a.preconditionFailed_412&&"X-NewKey"in e.data.responseHeaders){p.ULS.sendTraceTag(24134236,352,50,"GetMoreInfo request failed due to bad canary. Updating with new canary and resending");var t={};t["X-Key"]=e.data.responseHeaders["X-NewKey"],this.sendGetMoreInfoRequest(t)}else this._retriesRemaining>0?(p.ULS.sendTraceTag(24134237,352,50,"GetMoreInfo request failed, attmepting again. {0} retries remaining",this._retriesRemaining),this._retriesRemaining--,this.sendGetMoreInfoRequest()):(p.ULS.sendTraceTag(24134238,352,50,"GetMoreInfo request failed, and no more retries remaining. Faulting task"),this._tcs.setException(Error.create("GetMoreInfo request failed and no more retries remain")))},t.getMoreInfoSucceeded=function(e){"PersonalFileStorageUrl"in e.data.responseHeaders&&""!==e.data.responseHeaders.PersonalFileStorageUrl?(p.ULS.sendTraceTag(24134239,352,50,"Successfully received an ODB endpoint"),this._tcs.setResult(e.data.responseHeaders.PersonalFileStorageUrl)):(p.ULS.sendTraceTag(24134240,352,50,"GetMoreInfo request was successful but didn't return an ODB endpoint"),this._tcs.setException(Error.create("GetMoreInfo request succeeded but did not have ODB endpoint")))},e}();Object(i.a)(oi,"OneDriveForBusinessEndpointHelper",null,[368]);var si=n(218);function li(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ci=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){},r.dispose=function(){},r.configure=function(e){var t=this;this._container=e,this._container.register(Jn,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV5").as("Common.App.OneDriveFilePickerApi.IOneDriveFilePickerApiManager").singleInstance().usingFactory((function(){return new Jn(si.a.instance,s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,s.AFrameworkApplication.limitedEdit,s.AFrameworkApplication.showRequiresSignInDialog,(function(){return new jn}))})),s.AFrameworkApplication.isSkyDrive?this._container.register(368,"Common.App.OneDriveFilePickerApi.IOneDriveApiEndpointHelper").singleInstance().usingFactory((function(){return new Vn})):this._container.register(368,"Common.App.OneDriveFilePickerApi.IOneDriveApiEndpointHelper").singleInstance().usingFactory((function(){return new oi(s.AFrameworkApplication.theClientRequestManager)})),this._container.register(Yn,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV7").singleInstance().usingFactory((function(){return new Yn(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,s.AFrameworkApplication.limitedEdit,(function(){return new jn}),t._container.resolve("Common.App.OneDriveFilePickerApi.IOneDriveApiEndpointHelper"))})),this._container.register(ti,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV72").singleInstance().usingFactory((function(){return new ti(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,s.AFrameworkApplication.limitedEdit,(function(){return new jn}))})),this._container.register(ai,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiOpenManagerV72").singleInstance().usingFactory((function(){return new ai(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,s.AFrameworkApplication.limitedEdit,(function(){return new jn}))}))},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.OneDriveFilePickerApi"}}])&&li(t.prototype,n),i&&li(t,i),e}();Object(i.a)(ci,"PackageManager",null,[20,21]);function ui(e,t){return(ui=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var di=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).buttonsOption=0,t.setButtonText(1,CommonUIStrings.l_DialogClose),t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ui(t,n),i.prototype.displayError=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_ErrorSavingToOneDrive,null)},i}(Nn.StandardDialog);Object(i.a)(di,"ErrorDialog",Nn.StandardDialog,[406]);var hi=function(){};hi.default=0,Object(i.a)(hi,"SaveToCloudErrorCodes",null,[]);var pi=function(){function e(e,t,n,i,r,a){this._options=null,this._signInFactory=e,this._signOutResponse=t,this._uploadToCloudManager=n,this._appSettingsManager=i,this._appEnvironment=r,this._errorDialogFactory=a}var t=e.prototype;return t.start=function(e){this._options=e,this._signOutResponse.isAuthenticated?(p.ULS.sendTraceTag(6590559,216,50,"User is signed in. We will show file picker."),this.callFilePicker()):(p.ULS.sendTraceTag(6590560,216,50,"User is not signed in. We will show sign in dialog."),this.showSignInDialog())},t.showSignInDialog=function(){this._signInFactory.create().displayDialog()},t.showErrorDialog=function(){this._errorDialogFactory().displayError(hi.default)},t.callFilePicker=function(){try{var e,t;p.ULS.sendTraceTag(6590561,216,50,"Initializing OneDrive API");var n,i=((e={}).client_id=this._appSettingsManager.appSettings.UploadToSkyDriveClientId,e.env="INT",e);if(1===this._appEnvironment||2===this._appEnvironment)(n={}).client_id=this._appSettingsManager.appSettings.UploadToSkyDriveClientId,i=n;var a=((t={}).mode="save",t.lightbox="grey",t);WL.init(i),p.ULS.sendTraceTag(6590562,216,50,"OneDrive API is initialized. Launching file dialogue"),WL.fileDialog(a).then(Object(r.a)(this,this.onSuccess,"onSuccess"),Object(r.a)(this,this.onFailure,"onFailure"))}catch(e){p.ULS.sendTraceTag(6590563,216,10,"OneDrive API Failure. [Exception:{0}] [Stack:{1}]",e,e.stack),this.showErrorDialog()}},t.onSuccess=function(e){p.ULS.sendTraceTag(6590592,216,50,"Success Callback called. Calling UploadToCloudManger to start upload."),e&&e.data&&e.data.folders&&this._uploadToCloudManager.startUpload(e.data.folders[0].id,e.data.folders[0].urls.viewInBrowser,null,this._options)},t.onFailure=function(e){if(e&&e.error){if("user_canceled"===e.error.code)return void p.ULS.sendTraceTag(6590593,216,50,"User cancelled upload to their OneDrive.");p.ULS.sendTraceTag(6590594,216,50,"File Dialog returned with error code:{0}, and error message: {1}",e.error.code,e.error.message)}else p.ULS.sendTraceTag(6590595,216,50,"File Dialog returned with no response");this.showErrorDialog()},e}();Object(i.a)(pi,"SaveToCloudManager",null,[405]);var gi=n(270),mi=n(252),fi=function(){function e(e,t,n,i){this._responseTimeToSaveToOneDriveAction=null,this._saveToCloudManager=e,this._appSettingsManager=n,this._oneDriveFilePickerApiManager=t,this._loadApiTaskCompletionSource=new C.a,this._stopwatchBuilder=i}var t=e.prototype;return t.isUIEnabled=function(){return this._appSettingsManager.getBooleanAppSetting("SaveToCloudStorageUIIsEnabled")},t.getActionId=function(){return h.a.saveToCloudStorage},t.callDownloadQueueActionsForOneDriveApi=function(){Z.a.registerDispatchHandler(Object(r.a)(this,this.saveToCloudActionDispatcher,"saveToCloudActionDispatcher")),Z.a.enqueueActions([new mi.a(h.a.saveToCloudStorage,ue.a.frame,0)],this._oneDriveFilePickerApiManager.getOneDriveApi())},t.registerActions=function(){var e=this,t=this._oneDriveFilePickerApiManager.getOneDriveApi();t?(t.add_loadFinished((function(t,n){e._loadApiTaskCompletionSource.setResult(!0)})),this.callDownloadQueueActionsForOneDriveApi()):p.ULS.sendTraceTag(6590596,216,15,"Failure with OneDrive API download as the onedrive url received is empty ")},t.recordExecuteTrace=function(){p.ULS.sendTraceTag(6590597,216,50,"User clicked on SaveToOneDrive button")},t.saveToCloudActionDispatcher=function(e,t,n,i,r){var a=this;if(t.contextId!==ue.a.frame||e!==this.getActionId())return 2;if(!this.isUIEnabled())return 8;if(1===n)return gi.SessionStatusManager.instance.hasEmergencyViewModeBeenDeployed?8:32;if(2===n){this.recordExecuteTrace();var o=r;return o&&o.FileDownloadUrl&&p.ULS.sendTraceTag(50708835,216,50,"SaveToCloudStorageActor FileDownloadUrl is there"),this._stopwatchBuilder&&(this._responseTimeToSaveToOneDriveAction=this._stopwatchBuilder.makeAndStartStopwatch("DialogShown","SaveToOneDriveReponseTime")),this._loadApiTaskCompletionSource.task.continueWith((function(e){a._responseTimeToSaveToOneDriveAction&&(a._responseTimeToSaveToOneDriveAction.stop(),a._responseTimeToSaveToOneDriveAction=null),a._saveToCloudManager.start(o)})),32}return 8},e}();function _i(e,t){return(_i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(fi,"SaveToCloudStorageActor",null,[404]);var vi=function(e){var t,n;function i(t,n,i){var r;return(r=e.call(this)||this)._actionManager=t,r._signOutResponse=n,r._aframeApplication=i,r._hideOnButtonClick=!1,r.buttonsOption=1,r.setDefaultButton(1),r.setButtonText(1,CommonUIStrings.l_SignIn),r.setButtonText(0,CommonUIStrings.l_SignInToSaveDialogCancelButton),r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,_i(t,n);var a=i.prototype;return a.displayDialog=function(){this._signOutResponse.add_authenticationRestored(Object(r.a)(this,this.onSignIn,"onSignIn")),this.messageBox(CommonUIStrings.l_SignInToSaveDialogTitle,CommonUIStrings.l_SaveToCloudSignInDialog,0,Object(r.a)(this,this.inputHandler,"inputHandler"))},a.inputHandler=function(e,t){if(!e)return p.ULS.sendTraceTag(6590598,216,50,"User dismissed SignIn Dialog."),void this.hide();this.performSignIn()},a.checkApp=function(){var e="2";if(this._aframeApplication)switch(this._aframeApplication.officeAppType){case 3:e="0";break;case 2:e="3";break;case 1:e="1"}return e},a.hide=function(){this._signOutResponse.remove_authenticationRestored(Object(r.a)(this,this.onSignIn,"onSignIn")),e.prototype.hide.call(this)},a.performSignIn=function(){var e=new U.QueryStringBuilder("Signin.aspx");e.addParam("prompt","1"),e.addParam("cbcxt",this.checkApp()),s.AFrameworkApplication.addCommonUrlParameters(e),nt.a.safelyOpenWindow(e.toString(),"LoginWindow",void 0,"SignInDialog")},a.onSignIn=function(e,t){this.isShowing&&this.hide(),p.ULS.sendTraceTag(7143885,216,50,"User signed in successfully. Calling Savetocloudstorage action handler"),this._actionManager.processAction(h.a.saveToCloudStorage,2)},i}(Nn.StandardDialog);Object(i.a)(vi,"SignInDialog",Nn.StandardDialog,[419]);var yi=function(){function e(e,t,n){this._actionManager=e,this._signOutResponse=t,this._aframeApplication=n}return e.prototype.create=function(){return new vi(this._actionManager,this._signOutResponse,this._aframeApplication)},e}();Object(i.a)(yi,"SignInDialogFactory",null,[403]);var Si=function(){function e(e,t,n,i,r,a,o){this._webServiceBase=e,this._fileName=t,this._fileNewName=n,this._folderId=i,this._querySig=r,this._handlerName=a,this._options=o}return e.prototype.execute=function(e,t){if(!s.AFrameworkApplication.isShuttingDown&&s.AFrameworkApplication.theClientRequestManager){var n={"Content-Type":"application/json; charset=utf-8"},i=this._webServiceBase+this._handlerName;i=Dt.a.addOrReplaceParameterValue(i,"fo",je.a.urlKeyValueEncode(this._folderId)),i=Dt.a.addOrReplaceParameterValue(i,"fn",je.a.urlKeyValueEncode(this._fileName)),i=Dt.a.addOrReplaceParameterValue(i,"qs",je.a.urlKeyValueEncode(this._querySig)),i=Dt.a.addOrReplaceParameterValue(i,"n",je.a.urlKeyValueEncode((new Date).getTime().toString())),this._options&&this._options.FileDownloadUrl&&(i=Dt.a.addOrReplaceParameterValue(i,"furl",je.a.urlKeyValueEncode(this._options.FileDownloadUrl))),this._fileNewName&&(i=Dt.a.addOrReplaceParameterValue(i,"fnn",je.a.urlKeyValueEncode(this._fileNewName))),s.AFrameworkApplication.theClientRequestManager.addRequest(i,1,"",n,!1,2,e,t,null)}},e}();Object(i.a)(Si,"SkyDriveUploadCaller",null,[418]);var bi=function(){function e(e){this._appSettingsManager=e,this._webServiceUrl=e.appSettings.SkyDriveUploadWebServiceBase,this._fileName=e.appSettings.FileName,this._handlerName=e.getStringAppSetting("SkyDriveUploadHandler")||"skydriveuploadhandler.ashx"}return e.prototype.create=function(e,t,n){return new Si(this._webServiceUrl,this._fileName,t,e,s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion,this._handlerName,n)},e}();Object(i.a)(bi,"SkydriveUploadCallerFactory",null,[402]);var Ci=function(){function e(e,t,n,i,r){this._caller=null,this._progressDialog=null,this._folderUrl=null,this._failedCanary=!1,this._uploadTimeStopwatch=null,this._options=null,this._uploadCallerFactory=e,this._progressDialogFactory=t,this._errorDialogFactory=n,this._activeFrame=i,this._stopwatchBuilder=r}var t=e.prototype;return t.showWaitUI=function(){this._activeFrame&&1===this._activeFrame.state||(this._progressDialog=this._progressDialogFactory(),this._progressDialog.message=CommonUIStrings.l_CommentProgressTooltip,this._progressDialog.buttonsOption=5,this._progressDialog.hasCloseGlyph=!1,this._progressDialog.showProgressDialog(CommonUIStrings.l_DefaultDialogTitle,null,null))},t.dismissWaitUI=function(){this._progressDialog&&(this._progressDialog.close(),this._progressDialog=null)},t.showErrorUI=function(){1!==s.AFrameworkApplication.activeFrame.state&&this._errorDialogFactory().displayError(hi.default)},t.redirectToFolder=function(){p.ULS.sendTraceTag(6590599,216,50,"Redirecting to OneDrive Folder."),nt.a.safelyOpenWindow(this._folderUrl,nt.a.windowTargetToString(3),void 0,"UploadToCloudManager.RedirectToFolder")},t.redirectToEditUrl=function(e){var t=!1,n=!1;if(s.AFrameworkApplication.appSettingsManager&&(t=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SaveACopyIsEnabledForUiHost"),n=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UiHostSupportsDocRebootFeatures")),p.ULS.sendTraceTag(6654163,216,50,"Redirecting to edit url {0}. IsEnabledForUiHost {1}",e,t),t&&n){p.ULS.sendTraceTag(594929733,216,50,"UploadToCloudManager.RedirectToEditUrl: Sending DocumentRefresh post message.");var i={};i[ln.a.rebootMode]="1",i[ln.a.documentUrl]=e,s.AFrameworkApplication.get_hostPostmessengerFuture().execute((function(e){e.sendMessage(d.a.documentRefresh,i)}))}else nt.a.safelyOpenWindow(e,nt.a.windowTargetToString(3),void 0,"UploadToCloudManager.RedirectToEditUrl")},t.startUpload=function(e,t,n,i){void 0===n&&(n=null),void 0===i&&(i=null),p.ULS.sendTraceTag(7143886,216,50,"Starting to upload file"),this._stopwatchBuilder&&(this._uploadTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("DialogShown","SaveToOneDriveUploadTime")),this.showWaitUI(),this._folderUrl=t,this._caller=this._uploadCallerFactory.create(e,n,i),this._options=i,this.executeUpload()},t.executeUpload=function(){p.ULS.sendTraceTag(6590600,216,50,"Calling SkydriveUploadHandler."),this._caller.execute(Object(r.a)(this,this.onSaveToCloudUploadFinished,"onSaveToCloudUploadFinished"),Object(r.a)(this,this.onSaveToCloudUploadFailed,"onSaveToCloudUploadFailed"))},t.onSaveToCloudUploadFinished=function(e){var t,n,i;if(this.dismissWaitUI(),this._failedCanary=!1,!e||!e.data||!e.data.responseData)return p.ULS.sendTraceTag(6590601,216,10,"UploadToCloudManager upload failure. Response data is null"),void this.showErrorUI();if(!(t=B.d(e.data.responseData,n),n=t.deserialized,t).returnValue)return p.ULS.sendTraceTag(7660114,216,10,"Failed to deserialize : {0}",((i={}).ResponseData=xn.truncateIfNecessary(e.data.responseData),i)),void this.showErrorUI();var r=n;if(r.StatusCode!==R.a.OK_200&&r.StatusCode!==R.a.created_201)return p.ULS.sendTraceTag(6590602,216,10,"UploadToCloudManager upload failure. Response data is not JSON."),void this.showErrorUI();p.ULS.sendTraceTag(6590603,216,50,"UploadToCloudManager upload success.");try{r.NewDocumentUrl&&""!==r.NewDocumentUrl?this.redirectToEditUrl(r.NewDocumentUrl):this.redirectToFolder()}catch(e){p.ULS.sendTraceTag(37025728,216,15,"Redirect failed with exception: {0}",e.toString())}this.perfWatchStop()},t.onSaveToCloudUploadFailed=function(e){5!==e.data.status&&12!==e.data.status||this._failedCanary?(p.ULS.sendTraceTag(6590605,216,10,"UploadToCloudManager HTTP failure with code: {0}",e.data.status),this.dismissWaitUI(),this.showErrorUI(),this.perfWatchStop()):(p.ULS.sendTraceTag(6590604,216,10,"UploadToCloudManager failure. Retrying."),this._failedCanary=!0,this.executeUpload())},t.perfWatchStop=function(){this._uploadTimeStopwatch&&(this._uploadTimeStopwatch.stop(),this._uploadTimeStopwatch=null)},e}();Object(i.a)(Ci,"UploadToCloudManager",null,[400]);var Ai=n(238);function Ti(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var wi=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SaveToCloudStorageUIIsEnabled")&&this._container.resolve("Common.App.SaveToCloudStorage.SaveToCloudStorageActor").registerActions()},r.dispose=function(){},r.configure=function(e){this._container=e,this._container.register(yi,"Common.App.SaveToCloudStorage.SignInDialogFactory").as("Common.App.SaveToCloudStorage.ISignInDialogFactory").usingFactory((function(){return new yi(s.AFrameworkApplication.theActionManager,si.a.instance,s.AFrameworkApplication.activeFrame.applicationInstance)})).singleInstance(),this._container.register(bi,"Common.App.SaveToCloudStorage.SkydriveUploadCallerFactory").as("Common.App.SaveToCloudStorage.ISkydriveUploadCallerFactory").usingFactory((function(){return new bi(s.AFrameworkApplication.appSettingsManager)})).singleInstance(),this._container.register(fi,"Common.App.SaveToCloudStorage.SaveToCloudStorageActor").usingFactory((function(){return new fi(e.resolve("Common.App.SaveToCloudStorage.SaveToCloudManager"),e.resolve("Common.App.OneDriveFilePickerApi.IOneDriveFilePickerApiManager"),s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.activeFrame.theStopwatchBuilder)})).singleInstance(),this._container.register(Ci,"Common.App.SaveToCloudStorage.UploadToCloudManager").usingFactory((function(){return new Ci(e.resolve("Common.App.SaveToCloudStorage.SkydriveUploadCallerFactory"),(function(){return(new Ai.a).create()}),(function(){return new di}),s.AFrameworkApplication.activeFrame,s.AFrameworkApplication.activeFrame.theStopwatchBuilder)})).singleInstance(),this._container.register(pi,"Common.App.SaveToCloudStorage.SaveToCloudManager").usingFactory((function(){return new pi(e.resolve("Common.App.SaveToCloudStorage.SignInDialogFactory"),si.a.instance,e.resolve("Common.App.SaveToCloudStorage.UploadToCloudManager"),s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,(function(){return new di}))})).singleInstance()},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.SaveToCloudStorage"}}])&&Ti(t.prototype,n),i&&Ti(t,i),e}();Object(i.a)(wi,"PackageManager",null,[20,21]);var ki=n(119),Ii=function(){function e(e){this._eventSource=new a.a,this._appFrame=e}var t=e.prototype;return t.add_onSessionExpired=function(t){this._eventSource.addHandler(e.sessionExpiredEventKey,t)},t.remove_onSessionExpired=function(t){this._eventSource.removeHandler(e.sessionExpiredEventKey,t)},t.add_onSessionExpiring=function(t){this._eventSource.addHandler(e.sessionExpiringEventKey,t)},t.remove_onSessionExpiring=function(t){this._eventSource.removeHandler(e.sessionExpiringEventKey,t)},t.add_onTokenRefreshed=function(t){this._eventSource.addHandler(e.tokenRefreshedEventKey,t)},t.remove_onTokenRefreshed=function(t){this._eventSource.removeHandler(e.tokenRefreshedEventKey,t)},t.showDialogOnKickout=function(t){this._eventSource.raiseEvent(e.sessionExpiredEventKey)},t.showDialogOnExpiring=function(t){this._eventSource.raiseEvent(e.sessionExpiringEventKey)},t.hasSessionExpired=function(){var e=s.AFrameworkApplication.accessTokenTtl;return ki.a.instance.isSessionExpired(e)},e}();Ii.sessionExpiredEventKey="SE",Ii.sessionExpiringEventKey="SEP",Ii.tokenRefreshedEventKey="SER",Object(i.a)(Ii,"NullSessionExpirationManager",null,[215,216]);var Fi=function(){function e(){var e;this._sessionExpiredDialogAlreadyDisplayed=!1,this._sessionExpiringDialogAlreadyDisplayed=!1;var t=s.AFrameworkApplication.accessTokenTtl;if(!(t<=0)){this.accessTokenTtl=t;var n=new Date;p.ULS.sendTraceTag(17581890,217,50,"Initializing SessionExpirationManager. {0}",((e={}).AccessTokenTtl=this.accessTokenTtl,e.NowGetTime=n.getTime(),e.BootTime=s.AFrameworkApplication.bootTime,e)),ki.a.instance.add_sessionExpiredDetected(Object(r.a)(this,this.onSessionExpiredDetected,"onSessionExpiredDetected")),ki.a.instance.add_sessionAboutToExpireDetected(Object(r.a)(this,this.onSessionExpiringDetected,"onSessionExpiringDetected"))}}var t=e.prototype;return t.onSessionExpiredDetected=function(e,t){ki.a.instance.remove_sessionExpiredDetected(Object(r.a)(this,this.onSessionExpiredDetected,"onSessionExpiredDetected")),p.ULS.sendTraceTag(19247381,217,50,"SessionExpiredDetected"),this.handleSessionExpired()},t.onSessionExpiringDetected=function(e,t){ki.a.instance.remove_sessionAboutToExpireDetected(Object(r.a)(this,this.onSessionExpiringDetected,"onSessionExpiringDetected")),this._sessionExpiringDialogAlreadyDisplayed||this._sessionExpiredDialogAlreadyDisplayed||(p.ULS.sendTraceTag(20492680,217,50,"SessionExpiringDetected - Showing expiring dialog."),this._sessionExpiringDialogAlreadyDisplayed=!0,this.showSessionExpiringDialog())},t.handleSessionExpired=function(){this._sessionExpiredDialogAlreadyDisplayed||(s.AFrameworkApplication.reportError(qn.a.sessionAccessTokenExpired),this._sessionExpiredDialogAlreadyDisplayed=!0,this.showSessionExpiredDialog())},e}();Object(i.a)(Fi,"ASessionExpirationManager",null,[]);var Ei=n(77),Pi=n(297),Oi=function(){function e(e,t,n,i){this.textToDisplay="",this._accessTokenTtl=e,this._sessionRefreshCallback=n,this._sessionDisposeCallback=i,this._isExpiredDialog=t;var r=new Date(this._accessTokenTtl).format(s.AFrameworkApplication.shortTimeFormat);this._isExpiredDialog?this.textToDisplay=String.format(CommonUIStrings.l_SessionExpiredMessage):this.textToDisplay=String.format(CommonUIStrings.l_SessionExpiringMessage,r)}var t=e.prototype;return t.sessionExpirationDialogHandler=function(e){1===e?this._sessionRefreshCallback&&this._sessionRefreshCallback(this._isExpiredDialog):e||s.AFrameworkApplication.theActionManager.processActionWithData(h.a.close,2,Pi.g)},t.dispose=function(){this._sessionDisposeCallback&&this._sessionDisposeCallback()},e}();Oi.id="SessionExpirationDialog",Object(i.a)(Oi,"SessionExpirationDialogSharedProperties",null,[]);var Ri=function(){};function Mi(e,t){return(Mi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Ri.dialogHtml="<div class='WACDialogRow' id='SessionExpirationBlock'> <label id='WACSessionExpirationText' class='WACDialogLabel' >Session Expiration</label> </div>",Object(i.a)(Ri,"SessionExpirationDialogHtml",null,[]);var Di=function(e){var t,n;function i(t,n,i,a){var o,l={};return(o=e.call(this,n)||this)._sessionExpirationDialogSharedProperties=new Oi(t,n,i,a),o.dialogId=Oi.id,s.AFrameworkApplication.canExecuteCloseAction?(o.buttonsOption=1,o.setButtonText(0,CommonUIStrings.l_DialogClose)):(o.buttonsOption=0,o.hasCloseGlyph=!1),n||1===s.AFrameworkApplication.activeFrame.mode?o.setButtonText(1,CommonUIStrings.l_SessionExpirationRefreshButton):o.setButtonText(1,CommonUIStrings.l_SessionExpiringSaveAndRefreshButton),o.dialogHtml=Ri.dialogHtml,l.WACSessionExpirationText=o._sessionExpirationDialogSharedProperties.textToDisplay,o.initializeAndShow(CommonUIStrings.l_DefaultDialogTitle,Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o),o.sessionExpirationDialogHandler,"sessionExpirationDialogHandler"),l),o.setDescribedByForDialog(o.myId("WACSessionExpirationText")),o}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Mi(t,n);var a=i.prototype;return a.sessionExpirationDialogHandler=function(e,t){void 0===t&&(t=null),this._sessionExpirationDialogSharedProperties.sessionExpirationDialogHandler(e)},a.isDialogShowing=function(){return this.isShowing},a.hideDialog=function(){this.hide()},a.dispose=function(){e.prototype.dispose.call(this),this._sessionExpirationDialogSharedProperties&&this._sessionExpirationDialogSharedProperties.dispose()},i}(Ei.a);function xi(e,t){return(xi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Di,"LegacySessionExpirationDialog",Ei.a,[300]);var Li=function(e){var t,n;function i(t,n,i,a){var o;return(o=e.call(this,n)||this)._sessionExpirationDialogSharedProperties=new Oi(t,n,i,a),o.dialogId=Oi.id,s.AFrameworkApplication.canExecuteCloseAction?(o.buttonsOption=1,o.setButtonText(0,CommonUIStrings.l_DialogClose)):(o.buttonsOption=0,o.hasCloseGlyph=!1),n||1===s.AFrameworkApplication.activeFrame.mode?o.setButtonText(1,CommonUIStrings.l_SessionExpirationRefreshButton):o.setButtonText(1,CommonUIStrings.l_SessionExpiringSaveAndRefreshButton),o.messageBox(CommonUIStrings.l_DefaultDialogTitle,o._sessionExpirationDialogSharedProperties.textToDisplay,0,Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o),o.sessionExpirationDialogHandler,"sessionExpirationDialogHandler")),o}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,xi(t,n);var a=i.prototype;return a.sessionExpirationDialogHandler=function(e,t){void 0===t&&(t=!1),this._sessionExpirationDialogSharedProperties.sessionExpirationDialogHandler(e)},a.isDialogShowing=function(){return this.isShowing},a.hideDialog=function(){this.hide()},a.dispose=function(){e.prototype.dispose.call(this),this._sessionExpirationDialogSharedProperties&&this._sessionExpirationDialogSharedProperties.dispose()},i}(Nn.StandardDialog);Object(i.a)(Li,"SessionExpirationDialog",Nn.StandardDialog,[300]);var Bi=function(e,t,n,i){return s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ReactStandardSessionExpirationDialogIsEnabled")?new Li(e,t,n,i):new Di(e,t,n,i)},Ui=n(106);function Hi(e,t){return(Hi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ni=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this)._showDialogOnKickout=!0,n._showDialogOnExpiring=!0,n._sessionExpirationDialog=null,n._eventSource=new a.a,n._appFrame=t,n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Hi(t,n);var o=i.prototype;return o.add_onSessionExpired=function(e){this._eventSource.addHandler(i.sessionExpiredEventKey,e)},o.remove_onSessionExpired=function(e){this._eventSource.removeHandler(i.sessionExpiredEventKey,e)},o.add_onSessionExpiring=function(e){this._eventSource.addHandler(i.sessionExpiringEventKey,e)},o.remove_onSessionExpiring=function(e){this._eventSource.removeHandler(i.sessionExpiringEventKey,e)},o.add_onTokenRefreshed=function(e){this._eventSource.addHandler(i.tokenRefreshedEventKey,e)},o.remove_onTokenRefreshed=function(e){this._eventSource.removeHandler(i.tokenRefreshedEventKey,e)},o.hasSessionExpired=function(){var e=s.AFrameworkApplication.accessTokenTtl;return ki.a.instance.isSessionExpired(e)},o.showDialogOnKickout=function(e){this._showDialogOnKickout=e},o.showDialogOnExpiring=function(e){this._showDialogOnExpiring=e},o.showSessionExpiringDialog=function(){if(!this._sessionExpirationDialog&&!Ui.a.currentDialog){if(this._showDialogOnExpiring){var e=Object(r.a)(this,this.disposeCallback,"disposeCallback");this._sessionExpirationDialog=Bi(this.accessTokenTtl,!1,Object(r.a)(this,this.sessionExpirationHandler,"sessionExpirationHandler"),e)}this._eventSource.raiseEvent(i.sessionExpiringEventKey)}},o.showSessionExpiredDialog=function(){if(this._sessionExpirationDialog&&(this._sessionExpirationDialog.isDialogShowing()&&this._sessionExpirationDialog.hideDialog(),this._sessionExpirationDialog=null),this._showDialogOnKickout){var e=Object(r.a)(this,this.disposeCallback,"disposeCallback");this._sessionExpirationDialog=Bi(this.accessTokenTtl,!0,Object(r.a)(this,this.sessionExpirationHandler,"sessionExpirationHandler"),e)}this._eventSource.raiseEvent(i.sessionExpiredEventKey)},o.disposeCallback=function(){this._sessionExpirationDialog=null},o.sessionExpirationHandler=function(e){(e||this._appFrame.beforeRefreshDocument())&&this._appFrame.refreshDocument(null)},i}(Fi);Ni.sessionExpiredEventKey="SE",Ni.sessionExpiringEventKey="SEP",Ni.tokenRefreshedEventKey="SER",Object(i.a)(Ni,"SessionExpirationManager",Fi,[215,216]);var Wi=function(){};function ji(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Wi.aborting="Aborting",Wi.activityDuration="ActivityDuration",Wi.aggregateDictionaryName="Aggregate",Wi.currentDictionaryName="Current",Wi.error="Error",Wi.errorsCount="Errors",Wi.failed="Failed",Wi.firstActivity="FirstActivity",Wi.initialized="Initialized",Wi.kickedOut="KickedOut",Wi.lastActivity="LastActivity",Wi.retryOverride="RetryOverride",Wi.requestGroups="RequestGroups",Wi.requests="Requests",Wi.responses="Responses",Wi.sessionDuration="SessionDuration",Wi.status="Status",Wi.success="Success",Wi.successful="Successful",Wi.tokens="Tokens",Object(i.a)(Wi,"SessionExpirationStrings",null,[]);var Vi=function(){function e(e){this._current={},this._aggregate={},this.logIntervalInMinutes=15,this._isStopped=!1,this._sessionStart=new Date,this._lastActivity=new Date,this._taskManager=e,this._taskItem=new u.a(2,2,60*this.logIntervalInMinutes*1e3,Object(r.a)(this,this.writeMeasures,"writeMeasures"),135,"SL",!1),this._taskManager.addTask(this._taskItem),this.initializeMeasures()}var t,n,i,a=e.prototype;return a.writeMeasures=function(e){var t;p.ULS.sendTraceTag(41964821,217,50,p.ULS.jsonSerialize(((t={}).Aggregate=this._aggregate,t.Current=this._current,t)))},a.initializeMeasures=function(){this._aggregate[Wi.requestGroups]=0,this._aggregate[Wi.requests]=0,this._aggregate[Wi.responses]=0,this._aggregate[Wi.status]=Wi.initialized,this._aggregate[Wi.firstActivity]=new Date,this._aggregate[Wi.sessionDuration]=0,this._aggregate[Wi.activityDuration]=0,this._aggregate[Wi.sessionDuration]=0,this._current[Wi.sessionDuration]=0,this._aggregate[Wi.activityDuration]=0,this._current[Wi.activityDuration]=0},a.incrementACounter=function(e,t){var n=e[t],i=n||0;i++,e[t]=i,this.setLastActivity(e)},a.setLastActivity=function(e){var t=new Date;e[Wi.activityDuration]=+t-+this._lastActivity,this._lastActivity=t,e[Wi.sessionDuration]=+this._lastActivity-+this._sessionStart,e[Wi.lastActivity]=this._lastActivity},a.setMeasure=function(e,t){this._current[e]=t,this.setLastActivity(this._current)},a.setCounter=function(e,t){this._current[e]=t,this.setLastActivity(this._current)},a.incrementCounter=function(e){this.incrementACounter(this._current,e),this.incrementACounter(this._aggregate,e)},a.flush=function(){this._isStopped||(this._aggregate[Wi.status]=this._current[Wi.status],this.writeMeasures(this._taskItem),this._taskManager.resetInterval(this._taskItem,60*this.logIntervalInMinutes*1e3))},a.resetGroup=function(){var e=this._current[Wi.status];e&&(this._aggregate[Wi.status]=e),this._current={}},a.stop=function(){p.ULS.sendTraceTag(41964822,217,100,"Stopping logger. Flushing one last time"),this.flush(),this._isStopped=!0,this._taskManager.deleteTask(this._taskItem)},t=e,(n=[{key:"aggregateMeasures",get:function(){return this._aggregate}},{key:"currentMeasures",get:function(){return this._current}}])&&ji(t.prototype,n),i&&ji(t,i),e}();function qi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Vi,"SessionLogger",null,[211]);var Gi=function(){function e(e,t){this._tokens=e,this._errors=t}var t,n,i;return t=e,(n=[{key:"tokens",get:function(){return this._tokens}},{key:"errors",get:function(){return this._errors}}])&&qi(t.prototype,n),i&&qi(t,i),e}();Object(i.a)(Gi,"TokenRefreshArgs",null,[265]);var Ki=function(){function e(e,t,n,i){var o;void 0===n&&(n=null),void 0===i&&(i=null),this._sessionExpiredDialogAlreadyDisplayed=!1,this._sessionExpiringDialogAlreadyDisplayed=!1,this._showDialogOnKickout=!0,this._showDialogOnExpiring=!0,this._sessionExpirationDialog=null,this._eventSource=new a.a,this._refreshingTokens=!1,this._lastAttemptToRefreshFailed=!1,this._shouldAbort=!1,this._appFrame=e,this._tokenRefreshManager=t,this._isTokenRefreshWhenExpiredEnabled=s.AFrameworkApplication.isWopiTokenRefreshWhenSessionExpiredEnabled;var l=new Date;p.ULS.sendTraceTag(39408093,217,50,"Initializing SessionExpirationManagerWithRefresh. {0}",((o={}).AccessTokenTtl=s.AFrameworkApplication.accessTokenTtl,o.NowGetTime=l.getTime(),o.BootTime=s.AFrameworkApplication.bootTime,o)),this._logger=n||new Vi(b.a.instance),this._statusManager=i,ki.a.instance.add_sessionExpiredDetected(Object(r.a)(this,this.sessionExpirationManagerWithRefresh_OnSessionExpired,"sessionExpirationManagerWithRefresh_OnSessionExpired")),ki.a.instance.add_sessionAboutToExpireDetected(Object(r.a)(this,this.sessionExpirationManagerWithRefresh_OnSessionExpiring,"sessionExpirationManagerWithRefresh_OnSessionExpiring")),gi.SessionStatusManager.instance.add_onSessionExpiringNetworkResumed(Object(r.a)(this,this.sessionExpirationManagerWithRefresh_OnSessionExpiring,"sessionExpirationManagerWithRefresh_OnSessionExpiring")),s.AFrameworkApplication.isWopiTokenRefreshCancelExpirationEnabled&&(ki.a.instance.cancelSessionExpiration=Object(r.a)(this,this.refreshAccessTokenWhenSessionExpired,"refreshAccessTokenWhenSessionExpired"))}var t=e.prototype;return t.add_onSessionExpired=function(t){this._eventSource.addHandler(e.sessionExpiredEventKey,t)},t.remove_onSessionExpired=function(t){this._eventSource.removeHandler(e.sessionExpiredEventKey,t)},t.add_onSessionExpiring=function(t){this._eventSource.addHandler(e.sessionExpiringEventKey,t)},t.remove_onSessionExpiring=function(t){this._eventSource.removeHandler(e.sessionExpiringEventKey,t)},t.add_onTokenRefreshed=function(t){this._eventSource.addHandler(e.tokenRefreshedEventKey,t)},t.remove_onTokenRefreshed=function(t){this._eventSource.removeHandler(e.tokenRefreshedEventKey,t)},t.hasSessionExpired=function(){var e=s.AFrameworkApplication.accessTokenTtl;return ki.a.instance.isSessionExpired(e)},t.refreshAccessTokenWhenSessionExpired=function(){return this.handleTokenRefresh(!1),!ki.a.instance.isSessionExpired(s.AFrameworkApplication.accessTokenTtl)},t.sessionExpirationManagerWithRefresh_OnSessionExpired=function(e,t){ki.a.instance.isSessionExpiredDueToScheduledShutdown?this.onSessionExpiredDetected(e,t):this._isTokenRefreshWhenExpiredEnabled?(this._lastAttemptToRefreshFailed=!1,this.handleTokenRefresh(!1)):this.onSessionExpiredDetected(e,t)},t.sessionExpirationManagerWithRefresh_OnSessionExpiring=function(e,t){ki.a.instance.isSessionAboutToExpireDueToScheduledShutdown?this.onSessionExpiringDetected(e,t):this.handleTokenRefresh(!0)},t.handleTokenRefresh=function(t){var n=this;if(!this._refreshingTokens&&!this._lastAttemptToRefreshFailed){if(this._statusManager&&this._statusManager.isKickedOut)return this._shouldAbort=!0,this._logger.setMeasure(Wi.status,Wi.kickedOut),this._logger.flush(),void this._logger.stop();if(p.ULS.sendTraceTag(40420955,217,50,"HandleTokenRefresh, IsExpiring:{0}. ShouldAbort: {1}",t,this._shouldAbort),this._shouldAbort)this.showSessionExpiredDialog();else{this._logger.flush(),this._logger.resetGroup(),this._logger.incrementCounter(Wi.requestGroups),this._refreshingTokens=!0;var i=this._tokenRefreshManager.refreshTokens(t);i.continueWith((function(r){n._tokenRefreshManager.processTokensOrErrors(i)?(n._logger.incrementCounter(Wi.successful),n._logger.setMeasure(Wi.status,Wi.success),n._showDialogOnExpiring=!1,n._isTokenRefreshWhenExpiredEnabled&&(n._showDialogOnKickout=!1),n._lastAttemptToRefreshFailed=!1,n._eventSource.raiseEvent(e.tokenRefreshedEventKey,new Gi(i.result.tokens,null))):(n._logger.incrementCounter(Wi.failed),n._logger.setMeasure(Wi.status,Wi.failed),t||(n._shouldAbort=n._tokenRefreshManager.isPermanentErrors(i.result.errors)),n._shouldAbort&&n._logger.setMeasure(Wi.aborting,JSON.stringify(i.result.errors)),n._lastAttemptToRefreshFailed=!0,n._eventSource.raiseEvent(e.tokenRefreshedEventKey,new Gi(null,i.result.errors))),n._logger.flush(),n._refreshingTokens=!1}))}}},t.onSessionExpiredDetected=function(e,t){this._isTokenRefreshWhenExpiredEnabled||ki.a.instance.remove_sessionExpiredDetected(Object(r.a)(this,this.onSessionExpiredDetected,"onSessionExpiredDetected")),p.ULS.sendTraceTag(39408094,217,50,"SessionExpiredDetected"),this.handleSessionExpired(ki.a.instance.isSessionExpiredDueToScheduledShutdown)},t.onSessionExpiringDetected=function(e,t){this._sessionExpiringDialogAlreadyDisplayed||this._sessionExpiredDialogAlreadyDisplayed||(p.ULS.sendTraceTag(39408095,217,50,"SessionExpiringDetected - Showing expiring dialog."),this._sessionExpiringDialogAlreadyDisplayed=!0,this.showSessionExpiringDialog(ki.a.instance.isSessionAboutToExpireDueToScheduledShutdown))},t.handleSessionExpired=function(e){if(!this._sessionExpiredDialogAlreadyDisplayed){var t,n;e?(t=qn.a.sessionExpiredDueToScheduledShutdown,n="ScheduledShutdown"):(t=qn.a.sessionAccessTokenExpired,n="SessionAccessTokenExpired");var i=Object.assign(new V.a,{extendedProperties:new Map});if(i.extendedProperties.set("ErrorCode",String.format("{0}",t)),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordUseSessionExpiredDueToScheduledShutdownErrorNameForVetoes")?s.AFrameworkApplication.reportError(t,void 0,["SessionExpired"],i):(s.AFrameworkApplication.reportError(t),l.Health.instance.recordQosError(n,["SessionExpired"],!0,!0,!1,!0,i)),!e){var r=new Date,a=new Date(s.AFrameworkApplication.bootTime);p.ULS.sendTraceTag(51642974,217,50,"Sending data to QoS. BootTime=[{0}], Now=[{1}], Duration=[{2}]",a,r,+r-+a),+r-+a<864e5&&l.Health.instance.recordQosError("SessionAccessTokenExpiredInLessThanOneDay",["SessionExpired"],!0,!0,!1,!0,i),+r-+a<2592e5&&l.Health.instance.recordQosError("SessionAccessTokenExpiredInLessThanThreeDays",["SessionExpired"],!0,!0,!1,!0,i)}this._sessionExpiredDialogAlreadyDisplayed=!0,this.showSessionExpiredDialog()}},t.showDialogOnKickout=function(e){this._showDialogOnKickout=e},t.showDialogOnExpiring=function(e){this._showDialogOnExpiring=e},t.showSessionExpiringDialog=function(t){if(!this._sessionExpirationDialog&&!Ui.a.currentDialog){if(t){var n=Object(r.a)(this,this.disposeCallback,"disposeCallback");this._sessionExpirationDialog=Bi(s.AFrameworkApplication.scheduledShutdownTtl,!1,Object(r.a)(this,this.sessionExpirationHandler,"sessionExpirationHandler"),n)}else if(this._showDialogOnExpiring){if(this._refreshingTokens)return;var i=Object(r.a)(this,this.disposeCallback,"disposeCallback");this._sessionExpirationDialog=Bi(s.AFrameworkApplication.accessTokenTtl,!1,Object(r.a)(this,this.sessionExpirationHandler,"sessionExpirationHandler"),i)}p.ULS.sendTraceTag(39408096,217,50,"Raising event: [{0}] IsScheduledShutdown: [{1}]",e.sessionExpiringEventKey,t),this._eventSource.raiseEvent(e.sessionExpiringEventKey)}},t.showSessionExpiredDialog=function(){if(this._sessionExpirationDialog&&(this._sessionExpirationDialog.isDialogShowing()&&this._sessionExpirationDialog.hideDialog(),this._sessionExpirationDialog=null),this._showDialogOnKickout){if(this._logger.stop(),this._statusManager&&this._statusManager.isKickedOut)return;var t=Object(r.a)(this,this.disposeCallback,"disposeCallback");this._sessionExpirationDialog=Bi(s.AFrameworkApplication.accessTokenTtl,!0,Object(r.a)(this,this.sessionExpirationHandler,"sessionExpirationHandler"),t)}p.ULS.sendTraceTag(39408097,217,50,"Raising event {0}",e.sessionExpiredEventKey),this._eventSource.raiseEvent(e.sessionExpiredEventKey)},t.disposeCallback=function(){this._sessionExpirationDialog=null},t.sessionExpirationHandler=function(e){(e||this._appFrame.beforeRefreshDocument())&&this._appFrame.refreshDocument(null)},e}();Ki.sessionExpiredEventKey="SE",Ki.sessionExpiringEventKey="SEP",Ki.tokenRefreshedEventKey="SER",Object(i.a)(Ki,"SessionExpirationManagerWithRefresh",null,[215,216]);var zi=function(){function e(e,t,n,i){void 0===n&&(n=null),void 0===i&&(i=null),this._useApplicationProvidedManager=!1,this._instance=null,this._frame=e,this._manager=t,this._logger=n||new Vi(b.a.instance),this._statusManager=i}return e.prototype.create=function(){if(this._useApplicationProvidedManager=s.AFrameworkApplication.isWopiTokenRefreshEnabled,!this._useApplicationProvidedManager)return new Ni(this._frame);if(s.AFrameworkApplication.logUniqueFlightedSettingUsage("WOPITokenRefreshIsEnabled"),p.ULS.sendTraceTag(39408088,217,50,"App has requested custom Session Expiration Manager"),!this._instance)switch(s.AFrameworkApplication.wopiTokenExpirationPolicy){case 1:p.ULS.sendTraceTag(39408090,217,50,"Creating new NullSessionExpirationManager"),this._instance=new Ii(this._frame);break;case 2:p.ULS.sendTraceTag(39408091,217,50,"Creating new SessionExpirationManagerWithRefresh"),this._instance=new Ki(this._frame,this._manager,this._logger,this._statusManager);break;default:p.ULS.sendTraceTag(39408092,217,50,"Creating new legacy SessionExpirationManager"),this._instance=new Ni(this._frame)}return p.ULS.sendTraceTag(39408089,217,50,"Returning instance of Session Expiration Manager: {0}",Object.getType(this._instance).getName()),this._instance},e}();Object(i.a)(zi,"SessionExpirationManagerFactory",null,[214]);var Xi=function(){};Object(i.a)(Xi,"Error",null,[]);var Ji=function(){};function Qi(e,t){return(Qi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Ji,"NamedResult",null,[]);var Zi=function(e){var t,n;function i(){return e.apply(this,arguments)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Qi(t,n),i}(Ji);Object(i.a)(Zi,"ErrorInfo",Ji,[]);var Yi=n(320),$i=n(97),er=function(){function e(e,t,n,i){var a=this;void 0===i&&(i=null),this._retryCount=0,this._task=null,this._taskId=null,this._tokens=new z.a,this._errors=new z.a,this._tcs=null,this._isTokenExpiring=!1,this._taskManager=e,this._postmessengerFuture=t,this._postmessengerFuture.execute((function(e){e.registerCallback(d.a.hostRefreshSessionInfo,Object(r.a)(a,a.onHostResponseReceived,"onHostResponseReceived"))})),this._refreshPolicy=n,this._tokenRefreshStopwatch=new Yi.a("WebServiceCall","TokenRefresh"),this._logger=i||new Vi(e)}var t=e.prototype;return t.onHostResponseReceived=function(e){if(e.MessageId===d.a.hostRefreshSessionInfo){var t=new z.a,n=new z.a;this._logger.incrementCounter(Wi.responses);var i=e.Values[ln.a.sessionInfo_TokenNamesField];(!i||i.length<=0)&&($i.b(40122317,306,15,"Found no tokens in the dictionary"),i=e.Values),$i.b(40122318,306,100,"The Tokens array contains {0} tokens",i.length),this._logger.setMeasure("Correlation",e.CorrelationId);for(var r=0;r<i.length;r++){this._logger.setCounter(Wi.tokens,i.length);var a=i[r],o=a;if(o&&o.Name){this._logger.incrementCounter(o.Name);var s=a;s&&s.Value?($i.b(39408128,306,100,"Received token with name: {0}",s.Name),t.add(s),this._tokens.add(s),this._logger.setMeasure(Wi.status,Wi.success)):($i.b(39408129,306,15,"Received error for token {0}. Creating error object from {1}, TaskId {2}",o.Name,JSON.stringify(a),this._taskId),n.add(a),this._errors.add(a),this._logger.setMeasure(Wi.error,JSON.stringify(a)),this._logger.setMeasure(Wi.status,Wi.failed))}}if($i.b(39408130,306,50,"Received new tokens response. {0} tokens and {1} errors. Correlation {2}, TaskId {3}",t.count,n.count,e.CorrelationId,this._taskId),n.count>0&&!this.isPermanentErrors(n)){var l=this._refreshPolicy.getRetryIntervalOverride(n);l!==this._refreshPolicy.retryInterval&&(this._logger.setCounter(Wi.retryOverride,l),this._taskManager.resetInterval(this._task,l))}else this._logger.flush(),this._task&&($i.b(39408131,306,100,"Deleting task {0} from task manager",this._task.name),this._taskManager.deleteTask(this._task)),this._tcs&&!this._tcs.task.isCompleted&&this._tcs.setResult(new Gi(t,n))}else $i.b(39408099,306,15,"Unexpected message.")},t.requestTokensOnce=function(e){if(this._retryCount>=this._refreshPolicy.maxRetryAttempts)return $i.b(39408132,306,15,"Too many attempts to refresh tokens. Aborting. TaskId {0}",this._taskId),void this.createErrorAndSetResult(this._tcs,"TOO_MANY_ATTEMPTS","We did not receive a new token from the host after the maximum allowed number of attempts");var t={};t[ln.a.sessionInfo_TokenNamesField]=this._refreshPolicy.tokens;var n=W.a.create().toString();$i.b(39408133,306,50,"Refreshing tokens {0}. Attempt {1}. Correlation {2}. TaskId {3}.",JSON.stringify(this._refreshPolicy.tokens),this._retryCount+1,n,this._taskId),this._postmessengerFuture.execute((function(e){e.sendMessage(d.a.appRefreshSessionInfo,t,n)})),this._retryCount++,this._logger.incrementCounter(Wi.requests)},t.createErrorAndSetResult=function(e,t,n){for(var i=new z.a,r=0;r<this._refreshPolicy.tokens.length;r++){var a=Object.assign(new Zi,{Name:this._refreshPolicy.tokens[r],Errors:[Object.assign(new Xi,{Id:t,Details:n})]});i.add(a),this._errors.add(a)}this._taskManager.deleteTask(this._task),this._logger.setMeasure(Wi.errorsCount,JSON.stringify(this._errors)),this._logger.setMeasure(Wi.status,Wi.failed),e&&!e.task.isCompleted&&e.setResult(new Gi(new z.a,this._errors))},t.refreshTokens=function(e,t){var n=this;void 0===t&&(t=null),this._tokenRefreshStopwatch.start(),this._isTokenExpiring=e,this._taskId=W.a.create().toString(),$i.b(41755338,306,50,"RefreshTokens Start, TaskId: [{0}]. IsTokenExpiring: [{1}].",this._taskId,this._isTokenExpiring),this._retryCount=0,this._errors.clear(),this._tokens.clear();var i=new C.a;return this._tcs=i,t&&t.R((function(){var e=!!i&&!i.task.isCompleted;$i.b(588096223,306,50,"RefreshTokens Cancelled, TaskId: [{0}]. IsTokenExpiring: [{1}]. isTaskStillRunning [{2}].",n._taskId,n._isTokenExpiring,e),e&&n.createErrorAndSetResult(i,"ABORTED_BY_CALLER","The refresh was aborted by the caller")})),this._task=new u.a(this._refreshPolicy.priority,2,this._refreshPolicy.retryInterval,Object(r.a)(this,this.requestTokensOnce,"requestTokensOnce"),98,d.a.appRefreshSessionInfo,!0),this._taskManager.addTask(this._task),this._tcs.task},t.processTokensOrErrors=function(e){this._tokenRefreshStopwatch.stop();var t=this.hasErrors(e.result.errors);return p.ULS.sendTraceTag(41755339,217,50,"ProcessTokensOrErrors: TokenRefreshResult:{0},TaskId:{1},IsTriggerByTokenExpiring:{2},RetryCount:{3},TotalErrorCount:{4},LastErrorName:{5},LastErrorId:{6},LastErrorDetail:{7}",!t,this._taskId,this._isTokenExpiring,this._retryCount,this._errors.count,e.result.errors.count>0?e.result.errors.get_item(0).Name:"",e.result.errors.count>0&&e.result.errors.get_item(0).Errors.length>0?e.result.errors.get_item(0).Errors[0].Id:"",e.result.errors.count>0&&e.result.errors.get_item(0).Errors.length>0?e.result.errors.get_item(0).Errors[0].Details:""),!t&&this.processTokens(e.result.tokens)},t.isPermanentErrors=function(e){return this._refreshPolicy.isPermanentErrors(e)},t.processTokens=function(e){for(var t=0;t<e.count;t++){var n=e.get_item(t);if(n.Name===ln.a.accessToken){var i,r,a=(new Date).getTime();if(n.Expiry>s.AFrameworkApplication.accessTokenTtl)p.ULS.sendTraceTag(39706827,217,50,"Updating AccessToken: {0}",((i={}).AccessTokenTtl=n.Expiry,i.NowGetTime=a,i.BootTime=s.AFrameworkApplication.bootTime,i),"PreviousAccessTokenTtl",s.AFrameworkApplication.accessTokenTtl),s.AFrameworkApplication.accessToken=n.Value,s.AFrameworkApplication.accessTokenTtl=Math.floor(n.Expiry),s.AFrameworkApplication.wopiTokenLastRefreshTime=a,s.AFrameworkApplication.accessTokenServerExpirationTime=Math.floor(n.Expiry);else p.ULS.sendTraceTag(39706828,217,15,"Ignoring AccessToken because it expires sooner than the current one: {0}",((r={}).AccessTokenTtl=n.Expiry,r.NowGetTime=a,r.BootTime=s.AFrameworkApplication.bootTime,r),"PreviousAccessTokenTtl",s.AFrameworkApplication.accessTokenTtl)}}return!0},t.hasErrors=function(e){for(var t=!1,n=0;n<e.count;n++){t=!0;var i=e.get_item(n);p.ULS.sendTraceTag(39706829,217,15,"Received error for token {0}. Errors: {1}. TaskId: {2} ",i.Name,JSON.stringify(i.Errors),this._taskId)}return t},e}();function tr(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return nr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function nr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}Object(i.a)(er,"TokenRefreshManager",null,[213]);var ir=function(){function e(){this.retryInterval=s.AFrameworkApplication.wopiTokenRefreshRetryeInterval,this.maxRetryAttempts=s.AFrameworkApplication.wopiTokenRefreshMaxRetryAttempts,this.tokens=s.AFrameworkApplication.get_wopiTokensToRefresh(),this.expirationPolicy=s.AFrameworkApplication.wopiTokenExpirationPolicy,this.priority=s.AFrameworkApplication.wopiTokenTaskItemPriority,this._retriableErrorInterval=this.setRetryIntervalForNetworkIssue(),this._wopiTokenRefreshPermanentHostErrorList=s.AFrameworkApplication.get_wopiTokenRefreshPermanentHostErrorIdList()}var t=e.prototype;return t.isPermanentErrors=function(e){var t=JSON.stringify(e);if(this._wopiTokenRefreshPermanentHostErrorList&&this._wopiTokenRefreshPermanentHostErrorList.length>0)for(var n,i=tr(this._wopiTokenRefreshPermanentHostErrorList);!(n=i()).done;){var r=n.value;if(r.length>0&&t.indexOf(r)>=0)return!0}return!1},t.getRetryIntervalOverride=function(e){try{if(e)for(var t,n=tr(e);!(t=n()).done;){var i=t.value;if(i.Errors)for(var r,a=tr(i.Errors);!(r=a()).done;){var o=r.value;if(o.Id in this._retriableErrorInterval)return Number.parseInvariant(this._retriableErrorInterval[o.Id].toString())}}}catch(e){p.ULS.sendTraceTag(41501720,217,50,"TokenRefreshPolicy:GetRetryIntervalOverride, exception:{0}",e.toString())}return this.retryInterval},t.setRetryIntervalForNetworkIssue=function(){var e={};try{if(!s.AFrameworkApplication.get_wopiTokenRefreshNetworkErrorIdList()||s.AFrameworkApplication.get_wopiTokenRefreshNetworkErrorIdList().length<=0||""===s.AFrameworkApplication.get_wopiTokenRefreshNetworkErrorIdList()[0])return e;for(var t,n=tr(s.AFrameworkApplication.get_wopiTokenRefreshNetworkErrorIdList());!(t=n()).done;){var i=t.value;i.length>0&&(e[i]=s.AFrameworkApplication.wopiTokenRefreshRetryIntervalForClientNetworkIssue)}}catch(e){p.ULS.sendTraceTag(41755340,217,50,"TokenRefreshPolicy:SetRetryIntervalForNetworkIssue, exception:{0}",e.toString())}return e},e}();function rr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ir,"TokenRefreshPolicy",null,[212]);var ar=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){e.initOnFullAppSettingsReady()}))},r.initOnFullAppSettingsReady=function(){this._container.resolve("Common.ISessionExpirationManagerFactory"),this._container.resolve("Common.ISessionExpirationManager"),this._container.resolve("Common.ISessionExpirationManagerWithDialog")},r.dispose=function(){},r.configure=function(e){this._container=e,e.register(211,"Common.App.SessionExpiration.ISessionLogger").singleInstance().usingFactory((function(){return new Vi(b.a.instance)})),e.register(212,"Common.App.SessionExpiration.ITokenRefreshPolicy").singleInstance().usingFactory((function(){return new ir})),e.register(213,"Common.App.SessionExpiration.ITokenRefreshManager").singleInstance().usingFactory((function(){return new er(b.a.instance,s.AFrameworkApplication.get_hostPostmessengerFuture(),e.resolve("Common.App.SessionExpiration.ITokenRefreshPolicy"),e.resolve("Common.App.SessionExpiration.ISessionLogger"))})),e.register(214,"Common.ISessionExpirationManagerFactory").singleInstance().usingFactory((function(){return new zi(s.AFrameworkApplication.activeFrame,e.resolve("Common.App.SessionExpiration.ITokenRefreshManager"),e.resolve("Common.App.SessionExpiration.ISessionLogger"),e.tryResolve("Common.ISessionStatus"))})),e.register(215,"Common.ISessionExpirationManagerWithDialog").singleInstance().usingFactory((function(){return e.resolve("Common.ISessionExpirationManagerFactory").create()})),e.register(216,"Common.ISessionExpirationManager").singleInstance().usingFactory((function(){return e.resolve("Common.ISessionExpirationManagerWithDialog")}))},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.SessionExpiration"}}])&&rr(t.prototype,n),i&&rr(t,i),e}();Object(i.a)(ar,"SessionExpirationPackage",null,[20,21]);function or(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var sr=function(){function e(e,t,n){this._actionManager=e,this._isMacOfficeTrialOfferEnabled=t,this._lcid=n}var t,n,i,a=e.prototype;return a.registerActions=function(){this._actionManager.addAction(h.a.tryMacOffice,ue.a.frame,Object(r.a)(this,this.onTryMacOffice,"onTryMacOffice")),this._actionManager.addAction(h.a.tryMacOfficeFromWordViewer,ue.a.frame,Object(r.a)(this,this.onTryMacOfficeFromViewer,"onTryMacOfficeFromViewer")),this._actionManager.addAction(h.a.tryMacOfficeFromPowerPointViewer,ue.a.frame,Object(r.a)(this,this.onTryMacOfficeFromViewer,"onTryMacOfficeFromViewer"))},a.onTryMacOffice=function(e,t,n,i,r){if(1===n)return 32;if(r){var a=r.SourceControlId;"btnjTryMacOfficeForWordEditor"===a?nt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(12),"_blank",void 0,"MacOfficeOffer.TriggerFromWordEditor"):"PptJewel.About.TryMacOffice"===a&&nt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(22),"_blank",void 0,"MacOfficeOffer.TriggerFromPPTEditor")}else this.launchMacOfficeTrialWindow();return 32},a.onTryMacOfficeFromViewer=function(e,t,n,i,r){if(1===n)return 32;switch(e){case h.a.tryMacOfficeFromWordViewer:nt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(15),"_blank",void 0,"MacOfficeOffer.TriggerFromWordViewer");break;case h.a.tryMacOfficeFromPowerPointViewer:nt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(25),"_blank",void 0,"MacOfficeOffer.TriggerFromPPTViewer")}return 32},a.launchMacOfficeTrialWindow=function(t){void 0===t&&(t=null);var n=0;t&&(n=t);var i=2===n?"https://go.microsoft.com/fwlink/?LinkId=331579":e.macOfficeTrialTarget;nt.a.safelyOpenWindow(i,"_blank",void 0,"LaunchMacTrialWindow")},t=e,i=[{key:"macOfficeTrialTarget",get:function(){return Dt.a.getFwLinkUrl("522401")}}],(n=[{key:"shouldOfferMacOfficeTrial",get:function(){return this._isMacOfficeTrialOfferEnabled&&H.a.isMac&&!H.a.isPpcMac&&!MSOJS.ClientUtils.IsO14MacPluginInstalled()}},{key:"shouldOfferMacOfficeTrialInFileMenu",get:function(){var e=this.shouldOfferMacOfficeTrial;return e||s.AFrameworkApplication.theWsaClient.setBool(9124,1),e}},{key:"shouldOfferMacOfficeTrialInErrorDialog",get:function(){return this.shouldOfferMacOfficeTrial}}])&&or(t.prototype,n),i&&or(t,i),e}();function lr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(sr,"MacOfficeOffer",null,[240]);var cr=function(){function e(e,t,n){this._actionManager=e,this._isOfficeTrialOfferEnabled=t,this._lcid=n}var t,n,i,a=e.prototype;return a.registerActions=function(){this._actionManager.addAction(h.a.tryOffice,ue.a.frame,Object(r.a)(this,this.onTryOffice,"onTryOffice")),this._actionManager.addAction(h.a.tryOfficeThroughTellMe,ue.a.frame,Object(r.a)(this,this.tryOfficeThroughTellMe,"tryOfficeThroughTellMe")),this._actionManager.addAction(h.a.tryOfficeFromWordViewer,ue.a.frame,Object(r.a)(this,this.tryOfficeThroughViewer,"tryOfficeThroughViewer")),this._actionManager.addAction(h.a.tryOfficeFromPowerPointViewer,ue.a.frame,Object(r.a)(this,this.tryOfficeThroughViewer,"tryOfficeThroughViewer"))},a.onTryOffice=function(e,t,n,i,r){if(2===n)if(r){var a=r.SourceControlId;"btnjTryOfficeForWordEditor"===a?nt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(11),"_blank",void 0,"OfficeTrial.TriggerFromWordEditor"):"PptJewel.About.TryOffice"===a?nt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(21),"_blank",void 0,"OfficeTrial.TriggerFromPPTViewer"):this.launchOffer()}else this.launchOffer();return 32},a.tryOfficeThroughTellMe=function(e,t,n,i,r){if(2===n)if(r){var a=r.SourceControlId;nt.a.safelyOpenWindow(Dt.a.getFwLinkUrl("862405")+this.getParameterForTellMeFeatures(a),"_blank",void 0,"TryOfficeThroughTellMe.WithSourceControlId")}else nt.a.safelyOpenWindow(Dt.a.getFwLinkUrl("522402"),"_blank",void 0,"TryOfficeThroughTellMe.Legacy");return 32},a.tryOfficeThroughViewer=function(e,t,n,i,r){if(2===n)switch(e){case h.a.tryOfficeFromWordViewer:nt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(14),"_blank",void 0,"TryOfficeThroughViewer.Word");break;case h.a.tryOfficeFromPowerPointViewer:nt.a.safelyOpenWindow(Dt.a.getFwLinkForUpsellFeatures(24),"_blank",void 0,"TryOfficeThroughViewer.PPT")}return 32},a.launchOffer=function(t){void 0===t&&(t=null);var n=0;t&&(n=t),nt.a.safelyOpenWindow(e.getLinkForPlatformAndApplication(n),"_blank",void 0,"LaunchOfficeOffer")},a.getParameterForTellMeFeatures=function(e){var t=0;switch(e){case"jbtnTryOfficeThroughTellMeForWordTrackChanges":t=1;break;case"jbtnTryOfficeThroughTellMeForWordShapes":t=2;break;case"jbtnTryOfficeThroughTellMeForWordLabel":t=3;break;case"jbtnTryOfficeThroughTellMeForWordCitations":t=4;break;case"jbtnTryOfficeThroughTellMeForWordTextBox":t=5;break;case"jbtnTryOfficeThroughTellMeForWordTableOfContent":t=6;break;case"jbtnTryOfficeThroughTellMeForWordSmartArt":t=7;break;case"jbtnTryOfficeThroughTellMeForWordWordArt":t=8;break;case"jbtnTryOfficeThroughTellMeForWordMultiColumnLayout":t=9;break;case"jbtnTryOfficeThroughTellMeForWordEquation":t=10;break;case"jbtnTryOfficeThroughTellMeForPPTGroupShapes":t=16;break;case"jbtnTryOfficeThroughTellMeForPPTWordArt":t=17;break;case"jbtnTryOfficeThroughTellMeForPPTSpellCheckDict":t=18;break;case"jbtnTryOfficeThroughTellMeForPPTInsertAudio":t=19;break;case"jbtnTryOfficeThroughTellMeForPPTInsertChart":t=20;break;case"TellMe.TryOfficeThroughTellMeForXLSSpellCheck":t=26;break;case"TellMe.TryOfficeThroughTellMeForXLSMacros":t=27;break;case"TellMe.TryOfficeThroughTellMeForXLSPivotTable":t=28;break;case"TellMe.TryOfficeThroughTellMeForXLSHeaderFooter":t=29}return t?String.format("&pc={0:D}",t):""},e.getLinkForPlatformAndApplication=function(e){if(H.a.isIPad)switch(e){case 1:return Dt.a.getFwLinkUrl("393806");case 2:return Dt.a.getFwLinkUrl("393810");case 3:return Dt.a.getFwLinkUrl("393809");case 5:return Dt.a.getFwLinkUrl("393805")}else if(H.a.isAndroid)switch(e){case 1:return Dt.a.getFwLinkUrl("521979");case 3:return Dt.a.getFwLinkUrl("521980");case 5:return Dt.a.getFwLinkUrl("521978");case 2:return Dt.a.getFwLinkUrl("522490")}else{if(2===e)return Dt.a.getFwLinkUrl("517778");if(1===e)return Dt.a.getFwLinkForUpsellFeatures(30)}return Dt.a.getFwLinkUrl("522402")},t=e,(n=[{key:"offerOfficeTrialInFileMenu",get:function(){return this.shouldOfferOfficeTrial}},{key:"offerOfficeTrialInDialog",get:function(){return this.shouldOfferOfficeTrial&&MSOJS.ClientUtils.OfferOfficeInDialog()}},{key:"shouldOfferOfficeTrial",get:function(){return this._isOfficeTrialOfferEnabled&&!H.a.isMac}}])&&lr(t.prototype,n),i&&lr(t,i),e}();Object(i.a)(cr,"OfficeTrialExperience",null,[239]);var ur=function(){function e(){}return e.prototype.configure=function(e){e.register(cr,"Common.App.OpenInClient.OfficeTrialExperience").as("Common.IOfficeTrialExperience").singleInstance().usingFactory((function(){return new cr(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.isOfficeTrialOfferEnabled,s.AFrameworkApplication.lcid)})),e.register(sr,"Common.App.OpenInClient.MacOfficeOffer").as("Common.IMacOfficeOffer").singleInstance().usingFactory((function(){return new sr(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.isMacOfficeTrialOfferEnabled,s.AFrameworkApplication.lcid)}))},e}();Object(i.a)(ur,"OpenInClientConfiguration",null,[21]);var dr=n(24),hr=n(18),pr=n(14),gr=n(6),mr=n(20);function fr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _r(e,t){return(_r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var vr=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).commandsHeaderText=CommonUIStrings.l_AccHelpDialogCommandsHeaderText,n.shortcutHeaderText=CommonUIStrings.l_AccHelpDialogShortcutHeaderText,n._shortcutEntries=null,n._moreHelpLink=null,n._dialogTable=null,n._selectedRow=null,n.dialogBody=null,n._focusManager=t,n.dialogHtml="<div id='AccessibilityHelpDialogBody'></div>",n.dialogId="AAccessibilityHelpDialog",n.buttonsOption=6,n.setButtonText(0,CommonUIStrings.l_DialogClose),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,_r(t,n);var a,o,s,l=i.prototype;return l.setDialogProperties=function(t){e.prototype.setDialogProperties.call(this,t),this.populateDialogBody()},l.showAndFocus=function(){this.showDialog(this.dialogTitle,Object(r.a)(this,this.accHelpDialogResultHandler,"accHelpDialogResultHandler")),this.rebindTabNavigationHandlers(),this.setFocus()},l.setFocus=function(){this._dialogTable?(this._selectedRow=this._dialogTable.tBodies[0].firstChild,this.setFocusOnElement(this._selectedRow)):this._btnAction&&"none"!==this._btnAction.style.display?this.setFocusOnElement(this._btnAction):this.setFocusOnElement(this._btnCancel)},l.attachDialogEvents=function(){if(this._keyInputManager.registerHandler(f.a.keyDown,this.dialogBody,Object(r.a)(this,this.accHelpDialogKeydownHandler,"accHelpDialogKeydownHandler")),this._dialogTable){this._keyInputManager.registerHandler(f.a.keyUp,this._dialogTable,Object(r.a)(this,this.tableOnKeyUpHandler,"tableOnKeyUpHandler"));for(var t=this._dialogTable.tBodies[0].children,n=0;n<t.length;n++)if(Fe.a.addHandler(t[n],f.a.focus,Object(r.a)(this,this.rowOnFocusHandler,"rowOnFocusHandler")),Fe.a.addHandler(t[n],f.a.blur,Object(r.a)(this,this.rowOnBlurHandler,"rowOnBlurHandler")),H.a.isInternetExplorerNonEdge)for(var i=t[n].children,a=0;a<i.length;a++)Fe.a.addHandler(i[a],f.a.focus,Object(r.a)(this,this.cellOnFocusHandler,"cellOnFocusHandler"))}e.prototype.attachDialogEvents.call(this)},l.detachDialogEvents=function(){if(this._keyInputManager&&(this._keyInputManager.unregisterHandler(f.a.keyDown,this.dialogBody,Object(r.a)(this,this.accHelpDialogKeydownHandler,"accHelpDialogKeydownHandler")),this._dialogTable&&this._keyInputManager.unregisterHandler(f.a.keyUp,this._dialogTable,Object(r.a)(this,this.tableOnKeyUpHandler,"tableOnKeyUpHandler"))),this._dialogTable)for(var t=this._dialogTable.tBodies[0].children,n=0;n<t.length;n++)if(Fe.a.removeHandler(t[n],f.a.focus,Object(r.a)(this,this.rowOnFocusHandler,"rowOnFocusHandler")),Fe.a.removeHandler(t[n],f.a.blur,Object(r.a)(this,this.rowOnBlurHandler,"rowOnBlurHandler")),H.a.isInternetExplorerNonEdge)for(var i=t[n].children,a=0;a<i.length;a++)Fe.a.removeHandler(i[a],f.a.focus,Object(r.a)(this,this.cellOnFocusHandler,"cellOnFocusHandler"));e.prototype.detachDialogEvents.call(this)},l.rebindTabNavigationHandlers=function(){this.currentFocusRegion.scope.unBindAction(this._focusManager._tabInput),this.currentFocusRegion.scope.unBindAction(this._focusManager._tabShiftInput),this.currentFocusRegion.scope.bindAction(this._focusManager._tabInput,h.a.accessibilityHelpDialogFocusForward),this.currentFocusRegion.scope.bindAction(this._focusManager._tabShiftInput,h.a.accessibilityHelpDialogFocusBackward)},l.handleTabFocus=function(e,t,n,i,r){if(!this.currentFocusRegion.listing||!this.currentFocusRegion.listing.currentElement)return 2;var a=this.currentFocusRegion.listing.currentElement;if(this._dialogTable&&(a===this._btnCancel&&e===h.a.accessibilityHelpDialogFocusForward||a===this._moreHelpLink&&e===h.a.accessibilityHelpDialogFocusBackward))this.setFocusOnElement(this._selectedRow);else if(a.id.startsWith("SelectableTableRow")){var o=null;e===h.a.accessibilityHelpDialogFocusForward?o=this._moreHelpLink:e===h.a.accessibilityHelpDialogFocusBackward&&(o=this._btnCancel),o&&this.setFocusOnElement(o)}else if(e===h.a.accessibilityHelpDialogFocusForward)this.currentFocusRegion.moveForward();else{if(e!==h.a.accessibilityHelpDialogFocusBackward)return 2;this.currentFocusRegion.moveBackward()}return 32},l.rowOnFocusHandler=function(e){e.target.setAttribute(gr.a.ariaSelectedAttribute,gr.a.ariaTrueValue),Sys.UI.DomElement.removeCssClass(this._selectedRow,"inactiveRowSelection"),this._selectedRow=e.target},l.rowOnBlurHandler=function(e){e.target.removeAttribute(gr.a.ariaSelectedAttribute),Sys.UI.DomElement.addCssClass(e.target,"inactiveRowSelection")},l.cellOnFocusHandler=function(e){var t=e.target.parentNode;t&&t!==this._selectedRow&&this.setFocusOnElement(t)},l.tableOnKeyUpHandler=function(e){return e.innerEvent.keyCode===dr.a.vK_Enter&&(e.innerEvent.stopPropagation(),!0)},l.accHelpDialogKeydownHandler=function(e){if(!e.innerEvent)return!1;var t=e.innerEvent.keyCode;if(e.eventName===f.a.keyDown){var n=this.getIndexOfRow(this._selectedRow),i=-1,r=N.a.count(this.shortcutEntries)-1;t===Sys.UI.Key.down?i=n<r?n+1:0:t===Sys.UI.Key.up?i=n>0?n-1:r:t===Sys.UI.Key.home?i=0:t===Sys.UI.Key.end&&(i=r),-1!==i&&this.setFocusOnElement(this._dialogTable.tBodies[0].children[i])}return!0},l.accHelpDialogResultHandler=function(e,t){},l.populateDialogBody=function(){this.dialogBody=document.getElementById("AccessibilityHelpDialogBody")||this._bodyPanel,this.createSubtitle(),this.createShortcutsTable(),this.createMoreHelpLink()},l.createSubtitle=function(){if(this.dialogSubtitle){var e=document.createElement("div");e.className="WACDialogSubtitle";var t=document.createElement("span");t.innerText=this.dialogSubtitle,e.appendChild(t),this._divMessageBoxTitle.appendChild(e)}},l.createShortcutsTable=function(){if(this.shortcutEntries&&!N.a.isEmpty(this.shortcutEntries)){this._dialogTable=document.createElement("table"),this._dialogTable.className="SelectableDialogTable";var e=document.createElement("thead"),t=document.createElement("tr");t.setAttribute(gr.a.ariaRoleAttribute,gr.a.ariaRowRole),e.appendChild(t);var n=mr.a.createElementWithInnerTextSafe(14,this.commandsHeaderText);t.appendChild(n);var i=mr.a.createElementWithInnerTextSafe(14,this.shortcutHeaderText);t.appendChild(i),this._dialogTable.appendChild(e);var r=document.createElement("tbody"),a=0,o=this.shortcutEntries;for(var s in o){var l={key:s,value:o[s]},c=document.createElement("tr");c.tabIndex=0,c.setAttribute(gr.a.ariaRoleAttribute,gr.a.ariaRowRole),c.id="SelectableTableRow"+a++;var u=mr.a.createElementWithInnerTextSafe(15,l.key);c.appendChild(u);var d=mr.a.createElementWithInnerTextSafe(15,l.value);c.appendChild(d),r.appendChild(c)}r.style.maxHeight=this.tableMaxHeight+"px",this._dialogTable.appendChild(r),this.dialogBody.appendChild(this._dialogTable)}},l.createMoreHelpLink=function(){if(this.moreHelpLinkText&&this.moreHelpLinkUrl){var e=document.createElement("div");e.className="WACDialogLearnMoreLinkContainer",this._moreHelpLink=document.createElement("a"),this._moreHelpLink.innerText=this.moreHelpLinkText,this._moreHelpLink.href=this.moreHelpLinkUrl,this._moreHelpLink.target="_blank",this._moreHelpLink.id=this.myId("AccessibilityHelpDialogLink"),this._moreHelpLink.className=kt.AFrame.allowBrowserClickClassname,e.appendChild(this._moreHelpLink),this._divMessageBox.insertBefore(e,this._divMessageBox.lastChild)}},l.getIndexOfRow=function(e){var t="SelectableTableRow".length;return Number.parseInvariant(e.id.substr(t))},l.addCommandShortcutToDict=function(e,t,n,i){if(void 0===i&&(i=null),e&&t&&n){var r=i?String.format(n,i):n;e[t]=r}},l.getSpecialKeyForOS=function(e,t){return H.a.isMac?t:e},a=i,(o=[{key:"dialogSubtitle",get:function(){return null}},{key:"shortcutEntries",get:function(){return this._shortcutEntries||(this._shortcutEntries=this.initializeDictionary()),this._shortcutEntries}},{key:"tableMaxHeight",get:function(){return 300}},{key:"moreHelpLinkUrl",get:function(){return"https://go.microsoft.com/fwlink/p/?LinkId=325036"}},{key:"moreHelpLinkText",get:function(){return CommonUIStrings.l_AccHelpDialogMoreHelpLinkText}},{key:"currentFocusRegion",get:function(){return this._focusManager.getCurrentRegion()}}])&&fr(a.prototype,o),s&&fr(a,s),i}(Ei.a);function yr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Sr(e,t){return(Sr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(vr,"AAccessibilityHelpDialog",Ei.a,[261]);var br=function(e){var t,n,i,r,a;function o(t){return e.call(this,t)||this}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,Sr(t,n),o.prototype.initializeDictionary=function(){var e={};return e[CommonUIStrings.l_AccHelpDialogAccHelpCommand]=CommonUIStrings.l_AccHelpDialogAccHelpShortcut,e[CommonUIStrings.l_AccHelpDialogMoveInEditingAreaCommand]=CommonUIStrings.l_AccHelpDialogMoveInEditingAreaShortcut,s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("AccessibleMovingDialogsEnabled")&&(e[CommonUIStrings.l_AccHelpDialogOpenDialogMenuCommand]=CommonUIStrings.l_AccHelpDialogOpenDialogMenuShortcut),e},i=o,(r=[{key:"dialogTitle",get:function(){return CommonUIStrings.l_AccHelpDialogAppViewerTitle}}])&&yr(i.prototype,r),a&&yr(i,a),o}(vr);Object(i.a)(br,"PdfViewerAccessibilityHelpDialog",vr,[]);var Cr=n(17);function Ar(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Tr(e,t){return(Tr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var wr=function(e){var t,n;function i(t,n){var i;return(i=e.call(this,n)||this)._actionManager=t,i.buttonsOption=1,i.setButtonText(1,WordViewerIntl.WordViewerStrings.L_AccessibilityMode),i.setButtonText(0,CommonUIStrings.l_DialogClose),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Tr(t,n);var r,a,o,s=i.prototype;return s.populateDialogBody=function(){e.prototype.populateDialogBody.call(this);var t=document.createElement("div");t.style.maxWidth="550px";var n=mr.a.createElementWithInnerTextSafe(12,WordViewerIntl.WordViewerStrings.L_AccHelpDialogSwitchToAccessibleMode);t.appendChild(n),this.dialogBody.appendChild(t),this._divMessageBox.setAttribute(gr.a.ariaDescribedByAttribute,"WACDialogText")},s.accHelpDialogResultHandler=function(e,t){1===e?this._actionManager.processAction(Cr.a.toggleViewMode,2):e||this.hide()},s.initializeDictionary=function(){return null},r=i,(a=[{key:"dialogTitle",get:function(){return CommonUIStrings.l_AccHelpDialogAppViewerTitle}}])&&Ar(r.prototype,a),o&&Ar(r,o),i}(vr);Object(i.a)(wr,"PngViewerAccessibilityHelpDialog",vr,[]);var kr=function(){function e(e,t){this._dialog=null,this._actionManager=e,this._focusManager=t}var t=e.prototype;return t.registerActions=function(){if(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UIDiscoverabilityEnabled")&&pr.App.instance.userMayEnterAccessiblePdfMode){var e=hr.KeyInputManager.hashKey(dr.a.VK_A,5);this._focusManager.getScope(kt.AFrame.documentFocusID).unBindAction(e),this._focusManager.getScope(kt.AFrame.mainAppFocusId).bindAction(e,h.a.showAccessibilityHelpDialog),this._actionManager.addAction(h.a.showAccessibilityHelpDialog,ue.a.frame,Object(r.a)(this,this.showAccessibilityHelpDialog,"showAccessibilityHelpDialog")),this._actionManager.addAction(h.a.accessibilityHelpDialogFocusForward,ue.a.frame,Object(r.a)(this,this.accHelpDialogTabFocusHandler,"accHelpDialogTabFocusHandler")),this._actionManager.addAction(h.a.accessibilityHelpDialogFocusBackward,ue.a.frame,Object(r.a)(this,this.accHelpDialogTabFocusHandler,"accHelpDialogTabFocusHandler"))}},t.showAccessibilityHelpDialog=function(e,t,n,i,r){return 1===n?32:(pr.App.instance.isAccessiblePdfMode?this._dialog=new br(this._focusManager):this._dialog=new wr(this._actionManager,this._focusManager),this._dialog?(this._dialog.showAndFocus(),32):(p.ULS.sendTraceTag(21233674,334,10,"AccessibilityHelpDialog failed to initialize"),8))},t.accHelpDialogTabFocusHandler=function(e,t,n,i,r){return this._dialog?this._dialog.handleTabFocus(e,t,n,i,r):2},e}();function Ir(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(kr,"AccessibilityHelpDialogActor",null,[]);var Fr=function(){function e(e,t){this._hostPostmessenger=null,this._actionManager=e,this._hostPostmessengerFuture=t}var t,n,i,a=e.prototype;return a.registerActions=function(){this._actionManager.addActionWithFlags(h.a.close,ue.a.frame,Object(r.a)(this,this.closeDocument,"closeDocument"),2176),this._actionManager.addActionWithFlags(h.a.fileProperties,ue.a.frame,Object(r.a)(this,this.fileProperties,"fileProperties"),128),this._actionManager.addAction(h.a.fileSharing,ue.a.frame,Object(r.a)(this,this.fileSharing,"fileSharing")),this._actionManager.addActionWithFlags(h.a.copyAndEdit,ue.a.frame,Object(r.a)(this,this.copyAndEdit,"copyAndEdit"),128),this._actionManager.addActionWithFlags(h.a.replyWithChanges,ue.a.frame,Object(r.a)(this,this.replyWithChanges,"replyWithChanges"),128),this._actionManager.addActionWithFlags(h.a.showFileVersion,ue.a.frame,Object(r.a)(this,this.fileVersion,"fileVersion"),128),this._actionManager.addAction(h.a.downloadACopy,ue.a.frame,Object(r.a)(this,this.downloadACopy,"downloadACopy")),this._actionManager.addAction(h.a.downloadACopyDownloadButtonClick,ue.a.frame,yt.ActionManager.doNothingButReportHandler),this._actionManager.addActionWithFlags(h.a.reportAbuseLink,ue.a.frame,Object(r.a)(this,this.reportAbuseLink,"reportAbuseLink"),128),this._actionManager.addActionWithFlags(h.a.signIn,ue.a.frame,Object(r.a)(this,this.signInInternal,"signInInternal"),128),this._actionManager.addAction(h.a.workflow,ue.a.frame,Object(r.a)(this,this.workflow,"workflow")),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DocumentNameInJewelInfoMenuIsEnabled")&&this._actionManager.addActionWithFlags(h.a.queryBreadcrumbDocName,ue.a.frame,Object(r.a)(this,this.queryBreadcrumbDocName,"queryBreadcrumbDocName"),96),this._actionManager.addActionWithFlags(h.a.queryCopyAndEditButton,ue.a.frame,Object(r.a)(this,this.queryCopyAndEditButton,"queryCopyAndEditButton"),96),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DiagnosticsInfoInJewelAboutMenuIsEnabled")&&(this._actionManager.addActionWithFlags(h.a.queryBuildVersion,ue.a.frame,Object(r.a)(this,this.queryBuildVersion,"queryBuildVersion"),2144),this._actionManager.addActionWithFlags(h.a.querySessionId,ue.a.frame,Object(r.a)(this,this.querySessionId,"querySessionId"),2144)),this._actionManager.addAction(h.a.conversation,ue.a.frame,Object(r.a)(this,this.conversation,"conversation")),this._hostPostmessengerFuture.execute(Object(r.a)(this,this.onHostPostmessengerCreated,"onHostPostmessengerCreated"))},a.onHostPostmessengerCreated=function(e){this._hostPostmessenger=e},a.closeDocument=function(e,t,n,i,r){var a=2===n,o=Pi.h;return r&&(o=r),t&&a&&!this.beforeCloseDocument(o)?8:this.closeDocumentInternal(a,o)},a.beforeCloseDocument=function(e){return!0},a.closeDocumentInternal=function(e,t){if(s.AFrameworkApplication.activeFrame.applicationInstance.shouldCommandBeHostControlled("3033402446"))return p.ULS.sendTraceTag(41231952,306,50,"CloseDocumentInternal - Sending FileClose postMessage to give the host control of closing the page"),this.sendPostmessage(e,d.a.fileClose,!0,{});if(s.AFrameworkApplication.reportAbuseUrl&&t&&t===Pi.f)return p.ULS.sendTraceTag(6070357,306,50,"CloseDocumentInternal - navigating to ReportAbuseUrl"),s.AFrameworkApplication.activeFrame.navigateToHostUrl(e,s.AFrameworkApplication.reportAbuseUrl);if(s.AFrameworkApplication.isEmbedded)return e&&p.ULS.sendTraceTag(6070358,306,50,"CloseDocumentInternal - cannot close because application is embedded"),8;if(s.AFrameworkApplication.closeWindowOnAppClose){if(!e)return 32;p.ULS.sendTraceTag(6070359,306,50,"CloseDocumentInternal - closing the window");try{return window.top.close(),32}catch(e){return p.ULS.sendTraceTag(6070360,306,10,"CloseDocumentInternal - encountered unexpected exception: {0}",e),8}}var n,i=s.AFrameworkApplication.closeUrl;if(!i)return e&&p.ULS.sendTraceTag(6070361,306,50,"CloseDocumentInternal - no closeUrl found"),8;if(t||(t=Pi.h),t===Pi.c||t===Pi.h)return s.AFrameworkApplication.activeFrame.navigateToHostUrl(e,i);if(s.AFrameworkApplication.replyWithChangesUrl){var r;if(e&&p.ULS.sendTraceTag(6070362,306,50,"CloseDocumentInternal - Using ReplyWithChanges postmessage"),t===Pi.d||t===Pi.b)n=this.sendPostmessage(e,d.a.replyWithChanges,s.AFrameworkApplication.useReplyWithChangesPostMessage,((r={}).event_source=t,r));else n=2;return 32!==n?(i=t?Dt.a.addOrReplaceParameterValue(s.AFrameworkApplication.replyWithChangesUrl,Pi.e,t):s.AFrameworkApplication.replyWithChangesUrl,s.AFrameworkApplication.activeFrame.navigateToHostUrl(e,i)):n}return e&&p.ULS.sendTraceTag(6070363,306,50,"CloseDocumentInternal - Using FileClose postmessage"),32!==(n=t===Pi.b?this.sendPostmessage(e,d.a.fileClose,s.AFrameworkApplication.useClosePostMessage,null):2)?s.AFrameworkApplication.activeFrame.navigateToHostUrl(e,i):n},a.signInInternal=function(e,t,n,i,r){var a=r,o=this.sendPostmessage(2===n,d.a.signIn,!0,a);return 8===o&&(window.top.location=s.AFrameworkApplication.signInUrl,o=32),o},a.fileProperties=function(e,t,n,i,r){var a=this.sendPostmessage(2===n,d.a.fileProperties,s.AFrameworkApplication.useFilePropertiesPostMessage,null);return 32!==a?s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.filePropertiesUrl):a},a.fileSharing=function(e,t,n,i,r){if(1===n)return gi.SessionStatusManager.instance.hasEmergencyViewModeBeenDeployed?8:32;var a,o=r,l=W.a.create().toString(),c={};c.event_source=o,c[ln.a.shareCorrelation]=l;var u=r,h=u?u.nav:null;h&&(c[ln.a.shareNavId]=h),u&&"CopyLink"===u.SourceControlId&&(u.mode="copy");var g=u?u.mode:null;if(g&&(c[ln.a.shareMode]=g),2===n){var m={};m[ln.a.shareCorrelation]=l,g&&(m.mode=g),p.ULS.sendTraceTag(38278995,306,50,B.c(m))}var f=this.sendPostmessage(2===n,d.a.sharing,s.AFrameworkApplication.useFileSharingPostMessage,c);if(32!==f){var _;if(s.AFrameworkApplication.fileSharingUrl)return a=o?Dt.a.addOrReplaceParameterValue(s.AFrameworkApplication.fileSharingUrl,Pi.e,o):s.AFrameworkApplication.fileSharingUrl,s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,a,!0);p.ULS.sendTraceTag(7985242,306,50,"Sharing PostMessage didn't succeed but there is no FileSharingURL to fallback to.",((_={}).Result=f,_))}return f},a.conversation=function(e,t,n,i,r){return this.sendPostmessage(2===n,d.a.conversation,!0,{})},a.workflow=function(e,t,n,i,r){var a,o=this.sendPostmessage(2===n,d.a.workflow,s.AFrameworkApplication.useWorkflowPostMessage,((a={}).WorkflowType=s.AFrameworkApplication.workflowTypeString,a));if(32!==o){var l;if(s.AFrameworkApplication.workflowUrl)return s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.workflowUrl,!0);p.ULS.sendTraceTag(19781538,306,50,"Workflow PostMessage didn't succeed.",((l={}).Result=o,l))}return o},a.reportAbuseLink=function(e,t,n,i,r){var a=2===n;return t&&a&&!this.beforeCloseDocument(Pi.f)?8:s.AFrameworkApplication.activeFrame.navigateToHostUrl(a,s.AFrameworkApplication.reportAbuseUrl)},a.copyAndEdit=function(e,t,n,i,r){var a={};2===n&&(a=s.AFrameworkApplication.activeFrame.applicationInstance.getCopyAndEditParams());var o=this.sendPostmessage(2===n,d.a.copyAndEdit,s.AFrameworkApplication.useCopyAndEditPostMessage,a);return 32!==o?s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.copyAndEditUrl,s.AFrameworkApplication.hideHeader):o},a.downloadACopy=function(e,t,n,i,r){return 1===n?s.AFrameworkApplication.protectedFile||gi.SessionStatusManager.instance.hasEmergencyViewModeBeenDeployed?8:32:s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.downloadACopyUrl,!0)},a.replyWithChanges=function(e,t,n,i,r){var a,o=2===n;if(t&&o&&!this.beforeCloseDocument(Pi.d))return 8;var l=this.sendPostmessage(o,d.a.replyWithChanges,s.AFrameworkApplication.useReplyWithChangesPostMessage,((a={}).event_source=Pi.d,a));if(32!==l){var c=Dt.a.addOrReplaceParameterValue(s.AFrameworkApplication.replyWithChangesUrl,Pi.e,Pi.d);return s.AFrameworkApplication.activeFrame.navigateToHostUrl(o,c)}return l},a.fileVersion=function(e,t,n,i,r){var a=this.sendPostmessage(2===n,d.a.fileVersions,s.AFrameworkApplication.useFileVersionPostMessage,null);return 32!==a?s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.fileVersionUrl):a},a.queryBreadcrumbDocName=function(e,t,n,i,r){if(2===n){if(!r)return 8;var a=r,o=s.AFrameworkApplication.docPropertiesProvider.breadcrumbDocName;a.Value=je.a.getFileNameWithoutExtension(o)}return 32},a.queryBuildVersion=function(e,t,n,i,r){if(2===n){if(!r)return 8;r.Text=s.AFrameworkApplication.instance.diagnosticsBuildVersion}return 32},a.querySessionId=function(e,t,n,i,r){if(2===n){if(!r)return 8;r.Text=s.AFrameworkApplication.instance.diagnosticsSessionId}return 32},a.sendPostmessage=function(e,t,n,i){return n?e?this.hostPostmessenger.sendMessage(t,i)?32:8:32:2},a.queryCopyAndEditButton=function(e,t,n,i,r){if(2===n){if(!r)return 8;var a=r;s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsEditAndReplyFlow")&&(a.LabelText=CommonUIStrings.l_EditAndReply)}return 32},t=e,(n=[{key:"hostPostmessenger",get:function(){return this._hostPostmessenger}}])&&Ir(t.prototype,n),i&&Ir(t,i),e}();Object(i.a)(Fr,"WebAppFrameCommandUIActor",null,[]);var Er=n(579),Pr=n(52),Or=n(70),Rr=function(e){for(var t=0;t<e.children.length;t++){var n=e.children[t];n.style.position="relative",n.style.top=(n.parentNode.offsetHeight-n.offsetHeight)/2+"px"}},Mr=function(e){return(e.innerEvent.keyCode===dr.a.vK_Enter||e.innerEvent.keyCode===dr.a.vK_Space)&&(e.sourceElement.click(),!0)},Dr=function(e,t,n,i,r,a,o){var s=document.createElement("a");s.className="ProtocolLaunchingDialogButtonAnchor",s.className+=" OICDialog",s.id=e,s.setAttribute(gr.a.ariaRoleAttribute,gr.a.ariaButtonRole),s.style.padding="0",s.style.margin="0",i&&xr(r,t,n,i,s);var l=document.createElement("span");return l.className="ProtocolLaunchingDialogButtonLabel",l.innerText=r,s.appendChild(l),s.tabIndex=0,a&&Or.a.instance.registerHandler(f.a.click,s,a),o&&hr.KeyInputManager.instance.registerHandler(f.a.keyUp,s,o),s},xr=function(e,t,n,i,r){var a=document.createElement("img");a.alt=e,a.className=Pr.getImageClassWithCluster(n,i),a.src=t,a.setAttribute(gr.a.ariaRoleAttribute,gr.a.ariaPresentationRole);var o=document.createElement("span");o.className="ProtocolLaunchingDialogImg32Container",o.appendChild(a);var s=document.createElement("span");s.className="ProtocolLaunchingDialogIconContainer",s.appendChild(o),r.appendChild(s)};function Lr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Br=function(){function e(){}var t,n,i;return t=e,i=[{key:"dialogHtml",get:function(){return Ei.a.formatHtml(e.dialogHtmlFormat,CommonUIStrings.l_OICLaunchDialogTitle)}}],(n=null)&&Lr(t.prototype,n),i&&Lr(t,i),e}();function Ur(e,t){return(Ur=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Br.dialogHtmlFormat="<div class='ProtocolLaunchingDialogBody' id='PLDDlgBody'> <div class='ProtocolLaunchingDialogTitle UIFontDialogTitle OICDialog' id='ProtocolLaunchingDialogTitle'> <div class='WACDialogSectionTitle'>{0}</div> </div> <div class='OICDialogRow' id='OICDialog'> <div class='OICDialogButtons' id='Buttons'> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonLaunchRichClient'> <div id='OICLaunchRichClient' class='UIFontDialogButton WACGlyph OICDialog'></div> </div> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonReturn'> <div id='OICReturnToApp' class='UIFontDialogButton WACGlyph OICDialog'></div> </div> </div> </div> </div>",Object(i.a)(Br,"OICLaunchDialogHtml",null,[]);var Hr=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this)._btnRichClient=null,n._btnReturn=null,n._disposed$4=!1,n._operation=t,n.dialogHtml=Br.dialogHtml,n.autoSize=!0,n.buttonsOption=5,n.dialogId="OICLaunchDialog",n.showDialog("",Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),n.oicLaunchDialogResultHandler,"oicLaunchDialogResultHandler")),n.setLabelledByForDialog("ProtocolLaunchingDialogTitle"),n.setDescribedByForDialog("ProtocolLaunchingDialogTitle"),4!==s.AFrameworkApplication.activeFrame.applicationInstance.editMode&&(document.getElementById("ProtocolLaunchingDialogTitle").innerText=CommonUIStrings.l_OICLaunchDialogTitleForView),n.setFocusOnElement(n._btnRichClient),p.ULS.sendTraceTag(22140865,211,50,"OIC launch dialog opened"),document.getElementById("WACDialogTitlePanel").className+=" OICDialog",n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ur(t,n);var a=i.prototype;return a.onInnerHtmlSet=function(){this._btnRichClient=Dr("BtnRichClient",this._operation.dlgImgClusterPath,this._operation.imgClusterName,this._operation.imgBtnGetRichClient,CommonUIStrings.l_OICLaunchRichClient,Object(r.a)(this,this.onRichClientButtonClick,"onRichClientButtonClick"),Mr),document.getElementById("OICLaunchRichClient").appendChild(this._btnRichClient),Rr(this._btnRichClient),this._btnReturn=Dr("BtnReturn",this._operation.dlgImgClusterPath,this._operation.imgClusterName,this._operation.imgBtnEdit,CommonUIStrings.l_OICReturnToOnlineClient,Object(r.a)(this,this.onReturnButtonClick,"onReturnButtonClick"),Mr),document.getElementById("OICReturnToApp").appendChild(this._btnReturn),Rr(this._btnReturn)},a.onReturnButtonClick=function(e){return this.hide(),this._operation.restartApplication(),!0},a.onRichClientButtonClick=function(e){return p.ULS.sendTraceTag(22140866,211,50,"OIC dialog: launch rich client"),this.hide(),s.AFrameworkApplication.theActionManager.processAction(h.a.retryOpenInClient,2),!0},a.oicLaunchDialogResultHandler=function(e,t){this._operation.restartApplication()},a.dispose=function(){this._disposed$4||(this._btnRichClient&&(Or.a.instance.unregisterHandler(f.a.click,this._btnRichClient,Object(r.a)(this,this.onRichClientButtonClick,"onRichClientButtonClick")),hr.KeyInputManager.instance.unregisterHandler(f.a.keyUp,this._btnRichClient,Mr)),this._btnReturn&&(Or.a.instance.unregisterHandler(f.a.click,this._btnReturn,Object(r.a)(this,this.onReturnButtonClick,"onReturnButtonClick")),hr.KeyInputManager.instance.unregisterHandler(f.a.keyUp,this._btnReturn,Mr)),e.prototype.dispose.call(this),this._disposed$4=!0)},i}(Ei.a);function Nr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Hr,"OICLaunchDialog",Ei.a,[]);var Wr=function(){function e(){}var t,n,i;return t=e,i=[{key:"dialogHtml",get:function(){return Ei.a.formatHtml(e.dialogHtmlFormat,CommonUIStrings.l_OICDialogTitle)}}],(n=null)&&Nr(t.prototype,n),i&&Nr(t,i),e}();Wr.dialogHtmlFormat="<div class='ProtocolLaunchingDialogBody' id='PLDDlgBody'> <div class='ProtocolLaunchingDialogTitle UIFontDialogTitle OICDialog' id='ProtocolLaunchingDialogTitle'> <div class='WACDialogSectionTitle'>{0}</div> </div> <div class='ProtocolLaunchingDialogIssues OICDialog' id='ProtocolhandlerGetHelp'> <div class='UIFontDialogText OICDialog' id='Issues'> </div> <div class='ProtocolLaunchingDialogHelpButtons' id='Buttons'> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonEdit'> <div id='ProtocolHandlerDialogEditInApp' class='UIFontDialogButton WACGlyph'></div> </div> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonGiveFeedback'> <div id='ProtocolHandlerDialogGiveFeedbackInApp' class='UIFontDialogButton WACGlyph'></div> </div> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonRetryOIC'> <div id='ProtocolHandlerDialogRetryOIC' class='UIFontDialogButton WACGlyph OICDialog'></div> </div> </div> </div> </div>",Object(i.a)(Wr,"ProtocolLaunchingDialogV2Html",null,[]);var jr=n(95);function Vr(e,t){return(Vr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qr=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this)._btnEdit=null,n._btnGiveFeedback=null,n._disposed$4=!1,n._btnRetryOIC=null,n._operation=t,n.dialogHtml=Wr.dialogHtml,n.autoSize=!0,n.buttonsOption=5,n.dialogId="ProtocolLaunchingDialog",n._customCssClass="OICRetryDialog",s.AFrameworkApplication.theTaskManager.hasStopped&&s.AFrameworkApplication.theTaskManager.restart(),s.AFrameworkApplication.theTaskManager.addTask(new u.a(2,1,5e3,(function(e){n.switchToBackupMode()}),101)),n.showDialog("",Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),n.protocolLaunchingDialogResultHandler,"protocolLaunchingDialogResultHandler")),n.setLabelledByForDialog("ProtocolLaunchingDialogTitle"),n.setDescribedByForDialog("Issues"),n.focusOnEditButton(),p.ULS.sendTraceTag(19239262,211,50,"OIC dialog launched"),document.getElementById("WACDialogTitlePanel").className+=" OICDialog",n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Vr(t,n);var a=i.prototype;return a.onInnerHtmlSet=function(){var e=document.getElementById("Issues");if(e){xr("",this._operation.dlgImgClusterPath,this._operation.imgClusterName,this._operation.imgBtnGetRichClient,e);var t=document.createElement("span");t.className="WACDialogSectionTitle",t.innerText=5===this._operation.openDocumentMode?CommonUIStrings.l_OICBrowserDialogTitle:CommonUIStrings.l_OICDialogSectionTitle,e.appendChild(t),Rr(e),e.style.display="none"}if(s.AFrameworkApplication.activeFrame.applicationInstance.giveFeedbackOnOpenClient){var n=CommonUIStrings.l_OICDialogSectionGiveFeedback;this._btnGiveFeedback=Dr("GiveFeedback",this._operation.dlgImgClusterPath,this._operation.imgClusterName,"",n,Object(r.a)(this,this.onGiveFeedbackClick,"onGiveFeedbackClick"),Object(r.a)(this,this.onGiveFeedbackKeyUp,"onGiveFeedbackKeyUp")),document.getElementById("ProtocolHandlerDialogGiveFeedbackInApp").appendChild(this._btnGiveFeedback),Rr(this._btnGiveFeedback)}else document.getElementById("ButtonGiveFeedback").style.display="none";if(s.AFrameworkApplication.activeFrame.applicationInstance.editMode&&!s.AFrameworkApplication.disableEditIfAndroid){var i=null;i=2===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType?4===s.AFrameworkApplication.activeFrame.applicationInstance.editMode?CommonUIStrings.l_OICResumeEditing:CommonUIStrings.l_OICReturnToOnlineClient:4===s.AFrameworkApplication.activeFrame.applicationInstance.editMode?CommonUIStrings.l_OICResumeEditing:CommonUIStrings.l_OICContinueInBrowser,this._btnEdit=Dr("Edit",this._operation.dlgImgClusterPath,this._operation.imgClusterName,"",i,Object(r.a)(this,this.onEditClick,"onEditClick"),Object(r.a)(this,this.onEditKeyUp,"onEditKeyUp")),document.getElementById("ProtocolHandlerDialogEditInApp").appendChild(this._btnEdit),Rr(this._btnEdit)}else document.getElementById("ButtonEdit").style.display="none";s.AFrameworkApplication.activeFrame.applicationInstance.editMode||s.AFrameworkApplication.isOfficeTrialOfferEnabled||e&&(e.style.display="none")},a.focusOnRetryButton=function(){return!!this._btnRetryOIC&&(this.setFocusOnElement(this._btnRetryOIC),!0)},a.focusOnEditButton=function(){return!!this._btnEdit&&(this.setFocusOnElement(this._btnEdit),!0)},a.onFinishedClick=function(e){return this._operation.closeApplication(),!0},a.onEditKeyUp=function(e){return this.onBtnKeyUp(e,0)},a.onGiveFeedbackKeyUp=function(e){return this.onBtnKeyUp(e,2)},a.onRetryOICKeyUp=function(e){return this.onBtnKeyUp(e,1)},a.onBtnKeyUp=function(e,t){var n=!1;if(e.innerEvent.keyCode===dr.a.vK_Enter||e.innerEvent.keyCode===dr.a.vK_Space)e.sourceElement.click(),n=!0;else if(e.innerEvent.keyCode===Sys.UI.Key.down||e.innerEvent.keyCode===Sys.UI.Key.up)switch(t){case 1:n=this.focusOnEditButton();break;case 0:n=this.focusOnRetryButton()}return n},a.onEditClick=function(e){return this.hide(),4===s.AFrameworkApplication.activeFrame.applicationInstance.editMode?(p.ULS.sendTraceTag(18715411,211,50,"Restart the App and continue editing"),this._operation.restartApplication()):(p.ULS.sendTraceTag(18715412,211,50,"Switch to edit doc in browser"),this._operation.handleEditInBrowser()),!0},a.onGiveFeedbackClick=function(e){return p.ULS.sendTraceTag(37339423,211,50,"Open give feedback dialog"),this._operation.handleGiveFeedback(),!0},a.onGetRichClientClick=function(e){var t=j.a.instance.resolve("Common.IOfficeTrialExperience");var n=j.a.instance.resolve("Common.IMacOfficeOffer");return H.a.isMac?n.launchMacOfficeTrialWindow(this._operation.application):t.launchOffer(this._operation.application),!0},a.onLearnMoreClick=function(e){return jr.Redirect.showHelp("OICFailure"),!0},a.onRetryOICClick=function(e){return p.ULS.sendTraceTag(19239263,211,50,"OIC dialog retry"),document.getElementById("WACDialogPanel").style.display="none",s.AFrameworkApplication.theActionManager.processAction(h.a.retryOpenInClient,2),!0},a.protocolLaunchingDialogResultHandler=function(e,t){this._operation.restartApplication()},a.switchToBackupMode=function(){var e=document.getElementById("ProtocolLaunchingDialogTitle");if(e){e.innerText=CommonUIStrings.l_OICDialog2ndTitle;var t=document.getElementById("Issues");t&&(t.style.display="block");var n=document.getElementById("ProtocolHandlerDialogRetryOIC");n&&!n.children.length&&(this._btnRetryOIC=Dr("RetryOIC","","","",CommonUIStrings.l_OICDialogRetry,Object(r.a)(this,this.onRetryOICClick,"onRetryOICClick"),Object(r.a)(this,this.onRetryOICKeyUp,"onRetryOICKeyUp")),n.appendChild(this._btnRetryOIC),Rr(this._btnRetryOIC),this._btnEdit||this.focusOnRetryButton())}},a.dispose=function(){this._disposed$4||(this._btnEdit&&(Or.a.instance.unregisterHandler(f.a.click,this._btnEdit,Object(r.a)(this,this.onEditClick,"onEditClick")),hr.KeyInputManager.instance.unregisterHandler(f.a.keyUp,this._btnEdit,Object(r.a)(this,this.onEditKeyUp,"onEditKeyUp"))),this._btnGiveFeedback&&(Or.a.instance.unregisterHandler(f.a.click,this._btnGiveFeedback,Object(r.a)(this,this.onGiveFeedbackClick,"onGiveFeedbackClick")),hr.KeyInputManager.instance.unregisterHandler(f.a.keyUp,this._btnGiveFeedback,Object(r.a)(this,this.onGiveFeedbackKeyUp,"onGiveFeedbackKeyUp"))),this._btnRetryOIC&&(Or.a.instance.unregisterHandler(f.a.click,this._btnRetryOIC,Object(r.a)(this,this.onRetryOICClick,"onRetryOICClick")),hr.KeyInputManager.instance.unregisterHandler(f.a.keyUp,this._btnRetryOIC,Object(r.a)(this,this.onRetryOICKeyUp,"onRetryOICKeyUp"))),e.prototype.dispose.call(this),this._disposed$4=!0)},i}(Ei.a);function Gr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Kr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zr(e,t){return(zr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(qr,"ProtocolLaunchingDialog",Ei.a,[]);var Xr=function(e){var t,n;function i(t){var n;(n=e.call(this)||this)._operation=t,n.dialogId="ProtocolLaunchingDialog",s.AFrameworkApplication.theTaskManager.hasStopped&&s.AFrameworkApplication.theTaskManager.restart(),s.AFrameworkApplication.activeFrame.applicationInstance.giveFeedbackOnOpenClient&&n.addFeedbackLink(CommonUIStrings.l_OICStandardDialogSectionGiveFeedback,Object(r.a)(Kr(n),n.onGiveFeedbackClick,"onGiveFeedbackClick")),i.hasCloseAction?(n.buttonsOption=12,n.setButtonText(1,CommonUIStrings.l_CloseFile),n.setButtonText(2,CommonUIStrings.l_OICDialogContinueHere),n.setButtonText(3,CommonUIStrings.l_OICDialogLaunchAgain)):(n.buttonsOption=4,n.setButtonText(1,CommonUIStrings.l_OICDialogContinueHere),n.setButtonText(2,CommonUIStrings.l_OICDialogLaunchAgain));var a=5===n._operation.openDocumentMode?CommonUIStrings.l_OICBrowserDialogTitle:CommonUIStrings.l_OICStandardDialogSectionTitle;return n.messageBoxImpl(CommonUIStrings.l_OICDialog2ndTitle,a,null,null,Object(r.a)(Kr(n),n.protocolLaunchingDialogResultHandler,"protocolLaunchingDialogResultHandler"),null),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,zr(t,n);var a,o,l,c=i.prototype;return c.onGiveFeedbackClick=function(e){p.ULS.sendTraceTag(595342858,211,50,"Open give feedback dialog"),this.onFeedbackClickHandler(e)},c.onRetryOICClick=function(){p.ULS.sendTraceTag(595342857,211,50,"OIC dialog retry"),s.AFrameworkApplication.theActionManager.processAction(h.a.retryOpenInClient,2)},c.protocolLaunchingDialogResultHandler=function(e,t){i.hasCloseAction?3===e?this.retryOICClick():2!==e&&e?1===e&&this.closeDocument():this.continueEditing():2===e?this.retryOICClick():1!==e&&e||this.continueEditing()},c.closeDocument=function(){p.ULS.sendTraceTag(577783557,211,50,"Closing the document"),s.AFrameworkApplication.theActionManager.processActionWithData(h.a.close,2,Pi.a)},c.retryOICClick=function(){p.ULS.sendTraceTag(593602691,211,50,"OIC dialog retry"),window.setTimeout(Object(r.a)(this,this.onRetryOICClick,"onRetryOICClick"),0)},c.continueEditing=function(){4===s.AFrameworkApplication.activeFrame.applicationInstance.editMode||s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordConsumptionViewToEditRedirectIsEnabled")&&1===s.AFrameworkApplication.activeFrame.mode?(p.ULS.sendTraceTag(593602690,211,50,"Restart the App and continue editing"),this._operation.restartApplication()):(p.ULS.sendTraceTag(593602689,211,50,"Switch to edit doc in browser"),this._operation.handleEditInBrowser())},a=i,l=[{key:"hasCloseAction",get:function(){return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICDialogThreeActions")&&32===s.AFrameworkApplication.theActionManager.processAction(h.a.close,1)}}],(o=null)&&Gr(a.prototype,o),l&&Gr(a,l),i}(Nn.StandardDialog);Object(i.a)(Xr,"StandardProtocolLaunchingDialog",Nn.StandardDialog,[]);var Jr=n(277),Qr=function(){};function Zr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Qr,"EditDocumentInClientParams",null,[]);var Yr=function(){function e(){}var t,n,i;return e.editDocumentInClient=function(e,t,n,i,r,a,o,s,l,c,u,d){void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===l&&(l=""),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===d&&(d=!1);var h=new Qr;h.DocumentUrl=e,h.Mode=t,h.Options=n,h.Application=i,h.SilentExternalHandler=o,h.EncodeUrl=s,h.CorrelationIdForWinClient=l,h.NavigateUsingWindowOpen=c,h.DescriptiveUnattemptedEnums=u,h.NoBrowserModalDialogs=d,MSOJS.ClientUtils.EditDocumentInClient(h,r,a)},t=e,i=[{key:"isWLSIAInstalled",get:function(){try{if(new ActiveXObject("IDBHO.IDBHOCtrl"))return!0}catch(e){}return!1}},{key:"officeVersionInstalledSupportsOIC",get:function(){return MSOJS.ClientUtils.OfficeVersionInstalled()>11}}],(n=null)&&Zr(t.prototype,n),i&&Zr(t,i),e}();Object(i.a)(Yr,"ClientUtils",null,[]);var $r=n(388);function ea(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ta=function(){function e(e){this._clientUrl=null,this._downloadUrl=null,this._postmessengerlazy=null,this._forceClose=!1,this._officeTrialExperience=null,this._macOfficeOffer=null,this._mode=0,this.application=0,this.suppressClose=!1,this.suppressRestart=!1,this.useLaunchDialog=e&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICLaunchDialogIsEnabled"),s.AFrameworkApplication.theActionManager.getActionMetadata(h.a.retryOpenInClient)||s.AFrameworkApplication.theActionManager.addAction(h.a.retryOpenInClient,ue.a.frame,Object(r.a)(this,this.retryOpenInClientAction,"retryOpenInClientAction")),this.silentExternalHandler=!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SilentExternalHandler")}var t,n,i,a=e.prototype;return a.retryOpenInClientAction=function(e,t,n,i,r){return t.contextId!==ue.a.frame?2:1===n?32:this.retryOpenInClient()},a.supportsTopTargetNavigation=function(){return!(2===this.application&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsEmbeddedScenario"))},a.closeApplication=function(){this.suppressClose||this.executeCloseApplication()},a.restartApplication=function(){this.suppressRestart||this.executeRestartApplication()},a.readyForClientLaunch=function(e){return this.useLaunchDialog&&H.a.isIPad?(new Hr(this),32):this.completeClientLaunch(e)},a.completeClientLaunch=function(e){var t,n,i=(t=this.launchClient(e,n),n=t.trackingLog,t).returnValue;return p.ULS.sendTraceTag(34198736,211,50,"OICLaunchClient,{0},{1}",32===i,n),i},a.begin=function(e,t,n,i,r,a){return this._clientUrl=e,this._downloadUrl=t,this._postmessengerlazy=a,this.application=n,this._mode=i,s.AFrameworkApplication.downloadCopyOnOpenInClient?(this.launchDownload(),32):s.AFrameworkApplication.limitedEdit&&!s.AFrameworkApplication.hostAuthenticatesUsersDuringOpenInClient?(s.AFrameworkApplication.showRequiresSignInDialog(),8):this.beforeClientLaunch(r)},a.retryOpenInClient=function(){return this.completeClientLaunch(this._forceClose)},a.sendOICPostMessage=function(){var e=new $r.a(d.a.openInClient);return e.Values["ui-language"]=s.AFrameworkApplication.lcid.toString(),e.Values[Jr.a.currentSessionParamName]=s.AFrameworkApplication.userSessionId,this._postmessengerlazy.value.send(e)?32:8},a.sendTelemetryPostMessage=function(e){var t=new $r.a(d.a.wacActionComplete);t.Values["ui-language"]=s.AFrameworkApplication.lcid.toString(),t.Values[Jr.a.currentSessionParamName]=s.AFrameworkApplication.userSessionId,t.Values[ln.a.wacAction]=e,this._postmessengerlazy.value.send(t)},a.launchClient=function(t,n){return this._forceClose=t,this.sendTelemetryPostMessage(5===this._mode?e.openInBrowserAction:e.openInDesktopAction),5===this._mode?this.launchBrowser(n):this.launchDesktop(n)},a.launchBrowser=function(e){return"",this.launchProtocolDialog(),"HostEditUrl,",{returnValue:32,trackingLog:"HostEditUrl,"}},a.launchDesktop=function(e){e="";var t="";s.AFrameworkApplication.addSessionIdToClientUrl&&(t="|f|"+s.AFrameworkApplication.userSessionId);var n,i=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsAssignmentMode")&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UseWindowOpenForOpenInClientInChromeAssignmentsIsEnabled")||s.AFrameworkApplication.isUnifiedHostMode||H.a.isTeamsElectron,a=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UnattemptedEnumIsEnabled"),o=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("NoBrowserModalDialogs");if(s.AFrameworkApplication.preferPostMessageOverCommandUrlForOpenInClient){e+="NewOrder,";var l=8;return this._postmessengerlazy&&this._postmessengerlazy.value&&this._postmessengerlazy.value.isEnabled()&&s.AFrameworkApplication.useOpenInClientPostMessage&&(e+="Post,",l=this.sendOICPostMessage()),32===l?{returnValue:l,trackingLog:e}:(p.ULS.sendTraceTag(4994821,211,50,"AOpenInclientOperation.LaunchClient: cannot send postmessage"),s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl?(p.ULS.shipAssertTag(5566816,211,!!s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl),e+="HostUrl,",{returnValue:s.AFrameworkApplication.activeFrame.navigateToHostUrl(!0,s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl),trackingLog:e}):this._clientUrl?(p.ULS.sendTraceTag(18715405,211,15,"Try to open doc in rich client, SessionId {0}",s.AFrameworkApplication.userSessionId),e+="DocUrl,",Yr.editDocumentInClient(this._clientUrl,this._mode,this.options,this.application,Object(r.a)(this,this.onEditInClientSuccess,"onEditInClientSuccess"),Object(r.a)(this,this.onEditInClientFailure,"onEditInClientFailure"),this.silentExternalHandler,s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICEncodeUrlIsEnabled"),t,i,a,o),{returnValue:32,trackingLog:e}):{returnValue:8,trackingLog:e})}return e+="OldOrder,",!this._clientUrl&&s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl?(this._postmessengerlazy&&this._postmessengerlazy.value&&this._postmessengerlazy.value.isEnabled()&&s.AFrameworkApplication.useOpenInClientPostMessage?(e+="Post,",n=this.sendOICPostMessage()):(p.ULS.sendTraceTag(22595483,211,50,"AOpenInclientOperation.LaunchClient: cannot send postmessage"),n=8),32!==n?(p.ULS.shipAssertTag(22595484,211,!!s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl),e+="HostUrl,",{returnValue:s.AFrameworkApplication.activeFrame.navigateToHostUrl(!0,s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl),trackingLog:e}):{returnValue:n,trackingLog:e}):(p.ULS.sendTraceTag(22595485,211,15,"Try to open doc in rich client, SessionId {0}",s.AFrameworkApplication.userSessionId),e+="DocUrl,",Yr.editDocumentInClient(this._clientUrl,this._mode,this.options,this.application,Object(r.a)(this,this.onEditInClientSuccess,"onEditInClientSuccess"),Object(r.a)(this,this.onEditInClientFailure,"onEditInClientFailure"),this.silentExternalHandler,s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICEncodeUrlIsEnabled"),t,i,a,o),{returnValue:32,trackingLog:e})},a.reportControlUsed=function(e){s.AFrameworkApplication.theWsaClient.setDw(8981,e)},a.onEditInClientSuccess=function(e){this.reportControlUsed(e),p.ULS.sendTraceTag(18715406,211,50,"Open in rich client succeed"),6===e&&MSOJS.ClientUtils.ShouldShowDialog()?this.suppressProtocolHandlerDialog||this.launchProtocolDialog():this.suppressClose||this.closeApplication()},a.onEditInClientFailure=function(e,t){if(void 0===t&&(t=0),p.ULS.sendTraceTag(18715407,211,10,"Fail to open doc in rich client. Failure Type: {0:D2}, Application: {1}",e,t),5===e)alert(CommonUIStrings.l_OICErrorPopupBlockerForSafari);else{var n=!!this._downloadUrl&&!this._forceClose,i=0;1===e&&(i=2),e>=6&&e<=13&&(i=1,1===t&&(this.suppressClose=!0)),this.theOfficeTrialExperience.offerOfficeTrialInDialog?(p.ULS.sendTraceTag(18715408,211,50,"Open OICErrorDialogWithTrial. Dialog cause: {0}",i),Er.a.instance.createOICErrorDialogWithTrial(this._forceClose?Object(r.a)(this,this.oicErrorDialogHandlerCloseForced,"oicErrorDialogHandlerCloseForced"):Object(r.a)(this,this.oicErrorDialogHandlerNoCloseForced,"oicErrorDialogHandlerNoCloseForced"),n?Object(r.a)(this,this.onLaunchDownload,"onLaunchDownload"):null,this.directInvokeHandler(!1)?Object(r.a)(this,this.iHaveOfficeButtonHandler,"iHaveOfficeButtonHandler"):null,null,i,t)):(p.ULS.sendTraceTag(18715409,211,50,"Open OICErrorDialog. Dialog cause: {0}",i),Er.a.instance.createOICErrorDialog(this._forceClose?Object(r.a)(this,this.oicErrorDialogHandlerCloseForced,"oicErrorDialogHandlerCloseForced"):Object(r.a)(this,this.oicErrorDialogHandlerNoCloseForced,"oicErrorDialogHandlerNoCloseForced"),n?Object(r.a)(this,this.onLaunchDownload,"onLaunchDownload"):null,null,i))}},a.launchProtocolDialog=function(){s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("StandardProtocolDialogIsEnabled")?new Xr(this):new qr(this)},a.oicErrorDialogHandlerCloseForced=function(e){this.closeApplication()},a.oicErrorDialogHandlerNoCloseForced=function(e){this.restartApplication()},a.onLaunchDownload=function(e){this.launchDownload()},a.iHaveOfficeButtonHandler=function(e){return this.directInvokeHandler(!0)},a.directInvokeHandler=function(e){var t=(H.a.isInternetExplorer10Up||H.a.isInternetExplorerEdge)&&!!s.AFrameworkApplication.directInvokeDAVUrl;return t&&e&&(nt.a.safelyOpenWindow(s.AFrameworkApplication.directInvokeDAVUrl,"_blank",void 0,"OpenInClient"),this.closeApplication()),t},t=e,(n=[{key:"openDocumentMode",get:function(){return this._mode}},{key:"options",get:function(){var e=0;return s.AFrameworkApplication.requiresCheckout&&(e|=1),s.AFrameworkApplication.openInClientEditOnly&&(e|=4),this.supportsTopTargetNavigation()&&(e|=64),e}},{key:"openInClientCommandString",get:function(){return null}},{key:"dlgImgClusterPath",get:function(){return s.AFrameworkApplication.imageClusterPath}},{key:"imgClusterName",get:function(){return s.AFrameworkApplication.imageClusterName}},{key:"imgBtnFinished",get:function(){return"ImFinished_32x32x32"}},{key:"imgBtnEdit",get:function(){return""}},{key:"imgBtnGetRichClient",get:function(){return""}},{key:"suppressProtocolHandlerDialog",get:function(){return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OneNoteMobileViewerIsEnabled")}},{key:"theOfficeTrialExperience",get:function(){return this._officeTrialExperience||(this._officeTrialExperience=j.a.instance.resolve("Common.IOfficeTrialExperience"))}},{key:"theMacOfficeOffer",get:function(){return this._macOfficeOffer||(this._macOfficeOffer=j.a.instance.resolve("Common.IMacOfficeOffer"))}}])&&ea(t.prototype,n),i&&ea(t,i),e}();function na(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ia(e,t){return(ia=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}ta.openInDesktopAction="OpenInDesktop",ta.openInBrowserAction="OpenInBrowser",Object(i.a)(ta,"AOpenInClientOperation",null,[]);var ra=function(e){var t,n;function i(t,n,i){var r;return void 0===i&&(i=!1),(r=e.call(this,i)||this)._imgBtnGetRichClient=t,r._imgBtnEdit=n,r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ia(t,n);var r,a,o,l=i.prototype;return l.executeCloseApplication=function(){s.AFrameworkApplication.theActionManager.processActionWithData(h.a.close,2,Pi.a)},l.executeRestartApplication=function(){},l.beforeClientLaunch=function(e){return this.readyForClientLaunch(e)},l.launchDownload=function(){p.ULS.shipAssertTag(5566817,211,!!this._downloadUrl),s.AFrameworkApplication.isCloseable?s.AFrameworkApplication.activeFrame.navigateToHostUrl(!0,this._downloadUrl):nt.a.safelyOpenWindow(this._downloadUrl,void 0,void 0,"LaunchDownload")},l.handleEditInBrowser=function(){s.AFrameworkApplication.activeFrame.applicationInstance.handleEditInBrowser()},l.handleGiveFeedback=function(){s.AFrameworkApplication.activeFrame.applicationInstance.handleGiveFeedback()},r=i,(a=[{key:"imgBtnEdit",get:function(){return this._imgBtnEdit}},{key:"imgBtnGetRichClient",get:function(){return this._imgBtnGetRichClient}}])&&na(r.prototype,a),o&&na(r,o),i}(ta);Object(i.a)(ra,"OpenInClientOperation",ta,[]);var aa=n(72),oa=n(103),sa=n(36);function la(e,t){return(la=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ca=function(e){var t,n;function i(t,n,i){var r;return(r=e.call(this,t,n)||this)._shouldNavigateOuterFrameFunc=i,r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,la(t,n);var a=i.prototype;return a.registerActions=function(){e.prototype.registerActions.call(this),this._actionManager.addAction(Cr.a.switchToEditMode,sa.a.application,Object(r.a)(this,this.onModeSwitch,"onModeSwitch")),this._actionManager.addAction(Cr.a.openInClient,sa.a.application,Object(r.a)(this,this.onEditInClient,"onEditInClient")),this._actionManager.addAction(Cr.a.showPdfCopyAndEditDialog,sa.a.application,Object(r.a)(this,this.onShowPdfCopyAndEditDialog,"onShowPdfCopyAndEditDialog")),this._actionManager.addAction(h.a.openInBrowser,ue.a.frame,Object(r.a)(this,this.openInBrowser,"openInBrowser")),this._actionManager.addAction(Cr.a.switchToUnifiedReadMode,sa.a.application,Object(r.a)(this,this.switchToUnifiedReadMode,"switchToUnifiedReadMode")),pr.App.instance.userMayEnterAccessiblePdfMode&&(this._actionManager.addAction(Cr.a.toggleViewMode,sa.a.application,Object(r.a)(this,this.onModeSwitch,"onModeSwitch")),this._actionManager.addActionWithFlags(Cr.a.queryAccessibleModeButtonToggledState,sa.a.application,Object(r.a)(this,this.queryAccessibleModeButtonToggledState,"queryAccessibleModeButtonToggledState"),96))},a.switchToUnifiedReadMode=function(e,t,n,r,a){if(1===n)return 32;l.Health.instance.recordKpiUsage("SwitchToUnifiedReadMode",0,i.featureCrewAlias,null);var o=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("ClassicViewModePreferenceCookieName"),c={};c[ln.a.hostKey]=o,c[ln.a.hostValue]="false",s.AFrameworkApplication.get_hostPostmessengerFuture().execute((function(e){e.sendMessage(d.a.storeHostKeyValue,c)}));var u={unifiedRead:!0};return s.AFrameworkApplication.theActionManager.processActionWithData(Cr.a.switchToEditMode,2,u)},a.onModeSwitch=function(e,t,n,i,r){if(t.contextId!==sa.a.application)return 2;var a=s.AFrameworkApplication.activeFrame;switch(p.ULS.shipAssertTag(4776161,201,!!a),e){case Cr.a.switchToEditMode:return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordConsumptionViewToEditRedirectIsEnabled")&&r&&Object===Object.getType(r)&&"unifiedRead"in r?a.switchIntoEditMode(n,this.hostPostmessenger,this._shouldNavigateOuterFrameFunc(),!0):a.switchIntoEditMode(n,this.hostPostmessenger,this._shouldNavigateOuterFrameFunc());case Cr.a.toggleViewMode:return this.toggleViewMode(n);default:return 2}},a.toggleViewMode=function(e){if(1===e)return pr.App.instance.userMayEnterAccessiblePdfMode?32:8;if(2!==e)return p.ULS.sendTraceTag(20235094,301,15,"Unexpected ActionBehavior {0} for switching view modes",e),2;var t=!pr.App.instance.isAccessiblePdfMode;pr.App.instance.setAccessiblePdfModeCookie(t),p.ULS.sendTraceTag(20451532,301,50,"User has toggled into {0} mode.",t?"accessible PDF":"PNG");var n=s.AFrameworkApplication.isEmbedded?s.AFrameworkApplication.hostEmbeddedViewUrl:window.self.location.href,i=pr.App.getUrlParametersForAccessiblePdfMode(t);return oa.b(s.AFrameworkApplication.appSettingsManager)?oa.f("view",i,oa.d):(n=Dt.a.addOrReplaceParametersValue(n,i),nt.a.openWindow(1,n,void 0,void 0,void 0,s.AFrameworkApplication.isEmbedded)),32},a.onEditInClient=function(e,t,n,i,r){var a=this;if(t.contextId!==sa.a.application)return 2;var o=s.AFrameworkApplication.activeFrame;if(p.ULS.shipAssertTag(4776192,201,!!o),!o.clientEditDocumentUrl&&!s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl&&!s.AFrameworkApplication.useOpenInClientPostMessage)return 8;if(1===n)return 32;var l=!1;if((null!=r&&(l=r),pr.App.instance.isBroadcastMode)&&this.hostPostmessenger.sendMessage(d.a.broadcastOpenInClient,null))return 32;return new ra("Word_32x32x32","EditInWordWebApp_32x32x32").begin(o.clientEditDocumentUrl,s.AFrameworkApplication.downloadACopyUrl,5,2,l,new en.a((function(){return a.hostPostmessenger})))},a.queryAccessibleModeButtonToggledState=function(e,t,n,i,r){return 1===n?pr.App.instance.userMayEnterAccessiblePdfMode?32:8:(p.ULS.shipAssertTag(20451533,301,!!r),r[aa.a.On]=pr.App.instance.isAccessiblePdfMode,32)},a.onShowPdfCopyAndEditDialog=function(e,t,n,r,a){if(1===n)return pr.App.instance.isProtectedPdf?8:32;var o=new Nn.StandardDialog;return o.buttonsOption=1,o.setDefaultButton(0),o.showInformation(CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_ConversionDialogPdf,i.pdfCopyAndEditDialogHandler),32},a.openInBrowser=function(e,t,n,i,r){return 2===n&&this.sendPostmessage(!0,d.a.openInBrowser,!0,{}),32},i.pdfCopyAndEditDialogHandler=function(e,t){1===e&&s.AFrameworkApplication.theActionManager.processAction(h.a.copyAndEdit,2)},i}(Fr);ca.featureCrewAlias="wwaengidc",Object(i.a)(ca,"AppFrameCommandUIActor",Fr,[]);var ua=n(136),da=n(94);function ha(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var pa=function(){function e(){}var t,n,i;return e.initialize=function(t,n,i){pr.App.instance.isBroadcastMode&&!e._initialized&&n&&(e._actionManager=t,e._messenger=n,e._theWsaClient=i,e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastInSync),e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastNavigateToPage),e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastOutOfSync),e._messenger.addAllowedFreeReceivingMessage(d.a.queryLoadingStatus),e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastLinkedNotesInfo),e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastGlobalId),e._messenger.registerCallback(d.a.broadcastNavigateToPage,e.navigateHandler),e._messenger.registerCallback(d.a.queryLoadingStatus,e.onQueryAppLoadingStatus),e._messenger.registerCallback(d.a.broadcastInSync,e.onBroadcastInSync),e._messenger.registerCallback(d.a.broadcastOutOfSync,e.onBroadcastOutOfSync),e._messenger.registerCallback(d.a.broadcastLinkedNotesInfo,e.linkedNotesInfoHandler),e._messenger.registerCallback(d.a.broadcastGlobalId,e.writeSqmBroadcastSessionID),e._actionManager.addActionWithFlags(Cr.a.queryPresenterPageLabel,sa.a.application,e.onQueryPresenterPageLabel,96),window.setTimeout((function(){e._presenterPageLabelPolled||(e._presenterPageLabelPolled=!0,e.refreshStatusBar())}),10),e._initialized=!0)},e.suppressNavigateMessagesForAnimationDuration=function(){e._animationBeginTime=new Date},e.navigateHandler=function(t){if(2===pr.App.instance.status&&!(nt.a.isFieldNullOrUndefined(t,"Values")||nt.a.isFieldNullOrUndefined(t.Values,e.broadcastNavigateSequence)||nt.a.isFieldNullOrUndefined(t.Values,e.broadcastNavigatePage)||nt.a.isFieldNullOrUndefined(t.Values,e.broadcastNavigateYOffset))){var n=-1,i=-1,r=-1;try{n=t.Values[e.broadcastNavigateSequence],i=t.Values[e.broadcastNavigatePage],r=t.Values[e.broadcastNavigateYOffset]}catch(e){return void 0}if(e._waitingSequence!==n){e._waitingSequence=n;e.scrollControl.scrollToPageOffset(i,r)}}},e.sendNavigationMessage=function(t,n,i){if(2===pr.App.instance.status){var r=e.zoomControl.currentZoom,a=n.scrollTop-da.a.instance.getPageTopAtZoom(t,r),o=Math.round(100*a/da.a.instance.getPageHeightAtZoom(t,r)),s=n.scrollTop+e.scrollControl.getClientHeight(),l=da.a.instance.getPageFromScrollTop(s,r),c=s-da.a.instance.getPageTopAtZoom(l,r),u=Math.round(100*c/da.a.instance.getPageHeightAtZoom(l,r)),h=(new Date).getTime()-e._animationBeginTime.getTime(),p={};if(2!==i&&h>=0&&h<=e.scrollAnimationRunTime){if(!i)return;if(-999===e._waitingSequence)return;p[e.appNavigatedSource]=e._waitingSequence,e._waitingSequence=-999}else e._animationBeginTime=new Date(0),p[e.appNavigatedSource]=e.appNavigatedSourceUser;p[e.broadcastNavigatePage]=t,p[e.broadcastNavigateYOffset]=o,p[e.broadcastNavigateBottomPage]=l,p[e.broadcastNavigateBottomOffset]=u,e._messenger.sendMessage(d.a.appNavigated,p)}},e.onQueryAppLoadingStatus=function(t){e.sendAppLoadingStatus()},e.sendAppLoadingStatus=function(){var t={};t[e.appLoaded]=!pr.App.instance.status||1===pr.App.instance.status||2===pr.App.instance.status,t[e.documentLoaded]=2===pr.App.instance.status,e._messenger.sendMessage(d.a.appLoadingStatus,t)},e.onBroadcastInSync=function(t){2===pr.App.instance.status&&(e._outOfSyncEntry&&(pr.App.get_activeAppFrame().notificationBar.removeEntry(e._outOfSyncEntry),e._outOfSyncEntry=null),e._isBroadcastSynced=!0,e.refreshStatusBar())},e.refreshStatusBar=function(){pr.App.get_activeAppFrame().statusBarUser&&pr.App.get_activeAppFrame().statusBarUser.pollControl(ua.a.presenterPageLabel),pr.App.get_activeAppFrame().ribbonUser&&pr.App.get_activeAppFrame().ribbonUser.poll()},e.onBroadcastOutOfSync=function(t){2===pr.App.instance.status&&(e._isBroadcastSynced&&(e._outOfSyncEntry=pr.App.get_activeAppFrame().notificationBar.createEntry(WordViewerIntl.WordViewerStrings.l_BroadcastOutOfSync,!1),pr.App.get_activeAppFrame().notificationBar.addEntry(e._outOfSyncEntry)),e._isBroadcastSynced=!1,e.refreshStatusBar())},e.linkedNotesInfoHandler=function(t){if(2===pr.App.instance.status&&!nt.a.isFieldNullOrUndefined(t,"Values")&&!nt.a.isFieldNullOrUndefined(t.Values,e.linkedNotesEnabled)){var n,i;try{n=t.Values[e.linkedNotesEnabled],i=t.Values[e.linkedNotesUrl]}catch(e){return void 0}0,e._isSharedNotesEnabled=n,e._sharedNotesUrl=i,pr.App.get_activeAppFrame().ribbonUser&&pr.App.get_activeAppFrame().ribbonUser.poll()}},e.writeSqmBroadcastSessionID=function(t){if(!nt.a.isFieldNullOrUndefined(t,"Values")&&!nt.a.isFieldNullOrUndefined(t.Values,e.id)){var n;try{n=t.Values[e.id]}catch(e){return void 0}e._theWsaClient.setDw(e.DATAID_GLOBALBROADCASTID,n)}},e.onQueryPresenterPageLabel=function(t,n,i,r,a){if(1===i)return 32;var o=a;return o[de.a.Value]=e._isBroadcastSynced?WordViewerIntl.WordViewerStrings.l_SyncedWithPresenter:WordViewerIntl.WordViewerStrings.l_BroadcastOutOfSync,o[he.a.labelText]=o[de.a.Value],e._presenterPageLabelPolled=!0,32},t=e,i=[{key:"zoomControl",get:function(){return e._zoomControl||(e._zoomControl=j.a.instance.resolve("WordViewer.Controls.IZoomControl"))}},{key:"scrollControl",get:function(){return e._scrollControl||(e._scrollControl=j.a.instance.resolve("WordViewer.Controls.IScrollControl"))}},{key:"scrollAnimationRunTime",get:function(){return e._scrollAnimationRunTime+500},set:function(t){e._scrollAnimationRunTime=t}},{key:"isBroadcastSynced",get:function(){return e._isBroadcastSynced},set:function(t){e._isBroadcastSynced=t}},{key:"isSharedNotesEnabled",get:function(){return e._isSharedNotesEnabled},set:function(t){e._isSharedNotesEnabled=t}},{key:"sharedNotesUrl",get:function(){return e._sharedNotesUrl},set:function(t){e._sharedNotesUrl=t}}],(n=null)&&ha(t.prototype,n),i&&ha(t,i),e}();function ga(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}pa.broadcastNavigateSequence="Sequence",pa.broadcastNavigatePage="Page",pa.broadcastNavigateYOffset="YOffset",pa.broadcastNavigateBottomPage="BottomPage",pa.broadcastNavigateBottomOffset="BottomOffset",pa.appNavigatedSource="Source",pa.appNavigatedSourceUser="User",pa.appLoaded="AppLoaded",pa.documentLoaded="DocumentLoaded",pa.linkedNotesEnabled="Enabled",pa.linkedNotesUrl="NotesUrl",pa.id="Id",pa.DATAID_GLOBALBROADCASTID=9975,pa._initialized=!1,pa._waitingSequence=-999,pa._animationBeginTime=new Date(0),pa._isBroadcastSynced=!0,pa._isSharedNotesEnabled=!1,pa._sharedNotesUrl=null,pa._outOfSyncEntry=null,pa._scrollAnimationRunTime=0,pa._presenterPageLabelPolled=!1,pa._theWsaClient=null,pa._actionManager=null,pa._messenger=null,pa._zoomControl=null,pa._scrollControl=null,Object(i.a)(pa,"BroadcastMessengerHelper",null,[]);var ma=function(){function e(e,t,n){this._actionManager=e,this._messenger=t,this._theWsaClient=n}var t,n,i,a=e.prototype;return a.registerActions=function(){pr.App.instance.isBroadcastMode&&(pa.initialize(this._actionManager,this._messenger,this._theWsaClient),this._actionManager.addActionWithFlags(Cr.a.onAppReady,sa.a.application,Object(r.a)(this,this.onAppReady,"onAppReady"),96),this._actionManager.addActionWithFlags(Cr.a.syncToPresenter,sa.a.application,Object(r.a)(this,this.onSyncToPresenter,"onSyncToPresenter"),96),this._actionManager.addActionWithFlags(Cr.a.openSharedNotes,sa.a.application,Object(r.a)(this,this.onOpenSharedNotes,"onOpenSharedNotes"),96),this._actionManager.addActionWithFlags(Cr.a.beforeAnimateScroll,sa.a.application,Object(r.a)(this,this.beforeAnimateScroll,"beforeAnimateScroll"),96),this._actionManager.addActionWithFlags(Cr.a.animateScrollStarted,sa.a.application,Object(r.a)(this,this.animateScrollStarted,"animateScrollStarted"),96),this._actionManager.addActionWithFlags(Cr.a.broadcastOnScroll,sa.a.application,Object(r.a)(this,this.broadcastOnScroll,"broadcastOnScroll"),96),pa.sendAppLoadingStatus())},a.onAppReady=function(e,t,n,i,r){return t.contextId!==sa.a.application?2:1===n?pr.App.instance.isBroadcastMode&&pa.isBroadcastSynced?8:32:(pa.sendAppLoadingStatus(),32)},a.onSyncToPresenter=function(e,t,n,i,r){if(t.contextId!==sa.a.application)return 2;if(1===n)return pr.App.instance.isBroadcastMode&&pa.isBroadcastSynced?8:32;if(pr.App.instance.isBroadcastMode&&this._messenger&&this._messenger.sendMessage(d.a.broadcastSyncToPresenter,null))return 32;return 8},a.onOpenSharedNotes=function(e,t,n,i,r){return t.contextId!==sa.a.application?2:1===n?pr.App.instance.isBroadcastMode&&!pa.isSharedNotesEnabled?8:32:(nt.a.safelyOpenWindow(pa.sharedNotesUrl,void 0,void 0,"OpenSharedNotes"),32)},a.beforeAnimateScroll=function(e,t,n,i,r){return t.contextId!==sa.a.application?2:1===n?pr.App.instance.isBroadcastMode&&pa.isBroadcastSynced?8:32:(pa.suppressNavigateMessagesForAnimationDuration(),32)},a.animateScrollStarted=function(e,t,n,i,r){return t.contextId!==sa.a.application?2:1===n?pr.App.instance.isBroadcastMode&&pa.isBroadcastSynced?8:32:(pa.scrollAnimationRunTime=r,32)},a.broadcastOnScroll=function(e,t,n,i,r){if(t.contextId!==sa.a.application)return 2;if(1===n)return pr.App.instance.isBroadcastMode&&pa.isBroadcastSynced?8:32;var a=r;return pa.sendNavigationMessage(a.page,a.data,a.source),32},e.getInstanceWithResolvedDependencies=function(){var t=j.a.instance.resolve("Common.App.Postmessengers.HostIntegrationMessenger");return new e(s.AFrameworkApplication.theActionManager,t,s.AFrameworkApplication.theWsaClient)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getInstanceWithResolvedDependencies())}}],(n=null)&&ga(t.prototype,n),i&&ga(t,i),e}();function fa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ma._instance=null,Object(i.a)(ma,"BroadcastActor",null,[]);var _a=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){e.initOnFullAppSettingsReady()}))},r.initOnFullAppSettingsReady=function(){this._container.resolve("WordViewer.Actors.AccessibilityHelpDialogActor").registerActions(),this._container.resolve("WordViewer.Actors.AppFrameCommandUIActor").registerActions(),ma.instance.registerActions(),j.a.instance.resolve("Common.IOfficeTrialExperience").registerActions(),j.a.instance.resolve("Common.IMacOfficeOffer").registerActions()},r.dispose=function(){},r.configure=function(e){this._container=e,e.register(ca,"WordViewer.Actors.AppFrameCommandUIActor").singleInstance().usingFactory((function(){return new ca(s.AFrameworkApplication.theActionManager,e.resolveFuture("Postmessage.IHostPostmessenger"),(function(){var e=ki.a.instance;return e.isSessionExpired(s.AFrameworkApplication.accessTokenTtl)||e.isSessionAboutToExpire(s.AFrameworkApplication.accessTokenTtl,s.AFrameworkApplication.accessTokenExpirationPromptSeconds)}))})),e.register(kr,"WordViewer.Actors.AccessibilityHelpDialogActor").singleInstance().usingFactory((function(){return new kr(s.AFrameworkApplication.theActionManager,Ft.FocusManager.instance())})),(new ur).configure(e)},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"WordViewer.Actors"}}])&&fa(t.prototype,n),i&&fa(t,i),e}();function va(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(_a,"WordViewerActorsPackage",null,[16,17]);var ya=function(){function e(){}var t,n,i;return t=e,i=[{key:"dialogHtml",get:function(){return Ei.a.formatHtml(e.dialogHtmlFormat,CommonUIStrings.l_EmbedCodeText)}}],(n=null)&&va(t.prototype,n),i&&va(t,i),e}();ya.dialogHtmlFormat="<div class='WACDialogRow' id='EmbedLabelBlock'> <label id='embedCode' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRow' id='EmbedTextAreaBlock'> <textarea id='txtEmbedCode' class='EmbedCodeTextArea' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>",Object(i.a)(ya,"ReembedDialogHtml",null,[]);var Sa=function(){};Sa.dialogHtml="<div class='EmbedDialog' id='embeddialog'> <div class='EmbedPreviewPane' id='embedpreviewpane'> </div> <div class='EmbedOptionPane' id='embedoptionpane'> </div> </div>",Object(i.a)(Sa,"EmbedDialogHtml",null,[]);var ba=function(e,t,n,i){this.optionElement=e,this.imageElement=t,this.optionHolderElement=n,this.value=i};Object(i.a)(ba,"OptionInfo",null,[]);var Ca=function(e,t,n){this.sectionElement=e,this.imageHolder=t,this.imageElement=n};Object(i.a)(Ca,"SectionInfo",null,[]);var Aa=n(140);function Ta(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function wa(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ka(e,t){return(ka=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ia='<a target="_blank" href="{0}">{1}</a>',Fa=function(e){var t,n;function i(t,n){var i;return void 0===n&&(n=!1),(i=e.call(this,!1,!1,n)||this)._embedWidth=476,i._embedHeight=288,i._dialogWidth=798,i._previewPanelWidth=476,i._previewFrameHeight=288,i.paramToOptionInfo={},i.sectionInfoList=[],i._previewPane=null,i._optionPane=null,i._dimensionSection=null,i._optionSection=null,i._previewFrame=null,i._embedCodeTextArea=null,i._embedUrl=s.AFrameworkApplication.hostEmbeddedViewUrl,i._previewUrl=t,i._optionClickHandler=Object(r.a)(wa(i),i.optionClickHandler,"optionClickHandler"),i._optionKeyHandler=Object(r.a)(wa(i),i.optionKeyHandler,"optionKeyHandler"),i._arrowClickHandler=Object(r.a)(wa(i),i.arrowClickHandler,"arrowClickHandler"),i._arrowKeyHandler=Object(r.a)(wa(i),i.arrowKeyHandler,"arrowKeyHandler"),i._textAreafocusHandler=Object(r.a)(wa(i),i.textAreaOnFocusHandler,"textAreaOnFocusHandler"),i._isReactDialog=n,i.dialogHtml=Sa.dialogHtml,i.buttonsOption=0,i.dialogId="EmbedDialog",i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ka(t,n);var a,o,l,c=i.prototype;return c.showReactEmbedDialog=function(e){for(var t,n=((t={}).id=this.dialogId,t.bodyControls={},t.embedPreviewSectionTitle=CommonUIStrings.l_Preview,t.embedCodeSectionTitle=CommonUIStrings.l_EmbedCode,t.dimensionsSectionTitle=CommonUIStrings.l_Dimensions,t.interactionSectionTitle=CommonUIStrings.l_Interaction,t.initialPreviewUrl=Dt.a.addOrReplaceParameterValue(this._previewUrl,"wdPreview","1"),t.initialEmbedUrl=this._embedUrl,t.getEmbedCode=i.getEmbedCode,t.codeCopiedText=CommonUIStrings.l_EmbedCodeCopied,t),r=0,a=Object.keys(e);r<a.length;r++){var o=a[r];n[o]=e[o]}this.buttonsOption=1,this.setButtonText(1,CommonUIStrings.l_CopyAction),this.setButtonText(0,CommonUIStrings.l_Close),this.initializeAndShow(CommonUIStrings.l_Embed,null,n)},c.showEmbedDialog=function(){if(this._isReactDialog)this.showReactEmbedDialog({});else{this.showDialog(CommonUIStrings.l_Embed,null),this._previewPane=document.getElementById("embedpreviewpane"),this._optionPane=document.getElementById("embedoptionpane"),this._previewPane.style.width=String.format("{0}px",this._previewPanelWidth),this._previewFrame=document.createElement("iframe"),this._previewFrame.className=i._previewFrameCssClass,this._previewFrame.frameBorder="0",this._previewFrame.style.height=String.format("{0}px",this._previewFrameHeight),this._previewFrame.tabIndex=-1,this._previewPane.appendChild(this.createSectionHeader(CommonUIStrings.l_Preview,this._previewFrame,i._previewId,i._previewHeaderId,i._previewId,!0)),this._embedCodeTextArea=document.createElement("textarea"),this._embedCodeTextArea.className=i._embedCodeCssClass,Sys.UI.DomElement.addCssClass(this._embedCodeTextArea,Aa.a.allowBrowserContextMenu),this._embedCodeTextArea.id=i._embedcodeTextAreaId,H.a.isIPad||(this._embedCodeTextArea.readOnly=!0),this._embedCodeTextArea.rows=4,this._embedCodeTextArea.style.fontFamily=CommonUIStrings.l_UserInterfaceFontName,this._embedCodeTextArea.style.fontSize=CommonUIStrings.l_UserInterfaceFontSize,this._embedCodeTextArea.setAttribute(gr.a.ariaLabelledByAttribute,String.format("{0} {1}",i._embedCodeHeaderId,i._embedCodeFooterId)),this._previewPane.appendChild(this.createSectionHeader(CommonUIStrings.l_EmbedCode,this._embedCodeTextArea,i._embedCodeHeaderId)),Fe.a.addHandler(this._embedCodeTextArea,"focus",this._textAreafocusHandler);var e=document.createElement("span");e.className=i._footerCssClass,e.innerText=CommonUIStrings.l_CopyText,e.id=i._embedCodeFooterId,this._previewPane.appendChild(e),this._dimensionSection=document.createElement("div"),this._dimensionSection.className=i._dimensionSectionCssClass,this._optionPane.appendChild(this.createSectionHeader(CommonUIStrings.l_Dimensions,this._dimensionSection)),this._optionSection=document.createElement("div"),this._optionPane.appendChild(this.createCollapsibleSectionHeader(i._optionsId,CommonUIStrings.l_Interaction,this._optionSection)),this.buttonsOption=0,this.setButtonText(1,CommonUIStrings.l_Close),this.updateEmbedCode(),this.updatePreview(),H.a.isIPad||this._embedCodeTextArea.focus()}},c.dispose=function(){if(this.paramToOptionInfo){var t=this.paramToOptionInfo;for(var n in t){var i={key:n,value:t[n]}.value;this._clickManager.unregisterHandler(f.a.click,i.optionElement,this._optionClickHandler),this._keyInputManager.unregisterHandler(f.a.keyDown,i.optionElement,this._optionKeyHandler),this._keyInputManager.unregisterHandler(f.a.keyUp,i.optionElement,this._optionKeyHandler)}this.paramToOptionInfo=null,this._optionClickHandler=null,this._optionKeyHandler=null}if(this.sectionInfoList){for(var r=0;r<this.sectionInfoList.length;++r)this._clickManager.unregisterHandler(f.a.click,this.sectionInfoList[r].imageHolder,this._arrowClickHandler),this._keyInputManager.unregisterHandler(f.a.keyDown,this.sectionInfoList[r].imageHolder,this._arrowKeyHandler),this._keyInputManager.unregisterHandler(f.a.keyPress,this.sectionInfoList[r].imageHolder,this._arrowKeyHandler),this._keyInputManager.unregisterHandler(f.a.keyUp,this.sectionInfoList[r].imageHolder,this._arrowKeyHandler);this.sectionInfoList=null,this._arrowClickHandler=null,this._keyInputManager=null}this._textAreafocusHandler&&this._embedCodeTextArea&&(Fe.a.removeHandler(this._embedCodeTextArea,"focus",this._textAreafocusHandler),this._textAreafocusHandler=null),this._previewPane=null,this._optionPane=null,this._dimensionSection=null,this._optionSection=null,this._previewFrame=null,this._embedCodeTextArea=null,e.prototype.dispose.call(this)},c.reSizeDialog=function(){e.prototype.reSizeDialog.call(this),this._divMessageBox.style.width=String.format("{0}px",this._dialogWidth),this.centerDialog()},c.updateEmbedUrl=function(e,t){var n=Dt.a.addOrReplaceParameterValue(this._embedUrl,e,t);return this._embedUrl!==n&&(this._embedUrl=n,this._previewUrl=Dt.a.addOrReplaceParameterValue(this._previewUrl,e,t),!0)},c.updateEmbedCode=function(){this._embedCodeTextArea&&(this._embedCodeTextArea.innerText=i.getEmbedCode(this._embedUrl,this._embedWidth,this._embedHeight))},c.updatePreview=function(){this._previewFrame&&this._previewFrame.contentWindow.location.replace(Dt.a.addOrReplaceParameterValue(this._previewUrl,"wdPreview","1"))},c.updateEmbedUrlAndRefresh=function(e,t){this.updateEmbedUrl(e,t)&&(this.updateEmbedCode(),this.updatePreview())},c.createSectionHeader=function(e,t,n,r,a,o){void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=!1);var s=document.createElement("div");s.className=i._sectionHeaderCssClass,r&&(s.id=r),a&&s.setAttribute(gr.a.ariaLabelledByAttribute,a),o&&(s.tabIndex=0);var l=document.createElement("span");return l.className=i._sectionNameCssClass,l.innerText=e,n&&(l.id=n),s.appendChild(l),s.appendChild(t),s},c.createCollapsibleSectionHeader=function(e,t,n){var r=this.createSectionHeader(t,n),a=this._document.createElement("div");a.className=i._arrowHolderCssClass,a.id=i._arrowId+e,a.setAttribute(gr.a.ariaRoleAttribute,gr.a.ariaButtonRole),a.tabIndex=0,r.insertBefore(a,n);var o=Pr.createClusteredImage(16,16,i._arrowIconName,i._arrowImageCssClass,!0,"");a.appendChild(o);var s=o.childNodes[0];s.className=Pr.getImageClass(i._downArrowIconCssClass),s.title=CommonUIStrings.l_Expand,a.title=CommonUIStrings.l_Expand,n.style.visibility="hidden";var l=new Ca(n,a,s);return Array.add(this.sectionInfoList,l),this._clickManager.registerHandlerWithData(f.a.click,a,this._arrowClickHandler,l),this._keyInputManager.registerHandlerWithData(f.a.keyDown,a,this._arrowKeyHandler,l),this._keyInputManager.registerHandlerWithData(f.a.keyPress,a,this._arrowKeyHandler,l),this._keyInputManager.registerHandlerWithData(f.a.keyUp,a,this._arrowKeyHandler,l),r},c.arrowClickHandler=function(e){return this.changeArrowState(e),!0},c.arrowKeyHandler=function(e){return this.keyHandlerWithAction(e,Object(r.a)(this,this.changeArrowState,"changeArrowState"))},c.changeArrowState=function(e){var t=e.userData;"visible"===t.sectionElement.style.visibility?(t.sectionElement.style.visibility="hidden",t.imageElement.className=Pr.getImageClass(i._downArrowIconCssClass),t.imageElement.title=CommonUIStrings.l_Expand,t.imageHolder.title=CommonUIStrings.l_Expand):(t.sectionElement.style.visibility="visible",t.imageElement.className=Pr.getImageClass(i._upArrowIconCssClass),t.imageElement.title=CommonUIStrings.l_Collapse,t.imageHolder.title=CommonUIStrings.l_Collapse)},c.createCheckBox=function(e,t,n){var r=document.createElement("div");r.className=i._optionCssClass,r.id=e+i._optionId;var a=this._document.createElement("div");a.tabIndex=0,a.className=i._checkBoxHolderCssClass,a.id=e+i._checkId,a.setAttribute(gr.a.ariaRoleAttribute,gr.a.ariaCheckBoxRole),a.setAttribute(gr.a.ariaCheckedAttribute,n?gr.a.ariaTrueValue:gr.a.ariaFalseValue),a.setAttribute(gr.a.ariaLabelledByAttribute,e+i._descriptionCssClass),r.appendChild(a),r.setAttribute(gr.a.ariaRoleAttribute,gr.a.ariaPresentationRole);var o=Pr.createClusteredImage(16,16,i._checkboxIconName,i._checkboxCssClass,!0,"");a.appendChild(o);var s=o.childNodes[0];s.id=e+i._optionImageId,s.className=Pr.getImageClass(n?i._checkedIconCssClass:i._uncheckedIconCssClass);var l=new ba(r,s,a,n?1:0);this.paramToOptionInfo[e]=l,this._clickManager.registerHandlerWithData(f.a.click,r,this._optionClickHandler,e);var c=document.createElement("span");return c.className=i._descriptionCssClass,c.innerText=t,c.id=e+i._descriptionCssClass,r.appendChild(c),this._keyInputManager.registerHandlerWithData(f.a.keyDown,r,this._optionKeyHandler,e),this._keyInputManager.registerHandlerWithData(f.a.keyUp,r,this._optionKeyHandler,e),r},c.optionClickHandler=function(e){return this.optionHandler(e),!0},c.optionKeyHandler=function(e){return this.keyHandlerWithAction(e,Object(r.a)(this,this.optionHandler,"optionHandler"))},c.optionHandler=function(e){var t=this.paramToOptionInfo[e.userData.toString()];t.value?(t.value=0,t.imageElement.className=Pr.getImageClass(i._uncheckedIconCssClass),t.optionHolderElement.setAttribute(gr.a.ariaCheckedAttribute,gr.a.ariaFalseValue)):(t.value=1,t.imageElement.className=Pr.getImageClass(i._checkedIconCssClass),t.optionHolderElement.setAttribute(gr.a.ariaCheckedAttribute,gr.a.ariaTrueValue)),this.updateEmbedUrlAndRefresh(e.userData.toString(),t.value.toString())},c.textAreaOnFocusHandler=function(e){this._embedCodeTextArea.select()},i.getEmbedCode=function(e,t,n){if(!i._noFramesText){var r=String.format(Ia,je.a.htmlAttributeEncode("https://office.com"),CommonUIStrings.l_Office),a=String.format(Ia,je.a.htmlAttributeEncode("https://office.com/webapps"),CommonUIStrings.l_WebAppName);i._noFramesText=String.format(CommonUIStrings.l_NoFrames,r,a)}return String.format('<iframe src="{0}" width="{1}px" height="{2}px" frameborder="0">{3}</iframe>',je.a.htmlAttributeEncode(e),t,n,i._noFramesText)},a=i,(o=[{key:"_width$4",get:function(){return this._embedWidth},set:function(e){this._embedWidth=e}},{key:"_height",get:function(){return this._embedHeight},set:function(e){this._embedHeight=e}}])&&Ta(a.prototype,o),l&&Ta(a,l),i}(Ei.a);function Ea(e,t){return(Ea=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Fa._noFramesText=null,Fa._checkedIconCssClass="CheckboxChecked_16x16x32",Fa._uncheckedIconCssClass="CheckboxUnchecked_16x16x32",Fa._upArrowIconCssClass="OutlookSearchChevronUp_16x16x32",Fa._downArrowIconCssClass="OutlookSearchChevronDown_16x16x32",Fa._checkboxIconName="CommentChecked",Fa._arrowIconName="UpArrowServer",Fa._descriptionCssClass="EmbedDescription",Fa._sectionHeaderCssClass="EmbedSectionHeader",Fa._sectionNameCssClass="EmbedSectionName UIFontBold",Fa._footerCssClass="EmbedCodeFooter",Fa._checkboxCssClass="EmbedOptionImage",Fa._previewFrameCssClass="EmbedPreviewFrame",Fa._embedCodeCssClass="EmbedCodeTextArea",Fa._optionCssClass="EmbedOption",Fa._dimensionSectionCssClass="EmbedDimensionSection",Fa._arrowImageCssClass="EmbedArrowIcon",Fa._arrowHolderCssClass="WACGlyph EmbedArrowHolder",Fa._checkBoxHolderCssClass="EmbedCheckBoxHolder",Fa._optionId="Option",Fa._optionImageId="OptionImage",Fa._embedcodeTextAreaId="EmbedCode",Fa._embedCodeHeaderId="EmbedCodeHeader",Fa._previewId="Preview",Fa._previewHeaderId="PreviewHeader",Fa._codeId="Code",Fa._dimensionId="Dim",Fa._optionsId="Options",Fa._arrowId="Arrow",Fa._checkId="Check",Fa._embedCodeFooterId="EmbedCodeFooter",Object(i.a)(Fa,"EmbedDialog",Ei.a,[]);var Pa=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).dialogHtml=ya.dialogHtml,n.buttonsOption=0,n.dialogId="ReembedDialog",n.showDialog(CommonUIStrings.l_EmbedDialogTitle,null),n._embedCodeTextArea=document.getElementById("txtEmbedCode"),Sys.UI.DomElement.addCssClass(n._embedCodeTextArea,Aa.a.allowBrowserContextMenu),H.a.isIPad||(n._embedCodeTextArea.readOnly=!0),n._embedCodeTextArea.rows=4,n._embedCodeTextArea.style.fontFamily=CommonUIStrings.l_UserInterfaceFontName,n._embedCodeTextArea.style.fontSize=CommonUIStrings.l_UserInterfaceFontSize,n._embedCodeTextArea.innerText=Fa.getEmbedCode(t,Ui.a.pageWidth,Ui.a.pageHeight),n._textAreafocusHandler=Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),n.textAreaOnFocusHandler,"textAreaOnFocusHandler"),Fe.a.addHandler(n._embedCodeTextArea,"focus",n._textAreafocusHandler),n.centerDialog(),H.a.isIPad||n._embedCodeTextArea.focus(),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ea(t,n);var a=i.prototype;return a.dispose=function(){this._textAreafocusHandler&&(Fe.a.removeHandler(this._embedCodeTextArea,"focus",this._textAreafocusHandler),this._textAreafocusHandler=null),this._embedCodeTextArea=null,e.prototype.dispose.call(this)},a.textAreaOnFocusHandler=function(e){this._embedCodeTextArea.select()},i}(Ei.a);Object(i.a)(Pa,"ReembedDialog",Ei.a,[]);var Oa=function(){this.widthText=null,this.heightText=null,this.printOptionText=null,this.reembedOptionText=null,this.startOptionText=null,this.startPageText=null};Object(i.a)(Oa,"WordEmbedDialogStrings",null,[]);var Ra=n(557),Ma=n(556),Da=n(435);function xa(e,t){return(xa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var La=function(e){var t,n;function i(t,n,i,r,a){var o;return(o=e.call(this,t,n,i,r)||this).inputElement=a,o}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,xa(t,n),i}(ba);function Ba(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ua(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ha(e,t){return(Ha=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(La,"OptionInputInfo",ba,[]);var Na=function(e){var t,n;function i(t,n){var a;return(a=e.call(this,t,i.useReactDialog)||this)._startOnOptionInfo=null,a._dimensionElements=[],a._startOnOptionClickHandler=Object(r.a)(Ua(a),a.startOnOptionClickHandler,"startOnOptionClickHandler"),a._startOnOptionKeyHandler=Object(r.a)(Ua(a),a.startOnOptionKeyHandler,"startOnOptionKeyHandler"),a._pageNumberChangedHandler=Object(r.a)(Ua(a),a.onPageNumberChanged,"onPageNumberChanged"),a._dimensionChangedHandler=Object(r.a)(Ua(a),a.onDimensionChanged,"onDimensionChanged"),a._dialogStrings=n,a}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ha(t,n);var a,o,l,c=i.prototype;return c.showEmbedDialog=function(){if(i.useReactDialog){var t,n,r,a,o,s,l=i.reactUrlTransformFunctionOnChange,c=[];c.push(((t={}).id="wdPrint",t.checkboxInitialValue=!0,t.checkboxLabel=this._dialogStrings.printOptionText,t.urlTransformFunctionOnChange=l,t),((n={}).id="wdEmbedCode",n.checkboxInitialValue=!0,n.checkboxLabel=this._dialogStrings.reembedOptionText,n.urlTransformFunctionOnChange=l,n),((a={}).id="wdStartOn",a.checkboxInitialValue=!1,a.checkboxLabel=this._dialogStrings.startOptionText,a.urlTransformFunctionOnChange=l,a.textInputProps=((r={}).title=this._dialogStrings.startPageText,r),a));var u=((s={}).dimensionsOptions=((o={}).isMultipleChoice=!1,o.defaultWidth=this._embedWidth,o.defaultHeight=this._embedHeight,o.minWidth=375,o.minHeight=250,o.widthLabel=this._dialogStrings.widthText,o.heightLabel=this._dialogStrings.heightText,o),s.interactionOptions=c,s);this.showReactEmbedDialog(u)}else if(e.prototype.showEmbedDialog.call(this),this.addDimensionControl(this._dialogStrings.widthText,"EmbedWidthInput",this._embedWidth),this.addDimensionControl(this._dialogStrings.heightText,"EmbedHeightInput",this._embedHeight),this._optionSection.appendChild(this.createCheckBox("wdPrint",this._dialogStrings.printOptionText,!0)),this._optionSection.appendChild(this.createCheckBox("wdEmbedCode",this._dialogStrings.reembedOptionText,!0)),this.addCheckBoxWithInput(this._dialogStrings.startOptionText,!1),this.centerDialog(),Ft.FocusManager.usable()){var d=Ft.FocusManager.instance(),h=[document.getElementById(Fa._embedcodeTextAreaId),document.getElementById("EmbedWidthInput"),document.getElementById("EmbedHeightInput"),document.getElementById(Fa._arrowId+Fa._optionsId),document.getElementById("wdPrint"+Fa._checkId),document.getElementById("wdEmbedCode"+Fa._checkId),document.getElementById("wdStartOn"+Fa._checkId),document.getElementById("wdStartOnText"),document.getElementById(Ui.a._actionButtonId),document.getElementById(Fa._previewHeaderId)],p=new Da.a(h);d.getCurrentRegion().listing=p,H.a.isIPad?this.setFocusOnElement(document.getElementById(Ui.a._actionButtonId)):this._embedCodeTextArea.select()}},c.dispose=function(){if(i.useReactDialog)e.prototype.dispose.call(this);else{if(this._dimensionElements){for(var t=0;t<this._dimensionElements.length;++t)Fe.a.removeHandler(this._dimensionElements[t],"change",this._dimensionChangedHandler);this._dimensionChangedHandler=null,this._dimensionElements=null}this._pageNumberChangedHandler&&(Fe.a.removeHandler(this._startOnOptionInfo.inputElement,"change",this._pageNumberChangedHandler),this._pageNumberChangedHandler=null),this._startOnOptionClickHandler&&(this._clickManager.unregisterHandler(f.a.click,this._startOnOptionInfo.optionElement,this._startOnOptionClickHandler),this._startOnOptionClickHandler=null),this._startOnOptionKeyHandler&&(this._keyInputManager.unregisterHandler(f.a.keyDown,this._startOnOptionInfo.optionElement,this._startOnOptionKeyHandler),this._keyInputManager.unregisterHandler(f.a.keyUp,this._startOnOptionInfo.optionElement,this._startOnOptionKeyHandler),this._startOnOptionKeyHandler=null),this._startOnOptionInfo=null,e.prototype.dispose.call(this)}},c.addDimensionControl=function(e,t,n){var i=document.createElement("label");i.className="EmbedInputPrefix",i.innerText=e,this._dimensionSection.appendChild(i);var r=document.createElement("input");r.className=t,r.id=t,r.value=n.toString(),r.type="text",r.setAttribute("data-lpignore","true"),i.setAttribute("for",t),this._dimensionSection.appendChild(r),Array.add(this._dimensionElements,r),Fe.a.addHandler(r,"change",this._dimensionChangedHandler),this._dimensionSection.appendChild(document.createElement("br"))},c.onDimensionChanged=function(e){"EmbedWidthInput"===e.target.id?this._embedWidth=this.ensureMinValue(e.target,375):this._embedHeight=this.ensureMinValue(e.target,250),this.updateEmbedCode()},c.ensureMinValue=function(e,t){var n=parseInt(e.value);return(isNaN(n)||n<t)&&(n=t),e.value=n.toString(),n},c.onPageNumberChanged=function(e){var t=this.ensureMinValue(e.target,1);1===this._startOnOptionInfo.value&&this.updateEmbedUrlAndRefresh("wdStartOn",t.toString())},c.addCheckBoxWithInput=function(e,t){var n=document.createElement("div");n.className=Fa._optionCssClass+" EmbedInlineOption",n.id="wdStartOn"+Fa._optionId;var i=this._document.createElement("div");i.tabIndex=0,i.className=Fa._checkBoxHolderCssClass,i.id="wdStartOn"+Fa._checkId,i.setAttribute(gr.a.ariaRoleAttribute,gr.a.ariaCheckBoxRole),i.setAttribute(gr.a.ariaCheckedAttribute,t?gr.a.ariaTrueValue:gr.a.ariaFalseValue),i.setAttribute(gr.a.ariaLabelledByAttribute,"wdStartOn"+Fa._descriptionCssClass),n.appendChild(i),n.setAttribute(gr.a.ariaRoleAttribute,gr.a.ariaPresentationRole);var r=Pr.createClusteredImage(16,16,Fa._checkboxIconName,Fa._checkboxCssClass,!0,"");i.appendChild(r);var a=r.childNodes[0];a.id="wdStartOn"+Fa._optionImageId,a.className=Pr.getImageClass(t?Fa._checkedIconCssClass:Fa._uncheckedIconCssClass);var o=document.createElement("span");o.className=Fa._descriptionCssClass,o.innerText=e,o.id="wdStartOn"+Fa._descriptionCssClass,n.appendChild(o),this._optionSection.appendChild(n);var s=document.createElement("input");s.className="EmbedPageNumberInput",s.id="wdStartOnText",s.type="text",s.title=this._dialogStrings.startPageText,s.setAttribute("data-lpignore","true"),this._optionSection.appendChild(s),Fe.a.addHandler(s,"change",this._pageNumberChangedHandler),this._startOnOptionInfo=new La(n,a,i,t?1:0,s),this.updateEmbedUrlAndRefresh("wdStartOn","1"),this._clickManager.registerHandler(f.a.click,n,this._startOnOptionClickHandler),this._keyInputManager.registerHandler(f.a.keyDown,n,this._startOnOptionKeyHandler),this._keyInputManager.registerHandler(f.a.keyUp,n,this._startOnOptionKeyHandler)},c.startOnOptionClickHandler=function(e){return this.startOnOptionHandler(e),!0},c.startOnOptionKeyHandler=function(e){return this.keyHandlerWithAction(e,Object(r.a)(this,this.startOnOptionHandler,"startOnOptionHandler"))},c.startOnOptionHandler=function(e){var t=1;this._startOnOptionInfo.value?(this._startOnOptionInfo.value=0,this._startOnOptionInfo.imageElement.className=Pr.getImageClass(Fa._uncheckedIconCssClass),this._startOnOptionInfo.optionHolderElement.setAttribute(gr.a.ariaCheckedAttribute,gr.a.ariaFalseValue)):(this._startOnOptionInfo.value=1,this._startOnOptionInfo.imageElement.className=Pr.getImageClass(Fa._checkedIconCssClass),t=this.ensureMinValue(this._startOnOptionInfo.inputElement,1),this._startOnOptionInfo.optionHolderElement.setAttribute(gr.a.ariaCheckedAttribute,gr.a.ariaTrueValue)),this.updateEmbedUrlAndRefresh("wdStartOn",t.toString())},i.reactUrlTransformFunctionOnChange=function(e,t,n,i){if(void 0===i&&(i=null),"wdPrint"===t||"wdEmbedCode"===t)return Dt.a.addOrReplaceParameterValue(e,t,n?"1":"0");if("wdStartOn"===t){var r="1";if(n&&i){var a=parseInt(i);!isNaN(a)&&a>=1&&(r=a.toString())}return Dt.a.addOrReplaceParameterValue(e,t,n?r:"1")}return e},a=i,l=[{key:"useReactDialog",get:function(){return s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled}}],(o=null)&&Ba(a.prototype,o),l&&Ba(a,l),i}(Fa);Object(i.a)(Na,"WordEmbedDialog",Fa,[]);var Wa=function(){function e(e,t,n,i,r){this._hostPostmessenger=null,this._actionManager=e,this._hostPostmessengerFuture=t,this._actionId=n,this._dialogStrings=i,this._app=r}var t=e.prototype;return t.registerActions=function(){this._actionManager.addAction(this._actionId,ue.a.frame,Object(r.a)(this,this.showEmbedCode,"showEmbedCode")),this._hostPostmessengerFuture.execute(Object(r.a)(this,this.onHostPostmessengerCreated,"onHostPostmessengerCreated"))},t.onHostPostmessengerCreated=function(e){p.ULS.shipAssertTag(4994850,332,!!e),this._hostPostmessenger=e,s.AFrameworkApplication.isEmbedded||(this._hostPostmessenger.addAllowedReceivingMessage(d.a.canEmbed),this._hostPostmessenger.registerCallback(d.a.canEmbed,Object(r.a)(this,this.showEmbedDialog,"showEmbedDialog")))},t.showEmbedDialog=function(e){var t=e.Values.HostEmbeddedViewUrl.toString();s.AFrameworkApplication.hostEmbeddedViewUrl=t,this._app.embedPreviewUrl=t,new Na(t,this._dialogStrings).showEmbedDialog()},t.showEmbedCode=function(t,n,i,r,a){if(Ra.a.execute===i){if(!s.AFrameworkApplication.hostEmbeddedViewUrl)return s.AFrameworkApplication.theWsaClient.incrementDw(e.DATAID_WORDWAC_EMBEDWITHOUTURL,1),s.AFrameworkApplication.useFileEmbedCommandPostMessage&&this._hostPostmessenger.sendMessage(d.a.fileEmbed,null)?Ma.a.succeeded:s.AFrameworkApplication.activeFrame.navigateToHostUrl(!0,s.AFrameworkApplication.fileEmbedCommandUrl);new Na(this._app.embedPreviewUrl,this._dialogStrings).showEmbedDialog()}return Ma.a.succeeded},e}();Wa.DATAID_WORDWAC_EMBEDWITHOUTURL=10381,Object(i.a)(Wa,"EmbedActor",null,[]);var ja=n(131);function Va(e,t){return(Va=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qa=function(e){var t,n;function i(t,n){return e.call(this,t,n,Cr.a.showFileEmbedInfo,Object.assign(new Oa,{widthText:WordViewerIntl.WordViewerStrings.l_Width,heightText:WordViewerIntl.WordViewerStrings.l_Height,printOptionText:WordViewerIntl.WordViewerStrings.l_PrintOption,reembedOptionText:WordViewerIntl.WordViewerStrings.l_ReembedOption,startOptionText:WordViewerIntl.WordViewerStrings.l_StartOnOption,startPageText:WordViewerIntl.WordViewerStrings.l_StartPage}),pr.App.instance)||this}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Va(t,n);var a=i.prototype;return a.registerActions=function(){e.prototype.registerActions.call(this),this._actionManager.addAction(Cr.a.showReembedCode,ue.a.frame,Object(r.a)(this,this.showReembedCode,"showReembedCode")),window.setTimeout((function(){i._statusBarPolled||(i._statusBarPolled=!0,pr.App.get_activeAppFrame().statusBarUser&&pr.App.get_activeAppFrame().statusBarUser.pollControl(ja.a.documentInformationButton),pr.App.get_activeAppFrame().ribbonUser&&pr.App.get_activeAppFrame().ribbonUser.poll())}),10)},a.showReembedCode=function(e,t,n,r,a){var o=s.AFrameworkApplication.hostEmbeddedViewUrl,l=!s.AFrameworkApplication.hostEmbeddedViewUrl;return 1===n?l?8:32:(2===n&&(pr.App.instance.showPrint||(o=Dt.a.addOrReplaceParameterValue(o,"wdPrint","0")),1!==pr.App.initialPageNumber&&(o=Dt.a.addOrReplaceParameterValue(o,"wdStartOn",pr.App.initialPageNumber.toString())),new Pa(o)),i._statusBarPolled=!0,32)},i}(Wa);function Ga(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}qa._statusBarPolled=!1,Object(i.a)(qa,"EmbedActor",Wa,[]);var Ka=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.configure=function(e){this._container=e,e.register(qa,"WordViewer.Embed.EmbedActor").singleInstance().usingFactory((function(){return new qa(s.AFrameworkApplication.theActionManager,e.resolveFuture("Postmessage.IHostPostmessenger"))}))},r.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){e._container.resolve("WordViewer.Embed.EmbedActor").registerActions()}))},r.dispose=function(){},t=e,(n=[{key:"name",get:function(){return"WordViewer.Embed"}}])&&Ga(t.prototype,n),i&&Ga(t,i),e}();Object(i.a)(Ka,"EmbedPackage",null,[16,17]);var za=function(){this.LanguageRunsList=null,this.SelectionChunkIndex=0,this.SelectionCharIndex=0,this.LanguageRunsList=new z.a,this.SelectionChunkIndex=0,this.SelectionCharIndex=0};function Xa(e,t){return(Xa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(za,"LearningToolsDocumentData",null,[]);var Ja=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this)._errorDialogMessage=t,n.buttonsOption=0,n.setButtonText(1,CommonUIStrings.l_DialogClose),n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Xa(t,n),i.prototype.displayError=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,this._errorDialogMessage,null,!1,!0)},i}(Nn.StandardDialog);Object(i.a)(Ja,"ErrorDialog",Nn.StandardDialog,[237]);var Qa=function(){};function Za(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Qa,"LearningToolsExtraInfoContext",null,[235]);var Ya=function(){function e(){}var t,n,i;return e.requestFullscreen=function(e){e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.requestFullscreen?e.requestFullscreen():p.ULS.sendTraceTag(7145619,210,50,"RequestFullscreen got invoked in unknown browser")},e.exitFullscreen=function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.exitFullscreen?document.exitFullscreen():p.ULS.sendTraceTag(7145620,210,50,"ExitFullscreen got invoked in unknown browser")},t=e,i=[{key:"fullscreenChangeEventName",get:function(){return document.webkitFullscreenEnabled?"webkitfullscreenchange":document.msFullscreenEnabled?"MSFullscreenChange":document.mozFullScreenEnabled?"mozfullscreenchange":document.fullscreenEnabled?"fullscreenchange":null}},{key:"fullscreenErrorEventName",get:function(){return"undefined"!=typeof document.webkitFullscreenEnabled?"webkitfullscreenerror":"undefined"!=typeof document.msFullscreenEnabled?"MSFullscreenError":"undefined"!=typeof document.mozFullScreenEnabled?"mozfullscreenerror":"undefined"!=typeof document.fullscreenEnabled?"fullscreenerror":null}},{key:"isFullScreenAvailable",get:function(){return document.webkitFullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled||document.fullscreenEnabled}},{key:"isFullScreen",get:function(){return!!(document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.fullscreenElement)}},{key:"fullScreenElement",get:function(){var e=null;return(e=document.webkitFullscreenElement)||(e=document.msFullscreenElement)||(e=document.mozFullScreenElement)||(e=document.fullscreenElement)?e:null}}],(n=null)&&Za(t.prototype,n),i&&Za(t,i),e}();Object(i.a)(Ya,"FullscreenUtils",null,[]);var $a=n(429),eo=function(){function e(e,t,n,i,r,a,o,s,l,c,u,d,h,p,g,m,f,_,v){this._displayIframeStartTime=0,this._startToDisplayIFrameDuration=0,this._messageValueDictionary=null,this._container=null,this._iframe=null,this._progressDialog=null,this._errorDialog=null,this._title=e,this._msgEventHandler=t,this._clientRequestManager=n,this._webServiceBase=i,this._stopwatch=r,this._charCount=a,this._timeoutMs=o,this._textData=s,this._browserLcid=l,this._iFrameTitle=c,this._errorDialogMessage=u,this._isContentLoaded=!1,this._contentLoadedDuration=0,this._focusManager=h,this._learningToolsSessionId=W.a.create().toString(),this._learningToolsDocData=p,this._appId=f,this._staticReaderUrl=d+"?appId="+f,this._versionQueryParamEnabled=g,this._newDataFlowEnabled=m,this._useV2Api=_,this._sendDocxFile=v,this._isStorageIdReady=!1,this._browserLang=Fn.a.getCultureInfo(this._browserLcid).name,this._failedCanary=!1}var t=e.prototype;return t.showLoadingDialog=function(){var e=new Ai.a;this._progressDialog=e.create(),this._progressDialog.buttonsOption=5,this._progressDialog.hasCloseGlyph=!1,this._progressDialog.showProgressDialog(null,null,null)},t.closeLoadingDialog=function(){this._progressDialog&&(this._progressDialog.close(),this._progressDialog=null)},t.launchErrorDialog=function(){this._errorDialog=new Ja(this._errorDialogMessage),this._errorDialog.displayError(qn.a.learningToolsLaunchFailed)},t.launch=function(e){var t=this;p.ULS.sendTraceTag(2049e4,306,50,"Learning Tools service launched"),this._stopwatch.start(),this._displayIframeStartTime=(new Date).getTime(),this.showLoadingDialog();var n,i={};i.title=this._title,i.chunks=this._textData,i.StartingChunkIndex=this._learningToolsDocData.SelectionChunkIndex,i.StartingCharIndex=this._learningToolsDocData.SelectionCharIndex;var r="",a="",o="";if(this._useV2Api){var l={};l.data=i,n=B.c(l),r="&useV2Endpoint=1",this._sendDocxFile&&(a="&sendDocxFile=1",o="&startIndex="+this._learningToolsDocData.SelectionCharIndex)}else n=B.c(i);var c=this._webServiceBase+"OneNoteS2SHandler.ashx?action="+e+"&appId="+this._appId+"&enabledConfig=WordEditorLearningToolsIsEnabled&"+s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion+r+a+o,u={"Content-Type":"application/json; charset=utf-8"};u.LearningToolsSessionId=this._learningToolsSessionId,this._clientRequestManager.addRequest(c,2,n,u,!1,2,(function(e){t.onRequestSucceeded(e)}),(function(e){t.onRequestFailed(e)}),e,void 0,void 0,void 0,this._timeoutMs);var h=this._staticReaderUrl+"&exitCallback="+d.a.exitLT+"&omkt="+this._browserLang+"&sessionId="+this._learningToolsSessionId;this._versionQueryParamEnabled&&(h+="&v=2"),this.launchIFrame(h)},t.onRequestSucceeded=function(t){var n=e.getJsonFromResponse(t.data.responseData);if(this._messageValueDictionary={},this._failedCanary=!1,this._newDataFlowEnabled)this._messageValueDictionary.readerModel=n;else{var i,r=Object(P.a)(String,n.url),a=Object(P.a)(String,n.storageId),o=Object(P.a)(String,n.version),s=Object(P.a)(String,n.processingHost);if(!r)return void $i.b(20259850,200,10,"{0}",(i={},i.Desc="NoUrl",i));this._messageValueDictionary.storageId=a,this._messageValueDictionary.apiVersion=o,this._messageValueDictionary.processingHost=s}this.triggerPostMessageIfReady()},t.launchIFrame=function(t){s.AFrameworkApplication.isInImmersiveReaderMode=!0,this._container=document.createElement("div"),this._iframe=document.createElement("iframe"),this._container.appendChild(this._iframe),document.body.appendChild(this._container),e.setInitialElementStyle(this._container),e.setInitialElementStyle(this._iframe),this._iframe.id="ImmersiveReader-iframe",this._iframe.title=this._iFrameTitle,this._iframe.tabIndex=0,this._iframe.src=t,this._iframe.setAttribute("allowfullscreen","true"),this._iframe.setAttribute("aria-modal","true"),this.listenForPostMessage()},t.onRequestFailed=function(e){this.stopLearningToolsStopwatch(!1),p.ULS.sendTraceTag(20259852,201,10,"{0}",this.getFailureLogInfo(e)),this.closeLoadingDialog(),5!==e.data.status||this._failedCanary?this.launchErrorDialog():(this._failedCanary=!0,this.closeLearningTools(),this.launch(Object(P.a)(String,e.data.state)))},t.getFailureLogInfo=function(e){var t,n=-1;return e&&e.data&&(n=e.data.httpStatus),500===n?p.ULS.sendTraceTag(37065042,201,10,"Failed to load the immersive reader for app {0} due to a 500 internal server error response from the LT service with LearningToolsSessionId {1}",this._appId,this._learningToolsSessionId):408===n&&p.ULS.sendTraceTag(37065043,201,10,"Failed to load the immersive reader for app {0} due to a 408 request timeout from the LT service with LearningToolsSessionId {1}",this._appId,this._learningToolsSessionId),(t={}).desc="LT failure",t.status=n,t.LearningToolsSessionId=this._learningToolsSessionId,t},t.listenForPostMessage=function(){this._msgEventHandler.attachHandler(Object(r.a)(this,this.messageHandler,"messageHandler"),null)},t.triggerPostMessageIfReady=function(){var e=this;if(this._messageValueDictionary&&this._isStorageIdReady){this._focusManager.popScope("LearningToolsStaticReader"),this.stopLearningToolsStopwatch(!0),this._messageValueDictionary.launchToPostMessageSentDurationInMs=this._stopwatch.ageInMilliseconds;var t={},n="";if(this._newDataFlowEnabled)if(this._useV2Api){var i=this._messageValueDictionary.readerModel;i.launchToPostMessageSentDurationInMs=this._stopwatch.ageInMilliseconds,n="LinguisticModel",t.messageValue=i}else n="ReaderModel2",t.messageValue=this._messageValueDictionary;else n="Data",t.messageValue=this._messageValueDictionary;if(t.messageType=n,this.sendPostMessageDictionary(t),this._iframe){var r=this._focusManager.getScope("LearningTools");r.parent=kt.AFrame.appFocusId,r.addOnFocus((function(t,n){e._iframe.focus()})),this._focusManager.pushScope("LearningTools",!1)}var a={messageType:"SetFocus"};this.sendPostMessageDictionary(a)}},t.sendPostMessageDictionary=function(e){this._iframe&&this._iframe.contentWindow&&this._iframe.contentWindow.postMessage(JSON.stringify(e),"*")},t.displayIframe=function(){var e=this;this.closeLoadingDialog();var t=this._focusManager.getScope("LearningToolsStaticReader");t.parent=kt.AFrame.appFocusId,t.addOnFocus((function(t,n){e._iframe.focus()})),this._container.style.visibility="visible",this._iframe.style.visibility="visible",this._focusManager.pushScope("LearningToolsStaticReader",!1),p.ULS.sendTraceTag(20490001,306,50,"Learning Tools iFrame loaded"),this._startToDisplayIFrameDuration=(new Date).getTime()-this._displayIframeStartTime},t.stopLearningToolsStopwatch=function(e){var t=new $a.a,n=new Qa;e?(n.RequestSucceeded=!0,n.DocumentCharCount=this._charCount,n.StartToDisplayIFrameDuration=this._startToDisplayIFrameDuration):n.RequestSucceeded=!1,t.ExtraInfoContext=n,this._stopwatch.stopEx(t)},t.messageHandler=function(e){if(e.data===d.a.exitLT)return p.ULS.sendTraceTag(20490002,306,50,"Postmessage sent with param: {0}",e.data),this.closeLearningTools(),!0;if(e.data===d.a.readyForStorageLT)return this._isStorageIdReady=!0,this.displayIframe(),this.triggerPostMessageIfReady(),!0;if(e.data===d.a.requestLTFullScreen)Ya.requestFullscreen(this._container);else if(e.data===d.a.exitLTFullScreen)Ya.exitFullscreen();else{var t=null;try{t=JSON.parse(e.data)}catch(e){return p.ULS.sendTraceTag(21320706,306,100,"Postmessage generated exception: "+e),!1}if(t){var n=t.storageIdReceivedToContentLoadedDurationInMs;if(n)return this._isContentLoaded=!0,this._contentLoadedDuration=n,p.ULS.sendTraceTag(22905240,306,50,"contentLoadedDuration:{0}",this._contentLoadedDuration),!0}}return p.ULS.sendTraceTag(20490003,306,100,"Postmessage fired with irrelevant param"),!1},t.closeLearningTools=function(){mr.a.removeElement(this._iframe),mr.a.removeElement(this._container),this._msgEventHandler.detachHandler(Object(r.a)(this,this.messageHandler,"messageHandler"));var e={};e.learningToolsSessionDurationInMs=(new Date).getTime()-this._displayIframeStartTime,e.isContentLoaded=this._isContentLoaded,e.contentLoadedDuration=this._contentLoadedDuration,this._focusManager.popScope("LearningTools"),s.AFrameworkApplication.isInImmersiveReaderMode=!1,p.ULS.sendTraceTag(21320707,306,50,JSON.stringify(e))},e.setInitialElementStyle=function(e){e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.left="0",e.style.top="0",e.style.borderWidth="0",e.style.visibility="hidden",e.style.zIndex="1000",e.style.background="white"},e.getJsonFromResponse=function(e){var t,n,i=null,r=(t=B.d(e,i),i=t.deserialized,t).returnValue,a=Object(P.a)(Object,i);return a||($i.b(20259851,200,10,"{0}",((n={}).desc="CouldntParse",n.serialized=r,n)),null)},e}();Object(i.a)(eo,"LearningToolsLauncher",null,[]);var to=n(319),no=n(27);function io(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ro=function(){function e(){this._msgEventHandler=null,this._clientRequestManager=null,this._webServiceBase=null,this._stopwatch=null,this._charCount=0,this._timeoutMs=0,this._browserLcid=0,this._iFrameTitle=null,this._staticUrl=null,this._focusManager=null,this._versionQueryParamIsEnabled=!1,this._newDataFlowIsEnabled=!1,this._useV2Api=!1}var t,n,i,a=e.prototype;return a.configure=function(e){},a.init=function(){s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordViewerLearningToolsIsEnabled")&&(this.registerActions(),this._msgEventHandler=to.a.instance,this._clientRequestManager=s.AFrameworkApplication.theClientRequestManager,this._webServiceBase=s.AFrameworkApplication.appSettingsManager.appSettings.WebServiceBase,this._stopwatch=s.AFrameworkApplication.activeFrame.theStopwatchBuilder.makeStopwatch("LoadResource","ImmersiveReader"),this._timeoutMs=s.AFrameworkApplication.appSettingsManager.getIntAppSetting("LearningToolsViewerTimeoutMs",47e3),this._browserLcid=s.AFrameworkApplication.lcid,this._staticUrl=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("LearningToolsStaticUrl"),this._focusManager=Ft.FocusManager.instance(),this._newDataFlowIsEnabled=!0,this._iFrameTitle=WordViewerIntl.WordViewerStrings.L_ImmersiveView,this._versionQueryParamIsEnabled=!1,this._useV2Api=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("LearningToolsV2EndpointIsEnabled"))},a.dispose=function(){},a.registerActions=function(){s.AFrameworkApplication.theActionManager.addAction(Cr.a.launchImmersiveReader,sa.a.application,Object(r.a)(this,this.launchImmersiveReader,"launchImmersiveReader"))},a.launchImmersiveReader=function(e,t,n,i,r){if(1===n)return no.a.isDocumentEncrypted()?8:32;var a=new za;return new eo("",this._msgEventHandler,this._clientRequestManager,this._webServiceBase,this._stopwatch,this._charCount,this._timeoutMs,[],this._browserLcid,this._iFrameTitle,WordViewerIntl.WordViewerStrings.l_LearningToolsErrorMessage,this._staticUrl,this._focusManager,a,this._versionQueryParamIsEnabled,this._newDataFlowIsEnabled,"Word Viewer",this._useV2Api,!1).launch("learningtoolsviewer"),32},e.main=function(){s.AFrameworkApplication.disableWholeAppsForOfficeFeature||S.a.instance.registerPackage(new e,void 0)},t=e,(n=[{key:"name",get:function(){return"WordViewer.LearningToolsViewerLauncher"}}])&&io(t.prototype,n),i&&io(t,i),e}();Object(i.a)(ro,"LearningToolsViewerLauncherPackage",null,[16,17]);var ao=n(566);function oo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var so=function(){function e(){}var t,n,i,a=e.prototype;return a.configure=function(e){},a.init=function(){if(pr.App.get_activeAppFrame()){var e=ao.a.instance;pr.App.get_activeAppFrame().workspace.setSelectionManagerDisposable(e,Object(r.a)(e,e.firstPage,"firstPage"),Object(r.a)(e,e.lastPage,"lastPage"))}},a.dispose=function(){},t=e,(n=[{key:"name",get:function(){return"WordViewer.Selection"}}])&&oo(t.prototype,n),i&&oo(t,i),e}();Object(i.a)(so,"SelectionPackage",null,[16,17]);var lo=n(560);function co(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var uo=function(){function e(){}var t,n,i,a=e.prototype;return a.configure=function(e){},a.init=function(){s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(Object(r.a)(this,this.onFullAppSettingsReady,"onFullAppSettingsReady"))},a.onFullAppSettingsReady=function(){if(pr.App.get_activeAppFrame()&&lo.SearchManager.instance){if(Z.a.registerDispatchHandler(e.dispatcher),!pr.App.instance.isSmallView&&!s.AFrameworkApplication.isNoChrome){var t=lo.SearchManager.instance;pr.App.get_activeAppFrame().workspace.setSearchManagerDisposable(t,Object(r.a)(t,t.isSearchActive,"isSearchActive"))}pr.App.get_activeAppFrame().ribbonUser&&pr.App.get_activeAppFrame().ribbonUser.poll()}},a.dispose=function(){},e.dispatcher=function(e,t,n,i,r){return e===Cr.a.showSearchPane?lo.SearchManager.instance.showSearchPane(e,t,n,i,r):e===Cr.a.toggleSearchPane?lo.SearchManager.instance.toggleSearchPane(e,t,n,i,r):2},t=e,(n=[{key:"name",get:function(){return"WordViewer.Search"}}])&&co(t.prototype,n),i&&co(t,i),e}();Object(i.a)(uo,"SearchPackage",null,[16,17]);var ho=n(565),po=n(98);function go(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var mo,fo,_o=function(){function e(){this._id=0,this._request=null,this._dependency=null,this.batchedOperation=null,this.isPersistedSave=!1,this.hasClientAcceptedServerUpdate=!1,this.status=0,this.statusCode=tt.executing,this.corrrelation=null,this.httpStatusCode=0,this.requestEnqueueTime=null,this.invokedTime=null,this.invokedTimeTicks=0,this.completedTime=null,this.completedTimeTicks=0,this._responseObjects=null,this._httpHeaders=null,this.roundtripId=-1,this._createdTime=new Date,this.perfTag="Unknown",this._queryParameters=new Ie.a}var t,n,i,r=e.prototype;return r.addResponse=function(e){this.responseObjects||(this._responseObjects=[]),Array.add(this.responseObjects,e)},r.addHttpHeader=function(e,t){this.httpHeaders||(this._httpHeaders=new Ie.a),this.httpHeaders.add(e,t)},r.getDiagnosticStateForLogging=function(){var e={};this.hasClientAcceptedServerUpdate&&(e.CASU=1),e.ID=this.id,e.RID=this.roundtripId,e.S=this.status,this.corrrelation&&(e.C=this.corrrelation),e.CRT=this.createdTime.toISOString();var t=null;return s.AFrameworkApplication.theClientRequestManager&&(t=s.AFrameworkApplication.theClientRequestManager.peekAtRequestQueue(this.roundtripId)),t?(e.HSC=t.httpStatus,e.RI=1,e.ST=t.status,t.enqueueTime&&(e.ET=t.enqueueTime.toISOString()),t.invokedTime&&(e.IT=t.invokedTime.toISOString()),t.completedTime&&(e.CT=t.completedTime.toISOString())):(e.HSC=this.httpStatusCode,e.RI=0,e.ST=this.statusCode,this.requestEnqueueTime&&(e.ET=this.requestEnqueueTime.toISOString()),this.invokedTime&&(e.IT=this.invokedTime.toISOString()),this.completedTime&&(e.CT=this.completedTime.toISOString())),e},t=e,(n=[{key:"id",get:function(){return this._id},set:function(e){this._request&&(this._request.OperationId=e),this._id=e}},{key:"createdTime",get:function(){return this._createdTime}},{key:"queryParameters",get:function(){return this._queryParameters}},{key:"requestObject",get:function(){return this._request},set:function(e){e&&(e.OperationId=this.id),this._request=e}},{key:"responseObjects",get:function(){return this._responseObjects}},{key:"httpHeaders",get:function(){return this._httpHeaders}},{key:"dependency",get:function(){return this._dependency},set:function(e){this._dependency=e,e&&(this.requestObject.DependentOn=e.id)}}])&&go(t.prototype,n),i&&go(t,i),e}();Object(i.a)(_o,"ServerOperation",null,[]),function(e){e[e.nil=0]="nil",e[e.requestReady=1]="requestReady",e[e.responseReady=2]="responseReady"}(mo||(mo={})),Object(i.b)("ServerOperationStatus",mo),function(e){e[e.get=1]="get",e[e.post=2]="post"}(fo||(fo={})),Object(i.b)("RequestVerb",fo);var vo=function(){};vo.batchedOperation="BatchedOperation",vo.replication="Replication",vo.typingProcessEvent="25",vo.replicationEvent="9_"+vo.batchedOperation+"_"+vo.replication,Object(i.a)(vo,"CpuMeterConstants",null,[]);var yo=n(434),So=n(558),bo=n(115),Co=n(163);function Ao(e,t){return(Ao=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var To=function(e){var t,n;function i(){return e.call(this)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ao(t,n),i}(Co.ScriptSharpLegacyMap);function wo(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ko(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ko(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function ko(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}Object(i.a)(To,"UIntDictionary",Co.ScriptSharpLegacyMap,[]);var Io=function(){function e(){this.Mode=0,this.srs=null}return e.addRequestToGroup=function(e,t){var n=[];n[0]=t.getClassId(),n[1]=t,Array.add(e,n)},e.serialization=function(t,n){var i=new e;return i.Mode=n,i.srs=t,B.c(i)},e.construct=function(t,n){for(var i,r=[],a=wo(t);!(i=a()).done;){var o=i.value.value;o&&e.addRequestToGroup(r,o.requestObject)}return e.serialization(r,n)},e.constructFromSingleRequest=function(t,n){var i=[];return e.addRequestToGroup(i,t),e.serialization(i,n)},e.constructFromArrayList=function(t,n){for(var i=[],r=0;r<t.length;++r)t[r]&&e.addRequestToGroup(i,t[r]);return e.serialization(i,n)},e}();Object(i.a)(Io,"CommonServerRequestGroup",null,[]);var Fo=function(){function e(){this.Responses=null}return e.fixupArrayResponses=function(e){if(e)for(var t=e.length,n=0;n<t;n++){var i=e[n];e[n]=i[1],e[n].classId=i[0]}},e.fromServerResponseObject=function(t){try{var n=t;if(e.fixupArrayResponses(n.Responses),n.Responses&&n.Responses.length>0)return n}catch(e){}return null},e.tryDeserializeServerResponse=function(t,n){try{var i=B.a(t);n=e.fromServerResponseObject(i)}catch(e){n=null}return{returnValue:!!n,group:n}},e}();function Eo(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Po(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Po(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Po(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Oo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Fo,"ServerResponseGroup",null,[]);var Ro=function(){function e(e,t){this._operations=new To,this._operationsAdded=0,this._operationsRemoved=0,this._requestId=0,this._cancelled=!1,this._hasResponse=!1,this._responseTime=null,this.invokedCallback=null,this._priority=e,this._onServerResponse=t,this.operationName="generic"}var t,n,i,a=e.prototype;return a.addOperation=function(e){e.id=++this._operationsAdded,e.batchedOperation=this,this._operations.set_item(this._operationsAdded,e)},a.removeOperation=function(e){this._operations.remove(e.id),e.id=0,e.batchedOperation=null,this._operationsRemoved++},a.dispatchRequest=function(t){void 0===t&&(t=null);var n=Io.construct(this._operations,this.mode);if(n){var i=this.getRequestQueueTimeoutMs(),a=this.getRequestTimeoutMs(n.length),o=this.buildTargetUrl();0;var l={};this.addRequestHeaders(l);var c=(t||e.extraInfoScanner)(this._operations);this._requestId=s.AFrameworkApplication.theClientRequestManager.addRequestWithHeaderForwarding(o,fo.post,n,l,this.getResponseHeadersToSet(),!1,this._priority,Object(r.a)(this,this.onSuccess,"onSuccess"),Object(r.a)(this,this.onFailure,"onFailure"),null,null,!1,i,a,vo.batchedOperation+"_"+this.operationName,void 0,this.shouldProcessResponseSynchronously,void 0,void 0,c,this.invokedCallback);for(var u,d=Eo(this._operations);!(u=d()).done;){u.value.value.roundtripId=this._requestId}this._requestId}},a.buildTargetUrl=function(){for(var e,t=this.webServiceBase+this.serviceName,n=new U.QueryStringBuilder(t),i=new Ie.a,r=Eo(this._operations);!(e=r()).done;){var a=e.value,o=a.value&&a.value.perfTag&&""!==a.value.perfTag?a.value.perfTag:"Unknown",s=void 0;if(s=i.tryGetValue(o,s,0).value,i.set_item(o,s+1),a.value&&a.value.queryParameters.count>0)for(var l,c=Eo(a.value.queryParameters);!(l=c()).done;){var u=l.value;n.addParam(u.key,u.value)}}for(var d,h=new Sys.StringBuilder,p=!0,g=Eo(i);!(d=g()).done;){var m=d.value;p||h.append(";"),p=!1,h.append(m.key),h.append("_"),h.append(m.value)}var f=h.toString();return n.addParam("perfTag",f),n.toString()},a.dispatchShutdownRequest=function(){var e=Io.construct(this._operations,this.mode);if(e){var t=this.webServiceBase+this.serviceName;0;for(var n,i=Eo(this._operations);!(n=i()).done;)n.value;s.AFrameworkApplication.theClientRequestManager.sendShuttingDownRequest(t,e)}},a.createBootstrapResponse=function(){var e,t=null;if(1!==this.operationCount||!(e=this._operations.tryGetValue(this.operationCount,t),t=e.value,e).returnValue||!t||1!==t.requestObject.getClassId())return this.dispatchRequest(),null;var n=(new Date).getTime();Nt.a.instance.addMetric(Ht.a.parseResponseStart,n),Wt.a.instance.addMark(Ht.a.parseResponseStart),this._requestId=s.AFrameworkApplication.theClientRequestManager.getNextRequestIdAndIncrement();var i=new yo.a(this._requestId,So.a.realtime,null,null,!1,null,null,null);return i.status=tt.succeeded,this._hasResponse=!0,i},a.processBootstrapResponse=function(e){e.status===tt.executing&&p.ULS.sendTraceTag(42022656,306,15,"BootstrapRequest still executing"),this.parseServerResponse(e),this._onServerResponse&&this._onServerResponse(this)},a.prepareBootstrapResponse=function(){var e=this.createBootstrapResponse();e&&this.processBootstrapResponse(e)},a.cancel=function(){this._cancelled=!0,s.AFrameworkApplication.theClientRequestManager.abortRequest(this._requestId)},a.onSuccess=function(e){this.onSuccessOrFailure(e.data,!0)},a.onFailure=function(e){this.onSuccessOrFailure(e.data,!1)},a.onSuccessOrFailure=function(e,t){this._cancelled||(this._hasResponse=!0,this._responseTime=new Date,e&&e.status===tt.executing&&(t?p.ULS.sendTraceTag(42022658,306,15,"Successful request still executing"):p.ULS.sendTraceTag(42022659,306,15,"Failed request still executing")),this.parseServerResponse(e),this._onServerResponse&&this._onServerResponse(this))},a.getRequestTimeoutMs=function(e){return null},a.getRequestQueueTimeoutMs=function(){return null},a.parseServerResponse=function(e){this.handleResponseHeaders(e.responseHeaders);var t,n,i=(e.responseHeaders?e.responseHeaders[bo.a.correlationIdHeaderName]:"")||this.correlation;e.responseObject?t=Fo.fromServerResponseObject(e.responseObject):t=Fo.tryDeserializeServerResponse(e.responseData,t).group;if(t)for(var r=0;r<t.Responses.length;r++){var a=t.Responses[r];0,a.requestInvokedTime=e.invokedTime,a.requestInvokedTimeTicks=e.invokedTimeTicks,a.requestCompletedTimeTicks=e.completedTimeTicks,a.correlation=i;var o=null;null!=(o=this._operations.tryGetValue(a.OperationId,o).value)&&o.addResponse(a)}else p.ULS.sendTraceTag(42022663,306,15,"Couldn't deserialize server response {0}",((n={}).Correlation=i,n.HttpStatus=e.httpStatus,n.Id=e.id,n.RequestEnqueueTime=e.enqueueTime?e.enqueueTime.getTime().toString():"NULL",n.RequestInvokedTime=e.invokedTime?e.invokedTime.getTime().toString():"NULL",n.RequestCompletedTime=e.completedTime?e.completedTime.getTime().toString():"NULL",n));for(var s,l=Eo(this._operations);!(s=l()).done;){var c=s.value.value;c.status=2,c.statusCode=e.status,c.corrrelation=i,c.httpStatusCode=e.httpStatus,c.requestEnqueueTime=e.enqueueTime,c.invokedTime=e.invokedTime,c.invokedTimeTicks=e.invokedTimeTicks,c.completedTime=e.completedTime,c.completedTimeTicks=e.completedTimeTicks}},a.addRequestHeaders=function(e){e["Content-Type"]="application/json; charset=utf-8";for(var t,n=Eo(this._operations);!(t=n()).done;){var i=t.value.value;if(i.httpHeaders)for(var r,a=Eo(i.httpHeaders);!(r=a()).done;){var o=r.value;e[o.key]=o.value}}},a.handleResponseHeaders=function(e){},a.getResponseHeadersToSet=function(){return[]},e.extraInfoScanner=function(e){return{}},t=e,(n=[{key:"operations",get:function(){return this._operations}},{key:"operationCount",get:function(){return this._operationsAdded-this._operationsRemoved}},{key:"shouldProcessResponseSynchronously",get:function(){return!1}},{key:"hasResponse",get:function(){return this._hasResponse}},{key:"responseTime",get:function(){return this._responseTime},set:function(e){this._responseTime=e}},{key:"correlation",get:function(){return""}}])&&Oo(t.prototype,n),i&&Oo(t,i),e}();function Mo(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Do(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Do(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Do(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function xo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Lo(e,t){return(Lo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Ro,"ABatchedServerOperation",null,[176]);var Bo=function(e){var t,n;function i(t,n,i,r,a,o,s,l,c,u,d){var h;return void 0===o&&(o=!1),void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===d&&(d=!1),(h=e.call(this,t,n)||this)._serviceName=i,h._responseTimeFetcher=c,h._requestItemProcessor=u,h._appMode=r,h._webServiceBase=a,h._amIAlone=l,h._bachedServerOperationTimeoutIsEnabled=d,h}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Lo(t,n);var r,a,o,s=i.prototype;return s.prepareBootstrapResponse=function(){var e=this.createBootstrapResponse();e&&(this._requestItemProcessor&&this._requestItemProcessor(e),this._responseTimeFetcher&&(this._responseTime=this._responseTimeFetcher()),this.processBootstrapResponse(e))},s.getRequestTimeoutMs=function(e){return this._bachedServerOperationTimeoutIsEnabled?6e4:null},s.getRequestQueueTimeoutMs=function(){return this._bachedServerOperationTimeoutIsEnabled?6e4:null},r=i,(a=[{key:"serviceName",get:function(){return this._serviceName}},{key:"mode",get:function(){return this._appMode}},{key:"webServiceBase",get:function(){return this._webServiceBase}},{key:"shouldProcessResponseSynchronously",get:function(){if(!this._amIAlone||this._amIAlone())return!1;for(var e,t=Mo(this.operations);!(e=t()).done;){var n=e.value.value;if(n){var i=n.requestObject;if(i&&(2===i.getClassId()||3===i.getClassId()))return!0}}return!1}}])&&xo(r.prototype,a),o&&xo(r,o),i}(Ro);Object(i.a)(Bo,"BatchedServerOperation",Ro,[176]);var Uo=function(){function e(){}return e.prototype.getBatchedServerOperation=function(e,t){return new Bo(e,t,"Comments.ashx",pr.App.mode,pr.App.webServiceBase)},e}();Object(i.a)(Uo,"BatchedServerOperationFactory",null,[234]);var Ho,No=n(318),Wo=n(31);!function(e){e[e.none=0]="none",e[e.getCells=1]="getCells",e[e.getChanges=2]="getChanges",e[e.putChanges=3]="putChanges",e[e.spelling=4]="spelling",e[e.spellingFailure=5]="spellingFailure",e[e.cellData=6]="cellData",e[e.setCurrentRevision=7]="setCurrentRevision",e[e.nullRequest=8]="nullRequest",e[e.editorsTable=9]="editorsTable",e[e.secondaryMetadata=10]="secondaryMetadata",e[e.amIAlone=11]="amIAlone",e[e.coauthStatus=14]="coauthStatus",e[e.beginCommenting=15]="beginCommenting",e[e.deleteComment=16]="deleteComment",e[e.addComment=17]="addComment",e[e.addCommentReply=18]="addCommentReply",e[e.changeCommentDoneStatus=19]="changeCommentDoneStatus",e[e.endCommenting=20]="endCommenting",e[e.search=21]="search",e[e.hotStoreStatus=22]="hotStoreStatus",e[e.updateLock=23]="updateLock",e[e.refreshCommentingLock=24]="refreshCommentingLock",e[e.saveToDocxPut_Deprecated=25]="saveToDocxPut_Deprecated",e[e.saveToDocxSet_Deprecated=26]="saveToDocxSet_Deprecated",e[e.saveToDocxResponse=27]="saveToDocxResponse",e[e.createSaveReplay=28]="createSaveReplay",e[e.playSaveReplay=29]="playSaveReplay",e[e.unlockSection=30]="unlockSection",e[e.picturePaste=31]="picturePaste",e[e.forceSaveToDocx=32]="forceSaveToDocx",e[e.createGraphMergeReplay=33]="createGraphMergeReplay",e[e.playGraphMergeReplay=34]="playGraphMergeReplay",e[e.whoAmI=35]="whoAmI",e[e.pagination=36]="pagination",e[e.getLastSavedRevision=37]="getLastSavedRevision",e[e.sendUsYourFile=38]="sendUsYourFile",e[e.ooXmlGet=39]="ooXmlGet",e[e.getFileAgaveApi=40]="getFileAgaveApi",e[e.spellingUserEvent=41]="spellingUserEvent",e[e.spellingContextualProofingResult=42]="spellingContextualProofingResult",e[e.spellingMetrics=43]="spellingMetrics",e[e.ooXmlSet=44]="ooXmlSet",e[e.imageCrop=45]="imageCrop",e[e.renderPage=46]="renderPage",e[e.mathConversion=47]="mathConversion",e[e.notebookSearch=48]="notebookSearch",e[e.notebookSearchResult=49]="notebookSearchResult",e[e.externalContentEmbed=50]="externalContentEmbed",e[e.externalContentFetchThumbnail=51]="externalContentFetchThumbnail",e[e.getEditPresResources=52]="getEditPresResources",e[e.getSlides=53]="getSlides",e[e.findText=54]="findText",e[e.diffRenderPage=55]="diffRenderPage",e[e.accCheck=56]="accCheck",e[e.pictureCropInfo=57]="pictureCropInfo",e[e.pageEventNotification=58]="pageEventNotification",e[e.updateContentAddinSnapshotInfo=59]="updateContentAddinSnapshotInfo",e[e.educationUser=60]="educationUser",e[e.checkUnblockUI=61]="checkUnblockUI",e[e.proofingConfig=62]="proofingConfig",e[e.proofingCheck=63]="proofingCheck",e[e.getFileSlice=64]="getFileSlice",e[e.copy=65]="copy",e[e.generateDesignerSuggestion=66]="generateDesignerSuggestion",e[e.reportDesignerSuggestionSessionInfo=67]="reportDesignerSuggestionSessionInfo",e[e.mathRecognize=68]="mathRecognize",e[e.mathRecoAlternates=69]="mathRecoAlternates",e[e.mathSolverActions=70]="mathSolverActions",e[e.mathSolverExecute=71]="mathSolverExecute",e[e.mathSolverGetTemplates=72]="mathSolverGetTemplates",e[e.mathSolverGetSteps=73]="mathSolverGetSteps",e[e.mathSolverGraph=74]="mathSolverGraph",e[e.getNotebooks=75]="getNotebooks",e[e.notebookData=76]="notebookData",e[e.closeFileAgave=77]="closeFileAgave",e[e.notifyImageUploadFailure=78]="notifyImageUploadFailure",e[e.reportDesignerSuggestionSessionInformation=79]="reportDesignerSuggestionSessionInformation",e[e.getChangeIdsForCatchUp=80]="getChangeIdsForCatchUp",e[e.flush=81]="flush",e[e.setUserInfo=82]="setUserInfo",e[e.generateObjectReplacementSuggestion=83]="generateObjectReplacementSuggestion",e[e.reportObjectReplacementSessionInfo=84]="reportObjectReplacementSessionInfo",e[e.swayPreview=85]="swayPreview",e[e.swayPublish=86]="swayPublish",e[e.uploadRsidsOnDocOpen=87]="uploadRsidsOnDocOpen",e[e.findComment=88]="findComment",e[e.getImages=89]="getImages",e[e.notebookType=90]="notebookType",e[e.generateImageDescription=91]="generateImageDescription",e[e.userSessionDataUpdate=92]="userSessionDataUpdate",e[e.getFileRevisionHistory=93]="getFileRevisionHistory",e[e.checkSwayLicense=94]="checkSwayLicense",e[e.richApiRequest=95]="richApiRequest",e[e.getWywaActivities=96]="getWywaActivities",e[e.getActivities=97]="getActivities",e[e.notifyDocUpdate=98]="notifyDocUpdate",e[e.generateIconSuggestion=99]="generateIconSuggestion",e[e.graphMergeConsentChange=100]="graphMergeConsentChange",e[e.getChangeIdObjectIdMapping=101]="getChangeIdObjectIdMapping",e[e.seedFullFileAugLoop=102]="seedFullFileAugLoop",e[e.getAppliedPolicyId=103]="getAppliedPolicyId",e[e.updateChangeIdCommitMapping=104]="updateChangeIdCommitMapping",e[e.sessionInfoRefresh=105]="sessionInfoRefresh",e[e.restoreVersion=106]="restoreVersion",e[e.getRelevantActivities=107]="getRelevantActivities",e[e.augmentImage=108]="augmentImage",e[e.updateWaterline=109]="updateWaterline"}(Ho||(Ho={})),Object(i.b)("OperationClassId",Ho);var jo=function(){this.OperationId=0,this.DependentOn=0};function Vo(e,t){return(Vo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(jo,"AServerRequest",null,[]);var qo=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.DocNormal=!1,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Vo(t,n),i.prototype.getClassId=function(){return Ho.beginCommenting},i.construct=function(e,t){var n=new i;return n.FileId=e,n.SharedLock=!1,n.DocNormal=t,n},i}(jo);function Go(e,t){return(Go=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(qo,"BeginCommentingRequest",jo,[]);var Ko=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Go(t,n),i.prototype.getClassId=function(){return Ho.endCommenting},i.construct=function(e,t){var n=new i;return n.FileId=e,n.SharedLock=t,n},i}(jo);Object(i.a)(Ko,"EndCommentingRequest",jo,[]);var zo=n(298),Xo=n(160),Jo=n(313),Qo=n(149);function Zo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Yo=function(){function e(t,n,i,a,o){void 0===o&&(o=!0),this._commentIds=[],this._zoomControl=null,this._pageNumber=n,this._top=i,Array.add(this._commentIds,a),this._hintElement=document.createElement("span"),this._hintElement.className="CommentHint",this._hintElement.setAttribute(e.COUNT_ATTRIBUTE,"1");var s=Pr.createClusteredImage(16,16,"CommentHint_16x16x32","",!0,CommonUIStrings.l_CommentHintTooltip);this._hintElement.appendChild(s),t.appendChild(this._hintElement),this._imageElement=s.firstChild,this.positionHint(o),pr.App.get_activeAppFrame().theClickInputManager.registerHandler(f.a.click,this._hintElement,Object(r.a)(this,this.onHintClick,"onHintClick"));var l=pr.App.get_activeAppFrame().theMouseInputManager;l.registerHandler(f.a.mouseOver,this._imageElement,Object(r.a)(this,this.onMouseOver,"onMouseOver"),null),l.registerHandler(f.a.mouseOut,this._imageElement,Object(r.a)(this,this.onMouseExit,"onMouseExit"),null)}var t,n,i,a=e.prototype;return a.repurposeFor=function(t,n,i,r){void 0===r&&(r=!0),this._pageNumber=t,this._top=n,Array.clear(this._commentIds),Array.add(this._commentIds,i),this._hintElement.setAttribute(e.COUNT_ATTRIBUTE,"1"),this.positionHint(r)},a.dispose=function(){pr.App.get_activeAppFrame().theClickInputManager.unregisterHandler(f.a.click,this._hintElement,Object(r.a)(this,this.onHintClick,"onHintClick")),this._hintElement=null;var e=pr.App.get_activeAppFrame().theMouseInputManager;e.unregisterHandler(f.a.mouseOver,this._imageElement,Object(r.a)(this,this.onMouseOver,"onMouseOver")),e.unregisterHandler(f.a.mouseOut,this._imageElement,Object(r.a)(this,this.onMouseExit,"onMouseExit")),this._imageElement=null},a.registerForComment=function(t){Array.add(this._commentIds,t),this._hintElement.setAttribute(e.COUNT_ATTRIBUTE,String.format("{0}",this._commentIds.length)),this._commentIds.sort()},a.unregisterCommentAndCheckValidity=function(t){return Array.remove(this._commentIds,t),this._hintElement.setAttribute(e.COUNT_ATTRIBUTE,String.format("{0}",this._commentIds.length)),!!this._commentIds.length||(this.removeFromView(),!1)},a.removeFromView=function(){this._hintElement.parentNode.removeChild(this._hintElement)},a.positionHint=function(t){void 0===t&&(t=!0);var n=this.zoomControl.currentZoom,i=da.a.instance.getPageTopAtZoom(this._pageNumber,n)+Math.round(this._top*n),r=0;r=s.AFrameworkApplication.isRtl?e.HINT_OVERLAP-e.HINT_WIDTH+da.a.instance.getPageLeftAtZoom(this._pageNumber,n,!1):da.a.instance.getPageWidthAtZoom(this._pageNumber,n)-e.HINT_OVERLAP+da.a.instance.getPageLeftAtZoom(this._pageNumber,n,!1),t?Qo.a.animateCommentHintPosition(this._hintElement,i,r):(mr.a.setElementStyleLeftInPixels(this._hintElement,r),mr.a.setElementStyleTopInPixels(this._hintElement,i))},a.onHintClick=function(e){var t=new Jo.a(null,e.inputSource);return s.AFrameworkApplication.theActionManager.processActionWithData(h.a.showCommentPane,2,t),ho.a.instance.selectComment(this._commentIds[0]),s.AFrameworkApplication.theActionManager.processAction(h.a.commentHintClick,2),!0},a.onMouseOver=function(e){return this._imageElement.className=Pr.getImageClass("CommentHintHover_16x16x32"),!0},a.onMouseExit=function(e){return this._imageElement.className=Pr.getImageClass("CommentHint_16x16x32"),!0},t=e,(n=[{key:"top",get:function(){return this._top}},{key:"pageNumber",get:function(){return this._pageNumber}},{key:"commentIds",get:function(){return this._commentIds}},{key:"zoomControl",get:function(){return this._zoomControl||(this._zoomControl=j.a.instance.resolve("WordViewer.Controls.IZoomControl"))}}])&&Zo(t.prototype,n),i&&Zo(t,i),e}();Yo.HINT_OVERLAP=22,Yo.HINT_WIDTH=16,Yo.HINT_HEIGHT=16,Yo.COUNT_ATTRIBUTE="count",Object(i.a)(Yo,"CommentHint",null,[4]);var $o=n(568);function es(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ts=function(){function e(t,n){this._startKnown=!1,this._isEmpty=!1,this._currentFoundStartPage=0,this._currentFoundStartTextrunId=e.ID_UNKNOWN,this._currentFoundEndTextrunId=e.ID_UNKNOWN,this._anchorBoxes=[],this._anchorPageNumbers=[],this._commentId=t,this._pageNumber=n}var t,n,i,r=e.prototype;return r.trySetSingleBoxAnchorFromNode=function(t,n){var i,r;return!!(i=e.tryCreateBox(t,r),r=i.newBox,i).returnValue&&(Array.add(this._anchorBoxes,r),Array.add(this._anchorPageNumbers,n),!0)},r.insertBoxRange=function(e,t){if(!(t.length<1)){for(var n=t[0],i=[],r=[],a=0;a<this._anchorPageNumbers.length&&!(n<this._anchorPageNumbers[a]);)Array.add(i,this._anchorBoxes[a]),Array.add(r,this._anchorPageNumbers[a]),a++;for(Array.addRange(i,e),Array.addRange(r,t);a<this._anchorPageNumbers.length;a++)Array.add(i,this._anchorBoxes[a]),Array.add(r,this._anchorPageNumbers[a]);this._anchorBoxes=i,this._anchorPageNumbers=r}},r.cloneFor=function(t){var n=new e(t,this._pageNumber);return n._anchorBoxes=Array.clone(this._anchorBoxes),n._anchorPageNumbers=Array.clone(this._anchorPageNumbers),n._startKnown=this._startKnown,n._isEmpty=this._isEmpty,n},e.tryCreateBox=function(t,n){n=null;var i=parseFloat(no.a.parseXmlAttribute(t,"l")),r=parseFloat(no.a.parseXmlAttribute(t,"t")),a=parseFloat(no.a.parseXmlAttribute(t,"w")),o=parseFloat(no.a.parseXmlAttribute(t,"h"));return isNaN(i)||isNaN(r)||isNaN(a)||isNaN(o)?{returnValue:!1,newBox:n}:(a<8&&(a=8),o<e.MINIMUM_BOX_HEIGHT&&(o=e.MINIMUM_BOX_HEIGHT),{returnValue:!0,newBox:n=new $o.a(i,r,a,o)})},e.compare=function(e,t){var n=e,i=t;if(!n.isStartKnown||!i.isStartKnown)return 0;var r=n.anchorPageNumbers[0],a=i.anchorPageNumbers[0];if(r!==a)return r-a;var o=n.anchorBoxes[0],s=i.anchorBoxes[0];return o.top===s.top?0:o.top<s.top?-1:1},t=e,(n=[{key:"commentId",get:function(){return this._commentId}},{key:"firstPageNumber",get:function(){return this._pageNumber}},{key:"isStartKnown",get:function(){return this._startKnown},set:function(e){this._startKnown=e}},{key:"isEmpty",get:function(){return this._isEmpty},set:function(e){this._isEmpty=e}},{key:"needsProcessing",get:function(){return this.currentFoundStartTextrunId!==e.ID_UNKNOWN||this.currentFoundEndTextrunId!==e.ID_UNKNOWN}},{key:"currentFoundStartPage",get:function(){return this._currentFoundStartPage},set:function(e){this._currentFoundStartPage=e}},{key:"currentFoundStartTextrunId",get:function(){return this._currentFoundStartTextrunId},set:function(e){this._currentFoundStartTextrunId=e}},{key:"currentFoundEndTextrunId",get:function(){return this._currentFoundEndTextrunId},set:function(e){this._currentFoundEndTextrunId=e}},{key:"anchorBoxes",get:function(){return this._anchorBoxes}},{key:"anchorPageNumbers",get:function(){return this._anchorPageNumbers}}])&&es(t.prototype,n),i&&es(t,i),e}();ts.ID_UNKNOWN=-1,ts.MINIMUM_BOX_HEIGHT=10,Object(i.a)(ts,"ViewerAnchorInfo",null,[260]);var ns=n(562),is=n(573),rs=n(358);function as(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var os=function(){function e(){this._scrollerElement=null,this._commentToViewerAnchorInfo={},this._commentToHint={},this._unhintedComments=[],this._hints=[],this._activeHighlights=[],this._pagesAlreadyParsed={},this._anchorWaitingToHighlight=null,this._commentCurrentlyHighlighted=null,this._waitingToScrollToComment=!1,this._zoomControl=null,this._scrollControl=null,pr.App.instance.isSmallView||s.AFrameworkApplication.isNoChrome||(this._highlightWhenPageLoadedTask=new u.a(3,1,pr.App.instance.theConfig.highlightTaskDelay,Object(r.a)(this,this.delayedHighlightTimer,"delayedHighlightTimer")),s.AFrameworkApplication.theActionManager.addActionWithFlags(Cr.a.xmlPageDownloaded2,sa.a.application,Object(r.a)(this,this.onXmlPageDownloaded2,"onXmlPageDownloaded2"),64),s.AFrameworkApplication.theActionManager.addActionWithFlags(Cr.a.rebuildCommentHints,sa.a.application,Object(r.a)(this,this.onRebuildCommentHints,"onRebuildCommentHints"),96),s.AFrameworkApplication.theActionManager.addActionWithFlags(Cr.a.rebuildCommentHintsWithoutAnimation,sa.a.application,Object(r.a)(this,this.onRebuildCommentHintsWithoutAnimation,"onRebuildCommentHintsWithoutAnimation"),96),s.AFrameworkApplication.theActionManager.addActionWithFlags(Cr.a.updateCommentHighlight,sa.a.application,Object(r.a)(this,this.onUpdateCommentHighlight,"onUpdateCommentHighlight"),64),pr.App.get_activeAppFrame().add_onResize(Object(r.a)(this,this.onWindowResize,"onWindowResize")),this._initialCommentDataTask=new u.a(3,1,1e3,Object(r.a)(this,this.loadInitialSelectionXml,"loadInitialSelectionXml")),s.AFrameworkApplication.theTaskManager.addTask(this._initialCommentDataTask))}var t,n,i,a=e.prototype;return a.initialize=function(e){this._scrollerElement=e},a.dispose=function(){this.removeCurrentHighlights();for(var e=0;e<this._hints.length;e++)this._hints[e].dispose();this._hints=[],this._commentToHint={},this._commentToViewerAnchorInfo={},this._unhintedComments=[],this._activeHighlights=[],this._commentCurrentlyHighlighted=null,pr.App.get_activeAppFrame().remove_onResize(Object(r.a)(this,this.onWindowResize,"onWindowResize"))},a.highlightComment=function(e,t){this._commentCurrentlyHighlighted!==e&&(this._commentCurrentlyHighlighted=e,this._waitingToScrollToComment=!1,this._anchorWaitingToHighlight&&(s.AFrameworkApplication.theTaskManager.deleteTask(this._highlightWhenPageLoadedTask),this._anchorWaitingToHighlight=null));var n=this._commentToViewerAnchorInfo[e.id];n&&n.isStartKnown?(this._waitingToScrollToComment=!1,this.highlightAndScrollToAnchor(n,t)):t&&(this.scrollControl.scrollToPage(e.groupNumber),this._waitingToScrollToComment=!0,this.removeCurrentHighlights())},a.clearHighlighting=function(){this.removeCurrentHighlights(),this._commentCurrentlyHighlighted=null,this._anchorWaitingToHighlight=null,this._waitingToScrollToComment=!1},a.removeCurrentHighlights=function(){for(var e=0;e<this._activeHighlights.length;e++){var t=this._activeHighlights[e];ns.a.instance.removeFromParent(t)}this._activeHighlights=[]},a.createAnchorForSelectedParagraphs=function(t,n){n=null;var i=null,r=ao.a.instance.selectionStart,a=ao.a.instance.selectionEnd;if(r&&a||(r=ao.a.instance.previousSelectionStart,a=ao.a.instance.previousSelectionEnd),!r||!a){var o=lo.SearchManager.instance,s=o?o.currentSelectedResult:null;if(s&&s.result){var l=s.result.page,c=s.result.paragraphTextrunId,u=pr.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(l);if(!u)return{returnValue:1,anchor:n};var d=u.selectSingleNode(e.getXPathForTextrun(l,c));if(!d)return{returnValue:1,anchor:n};r=new is.a(null,d),a=new is.a(null,d)}}if(!r||!a)return{returnValue:1,anchor:n};var h=pr.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(r.page).selectSingleNode(e.getXPathForTextrun(r.page,r.id));var p=h.selectSingleNode("preceding-sibling::T[last()]")||h,g=h.selectSingleNode("ancestor::P");var m=pr.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(a.page).selectSingleNode(e.getXPathForTextrun(a.page,a.id));var f=m.selectSingleNode("following-sibling::T[last()]")||m,_=m.selectSingleNode("ancestor::P");if(!e.isCommentablePara(g)||!e.isCommentablePara(_))return{returnValue:2,anchor:n};(i=new ts(t.id,r.page)).currentFoundStartTextrunId=parseInt(no.a.parseXmlAttribute(p,"id")),i.currentFoundEndTextrunId=parseInt(no.a.parseXmlAttribute(f,"id")),i.currentFoundStartPage=r.page,i.isStartKnown=!0,t.anchorStartId=no.a.parseXmlAttribute(g,"id"),t.anchorEndId=no.a.parseXmlAttribute(_,"id");var v=[];return Array.add(v,i),this.parseAnchorLocations(v),this._commentToViewerAnchorInfo[t.id]=i,Array.add(this._unhintedComments,t.id),this.createHints(),{returnValue:0,anchor:n=i}},a.createAnchorForReply=function(e){var t=this._commentToViewerAnchorInfo[e.replyToId];if(t){var n=t.cloneFor(e.id);this._commentToViewerAnchorInfo[e.id]=n}},a.commentsDeleted=function(e){for(var t=0;t<e.length;t++){var n=e[t];this._commentToViewerAnchorInfo[n.id]=null;var i=this._commentToHint[n.id];i?i.unregisterCommentAndCheckValidity(n.id)||(Array.remove(this._hints,i),i.dispose(),this._commentToHint[n.id]=null):Array.contains(this._unhintedComments,n.id)&&Array.remove(this._unhintedComments,n.id)}},a.getAnchorForComment=function(e){return this._commentToViewerAnchorInfo[e.id]},a.parseSelectionXmlForCommentData=function(t){for(var n=[],i=t.firstPage;i<=t.lastPage;i++)if(!this._pagesAlreadyParsed[i.toString()]){0;var r=pr.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(i);if(r){if(i===t.firstPage){var a=r.selectNodes(e.getXPathForCommentContinueNodes(i));0,this.parseCommentContinues(i,r,a,n)}var o=r.selectNodes(e.getXPathForCommentBeginNodes(i));0,this.parseCommentMarkers(i,o,!0,n);var s=r.selectNodes(e.getXPathForCommentEndNodes(i));if(this.parseCommentMarkers(i,s,!1,n),this._pagesAlreadyParsed[i.toString()]=!0,i===t.lastPage)for(var l=ts.ID_UNKNOWN,c=0;c<n.length;c++){var u=n[c];if(!u.isEmpty&&u.currentFoundEndTextrunId===ts.ID_UNKNOWN){if(l===ts.ID_UNKNOWN){var d=r.selectSingleNode(e.getXPathForLastTextrun(i));l=parseInt(no.a.parseXmlAttribute(d,"id"))}u.currentFoundEndTextrunId=l}}}}if(this.parseAnchorLocations(n),this._commentCurrentlyHighlighted)for(var h=0;h<n.length;h++)if(this._commentCurrentlyHighlighted.id===n[h].commentId){0,this.highlightComment(this._commentCurrentlyHighlighted,this._waitingToScrollToComment);break}},a.parseCommentMarkers=function(e,t,n,i){for(var r=t.length,a=0;a<r;a++){var o=t[a],s=this.createViewerAnchorInfo(o,e,n);Array.add(i,s)}},a.parseCommentContinues=function(t,n,i,r){if(i.length){var a=n.selectSingleNode(e.getXPathForFirstTextrun(t)),o=parseInt(no.a.parseXmlAttribute(a,"id"));0;for(var s=i.length,l=0;l<s;l++){var c=i[l],u=no.a.parseXmlAttribute(c,"id");0;var d=this.ensureAnchorForComment(t,u);d.currentFoundStartTextrunId=o,d.currentFoundStartPage=t,Array.add(r,d)}}},a.createViewerAnchorInfo=function(t,n,i){var r=no.a.parseXmlAttribute(t,"id");var a=this.ensureAnchorForComment(n,r);if(a.isEmpty)return a;for(var o=!1,s=t;s=i?s.nextSibling:s.previousSibling;){if("T"===s.nodeName){o=!0;var l=parseInt(no.a.parseXmlAttribute(s,"id"));if(i){if(a.currentFoundStartTextrunId!==ts.ID_UNKNOWN)return a;a.currentFoundStartTextrunId=l,a.currentFoundStartPage=n,a.isStartKnown=!0}else{if(a.currentFoundEndTextrunId!==ts.ID_UNKNOWN)return a;a.currentFoundEndTextrunId=l}break}if(i&&"CE"===s.nodeName){if(r!==no.a.parseXmlAttribute(s,"id"))continue;a.trySetSingleBoxAnchorFromNode(s,n)&&(o=!0,a.isEmpty=!0,a.isStartKnown=!0,a.currentFoundStartPage=n);break}i||s.nodeName!==e.COMMENT_BEGIN_NODENAME||no.a.parseXmlAttribute(s,"id")}if(!o)if(i);else{for(s=t;s=s.nextSibling;)if("T"===s.nodeName){o=!0;var c=parseInt(no.a.parseXmlAttribute(s,"id"));0,a.currentFoundEndTextrunId=c-1;break}0}return a},a.ensureAnchorForComment=function(e,t){var n=this._commentToViewerAnchorInfo[t];return n||(n=new ts(t,e),this._commentToViewerAnchorInfo[t]=n,Array.add(this._unhintedComments,t)),n},a.parseAnchorLocations=function(t){for(var n=0;n<t.length;n++){var i=t[n];if(i.needsProcessing&&!i.isEmpty)if(i.currentFoundStartTextrunId!==ts.ID_UNKNOWN)if(i.currentFoundEndTextrunId!==ts.ID_UNKNOWN){if(!(i.currentFoundStartPage<=0)){var r=i.currentFoundStartPage,a=pr.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(r);0;for(var o=[],s=[],l=i.currentFoundStartTextrunId;l<=i.currentFoundEndTextrunId;l++){var c,u=null;do{if(u=a.selectSingleNode(e.getXPathForTextrun(r,l)))break;if(r++,!(a=pr.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(r))){0;break}}while(!u);if(!u){0;break}if("P"===u.parentNode.nodeName&&e.isMainDocumentContent(u.parentNode)){var d=void 0;(c=ts.tryCreateBox(u,d),d=c.newBox,c).returnValue&&(Array.add(o,d),Array.add(s,r))}}o.length&&i.insertBoxRange(o,s),i.currentFoundStartPage=0,i.currentFoundEndTextrunId=ts.ID_UNKNOWN,i.currentFoundStartTextrunId=ts.ID_UNKNOWN}}else p.ULS.shipAssertTag(4468766,301,!1,"If we're trying to process a comment, we should always know where it ends.");else p.ULS.shipAssertTag(4468765,301,!1,"If we're trying to process a comment, we should always know where it starts.")}},a.createHints=function(){for(var e=this.zoomControl.currentZoom,t=0;t<this._unhintedComments.length;){var n=this._unhintedComments[t],i=this._commentToViewerAnchorInfo[n];if(i.isStartKnown)if(i.anchorBoxes.length){0;for(var r=i.anchorBoxes[0].top,a=i.anchorPageNumbers[0],o=null,s=0;s<this._hints.length;s++){var l=this._hints[s];if(!(a>l.pageNumber)){if(a<l.pageNumber){o=new Yo(this._scrollerElement,a,r,i.commentId),Array.insert(this._hints,s,o);break}var c=(r-l.top)*e;if(!(c>=Yo.HINT_HEIGHT)){if(Math.abs(c)<Yo.HINT_HEIGHT){(o=l).registerForComment(n);break}if(c<0){o=new Yo(this._scrollerElement,a,r,i.commentId),Array.insert(this._hints,s,o);break}0}}}o||(o=new Yo(this._scrollerElement,a,r,i.commentId),Array.add(this._hints,o)),this._commentToHint[i.commentId]=o,Array.removeAt(this._unhintedComments,t)}else Array.removeAt(this._unhintedComments,t);else t++}},a.ensureAnchorIsVisible=function(t,n){var i=this.zoomControl.currentZoom,r=this.scrollControl.getScrollTop(),a=r+this.scrollControl.getClientHeight(),o=this.scrollControl.getScrollLeft(),l=o+this.scrollControl.getWidth(),c=da.a.instance.getPageTopAtZoom(n,i),u=da.a.instance.getPageLeftAtZoom(n,i,!1),d=Math.round(c+t.top*i),h=d+Math.round(t.height*i),p=Math.round(u+t.left*i),g=Number.NaN,m=Number.NaN;if((r>d||a<h)&&(g=d-40),(o>p||l<p)&&(m=p-e.ANCHOR_SCROLL_SIDE_MARGIN),!isNaN(g)||!isNaN(m)){var f=new Xo.a(g,m);s.AFrameworkApplication.theActionManager.processActionWithData(Cr.a.repositionScroller,2,f),pr.App.instance.isBroadcastMode&&s.AFrameworkApplication.theActionManager.processActionWithData(Cr.a.broadcastOnScroll,2,new zo.a(n,f,2))}},a.repositionHints=function(e){void 0===e&&(e=!0);for(var t=[],n=0;n<this._hints.length;n++){var i=this._hints[n];Array.addRange(t,i.commentIds)}for(var r=[],a=new Array(t.length),o=0;o<t.length;o++)a[o]=this._commentToViewerAnchorInfo[t[o]];a.sort(ts.compare);for(var s=this.zoomControl.currentZoom,l=0,c=null,u=0;u<a.length;u++){var d=a[u],h=d.anchorBoxes[0];if(!c||c.pageNumber!==d.firstPageNumber||l<h.top*s){var p=void 0;this._hints.length>0?(p=this._hints[0],Array.removeAt(this._hints,0),p.repurposeFor(d.anchorPageNumbers[0],h.top,d.commentId,e)):p=new Yo(this._scrollerElement,d.anchorPageNumbers[0],h.top,d.commentId,e),Array.add(r,p),c=p,l=h.top*s+Yo.HINT_HEIGHT,this._commentToHint[d.commentId]=p}else c.registerForComment(d.commentId),this._commentToHint[d.commentId]=c}for(var g=0;g<this._hints.length;g++){var m=this._hints[g];m.removeFromView(),m.dispose()}this._hints=r},a.highlightAndScrollToAnchor=function(t,n){this.removeCurrentHighlights();var i=this.zoomControl.currentZoom;for(var r=0;r<t.anchorBoxes.length;r++){var a=t.anchorBoxes[r],o=t.anchorPageNumbers[r];if(ns.a.instance.isPageLoaded(o)){var l=ns.a.instance.drawRectangle(a,3,e.makeHighlightId(r),o);l.setPosition(l.box,l.page,i),Array.add(this._activeHighlights,l)}else if(!r&&n)return this._anchorWaitingToHighlight=t,this._highlightWhenPageLoadedTask.customData=n,s.AFrameworkApplication.theTaskManager.addTask(this._highlightWhenPageLoadedTask),void this.ensureAnchorIsVisible(a,o)}this._anchorWaitingToHighlight=null,n&&this._activeHighlights.length>0&&this.ensureAnchorIsVisible(this._activeHighlights[0].box,t.anchorPageNumbers[0])},a.delayedHighlightTimer=function(e){this._anchorWaitingToHighlight&&this.highlightAndScrollToAnchor(this._anchorWaitingToHighlight,e.customData)},a.onWindowResize=function(){this.repositionHints(),this._commentCurrentlyHighlighted&&ns.a.instance.needsManualRepositioning&&this.highlightComment(this._commentCurrentlyHighlighted,!1)},a.onRebuildCommentHints=function(e,t,n,i,r){return this.rebuildCommentHints(n,!0)},a.onRebuildCommentHintsWithoutAnimation=function(e,t,n,i,r){return this.rebuildCommentHints(n,!1)},a.rebuildCommentHints=function(e,t){return void 0===t&&(t=!0),1===e||this.repositionHints(t),32},a.onUpdateCommentHighlight=function(e,t,n,i,r){return 1===n||this._commentCurrentlyHighlighted&&this.highlightComment(this._commentCurrentlyHighlighted,!1),32},a.onXmlPageDownloaded2=function(e,t,n,i,r){if(1===n)return 32;this._initialCommentDataTask&&(s.AFrameworkApplication.theTaskManager.deleteTask(this._initialCommentDataTask),this._initialCommentDataTask=null);var a=r;return this.parseSelectionXmlForCommentData(a),this.createHints(),32},a.loadInitialSelectionXml=function(e){this._initialCommentDataTask=null;var t=pr.App.get_activeAppFrame().workspace.getCurrentPage();if(pr.App.get_activeAppFrame().thePageInfoCache.isPageCached(t)){var n=no.a.getPageSetFromPage(t),i=new rs.a(no.a.getStartPageFromPageSetXml(n),no.a.getEndPageFromPageSetXml(n));this.parseSelectionXmlForCommentData(i),this.createHints()}},e.getInstance=function(){return e.getInstanceWithResolvedDependencies()},e.getInstanceWithResolvedDependencies=function(){return new e},e.makeHighlightId=function(e){return"hi_"+e},e.getXPathForCommentBeginNodes=function(t){return String.format("/Pages/Page[@id='{0}']/descendant::P/"+e.COMMENT_BEGIN_NODENAME,t)},e.getXPathForCommentEndNodes=function(e){return String.format("/Pages/Page[@id='{0}']/descendant::P/CE",e)},e.getXPathForCommentContinueNodes=function(e){return String.format("/Pages/Page[@id='{0}']/CC",e)},e.getXPathForTextrun=function(e,t){return String.format("/Pages/Page[@id='{0}']//T[@id='{1}']",e,t)},e.getXPathForFirstTextrun=function(e){return String.format("/Pages/Page[@id='{0}']/descendant::T[1]",e)},e.getXPathForLastTextrun=function(e){return String.format("/Pages/Page[@id='{0}']/descendant::T[last()]",e)},e.isMainDocumentContent=function(e){return 1===parseInt(no.a.parseXmlAttribute(e,"storyId"))},e.isCommentablePara=function(t){return!!e.isMainDocumentContent(t)&&(!t.firstChild||"CN"!==t.firstChild.nodeName)},t=e,(n=[{key:"zoomControl",get:function(){return this._zoomControl||(this._zoomControl=j.a.instance.resolve("WordViewer.Controls.IZoomControl"))}},{key:"scrollControl",get:function(){return this._scrollControl||(this._scrollControl=j.a.instance.resolve("WordViewer.Controls.IScrollControl"))}}])&&as(t.prototype,n),i&&as(t,i),e}();os.ANCHOR_SCROLL_SIDE_MARGIN=40,os.COMMENT_BEGIN_NODENAME="CB",Object(i.a)(os,"ViewerCommentHintManager",null,[233,4]);var ss=n(564),ls=n(571);function cs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var us=function(){function e(e,t){this._retriesLeft=5,this._comment=e,this._changeType=t,this._status=0}var t,n,i;return e.prototype.toString=function(){return String.format("Type:{0} State:{1} Com:[{2}] R:[{3}]",this._changeType,this._status,this._comment.toString(),this._retriesLeft)},t=e,(n=[{key:"comment",get:function(){return this._comment}},{key:"changeType",get:function(){return this._changeType},set:function(e){this._changeType=e}},{key:"status",get:function(){return this._status},set:function(e){this._status=e,this._comment.saveState=e}},{key:"retriesLeft",get:function(){return this._retriesLeft},set:function(e){this._retriesLeft=e}}])&&cs(t.prototype,n),i&&cs(t,i),e}();Object(i.a)(us,"CommentSaveRecord",null,[]);var ds=n(74);function hs(e,t){return(hs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ps=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.CommId=null,t.Time=0,t.Text=null,t.GuardParaId=null,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,hs(t,n),i.prototype.getClassId=function(){return Ho.addCommentReply},i.construct=function(e,t,n,r,a,o){var s=new i;return s.FileId=e,s.GuardParaId=n,s.Time=r,s.Text=t,s.SharedLock=a,s.CommId=o,s},i}(jo);function gs(e,t){return(gs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ps,"AddCommentReplyRequest",jo,[]);var ms=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.CommId=null,t.Time=0,t.Text=null,t.StartParaId=null,t.EndParaId=null,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,gs(t,n),i.prototype.getClassId=function(){return Ho.addComment},i.construct=function(e,t,n,r,a,o,s){var l=new i;return l.FileId=e,l.StartParaId=n,l.EndParaId=r,l.Time=a,l.Text=t,l.SharedLock=o,l.CommId=s,l},i}(jo);function fs(e,t){return(fs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ms,"AddCommentRequest",jo,[]);var _s=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.GuardParaId=null,t.Done=!1,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,fs(t,n),i.prototype.getClassId=function(){return Ho.changeCommentDoneStatus},i.construct=function(e,t,n,r){var a=new i;return a.FileId=e,a.GuardParaId=t,a.Done=n,a.SharedLock=r,a},i}(jo);function vs(e,t){return(vs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(_s,"ChangeCommentDoneStatusRequest",jo,[]);var ys=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.GuardParaId=null,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,vs(t,n),i.prototype.getClassId=function(){return Ho.deleteComment},i.construct=function(e,t,n){var r=new i;return r.FileId=e,r.GuardParaId=t,r.SharedLock=n,r},i}(jo);function Ss(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bs(e,t){return(bs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ys,"DeleteCommentRequest",jo,[]);var Cs=function(e){var t,n;function i(){var t;return(t=e.call(this)||this)._pendingSaves=[],t._serverOpToSaveRecord={},t._autosaveTask=null,t._onBeforeNavigateWebkitString=null,t._retryingBadCanary=!1,t._maxCommentsPerBatch=20,t._batchedOperationFactory=new Uo,s.AFrameworkApplication.theActionManager.addAction(Cr.a.preventWarningsOnAppClose,sa.a.application,i.preventWarningsOnAppClose),s.AFrameworkApplication.activeFrame.thePageManager.getOnBeforeNavigateWebkitString=Object(r.a)(Ss(t),t.onBeforeNavigateWebkitString,"onBeforeNavigateWebkitString"),s.AFrameworkApplication.activeFrame.thePageManager.registerHandler(1,Object(r.a)(Ss(t),t.onBeforeAppClose,"onBeforeAppClose"),null),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,bs(t,n);var a=i.prototype;return a.updateContent=function(e){if(e){var t,n,i,r,a,o,s,l=e.selectNodes("/comments/comment"),c=l.length;this._comments=[];for(var u=0;u<c;u++){var d=l[u];t=no.a.parseXmlAttribute(d,"id"),n=no.a.parseXmlAttribute(d,"author"),i=no.a.parseXmlAttribute(d,"date"),r=no.a.parseXmlAttribute(d,"replyId"),a=no.a.parseXmlAttribute(d,"done"),o=no.a.parseXmlAttribute(d,"guardId"),s=no.a.parseXmlAttribute(d,"page"),n||(n=CommonUIStrings.l_CommentAuthorUnknown);var h=d.selectNodes("p");0;for(var p=new Array(h.length),g=0;g<h.length;g++)p[g]=h[g].text;var m=null;i&&(m=new Date(parseInt(i))).setMinutes(m.getMinutes()+m.getTimezoneOffset());var f=!1;a&&"true"===a.toLowerCase()&&(f=!0);var _=-1;s&&(_=parseInt(s));var v=new ss.Comment(t,o,n,m,r,f,p,_);Array.add(this._comments,v)}}},a.addCommentToModel=function(e,t){this._commentManager.mode=2,this._inProgress=e,e.groupNumber=t.firstPageNumber;for(var n=-1,i=0;i<this._comments.length;i++){var r=this._comments[i];if(!(r.groupNumber<e.groupNumber)){if(r.groupNumber===e.groupNumber){var a=this._commentManager.hintManager.getAnchorForComment(r);if(a&&a.isStartKnown){if(ts.compare(a,t)<=0)continue}else 0}n=i;break}}-1===n&&(n=this._comments.length),Array.insert(this._comments,n,e)},a.recordChanges=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if((1!==i.commentType||3!==t)&&3!==i.saveState){var r=new us(i,t);r.status=0,Array.add(this._changes,r)}}this.saveSoonerOrLater()},a.recordTaskChanges=function(e,t){0},a.saveSoonerOrLater=function(){this.okToReplicate()?(this._autosaveTask=null,this.replicateChanges()):this.startAutosaveTimer()},a.startAutosaveTimer=function(){this._autosaveTask?s.AFrameworkApplication.theTaskManager.resetInterval(this._autosaveTask,15e3):(this._autosaveTask=new u.a(4,1,15e3,Object(r.a)(this,this.delayedSaveTimer,"delayedSaveTimer")),s.AFrameworkApplication.theTaskManager.addTask(this._autosaveTask))},a.okToReplicate=function(){return!this._pendingSaves.length},a.delayedSaveTimer=function(e){this._autosaveTask=null,this.saveSoonerOrLater()},a.replicateChanges=function(){this._changes.sort(i.sortCommentsById);for(var e=[],t=this._batchedOperationFactory.getBatchedServerOperation(2,Object(r.a)(this,this.saveCommentOperationResponseHandler,"saveCommentOperationResponseHandler")),n=0;n<this._changes.length&&e.length<this._maxCommentsPerBatch-i.maxOperationsFromOneSaveRecord;){for(var a=this._changes[n].comment,o=0,s=new Array(7),l=0;l<7;l++)s[l]=[];for(;n<this._changes.length;){var c=this._changes[n];if(c.comment.id!==a.id)break;c.status||(Array.add(s[c.changeType],c),o++),n++}if(o>0){var u=this.createServerOpsForChanges(s,t,e);Array.addRange(e,u)}}e.length>0&&(this._pendingSaves=e,t.dispatchRequest())},a.createServerOpsForChanges=function(e,t,n){var i=[],r=this._commentManager.hasSharedLock;if(1===e[3].length){this.updateStatesTo(4,e[2]),this.updateStatesTo(4,e[0]),this.updateStatesTo(4,e[1]);var a=e[3][0];if(1===e[2].length)return this.updateStatesTo(4,e[3]),i;var o=this.createAndAddServerOp(t,3,a,r,n);return a.status=1,Array.add(i,o),i}if(1===e[2].length){var s=e[2][0],l=this.createAndAddServerOp(t,2,s,r,n);l?(s.status=1,Array.add(i,l)):s.status=0}var c=e[0].length,u=e[1].length;if(this.updateStatesTo(4,e[0]),this.updateStatesTo(4,e[1]),c!==u){var d=c>u?0:1,h=e[d][0],p=this.createAndAddServerOp(t,d,h,r,n);p?(h.status=1,Array.add(i,p)):h.status=0}return i},a.updateStatesTo=function(e,t){for(var n=0;n<t.length;n++)t[n].status=e},a.createAndAddServerOp=function(e,t,n,i,r){var a=n.comment,o=new _o;if(3===t)o.requestObject=ys.construct(pr.App.instance.baseDocQueryParam,a.guardId,i);else if(t&&1!==t)if(2===t&&a.replyToId){var s=this.getComment(a.replyToId);if(!s.guardId)return 3===s.saveState?(n.status=3,null):null;for(var l=0;l<r.length;l++){var c=r[l];if(Object(ds.a)(ps,c.requestObject)&&c.requestObject.GuardParaId===s.guardId)return null}var u=a.text[0];o.requestObject=ps.construct(pr.App.instance.baseDocQueryParam,u,s.guardId,ls.a.dateToLocalTime(a.date),i,a.id)}else{if(2!==t)return null;var d=a.text[0];o.requestObject=ms.construct(pr.App.instance.baseDocQueryParam,d,a.anchorStartId,a.anchorEndId,ls.a.dateToLocalTime(a.date),i,a.id)}else{if(!a.guardId)return null;o.requestObject=_s.construct(pr.App.instance.baseDocQueryParam,a.guardId||a.id,a.done,i)}return o.status=mo.requestReady,e.addOperation(o),this._serverOpToSaveRecord[o.id.toString()]=n,o},a.saveCommentOperationResponseHandler=function(e){for(var t=!1,n=!1,r=0;r<this._changes.length;){3!==this._changes[r].status?r++:Array.removeAt(this._changes,r)}for(var a=0;a<this._pendingSaves.length;a++){var o=this._pendingSaves[a];0;var l=this._serverOpToSaveRecord[o.id.toString()];if(5===o.statusCode){if(this._retryingBadCanary){0,l.status=3,i.showSaveFailureDialog(WordViewerIntl.WordViewerStrings.l_GenericErrorSave,Wo.a.commentSaveCanaryFailure),no.a.propagateError(!1,"CommentSaveCanaryFailure",Wo.a.commentSaveCanaryFailure,WordViewerIntl.WordViewerStrings.l_GenericErrorSave);continue}return this._retryingBadCanary=!0,void e.dispatchRequest()}if(2===o.statusCode&&o.responseObjects){0;var c=o.responseObjects[o.responseObjects.length-1];if(33!==c.StatusCode)if(46!==c.StatusCode&&59!==c.StatusCode){if(c.StatusCode){var u;l.status=3;var d=void 0,p=(u=i.getErrorInfoForSaveFailure(c.StatusCode,d),d=u.errorCode,u).returnValue;i.showSaveFailureDialog(p,d),no.a.propagateError(!1,"CommentSaveFailed",d,p),61===c.StatusCode&&(this._commentManager.mode=0)}else if(s.AFrameworkApplication.theActionManager.processAction(h.a.commentSaveSucceeded,2),j.a.instance.resolveFuture("Common.Interface.IEditNotificationManager").execute((function(e){e.editHappened()})),l.status=2,c.classId===Ho.addCommentReply){var g=c,m=this.getComment(g.CommId);m&&(m.guardId=g.ParaId)}else if(c.classId===Ho.addComment){var f=c,_=this.getComment(f.CommId);_&&(_.guardId=f.ParaId)}}else l.status=0,n=i.markForRetry(l)||n;else{if(this._maxCommentsPerBatch<=i.maxOperationsFromOneSaveRecord){0,l.status=3,i.showSaveFailureDialog(WordViewerIntl.WordViewerStrings.l_GenericErrorSave,Wo.a.commentSaveRequestCountTooLarge),no.a.propagateError(!1,"CommentSaveRequestCountTooLarge",Wo.a.commentSaveRequestCountTooLarge,WordViewerIntl.WordViewerStrings.l_GenericErrorSave);continue}t||(t=!0,this._maxCommentsPerBatch=parseInt(String(Math.max(Math.floor(this._maxCommentsPerBatch/2),1)))),l.status=0,n=i.markForRetry(l)||n}}else s.AFrameworkApplication.theActionManager.processAction(h.a.commentSaveNetworkError,2),n=i.markForRetry(l)||n}for(this._pendingSaves=[],this._serverOpToSaveRecord={},this._retryingBadCanary=!1,r=0;r<this._changes.length;){var v=this._changes[r];2!==v.status&&4!==v.status?r++:Array.removeAt(this._changes,r)}(n||this.hasUnsavedChanges())&&this.startAutosaveTimer()},a.onBeforeAppClose=function(e){if(this._onBeforeNavigateWebkitString=null,this.hasUnsavedChanges()&&!pr.App.allowUnsafeAppClose)return this.okToReplicate()&&(s.AFrameworkApplication.isShuttingDown=!0,this.replicateChanges(),s.AFrameworkApplication.isShuttingDown=!1),this.hasUnsavedChanges()||this.lastSaveHadFailures()?(this._onBeforeNavigateWebkitString=CommonUIStrings.l_NavigateAway,void(e.eventObject.rawEvent.returnValue=CommonUIStrings.l_NavigateAway)):void 0},a.onBeforeNavigateWebkitString=function(){return this._onBeforeNavigateWebkitString},a.hasUnsavedChanges=function(){for(var e=0;e<this._changes.length;e++){var t=this._changes[e];if(!t.status||1===t.status)return!0}return!1},a.lastSaveHadFailures=function(){for(var e=0;e<this._changes.length;e++){if(3===this._changes[e].status)return!0}return!1},i.getInstance=function(){return i.getInstanceWithResolvedDependencies()},i.getInstanceWithResolvedDependencies=function(){return new i},i.sortCommentsById=function(e,t){var n=e,i=t;return n.comment.id===i.comment.id?0:n.comment.id.toLowerCase().localeCompare(i.comment.id.toLowerCase())},i.markForRetry=function(e){return e.retriesLeft<=0?(e.status=3,i.showSaveFailureDialog(WordViewerIntl.WordViewerStrings.l_GenericErrorSave,Wo.a.commentSaveRetryCountExceeded),no.a.propagateError(!1,"CommentSaveRetryCountExceeded",Wo.a.commentSaveRetryCountExceeded,WordViewerIntl.WordViewerStrings.l_GenericErrorSave),!1):(e.retriesLeft=e.retriesLeft-1,e.status=0,s.AFrameworkApplication.theActionManager.processAction(h.a.commentSaveRetry,2),!0)},i.showSaveFailureDialog=function(e,t){if(1!==s.AFrameworkApplication.activeFrame.state){var n=new Nn.StandardDialog;n.buttonsOption=0,n.showError(t,CommonUIStrings.l_DefaultDialogTitle,e,null)}},i.getErrorInfoForSaveFailure=function(e,t){switch(e){case 1:return t=Wo.a.commentSaveInvalidPropertyData,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorSave,errorCode:t};case 14:return t=Wo.a.commentSaveUnspecifiedFailure,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorSave,errorCode:t};case 7:return t=Wo.a.commentSavePermissionDenied,{returnValue:WordViewerIntl.WordViewerStrings.l_AccessDeniedSave,errorCode:t};case 36:return t=Wo.a.commentSaveOldProductDigitalSignature,{returnValue:WordViewerIntl.WordViewerStrings.l_OldProductDigitalSignatureSave,errorCode:t};case 9:return t=Wo.a.commentSaveDocumentProtectionSettings,{returnValue:WordViewerIntl.WordViewerStrings.l_DocumentProtectionSettingsCommentSave,errorCode:t};case 30:return t=Wo.a.commentSaveDocumentPasswordEncrypted,{returnValue:WordViewerIntl.WordViewerStrings.l_DocumentPasswordEncryptedSave,errorCode:t};case 31:return t=Wo.a.commentSaveFileCheckedOut,{returnValue:WordViewerIntl.WordViewerStrings.l_CheckedOutSave,errorCode:t};case 17:return t=Wo.a.commentSaveFileRequiresCheckout,{returnValue:WordViewerIntl.WordViewerStrings.l_RequiresCheckoutSave,errorCode:t};case 16:return t=Wo.a.commentSaveFileLockedForOfflineCheckout,{returnValue:WordViewerIntl.WordViewerStrings.l_LockedForOfflineCheckoutSave,errorCode:t};case 11:return t=Wo.a.commentSaveFileLockedByOtherInterface,{returnValue:WordViewerIntl.WordViewerStrings.l_LockedByOtherInterfaceSave,errorCode:t};case 57:return t=Wo.a.commentSaveNumberOfCoauthorsReachedMax,{returnValue:WordViewerIntl.WordViewerStrings.l_NumberOfCoauthorsReachedMaxSave,errorCode:t};case 47:return t=Wo.a.commentSaveWordFileVersionMismatch,{returnValue:WordViewerIntl.WordViewerStrings.l_DocumentChangedErrorSave,errorCode:t};case 59:return t=Wo.a.commentSaveDocxCoherencyFailure,{returnValue:WordViewerIntl.WordViewerStrings.l_DocxCoherencyErrorSave,errorCode:t};case 12:return t=Wo.a.commentSaveCorruptedFile,{returnValue:WordViewerIntl.WordViewerStrings.l_CorruptFileSave,errorCode:t};case 61:return t=Wo.a.commentSaveDocumentMarkedFinal,{returnValue:WordViewerIntl.WordViewerStrings.l_DocumentMarkedFinalSave,errorCode:t};case 38:return t=Wo.a.commentSavePreReleaseFile,{returnValue:WordViewerIntl.WordViewerStrings.l_PreReleaseFile,errorCode:t};case 35:return t=Wo.a.commentSaveLockExpired,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorSave,errorCode:t};case 39:return t=Wo.a.commentSaveFileEditedInRichClient,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorSave,errorCode:t};case 33:return t=Wo.a.commentSaveRequestCountTooLarge,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorSave,errorCode:t};default:return t=Wo.a.commentSaveUnspecifiedFailure,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorSave,errorCode:t}}},i.preventWarningsOnAppClose=function(e,t,n,i,r){return pr.App.allowUnsafeAppClose=!0,32},i}(ls.a);Cs.maxOperationsFromOneSaveRecord=2,Object(i.a)(Cs,"ViewerCommentModel",ls.a,[]);var As=n(572),Ts=n(561),ws=n(567),ks=n(154),Is=n(110),Fs=n(135),Es=n(30),Ps=n(56);function Os(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Rs=function(){function e(e,t,n,i,r){this._commentManager=null,this._headerControlsRow=null,this._closeButton=null,this._newCommentButton=null,this._addedDivider=!1,this._contentLoaded=!1,this._waitingToScrollTo=null,this._addCommentOnRender=!1,this._newCommentKeyEventHandler=null,this._closeCommentPaneKeyEventHandler=null,this.editCommentOnRender=!1,this._isVisible=!1,this._paneSurface=null,this._paneParent=null,this._pane=null,this._actionManager=e,this._clickInputManager=t,this._keyInputManager=n,this._focusManager=i,this._f6Manager=r,this._escapeKeyHash=hr.KeyInputManager.hashKey(dr.a.vK_Escape,0)}var t,n,i,a=e.prototype;return a.initialize=function(e,t){this._commentManager=e,this._paneParent=t;var n=this.createPane();this.paneParent.appendChild(n),this.registerActions(),this.resizeCommentPane()},a.dispose=function(){this.shouldCreateHeader&&this._closeButton&&(this._clickInputManager.unregisterHandler(f.a.click,this._closeButton,Object(r.a)(this,this.onClosePaneClick,"onClosePaneClick")),this._keyInputManager.unregisterHandlerForAllKeyEvents(this._closeButton,this._closeCommentPaneKeyEventHandler)),this.shouldCreateHeaderControls&&this._newCommentButton&&(this._clickInputManager.unregisterHandler(f.a.click,this._newCommentButton,Object(r.a)(this,this.onNewCommentClick,"onNewCommentClick")),this._keyInputManager.unregisterHandlerForAllKeyEvents(this._newCommentButton,this._newCommentKeyEventHandler)),this.pane&&this._clickInputManager.unregisterHandler(f.a.click,this.pane,Object(r.a)(this,this.clearSelection,"clearSelection"));var e=this._focusManager.getScope(kt.AFrame.commentPaneFocusId);e.unBindAction(this._escapeKeyHash),e.unBindAction(Ft.FocusManager.instance()._tabInput),e.unBindAction(Ft.FocusManager.instance()._tabShiftInput),this._pane=null,this._closeButton=null,this._paneSurface=null,this._newCommentButton=null},a.showEmptyUI=function(){this.paneSurface.innerText="";var e=Ts.a("div","","CommentPaneEmpty1");if(e.innerText=this.emptyUIStringPart1,this.paneSurface.appendChild(e),this._commentManager.mode){var t=Ts.a("div","","CommentPaneEmpty2");t.innerText=this.emptyUIStringPart2,this.paneSurface.appendChild(t)}},a.showErrorUI=function(){this.paneSurface.innerText="";var e=Ts.a("div","","CommentPaneEmpty1");e.innerText=CommonUIStrings.l_CommentPaneError,this.paneSurface.appendChild(e)},a.showLoadingUI=function(){this.paneSurface.innerText="";var e=Ts.a("div","","");e.style.textAlign="center";var t=document.createElement("img");t.className="CommentPaneLoading",t.src=lt.a.commonImage("progress.gif"),e.appendChild(t);var n=Ts.a("div","","CommentPaneLoadingText");n.innerText=CommonUIStrings.l_CommentLoading,e.appendChild(n),this.paneSurface.appendChild(e)},a.showComments=function(e){if(mr.a.clearElementHtml(this.paneSurface),e.length)for(var t=0;t<e.length;t++){var n=e[t],i=t?e[t-1]:null;(!t||i.groupNumber<n.groupNumber)&&this.paneSurface.appendChild(this.createGroupDivider(n)),this.paneSurface.appendChild(n.render())}else this.showEmptyUI();this._contentLoaded=!0,this.updateRenderedState(),this._waitingToScrollTo&&(this._waitingToScrollTo.focus(),this._waitingToScrollTo=null)},a.selectComment=function(e,t){void 0===t&&(t=1),this._contentLoaded?e.focus():this._waitingToScrollTo=e},a.isDifferentGroup=function(e,t){return!e||!t||e.groupNumber!==t.groupNumber},a.getPaneSurfaceOffsetTop=function(){var e=document.getElementById("CommentPaneHeader").offsetHeight;return this._headerControlsRow&&(e+=this._headerControlsRow.offsetHeight),e},a.renderNewComment=function(e){var t=this._commentManager.model.getCommentBefore(e,!1),n=this._commentManager.model.getCommentAfter(e,!1);t||n||mr.a.clearElementHtml(this.paneSurface);var i=this.isDifferentGroup(t,e),r=this.isDifferentGroup(n,e),a=null;n&&(a=n.containerElement,r&&(a=a.previousSibling)),this.renderNewOrEditingComment(e,a,i&&r)},a.renderEditingComment=function(e){var t=e.containerElement.nextSibling;this.paneSurface.removeChild(e.containerElement),this.renderNewOrEditingComment(e,t,!1)},a.onAfterFadeIn=function(t){e.clearOpacity(t.element),e.removeAllAnimationClasses(t.element)},a.onAfterMove=function(t){t.element.style.marginTop="",e.removeAllAnimationClasses(t.element)},a.removeCommentsFromPane=function(t){for(var n=[],i=null,a=null,o=0;o<t.length;o++){var s=t[o];if(o||(a=s.containerElement.previousSibling),o===t.length-1){var l=s.containerElement.nextSibling;a&&Sys.UI.DomElement.containsCssClass(a,"CommentGroupDivider")&&(!l||Sys.UI.DomElement.containsCssClass(l,"CommentGroupDivider"))&&Array.add(n,a)}i=s.containerElement,Array.add(n,i)}var c=0,u=i.nextSibling;if(u){for(var d=u.offsetTop,h=0;h<n.length;h++)n[h].style.display="none";c=u.offsetTop-d;for(var p=0;p<n.length;p++)n[p].style.display=""}e.animateDeleteComments(n,u,c,Object(r.a)(this,this.onAfterFadeOut,"onAfterFadeOut"),Object(r.a)(this,this.onAfterMove,"onAfterMove"))},a.registerActions=function(){this._actionManager.addAction(h.a.hideCommentPane,ue.a.frame,Object(r.a)(this,this.hideCommentPane,"hideCommentPane")),this._actionManager.addAction(h.a.editComment,ue.a.frame,Object(r.a)(this,this.editComment,"editComment")),this._actionManager.addAction(h.a.selectNextComment,ue.a.frame,Object(r.a)(this,this.selectNextComment,"selectNextComment")),this._actionManager.addAction(h.a.selectPrevComment,ue.a.frame,Object(r.a)(this,this.selectPrevComment,"selectPrevComment")),this._actionManager.addActionWithFlags(h.a.queryToggleCommentPane,ue.a.frame,Object(r.a)(this,this.queryToggleCommentPane,"queryToggleCommentPane"),96),this._actionManager.addAction(h.a.commentTabForward,ue.a.frame,Object(r.a)(this,this.commentMoveFocusForTabsHandler,"commentMoveFocusForTabsHandler")),this._actionManager.addAction(h.a.commentTabBackward,ue.a.frame,Object(r.a)(this,this.commentMoveFocusForTabsHandler,"commentMoveFocusForTabsHandler"))},a.onAfterFadeOut=function(e){e.element.parentNode&&e.element.parentNode.removeChild(e.element),this.paneSurface.childNodes.length||this.showEmptyUI()},a.modeChanged=function(){this.updateRenderedState()},a.createPane=function(){var e=Ts.a("div",this.commentPaneBodyId,"CommentPane"),t=Ts.a("label",As.a.commentTabHelp,As.a.commentTabHelp);if(t.innerText=CommonUIStrings.l_CommentTabHelp,e.appendChild(t),this.shouldCreateHeader){var n=this.createHeaderDom();e.appendChild(n)}if(this.shouldCreateHeaderControls){var i=this.createHeaderControlsDom();e.appendChild(i)}var a=Ts.a("div","CommentPaneSurface","CommentPaneSurface");return this._commentManager.copyingEnabled||(Sys.UI.DomElement.addCssClass(e,"DisableSelection"),e.setAttribute("Unselectable","on")),e.appendChild(a),this._pane=e,this._paneSurface=a,this.updateRenderedState(),this.setupFocus(),this._clickInputManager.registerHandler(f.a.click,e,Object(r.a)(this,this.clearSelection,"clearSelection")),this.showLoadingUI(),e},a.createHeaderDom=function(){var e=Ts.b("div","CommentPaneHeader","CommentPaneHeader"),t=Ts.b("span","CommentPaneTitle","PaneTitle CommentPaneTitle UIFontLight");t.innerText=CommonUIStrings.L_OpenCommentPane;var n=ws.a.createButton("CloseCommentPane","CommentPaneCloseButton",CommonUIStrings.l_Close,"ClosePaneGlyph_16x16x32",!1);return Sys.UI.DomElement.addCssClass(n,s.AFrameworkApplication.isRtl?"FloatLeft":"FloatRight"),this._clickInputManager.registerHandler(f.a.click,n,Object(r.a)(this,this.onClosePaneClick,"onClosePaneClick")),this._closeCommentPaneKeyEventHandler=this._keyInputManager.registerHandlerForAllKeyEvents(n,Object(r.a)(this,this.onClosePaneClick,"onClosePaneClick"),dr.a.vK_Enter),e.appendChild(t),e.appendChild(n),this._closeButton=n,e},a.createHeaderControlsDom=function(){this._headerControlsRow=Ts.b("div","CommentPaneControls","CommentPaneControls");var e=ws.a.createButton("CommentPaneNewComment","CommentPaneNewComment",CommonUIStrings.l_CommentNewCommentButton,"CommentNew_16x16x32");return this._headerControlsRow.appendChild(e),this._clickInputManager.registerHandler(f.a.click,e,Object(r.a)(this,this.onNewCommentClick,"onNewCommentClick")),this._newCommentKeyEventHandler=this._keyInputManager.registerHandlerForAllKeyEvents(e,Object(r.a)(this,this.onNewCommentClick,"onNewCommentClick"),dr.a.vK_Enter),this._newCommentButton=e,this._headerControlsRow},a.createGroupDivider=function(e){var t=Ts.a("div","","CommentGroupDivider");return this._addedDivider||Sys.UI.DomElement.addCssClass(t,"CommentGroupDividerFirst"),this._addedDivider=!0,t.innerText=this.getDividerLabel(e),t},a.updateRenderedState=function(){this._commentManager.mode&&-1!==this._commentManager.mode?(Sys.UI.DomElement.removeCssClass(this.paneSurface,"ReadOnly"),this._headerControlsRow&&(this._headerControlsRow.style.display="inline-block"),this.isCurrentlyEditing||4===this._commentManager.mode?(Sys.UI.DomElement.addCssClass(this.paneSurface,"CommentInProgress"),Sys.UI.DomElement.removeCssClass(this.paneSurface,"Interactive"),this._newCommentButton&&this.setNewCommentButtonState(!1)):(Sys.UI.DomElement.addCssClass(this.paneSurface,"Interactive"),Sys.UI.DomElement.removeCssClass(this.paneSurface,"CommentInProgress"),this._newCommentButton&&this.setNewCommentButtonState(this._contentLoaded))):(this._headerControlsRow&&(this._headerControlsRow.style.display="none"),Sys.UI.DomElement.addCssClass(this.paneSurface,"ReadOnly"))},a.setNewCommentButtonState=function(e){ws.a.setButtonEnabledState(this._newCommentButton,e)},a.setupFocus=function(){var e=this,t=this._focusManager.getScope(kt.AFrame.commentPaneFocusId);t.parent=kt.AFrame.appFocusId,this._clickInputManager.addFocusEvent(kt.AFrame.commentPaneFocusId,this.pane),t.addSetFocus((function(){var t=null;(t=e._newCommentButton.disabled&&e._closeButton?e._closeButton:e._newCommentButton).focus(),e._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t),e._commentManager.getCommentPaneFocusRegion().listing.addValidTag(5)})),t.addOnBlur((function(){2!==e._commentManager.mode&&3!==e._commentManager.mode&&e._commentManager.clearSelection()})),this._f6Manager.addF6KeyBindings(kt.AFrame.commentPaneFocusId),t.bindAction(hr.KeyInputManager.hashKey(dr.a.vK_UpArrow,0),h.a.selectPrevComment),t.bindAction(hr.KeyInputManager.hashKey(dr.a.vK_DownArrow,0),h.a.selectNextComment),t.bindAction(this._escapeKeyHash,h.a.hideCommentPane)},a.rebindTabNavigationHandlers=function(e){e.unBindAction(this._focusManager._tabInput),e.unBindAction(this._focusManager._tabShiftInput),e.bindAction(this._focusManager._tabInput,h.a.commentTabForward),e.bindAction(this._focusManager._tabShiftInput,h.a.commentTabBackward)},a.commentMoveFocusForTabsHandler=function(e,t,n,i,r){var a=this._commentManager.getCommentPaneFocusRegion().listing.currentElement,o=this._commentManager.model.selectedComment;if(!a){if(a=document.activeElement,this.pane.contains(a)||(a=o?o.containerElement:this._commentManager.pane.newCommentButton),!a)return 4;this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(a)}return e===h.a.commentTabForward?this.moveForward(a,o):e===h.a.commentTabBackward?this.moveBackward(a,o):2},a.moveForward=function(e,t){var n=this.isCurrentlyEditing;if(e===this._newCommentButton&&this._commentManager.model.hasComments()&&!this.isCurrentlyEditing)return this._commentManager.selectNextComment(),32;if(t&&e===t.containerElement)this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(e.firstChild);else if(-1!==e.className.indexOf(As.a.commentDeleteButtonClassName)){if(t){if(this._commentManager.model.getCommentAfter(t,!1))return this._commentManager.selectNextComment(),32;n||this._commentManager.model.clearSelection(),this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t.containerElement)}}else{if(-1!==e.className.indexOf(As.a.commentTextEntryClassName))return this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t.commentViewObject.saveButtonElement),32;-1!==e.className.indexOf(As.a.commentSaveButtonClassName)&&this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t.containerElement)}return this._commentManager.getCommentPaneFocusRegion().moveForward(),32},a.moveBackward=function(e,t){if(e===this._newCommentButton)return this._commentManager.getCommentPaneFocusRegion().moveBackward(),32;if(t){if(e===t.containerElement){var n=this.isCurrentlyEditing;if(this._commentManager.model.getCommentBefore(t,!1)){if(!n){this._commentManager.selectPrevComment();var i=this._commentManager.model.selectedComment.commentViewObject.deleteButtonElement;return i&&this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(i),32}}else n||this._commentManager.clearSelection()}else if(-1!==e.className.indexOf(As.a.commentReplyButtonClassName)||-1!==e.className.indexOf(As.a.commentCancelButtonClassName))return this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t.containerElement),32}else if((-1!==e.className.indexOf(As.a.commentTaskPaneCloseClassName)||-1!==e.className.indexOf(As.a.commentPaneCloseButtonClassName))&&this._commentManager.model.hasComments())return this._commentManager.selectPrevComment(),32;return this._commentManager.getCommentPaneFocusRegion().moveBackward(),32},a.onClosePaneClick=function(e){return this._actionManager.processAction(h.a.hideCommentPane,2),!0},a.clearSelection=function(e){return this._focusManager.scopeChanged(kt.AFrame.commentPaneFocusId),this._commentManager&&2!==this._commentManager.mode&&3!==this._commentManager.mode&&this._commentManager.clearSelection(),!0},a.onNewCommentClick=function(e){return this._newCommentButton.disabled||this.addNewCommentInternal(),!0},a.addNewCommentInternal=function(){this._focusManager.scopeChanged(kt.AFrame.commentPaneFocusId),this._commentManager.addNewComment(null)},a.addNewComment=function(e,t,n,i,r){if(1===n)return this._commentManager&&1!==this._commentManager.mode?8:32;if(this.isVisible)this.addNewCommentInternal();else{var a=0;if(Object(ds.a)(Jo.a,r))a=r.inputMethod;var o=new Jo.a(r,a);this.addCommentOnRender=!0,this._actionManager.processActionWithData(h.a.showCommentPane,2,o)}return 32},a.editComment=function(e,t,n,i,r){if(1===n)return 1===this._commentManager.mode?32:8;if(this.isVisible){var a=this._commentManager.model.getComment(r);if(!a)return 8;a.onEdit()}else this.editCommentOnRender=!0,this._actionManager.processActionWithData(h.a.showCommentPane,2,r);return 32},a.selectNextComment=function(e,t,n,i,r){return 1===n||this._commentManager.selectNextComment(),32},a.selectPrevComment=function(e,t,n,i,r){return 1===n||this._commentManager.selectPrevComment(),32},a.renderNewOrEditingComment=function(t,n,i){var a=t.render(),o=[],s=0,l=0;if(n?(l=n.offsetTop,this.paneSurface.insertBefore(a,n)):this.paneSurface.appendChild(a),Array.add(o,a),i){var c=this.createGroupDivider(t);this.paneSurface.insertBefore(c,a),Array.add(o,c)}n&&(s=n.offsetTop-l),e.animateNewComment(o,n,s,Object(r.a)(this,this.onAfterFadeIn,"onAfterFadeIn"),Object(r.a)(this,this.onAfterMove,"onAfterMove")),t.commentType&&t.focus()},a.showWithoutFocus=function(){},e.animateNewComment=function(t,n,i,r,a){for(var o=0;o<t.length;o++){var s=t[o];n?Es.WacAirSpace.setAnimationClass(s,"WAC_DelayShowClass"):Es.WacAirSpace.setAnimationClass(s,"Shared_BasicClass");var l=new Fs.a(s);l.animateOpacity(0,1),Es.WacAirSpace.animate(l,null,r)}if(n){var c=e.getExistingMarginTopOnElement(n);n.style.position="relative",Es.WacAirSpace.setAnimationClass(n,"Shared_BasicClass");var u=new Is.a(n);u.animateY(c-i,c),Es.WacAirSpace.animate(u,null,a)}},e.animateDeleteComments=function(t,n,i,r,a){for(var o=0;o<t.length;o++){var s=t[o];Es.WacAirSpace.setAnimationClass(s,"Shared_BasicClass");var l=new ks.a(s);l.animateOpacity(1,0),Es.WacAirSpace.animate(l,null,r)}if(n){var c=e.getExistingMarginTopOnElement(n);n.style.position="relative",Es.WacAirSpace.setAnimationClass(n,"WAC_DelayMoveClass");var u=new Is.a(n);u.animateY(c,i+c),Es.WacAirSpace.animate(u,null,a)}},e.removeAllAnimationClasses=function(e){var t=e.className;if(t)for(var n=t.split(" "),i=0;i<n.length;i++){var r=n[i];r.startsWith(Es.WacAirSpace.animationClassPrefix)&&Sys.UI.DomElement.removeCssClass(e,r)}},e.getExistingMarginTopOnElement=function(e){var t=Ps.a.getCurrentStyle(e),n=0;return t&&t.marginTop&&(n=parseInt(t.marginTop),n=isNaN(n)?0:n),n},e.clearOpacity=function(e){H.a.isNonStandardsCompliantIE?e.style.filter="":e.style.opacity=""},t=e,(n=[{key:"addCommentOnRender",get:function(){return this._addCommentOnRender},set:function(e){this._addCommentOnRender=e,e||this.addNewCommentInternal()}},{key:"commentPaneBodyId",get:function(){return"CommentPane"}},{key:"isVisible",get:function(){return this._isVisible},set:function(e){this._isVisible=e}},{key:"paneSurface",get:function(){return this._paneSurface}},{key:"newCommentButton",get:function(){return this._newCommentButton}},{key:"f6Manager",get:function(){return this._f6Manager}},{key:"paneParent",get:function(){return this._paneParent}},{key:"pane",get:function(){return this._pane}},{key:"shouldCreateHeader",get:function(){return!0}},{key:"shouldCreateHeaderControls",get:function(){return!0}},{key:"emptyUIStringPart1",get:function(){return CommonUIStrings.l_CommentPaneEmpty1}},{key:"emptyUIStringPart2",get:function(){return CommonUIStrings.l_CommentPaneEmpty2}},{key:"isCurrentlyEditing",get:function(){return 2===this._commentManager.mode||3===this._commentManager.mode}}])&&Os(t.prototype,n),i&&Os(t,i),e}();function Ms(e,t){return(Ms=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Rs,"CommentPane",null,[4,259]);var Ds=function(e){var t,n;function i(t,n,i,a,o,s,l){var c;return c=e.call(this,n,a,o,s,l)||this,t.add_onResize(Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(c),c.resizeCommentPane,"resizeCommentPane")),c}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ms(t,n);var a=i.prototype;return a.resizeCommentPane=function(){var e=pr.App.instance.theConfig.commentPaneWidth-pr.App.instance.theConfig.commentPaneHorizontalBorderWidth;this.pane.style.width=e+"px",pr.App.get_activeAppFrame().isCommentPaneVisible&&(this.pane.style.visibility="visible"),this.pane.style.top="0",pr.App.get_activeAppFrame().isCommentPaneVisible?(pr.App.get_activeAppFrame().isCommentPaneTouchMode?Sys.UI.DomElement.addCssClass(this.pane,kt.AFrame.dynamicTouchModeCssClass):Sys.UI.DomElement.removeCssClass(this.pane,kt.AFrame.dynamicTouchModeCssClass),Qo.a.animateCommentPane(this.pane,!0,Object(r.a)(this,this.onAfterCommentPaneShow,"onAfterCommentPaneShow"))):Qo.a.animateCommentPane(this.pane,!1,Object(r.a)(this,this.onAfterCommentPaneHide,"onAfterCommentPaneHide"));var t=pr.App.get_activeAppFrame().workspace.getHeight(),n=this.paneSurface.offsetTop;this.paneSurface.style.height=t>n?t-n+"px":"0px"},a.onAfterCommentPaneShow=function(e){this.pane.style.visibility="visible",ao.a.instance.calculateOffset()},a.onAfterCommentPaneHide=function(e){this.pane.style.visibility="hidden",ao.a.instance.calculateOffset()},a.showCommentPane=function(e,t,n,i,r){if(1===n)return pr.App.isReadyForRibbon()?32:8;if(!pr.App.get_activeAppFrame().isCommentPaneVisible){ao.a.instance.hideSelection();var a=0;if(r)a=r.inputMethod;pr.App.get_activeAppFrame().showCommentPane(a)}return this.isVisible=!0,s.AFrameworkApplication.activeFrame.theF6Manager.activateFocus(kt.AFrame.commentPaneFocusId),this._commentManager.initiateCommentingSession(),pr.App.get_activeAppFrame().ribbonUser.poll(),32},a.addNewComment=function(t,n,i,r,a){return pr.App.isReadyForRibbon()?e.prototype.addNewComment.call(this,t,n,i,r,a):8},a.hideCommentPane=function(e,t,n,i,r){if(1===n)return 32;var a=pr.App.get_activeAppFrame();a.isCommentPaneVisible&&(ao.a.instance.hideSelection(),a.hideCommentPane(),this._commentManager.paneClosing());var o=Ft.FocusManager.instance();return o.currentScope&&o.currentScope.name===kt.AFrame.commentPaneFocusId&&o.setScope(o.defaultScopeName),s.AFrameworkApplication.activeFrame.theF6Manager.deactivateFocus(kt.AFrame.commentPaneFocusId),this.isVisible=!1,pr.App.get_activeAppFrame().ribbonUser.poll(),32},a.toggleCommentPane=function(e,t,n,i,r){return this.isVisible?this.hideCommentPane(e,t,n,i,r):this.showCommentPane(e,t,n,i,r)},a.queryToggleCommentPane=function(e,t,n,i,r){return 1===n||(r[aa.a.On]=pr.App.get_activeAppFrame().isCommentPaneVisible),32},a.getDividerLabel=function(e){return String.format(WordViewerIntl.WordViewerStrings.l_CommentPanePageLabel,e.groupNumber)},i.getInstance=function(){return i.getInstanceWithResolvedDependencies()},i.getInstanceWithResolvedDependencies=function(){return new i(s.AFrameworkApplication.activeFrame,s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.activeFrame.thePageManager,s.AFrameworkApplication.activeFrame.theClickInputManager,s.AFrameworkApplication.activeFrame.theKeyInputManager,s.AFrameworkApplication.activeFrame.theFocusManager,s.AFrameworkApplication.activeFrame.theF6Manager)},i}(Rs);function xs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ls(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bs(e,t){return(Bs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Ds,"ViewerCommentPane",Rs,[]);var Us=function(e){var t,n;function i(t,n,i,r,a){var o;return(o=e.call(this,i)||this)._fetchCommentsDataRetried=!1,o._fetchCommentsDataFailed=!1,o._hasSharedLock=!1,o._inCommentingSession=!1,o._beginCommentingServerOp=null,o._refreshLockTask=null,o._refreshLockServerOp=null,o._networkStatusToast=null,o._retryingBadCanary=!1,o._sessionReady=!1,o._retryCountBeginCommentingBusy=0,o._commentsDataReady=!1,o.copyingEnabled=pr.App.instance.copyingEnabled,o._currentMode=pr.App.instance.userCanComment&&!pr.App.instance.accessibleModeEnabled?1:0,i.addActionWithFlags(Cr.a.commentDownloadCorrupt,sa.a.application,yt.ActionManager.doNothingButReportHandler,64),i.addAction(h.a.commentHintClick,ue.a.frame,yt.ActionManager.doNothingButReportHandler),o._commentPane=Ds.getInstance(),o._commentModel=Cs.getInstance(),o._hintManager=os.getInstance(),o._hostPostmessengerLazy=r,o._commentPane.initialize(Ls(o),t),o._commentModel.initialize(Ls(o)),o._hintManager.initialize(n),o._focusManager=a,o._batchedServerOperationFactory=new Uo,o.fetchCommentData(),pr.App.get_activeAppFrame().workspace.setCommentManagerDisposable(Ls(o)),o}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Bs(t,n);var a,o,l,c=i.prototype;return c.dispose=function(){e.prototype.dispose.call(this),this._networkStatusToast&&(this._networkStatusToast.dispose(),this._networkStatusToast=null)},c.addNewComment=function(t){void 0===t&&(t=null),e.prototype.addNewComment.call(this,t),ao.a.instance.clearSelection()},c.selectComment=function(t,n){void 0===n&&(n=1),this.commentsDataReady&&!this._fetchCommentsDataFailed&&e.prototype.selectComment.call(this,t,n)},c.initiateCommentingSession=function(){if(this._inCommentingSession)this.pane.addCommentOnRender&&(this.pane.addCommentOnRender=!1);else{if(e.prototype.initiateCommentingSession.call(this),s.AFrameworkApplication.useRedeemForCommentingPostMessage){var t,n="wdcomments=1",i=pr.App.get_activeAppFrame().getTopParagraphId();i&&(n+="&wdparaid="+i),p.ULS.shipAssertTag(4994851,327,!!this._hostPostmessengerLazy.value),this._hostPostmessengerLazy.value.sendMessage(d.a.redeemForCommenting,((t={}).targetWacAction="View",t.wdparams=n,t))||pr.App.get_activeAppFrame().navigateToHostUrl(!0,s.AFrameworkApplication.copyAndEditUrl),s.AFrameworkApplication.useRedeemForCommentingPostMessage=!1}if(this._currentMode){if(!this._beginCommentingServerOp){this._retryCountBeginCommentingBusy=0;var a=this._batchedServerOperationFactory.getBatchedServerOperation(0,Object(r.a)(this,this.beginCommentingResponseHandler,"beginCommentingResponseHandler"));this._beginCommentingServerOp=new _o,this._beginCommentingServerOp.requestObject=qo.construct(pr.App.instance.baseDocQueryParam,da.a.instance.isNormalized),this._beginCommentingServerOp.status=mo.requestReady,a.addOperation(this._beginCommentingServerOp),a.dispatchRequest()}}else this._sessionReady||(this._sessionReady=!0,this.populateCommentPane())}},c.endCommentingSession=function(){if(this._inCommentingSession){var e=this._batchedServerOperationFactory.getBatchedServerOperation(0,null),t=new _o;t.requestObject=Ko.construct(pr.App.instance.baseDocQueryParam,this._hasSharedLock),t.status=mo.requestReady,e.addOperation(t),e.dispatchRequest(),this._inCommentingSession=!1,this._refreshLockTask&&!s.AFrameworkApplication.isShuttingDown&&(s.AFrameworkApplication.theTaskManager.deleteTask(this._refreshLockTask),this._refreshLockTask=null)}},c.beginCommentingResponseHandler=function(e){if(!s.AFrameworkApplication.isShuttingDown){if(5===this._beginCommentingServerOp.statusCode){if(this._retryingBadCanary){0,this.mode=0,this._sessionReady=!0,this.populateCommentPane();var t=new Nn.StandardDialog;return t.buttonsOption=0,t.showError(Wo.a.commentBeginCanaryFailure,CommonUIStrings.l_DefaultDialogTitle,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen,null),void no.a.propagateError(!1,"CommentBeginCanaryFailed",Wo.a.commentBeginCanaryFailure,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen)}return this._retryingBadCanary=!0,void e.dispatchRequest()}if(this._retryingBadCanary=!1,this._sessionReady=!0,2!==this._beginCommentingServerOp.statusCode||!this._beginCommentingServerOp.responseObjects){0,this.mode=0,this.populateCommentPane();var n=new Nn.StandardDialog;return n.buttonsOption=0,n.showError(Wo.a.commentBeginNetworkError,CommonUIStrings.l_DefaultDialogTitle,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen,null),void no.a.propagateError(!1,"CommentBeginNetworkError",Wo.a.commentBeginNetworkError,WordViewerIntl.WordViewerStrings.l_GenericErrorOpen)}0;var a=this._beginCommentingServerOp.responseObjects[this._beginCommentingServerOp.responseObjects.length-1];if(46===a.StatusCode&&this._retryCountBeginCommentingBusy++<i.maxRetryCountForBeginCommentingBusy)e.dispatchRequest();else if(a.StatusCode){var o,l,c;this.mode=0,this.populateCommentPane();var d=(o=i.getErrorInfoForBeginCommentFailure(a.StatusCode,l,c),l=o.helpMessage,c=o.errorCode,o).returnValue;if(d){var p=new Nn.StandardDialog;p.buttonsOption=0,l&&p.addHelpLink(WordViewerIntl.WordViewerStrings.l_LearnMore,l),p.showError(c,CommonUIStrings.l_DefaultDialogTitle,d,null),no.a.propagateError(!1,"CommentFailed",c,d)}else s.AFrameworkApplication.reportError(c)}else{if(a.Refresh){var g;switch(this.mode=0,this.populateCommentPane(),a.Refresh){case 1:case 2:g=WordViewerIntl.WordViewerStrings.l_CommentingNeedsRefresh;break;default:0,g=WordViewerIntl.WordViewerStrings.l_GenericErrorOpen}var m=new Nn.StandardDialog;return m.buttonsOption=1,m.setButtonText(1,WordViewerIntl.WordViewerStrings.l_Reload),void m.showInformation(CommonUIStrings.l_DefaultDialogTitle,g,Object(r.a)(this,this.reloadDialogHandler,"reloadDialogHandler"))}0,this._hasSharedLock=a.SharedLock,this._inCommentingSession=!0,s.AFrameworkApplication.theActionManager.processAction(h.a.commentBeginSucceeded,2),this.populateCommentPane(),this._refreshLockTask||(this._refreshLockTask=new u.a(3,2,6e5,Object(r.a)(this,this.refreshLockTimer,"refreshLockTimer")),s.AFrameworkApplication.theTaskManager.addTask(this._refreshLockTask))}}},c.reloadDialogHandler=function(e,t){1===e?(s.AFrameworkApplication.theActionManager.processAction(h.a.commentBeginRefresh,2),nt.a.openWindow(1,window.location.href)):(s.AFrameworkApplication.theActionManager.processAction(h.a.commentBeginRefreshRefused,2),this.mode=0)},c.fetchCommentData=function(){if(da.a.instance.hasComments){var e=po.a.urlForNamedObject("comments.xml");s.AFrameworkApplication.theClientRequestManager.addRequest(e,1,null,no.a.isPasswordProtectedDocumentSupportEnabledForViewer()?po.a.getHeaders():null,!0,2,Object(r.a)(this,this.onCommentRequestSucceeded,"onCommentRequestSucceeded"),Object(r.a)(this,this.onCommentRequestFail,"onCommentRequestFail"),null)}else this._commentsDataReady=!0},c.onCommentRequestSucceeded=function(e){this._commentsDataReady=!0,e.data.responseXml?(this._commentModel.updateContent(e.data.responseXml),this.populateCommentPane()):(s.AFrameworkApplication.theActionManager.processAction(Cr.a.commentDownloadCorrupt,2),this.mode=0,this._commentPane.showErrorUI()),s.AFrameworkApplication.theActionManager.processAction(h.a.commentDownloadSucceeded,2)},c.onCommentRequestFail=function(e){if(this._fetchCommentsDataRetried)this.onFetchCommentsDataFail();else{this._fetchCommentsDataRetried=!0;var t=po.a.urlForNamedObject("comments.xml"),n=new No.a(Object(r.a)(this,this.onStatusRequestSuccess,"onStatusRequestSuccess"),t,no.a.isPasswordProtectedDocumentSupportEnabledForViewer()?po.a.getHeaders():null);n.failureCallback=Object(r.a)(this,this.onStatusRequestFail,"onStatusRequestFail"),n.send()}},c.onStatusRequestSuccess=function(e){this.fetchCommentData()},c.onStatusRequestFail=function(){this.onFetchCommentsDataFail()},c.onFetchCommentsDataFail=function(){this.mode=0,this._commentsDataReady=!0,this._fetchCommentsDataFailed=!0,this._commentPane.showErrorUI(),s.AFrameworkApplication.theActionManager.processAction(h.a.commentDownloadFailed,2)},c.refreshLockTimer=function(e){var t=this._batchedServerOperationFactory.getBatchedServerOperation(3,Object(r.a)(this,this.refreshLockResponseHandler,"refreshLockResponseHandler"));this._refreshLockServerOp=new _o,this._refreshLockServerOp.requestObject=qo.construct(pr.App.instance.baseDocQueryParam,da.a.instance.isNormalized),this._refreshLockServerOp.status=mo.requestReady,t.addOperation(this._refreshLockServerOp),t.dispatchRequest()},c.refreshLockResponseHandler=function(e){if(!s.AFrameworkApplication.isShuttingDown){if(5===this._refreshLockServerOp.statusCode)return this._retryingBadCanary?void this.showNetworkLostToast():(this._retryingBadCanary=!0,void e.dispatchRequest());if(this._retryingBadCanary=!1,2===this._refreshLockServerOp.statusCode&&this._refreshLockServerOp.responseObjects)0,this._refreshLockServerOp.responseObjects[0].StatusCode?this.showNetworkLostToast():this.hideNetworkLostToast();else this.showNetworkLostToast()}},c.showNetworkLostToast=function(){this._networkStatusToast||(this._networkStatusToast=pr.App.get_activeAppFrame().notificationBar.createEntry(CommonUIStrings.l_NetworkProblemToast,!0),pr.App.get_activeAppFrame().notificationBar.addEntry(this._networkStatusToast))},c.hideNetworkLostToast=function(){this._networkStatusToast&&(pr.App.get_activeAppFrame().notificationBar.removeEntry(this._networkStatusToast),this._networkStatusToast.dispose(),this._networkStatusToast=null)},c.populateCommentPane=function(){this.commentsDataReady&&this._sessionReady&&!this._fetchCommentsDataFailed&&(this._commentPane.showComments(this._commentModel.getAllComments()),this.pane.addCommentOnRender&&(this.pane.addCommentOnRender=!1))},i.getInstance=function(){return i.getInstanceWithResolvedDependencies()},i.getInstanceWithResolvedDependencies=function(){return pr.App.instance.fileTypeSupportsCommenting&&!s.AFrameworkApplication.isEmbedded&&!s.AFrameworkApplication.isNoChrome&&pr.App.get_activeAppFrame().workspace&&pr.App.get_activeAppFrame().workspace.appBaseDom&&pr.App.get_activeAppFrame().workspace.initialized?new i(pr.App.get_activeAppFrame().workspace.appBaseDom,j.a.instance.resolve("WordViewer.Controls.IScrollControl").scroller,s.AFrameworkApplication.theActionManager,j.a.instance.resolveLazy("Postmessage.IHostPostmessenger"),Ft.FocusManager.instance()):null},i.getErrorInfoForBeginCommentFailure=function(e,t,n){switch(t=null,e){case 1:return n=Wo.a.commentBeginInvalidPropertyData,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorOpen,helpMessage:t,errorCode:n};case 7:return{returnValue:null,helpMessage:t,errorCode:n=Wo.a.commentBeginPermissionDenied};case 14:return n=Wo.a.commentBeginUnspecifiedFailure,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorOpen,helpMessage:t,errorCode:n};case 36:return n=Wo.a.commentBeginOldProductDigitalSignature,{returnValue:WordViewerIntl.WordViewerStrings.l_OldProductDigitalSignatureOpen,helpMessage:t,errorCode:n};case 9:return n=Wo.a.commentBeginDocumentProtectionSettings,{returnValue:WordViewerIntl.WordViewerStrings.l_DocumentProtectionSettingsCommentOpen,helpMessage:t,errorCode:n};case 30:return n=Wo.a.commentBeginDocumentPasswordEncrypted,{returnValue:WordViewerIntl.WordViewerStrings.l_DocumentPasswordEncryptedOpen,helpMessage:t,errorCode:n};case 31:return n=Wo.a.commentBeginFileCheckedOut,{returnValue:WordViewerIntl.WordViewerStrings.l_CheckedOutOpen,helpMessage:t,errorCode:n};case 17:return n=Wo.a.commentBeginFileRequiresCheckout,{returnValue:WordViewerIntl.WordViewerStrings.l_RequiresCheckoutOpen,helpMessage:t,errorCode:n};case 16:return n=Wo.a.commentBeginFileLockedForOfflineCheckout,{returnValue:WordViewerIntl.WordViewerStrings.l_LockedForOfflineCheckoutOpen,helpMessage:t,errorCode:n};case 11:return n=Wo.a.commentBeginFileLockedByOtherInterface,t=WordViewerIntl.WordViewerStrings.l_CoauthHelpContextId,{returnValue:WordViewerIntl.WordViewerStrings.l_LockedByOtherInterfaceOpen,helpMessage:t,errorCode:n};case 12:return n=Wo.a.commentBeginCorruptedFile,{returnValue:WordViewerIntl.WordViewerStrings.l_CorruptFileOpen,helpMessage:t,errorCode:n};case 57:return n=Wo.a.commentBeginNumberOfCoauthorsReachedMax,{returnValue:WordViewerIntl.WordViewerStrings.l_NumberOfCoauthorsReachedMaxOpen,helpMessage:t,errorCode:n};case 61:return n=Wo.a.commentBeginDocumentMarkedFinal,{returnValue:WordViewerIntl.WordViewerStrings.l_DocumentMarkedFinalOpen,helpMessage:t,errorCode:n};case 38:return n=Wo.a.commentBeginPreReleaseFile,{returnValue:WordViewerIntl.WordViewerStrings.l_PreReleaseFile,helpMessage:t,errorCode:n};case 69:return n=Wo.a.commentBeginClientServerNormalizationConflict,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorOpen,helpMessage:t,errorCode:n};case 35:return n=Wo.a.commentBeginLockExpired,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorOpen,helpMessage:t,errorCode:n};case 47:return n=Wo.a.commentBeginWordFileVersionMismatch,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorOpen,helpMessage:t,errorCode:n};case 39:return n=Wo.a.commentBeginFileEditedInRichClient,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorOpen,helpMessage:t,errorCode:n};case 33:return n=Wo.a.commentBeginRequestCountTooLarge,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorOpen,helpMessage:t,errorCode:n};default:return n=Wo.a.commentBeginUnspecifiedFailure,{returnValue:WordViewerIntl.WordViewerStrings.l_GenericErrorOpen,helpMessage:t,errorCode:n}}},a=i,(o=[{key:"hasSharedLock",get:function(){return this._hasSharedLock}},{key:"commentsDataReady",get:function(){return this._commentsDataReady}}])&&xs(a.prototype,o),l&&xs(a,l),i}(ho.a);function Hs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Us.maxRetryCountForBeginCommentingBusy=2,Object(i.a)(Us,"ViewerCommentManager",ho.a,[]);var Ns=function(){function e(){}var t,n,i,a=e.prototype;return a.configure=function(e){},a.init=function(){s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(Object(r.a)(this,this.onFullAppSettingsReady,"onFullAppSettingsReady"))},a.onFullAppSettingsReady=function(){ho.a.factory=Us.getInstance,Z.a.registerDispatchHandler(e.dispatcher);ho.a.instance;(s.AFrameworkApplication.appSettingsManager.appSettings.BootActivityNavigationId?s.AFrameworkApplication.appSettingsManager.appSettings.BootActivityNavigationId.toString():null)&&p.ULS.sendTraceTag(37291602,327,15,"Deep linking for word viewer."),pr.App.get_activeAppFrame()&&pr.App.get_activeAppFrame().ribbonUser&&pr.App.get_activeAppFrame().ribbonUser.poll()},a.dispose=function(){},e.main=function(){S.a.instance.registerPackage(new e)},e.dispatcher=function(e,t,n,i,r){return e===h.a.showCommentPane?ho.a.instance.showCommentPane(e,t,n,i,r):e===Cr.a.toggleCommentPane?ho.a.instance.toggleCommentPane(e,t,n,i,r):2},t=e,(n=[{key:"name",get:function(){return"WordViewer.Comments"}}])&&Hs(t.prototype,n),i&&Hs(t,i),e}();function Ws(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Ns,"Program",null,[16,17]);var js=function(){function e(){}var t,n,i;return e.prototype.clickHandler=function(e){return p.ULS.sendTraceTag(37034014,342,50,"User clicked on the Privacy statement."),nt.a.safelyOpenWindow(this.privacyLink,"_blank",void 0,"SendUsYourFileDialog.PrivacyLink"),!0},t=e,(n=[{key:"privacyLink",get:function(){return s.AFrameworkApplication.privacyUrl}}])&&Ws(t.prototype,n),i&&Ws(t,i),e}();Object(i.a)(js,"PrivacyLinkHandler",null,[497]);var Vs=n(433),qs=function(){function e(e,t){this._onDone=null,this._sendUsYourFileManager=e,this._sendUsYourFileDialogFactory=t}var t=e.prototype;return t.showDialog=function(e){this._onDone=e,this._sendUsYourFileDialogFactory.create().initializeAndShow(Object(r.a)(this,this.handleDialog,"handleDialog"))},t.handleDialog=function(e,t){e===Vs.a.ok&&this._sendUsYourFileManager.sendRequestToAcquireFile(),this._onDone()},e}();Object(i.a)(qs,"SendUsYourFileController",null,[181]);var Gs=n(559);function Ks(e,t){return(Ks=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var zs=function(e){var t,n;function i(t,n,i){var r;return(r=e.call(this)||this)._privacyLink=null,r._clickInputManager=t,r._privacyLinkHandler=n,r._dialogStrings=i,r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ks(t,n);var a=i.prototype;return a.initializeAndShow=function(e){this.buttonsOption=Gs.a.okCancel,this.setButtonText(Vs.a.ok,this._dialogStrings.send),this.setButtonText(Vs.a.cancel,this._dialogStrings.noThanks),p.ULS.shipAssertTag(37034013,342,!this._privacyLink,"privacy anchor should be null before initializing it.");var t=this.dialogContent();this.messageBoxImpl(this._dialogStrings.appTitle,null,"CancelRequest_32x32x32",null,e,t),this.setDescribedByForDialog(this.myId(i.sendUsYourFileId))},a.dialogContent=function(){var e=document.createElement("span");e.innerText=this._dialogStrings.problemOpeningDocument;var t=document.createElement("span");t.innerText=this._dialogStrings.tellMicrosoftAboutThis,t.style.fontWeight=this._dialogStrings.userInterfaceFontWeightBold;var n=document.createElement("span");n.innerText=this._dialogStrings.sendUsYourFileDialogText;var r=this.constructPrivacyLinkSpan(),a=document.createElement("span");return a.id=this.myId(i.sendUsYourFileId),a.appendChild(e),a.appendChild(document.createElement("br")),a.appendChild(document.createElement("br")),a.appendChild(t),a.appendChild(document.createElement("br")),a.appendChild(n),a.appendChild(document.createElement("br")),a.appendChild(document.createElement("br")),a.appendChild(document.createElement("br")),a.appendChild(r),a},a.constructPrivacyLinkSpan=function(){var e=document.createElement("span"),t=document.createElement("a");return t.innerText=this._dialogStrings.privacyStatement,t.href=this._privacyLinkHandler.privacyLink,e.appendChild(t),this._privacyLink=t,this._clickInputManager.registerHandler(f.a.click,this._privacyLink,Object(r.a)(this._privacyLinkHandler,this._privacyLinkHandler.clickHandler,"clickHandler")),e},a.dispose=function(){this._privacyLink&&(this._clickInputManager.unregisterHandler(f.a.click,this._privacyLink,Object(r.a)(this._privacyLinkHandler,this._privacyLinkHandler.clickHandler,"clickHandler")),this._privacyLink=null),e.prototype.dispose.call(this)},i}(Nn.StandardDialog);zs.sendUsYourFileId="sendUsYourFileId",Object(i.a)(zs,"SendUsYourFileDialog",Nn.StandardDialog,[480]);var Xs=function(){function e(){}return e.prototype.create=function(){return j.a.instance.resolve("Wac.Common.SendUsYourFile.ISendUsYourFileDialog")},e}();function Js(e,t){return(Js=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Xs,"Factory",null,[498]);var Qs=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Js(t,n),i.prototype.getClassId=function(){return 38},i.construct=function(e){var t=new i;return t.FileId=e,t},i}(jo);Object(i.a)(Qs,"CreateSendUsYourFileRequest",jo,[]);var Zs=function(){function e(e,t,n){this._batchedServerOperationFactory=e,this._getRootQuerySignature=t,this._logSendingRequest=n}var t=e.prototype;return t.sendRequestToAcquireFile=function(e){var t=this;if(void 0===e&&(e=!1),this._getRootQuerySignature){var n,i=Qs.construct(this._getRootQuerySignature()),r=new _o;if(r.requestObject=i,r.status=1,r.perfTag="BootErrorReport",e)n=this._batchedServerOperationFactory(null);else{n=this._batchedServerOperationFactory((function(e){t.responseHandler(r,e)}))}n.addOperation(r),n.dispatchRequest(),this._logSendingRequest()}},t.responseHandler=function(e,t){e.statusCode===tt.preConditionFailed&&this.sendRequestToAcquireFile(!0)},e}();Object(i.a)(Zs,"SendUsYourFileManager",null,[182]);var Ys=function(){function e(e,t){this._container=null,this._dialogStrings=e,this._getRootQuerySignature=t}var t=e.prototype;return t.configure=function(e){var t=this;this._container=e,this._container.register(207,"Wac.Common.SendUsYourFile.ISendUsYourFileDialogStrings").singleInstance().usingFactory((function(){return t._dialogStrings})),this._container.register(480,"Wac.Common.SendUsYourFile.ISendUsYourFileDialog").usingFactory((function(){return new zs(Or.a.instance,new js,t._container.resolve("Wac.Common.SendUsYourFile.ISendUsYourFileDialogStrings"))})),this._container.register(182,"Wac.Common.SendUsYourFile.ISendUsYourFileManager").usingFactory((function(){return new Zs((function(e){return t.getBatchedServerOperation(So.a.realtime,e)}),t._getRootQuerySignature,(function(){p.ULS.sendTraceTag(42022664,342,50,"send us your file request is now sent.")}))})),this._container.register(181,"Wac.Common.SendUsYourFile.ISendUsYourFileController").singleInstance().usingFactory((function(){var e=new Xs;return new qs(t._container.resolve("Wac.Common.SendUsYourFile.ISendUsYourFileManager"),e)}))},t.init=function(){this._container.resolve("Wac.Common.SendUsYourFile.ISendUsYourFileController")},t.dispose=function(){},e}();Object(i.a)(Ys,"SendUsYourFilePackageManager",null,[]);function $s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var el=function(){function e(){}var t,n,i;return t=e,(n=[{key:"appTitle",get:function(){return CommonUIStrings.l_AppTitle}},{key:"send",get:function(){return CommonUIStrings.l_Send}},{key:"noThanks",get:function(){return CommonUIStrings.l_NoThanks}},{key:"problemOpeningDocument",get:function(){return WordViewerIntl.WordViewerStrings.L_ProblemOpeningDocument}},{key:"tellMicrosoftAboutThis",get:function(){return WordViewerIntl.WordViewerStrings.L_TellMicrosoftAboutThis}},{key:"userInterfaceFontWeightBold",get:function(){return CommonUIStrings.l_UserInterfaceFontWeightBold}},{key:"sendUsYourFileDialogText",get:function(){return WordViewerIntl.WordViewerStrings.L_SendUsYourFileDialogText}},{key:"privacyStatement",get:function(){return CommonUIStrings.l_PrivacyStatement}}])&&$s(t.prototype,n),i&&$s(t,i),e}();function tl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function nl(e,t){return(nl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(el,"WordViewerSendUsYourFileDialogStrings",null,[207]);var il=function(e){var t,n,i,r,a;function o(){return e.call(this,new el,(function(){return pr.App.instance.baseDocQueryParam}))||this}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,nl(t,n),o.prototype.getBatchedServerOperation=function(e,t){return new Bo(e,t,"SendUsYourFile.ashx",pr.App.mode,pr.App.webServiceBase)},o.main=function(){S.a.instance.registerPackage(new o)},i=o,(r=[{key:"name",get:function(){return"WordViewer.SendUsYourFile"}}])&&tl(i.prototype,r),a&&tl(i,a),o}(Ys);Object(i.a)(il,"PackageManager",Ys,[16,17]);var rl=function(){function e(){this._isAppFullyLoaded=!1}var t=e.prototype;return t.markAppAsFullyLoaded=function(){this._isAppFullyLoaded=!0},t.isAppFullyLoaded=function(){return this._isAppFullyLoaded},e.getAnInstanceWithResolvedDependencies=function(){return new en.a((function(){return new e}))},e.get_instance=function(){return e._instance.value},e}();function al(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}rl._instance=rl.getAnInstanceWithResolvedDependencies(),Object(i.a)(rl,"AppLoadStateTracker",null,[]);var ol=function(){function e(){}var t,n,i,r=e.prototype;return r.configure=function(e){},r.init=function(){rl.get_instance().markAppAsFullyLoaded()},r.dispose=function(){},t=e,(n=[{key:"name",get:function(){return"AppLoadStateTracker"}}])&&al(t.prototype,n),i&&al(t,i),e}();Object(i.a)(ol,"AppLoadStateTrackerPackage",null,[20,21]);var sl=n(150);function ll(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var cl=function(){function e(){}var t,n,i;return e.getAppStoreURL=function(t,n){switch(t){case 3:return e.getWordURLForPlatform(n);case 2:return e.getPPTURLForPlatform(n);case 1:return e.getExcelURLForPlatform(n)}return""},e.getWordURLForPlatform=function(e){switch(e){case 1:case 2:return s.AFrameworkApplication.appSettingsManager.appSettings.WildFireAdjustLinkWordWac.toString()}return""},e.getPPTURLForPlatform=function(e){switch(e){case 1:case 2:return s.AFrameworkApplication.appSettingsManager.appSettings.WildFireAdjustLinkPptWac.toString()}return""},e.getExcelURLForPlatform=function(e){switch(e){case 1:case 2:return s.AFrameworkApplication.appSettingsManager.appSettings.WildFireAdjustLinkExcelWac.toString()}return""},e.openInClient=function(t,n,i){(H.a.isIPad||H.a.isAndroid)&&(window.setTimeout((function(){e.redirectToStore(i,e.getWildFirePlatform())}),500),MSOJS.ClientUtils.OpenDocumentWithProtocolHandlerNoCallBack(e.appTypeToApplication(i),t,0,!1))},e.clientRedirect=function(t,n,i,r){n&&r&&r(),e.openInClient(t,n,i)},e.getWildFirePlatform=function(){return H.a.isIPad?1:H.a.isAndroid?2:H.a.isWindows?3:H.a.isMac?4:0},e.getWildFireConfigSettingName=function(e){switch(e){case 3:return"WildFireWordBizBar";case 2:return"WildFirePowerPointBizBar";case 1:return"WildFireExcelBizBar";default:return""}},e.getWildFireFlightSettingName=function(e){switch(e){case 3:return"WildFireWordBizBarFlight";case 2:return"WildFirePowerPointBizBarFlight";case 1:return"WildFireExcelBizBarFlight";default:return""}},e.redirectToStore=function(t,n){if(1===n){p.ULS.sendTraceTag(17151569,306,50,"User Directed to App Store");var i=e.getAppStoreURL(t,n);H.a.iPadOsVersion>8?nt.a.safelyOpenWindow(i,void 0,void 0,"RedirectToAppStore"):nt.a.followHyperlinkWithNoReferrer(i)}else{if(document.hidden)return;if(e.isLocaleChina){var r=s.AFrameworkApplication.appSettingsManager.appSettings.WildFireUrlChinaStoreAndroid.toString();r?(p.ULS.sendTraceTag(18088018,306,50,"User Directed to China Proxy Page"),nt.a.followHyperlinkWithNoReferrer(r)):p.ULS.sendTraceTag(18088019,306,50,"Empty Url in China Proxy Page BRS Setting")}else p.ULS.sendTraceTag(18088020,306,50,"User Directed to Play Store"),MSOJS.ClientUtils.NavigateToUrlUsingClickingOnATag(e.getAppStoreURL(t,n),null,null)}},e.appTypeToApplication=function(e){switch(e){case 3:return 5;case 2:return 3;case 1:return 1;default:return 0}},e.getBizBarDismissKeyForApplication=function(e){switch(e){case 3:return"WordBizBarDismiss";case 2:return"PptBizBarDismiss";case 1:return"ExcelBizBarDismiss";default:return""}},e.isLocalStorageValueTrue=function(t){var n=e.getItemFromLocalStore(t);return!(!n||""===n)&&Boolean.parse(n)},e.setTrueInLocalStore=function(t){e.setItemInLocalStore(t,"true")},e.getItemFromLocalStore=function(e){try{return localStorage.getItem(e)}catch(e){return p.ULS.sendTraceTag(18416668,306,50,"WildFire LocalStorage GetItem Failed with NullReferenceException : "+e.message),null}},e.setItemInLocalStore=function(e,t){try{localStorage.setItem(e,t)}catch(e){p.ULS.sendTraceTag(18416669,306,50,"WildFire LocalStorage SetItem Failed with exception : "+e.message)}},t=e,i=[{key:"isLocaleChina",get:function(){return"zh-CN"===window.navigator.language}},{key:"shouldUseChromeBar",get:function(){return(H.a.isWindows||H.a.isMac)&&H.a.isChrome}},{key:"shouldShowWildFireUI",get:function(){return H.a.isIPad||H.a.isAndroid}}],(n=null)&&ll(t.prototype,n),i&&ll(t,i),e}();cl.chomeExtensionBarDismissKey="ChromeExtensionBarDismiss",Object(i.a)(cl,"WildFireUtilities",null,[]);var ul=function(){function e(){}var t=e.prototype;return t.add=function(e,t){this.set_item(e,t)},t.get=function(e){return this.get_item(e)},t.getOrElse=function(e,t){var n,i;return(n=this.tryGetValue(e,i),i=n.value,n).returnValue?i:t},t.logString=function(e,t){void 0===e&&(e=" "),void 0===t&&(t=":");var n=!0,i=new Sys.StringBuilder;return this.forEach((function(r,a){return n?n=!1:i.append(e),i.append(r?r.toString():""),i.append(t),i.append(a?a.toString():""),!0})),i.toString()},e}();Object(i.a)(ul,"AXDictionary",null,[210]);var dl=function(e,t){this.key=e,this.value=t};Object(i.a)(dl,"XDictionaryEntry",null,[]);var hl=function(){function e(){}var t=e.prototype;return t.any=function(e){void 0===e&&(e=null);for(var t=0;t<this.length;t++)if(!e||e(this.get_item(t)))return!0;return!1},t.contains=function(e,t){var n=!1;return this.forEach((function(i){return!t(e,i)||(n=!0,!1)})),n},t.getItemAt=function(e){return this.get_item(e)},t.last=function(){return this.get_item(this.length-1)},t.forEach=function(e){for(var t=0;t<this.length&&e(this.get_item(t));t++);},t.areEqual=function(e,t){if(!e)return!1;if(e.length!==this.length)return!1;for(var n=0;n<this.length;n++)if(!t(this.get_item(n),e.get_item(n)))return!1;return!0},t.isInsertionIndexInvalid=function(e){return e<0||e>this.length},t.fillHashSet=function(e){this.forEach((function(t){return e.add(t),!0}))},t.logString=function(e){void 0===e&&(e=" ");var t=!0,n=new Sys.StringBuilder;return this.forEach((function(i){return t?t=!1:n.append(e),n.append(i?i.toString():""),!0})),n.toString()},e}();Object(i.a)(hl,"AXList",null,[209]);var pl=function(){function e(){}return e.prototype.containsAll=function(e){var t=this;if(!e)return!0;var n=!0;return e.forEach((function(e){return n=t.contains(e)})),n},e}();function gl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ml(e,t){return(ml=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(pl,"AXHashSet",null,[208]);var fl=function(e){var t,n;function i(){var t;return(t=e.call(this)||this)._collection={},t._count=0,t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ml(t,n);var r,a,o,s=i.prototype;return s.set_count=function(e){return this._count=e,e},s.add=function(e){e.toString()in this._collection||(this.set_count(this.count+1),this._collection[e.toString()]=!0)},s.remove=function(e){var t=e.toString();t in this._collection&&(this.set_count(this.count-1),delete this._collection[t])},s.contains=function(e){return e.toString()in this._collection},r=i,(a=[{key:"count",get:function(){return this._count}}])&&gl(r.prototype,a),o&&gl(r,o),i}(pl);function _l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function vl(e,t){return(vl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(fl,"XHashSet",pl,[]);var yl=function(e){var t,n;function i(t){var n;return void 0===t&&(t=null),(n=e.call(this)||this)._list=t||[],n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,vl(t,n);var r,a,o,s=i.prototype;return s.get_item=function(e){return this._list[e]},s.shallowClone=function(){return new i(Array.clone(this._list))},s.add=function(e){Array.add(this._list,e)},s.insert=function(e,t){if(this.isInsertionIndexInvalid(e))throw Error.argument(String.format("ArgumentException: [index: {0}] [length: {1}] [item: {2}]",e,this.length,t));Array.insert(this._list,e,t)},s.insertRange=function(e,t){if(this.isInsertionIndexInvalid(e))throw Error.argument(String.format("ArgumentException: [index: {0}] [length: {1}]",e,this.length));for(var n=t.length-1;n>=0;n--)Array.insert(this._list,e,t.getItemAt(n))},s.deleteAt=function(e){if(e<0||e>=this.length)throw Error.argument(String.format("ArgumentException: [index: {0}] [length: {1}]",e,this.length));Array.removeAt(this._list,e)},s.toHashSet=function(){var e=new fl;return this.fillHashSet(e),e},s.toArray=function(){return this._list},s.reverse=function(){this._list.reverse()},s.clear=function(){Array.clear(this._list)},s.toArrayList=function(){return this._list},r=i,(a=[{key:"length",get:function(){return this._list.length}}])&&_l(r.prototype,a),o&&_l(r,o),i}(hl);function Sl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function bl(e,t){return(bl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(yl,"XList",hl,[]);var Cl=function(e){var t,n;function i(t){var n;return void 0===t&&(t=null),(n=e.call(this)||this)._count=0,n._defaultValue=t,n._dictionary={},n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,bl(t,n);var r,a,o,s=i.prototype;return s.get_item=function(e){var t=this._dictionary[e.toString()];return t?t.value:this._defaultValue},s.set_item=function(e,t){return this.containsKey(e)||this.set_count(this.count+1),this._dictionary[e.toString()]=new dl(e,t),t},s.set_count=function(e){return this._count=e,e},s.remove=function(e){this.containsKey(e)&&(this.set_count(this.count-1),delete this._dictionary[e.toString()])},s.containsKey=function(e){return e.toString()in this._dictionary},s.tryGetValue=function(e,t){return e.toString()in this._dictionary?{returnValue:!0,value:this.get(e)}:{returnValue:!1,value:this._defaultValue}},s.forEach=function(e){var t=this._dictionary;for(var n in t){var i={key:n,value:t[n]}.value;if(!e(i.key,i.value))break}},s.toList=function(e){var t=new yl,n=this._dictionary;for(var i in n){var r={key:i,value:n[i]}.value;t.add(e(r))}return t},s.toSerializableDictionary=function(){var e={},t=this._dictionary;for(var n in t){var i={key:n,value:t[n]},r=i.value;e[i.key]=r.value}return e},i.createFromSerializableDictionary=function(e,t,n,r){void 0===r&&(r=null);var a=new i(r);for(var o in e){var s={key:o,value:e[o]};a.add(t(s.key),n(s.value))}return a},r=i,(a=[{key:"count",get:function(){return this._count}},{key:"keys",get:function(){return this.toList((function(e){return e.key}))}},{key:"values",get:function(){return this.toList((function(e){return e.value}))}}])&&Sl(r.prototype,a),o&&Sl(r,o),i}(ul);function Al(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Cl,"XDictionary",ul,[]);var Tl=function(){function e(){this._androidWordStrings=new Cl,this._androidPowerPointStrings=new Cl,this._androidExcelStrings=new Cl,this.buildAndroidWordDictionary(this._androidWordStrings),this.buildAndroidPowerPointDictionary(this._androidPowerPointStrings),this.buildAndroidExcelDictionary(this._androidExcelStrings),this._iPadWordStrings=new Cl,this._iPadPowerPointStrings=new Cl,this._iPadExcelStrings=new Cl,this.buildiOSWordDictionary(this._iPadWordStrings),this.buildiOSPowerPointDictionary(this._iPadPowerPointStrings),this.buildiOSExcelDictionary(this._iPadExcelStrings),this._chromeExtensionStrings=new Cl,this.buildChromeExtensionDictionary(this._chromeExtensionStrings),this.addCommonStrings(this._chromeExtensionStrings),this.addCommonStrings(this._androidExcelStrings),this.addCommonStrings(this._androidPowerPointStrings),this.addCommonStrings(this._androidWordStrings),this.addCommonStrings(this._iPadPowerPointStrings),this.addCommonStrings(this._iPadWordStrings),this.addCommonStrings(this._iPadExcelStrings)}var t,n,i,r=e.prototype;return r.getStrings=function(e,t){switch(e){case 1:return this.getiPadStringsForApp(t);case 2:return this.getAndroidStringsForApp(t)}return cl.shouldUseChromeBar?this._chromeExtensionStrings:null},r.buildAndroidWordDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFireWordBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFireWordBizBarAndroidCallToAction)},r.buildAndroidPowerPointDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFirePPTBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFirePPTBizBarAndroidCallToAction)},r.buildAndroidExcelDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFireExcelBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFireExcelBizBarAndroidCallToAction)},r.buildiOSWordDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFireWordBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("InstallButton",CommonUIStrings.l_WildFireBizBarInstallButtonText),e.add("OpenAppButton",CommonUIStrings.l_WildFireBizBarOpenAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFireWordBizBarIPadCallToAction),e.add("OverlayBig","Get the Word app"),e.add("OverlaySmall","Built for the iPad\u2014for when you're working on the go, even offline."),e.add("OverlaySmallSplit1","Discover Word"),e.add("OverlaySmallSplit2","designed for the iPad."),e.add("SkipButton","Skip for now")},r.buildChromeExtensionDictionary=function(e){e.add("Headline","Get the Office Online extension for Chrome"),e.add("UseAppButton","Get the extension"),e.add("CallToAction","The quickest way to view, edit, and share Office files in Chrome.")},r.buildiOSPowerPointDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFirePPTBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("InstallButton",CommonUIStrings.l_WildFireBizBarInstallButtonText),e.add("OpenAppButton",CommonUIStrings.l_WildFireBizBarOpenAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFirePPTBizBarIPadCallToAction),e.add("OverlayBig","Get the PowerPoint app"),e.add("OverlaySmall","Built for the iPad\u2014for when you're working on the go, even offline."),e.add("OverlaySmallSplit1","Discover PowerPoint"),e.add("OverlaySmallSplit2","designed for the iPad."),e.add("SkipButton","Skip for now")},r.buildiOSExcelDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFireExcelBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("InstallButton",CommonUIStrings.l_WildFireBizBarInstallButtonText),e.add("OpenAppButton",CommonUIStrings.l_WildFireBizBarOpenAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFireExcelBizBarIPadCallToAction)},r.addCommonStrings=function(e){e.add("Corporation","Microsoft Corporation")},r.getiPadStringsForApp=function(e){switch(e){case 3:return this._iPadWordStrings;case 2:return this._iPadPowerPointStrings;case 1:return this._iPadExcelStrings}return null},r.getAndroidStringsForApp=function(e){switch(e){case 3:return this._androidWordStrings;case 2:return this._androidPowerPointStrings;case 1:return this._androidExcelStrings}return null},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}],(n=null)&&Al(t.prototype,n),i&&Al(t,i),e}();function wl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Tl._instance=null,Object(i.a)(Tl,"WildFireStringFactory",null,[]);var kl=function(){function e(e,t,n,i,r,a){void 0===r&&(r=null),void 0===a&&(a=null),this._openURL=null,this._id=e,this._platform=t,this._getURL=r,this._isEdit=i,this._saveAction=a,this._appLinkBar=null,this._useTwoButton=n,this._stringsDict=Tl.instance.getStrings(t,e)}var t,n,i,a=e.prototype;return a.createBusinessBarEntry=function(){this._appLinkBar=new sl.a(this.title,this.message,null),this._appLinkBar.addButton(this.buttonOneText,Object(r.a)(this,this.onButtonOneClick,"onButtonOneClick"),""),this._useTwoButton&&this._appLinkBar.addSecondButton(this.buttonTwoText,Object(r.a)(this,this.onButtonTwoClick,"onButtonTwoClick"),""),this._appLinkBar.closeHandler=Object(r.a)(this,this.dismissBar,"dismissBar"),this._appLinkBar.image=3,this._appLinkBar.id=16,this._appLinkBar.closeable=!0},a.onButtonOneClick=function(e){this._useTwoButton?this.installAppButtonClick(e):this.useAppButtonClick(e)},a.onButtonTwoClick=function(e){this._useTwoButton&&this.openAppButtonClick(e)},a.installAppButtonClick=function(e){p.ULS.sendTraceTag(17932829,306,50,"Install App Button of BusinessBar Clicked"),this._isEdit&&this._saveAction&&this._saveAction(),cl.redirectToStore(this._id,this._platform)},a.openAppButtonClick=function(e){this.openUrl&&(p.ULS.sendTraceTag(17932830,306,50,"Open App Button of BusinessBar Clicked"),this._isEdit&&this._saveAction&&this._saveAction(),MSOJS.ClientUtils.OpenDocumentWithProtocolHandlerNoCallBack(cl.appTypeToApplication(this._id),this.openUrl,0,!1))},a.useAppButtonClick=function(e){cl.shouldUseChromeBar?this.buttonClickChromeExtension(e):(p.ULS.sendTraceTag(17109255,306,50,"AppBusinessBarNav"),cl.setTrueInLocalStore("BizBarClicked"),1!==this._platform&&2!==this._platform||cl.clientRedirect(this.openUrl,this._isEdit,this._id,this._saveAction))},a.buttonClickChromeExtension=function(e){this._isEdit?p.ULS.sendTraceTag(17571974,323,50,"ChromeExtBannerClicked"):p.ULS.sendTraceTag(17571975,301,50,"ChromeExtBannerClicked"),nt.a.followHyperlinkWithNoReferrer(s.AFrameworkApplication.appSettingsManager.appSettings.WildFireChromeExtensionUrl.toString())},a.dismissBarChromeExtension=function(e){this._isEdit?p.ULS.sendTraceTag(17571976,323,50,"ChromeExtBannerDismissed"):p.ULS.sendTraceTag(17571977,301,50,"ChromeExtBannerDismissed"),cl.setTrueInLocalStore(cl.chomeExtensionBarDismissKey)},a.dismissBar=function(e){cl.shouldUseChromeBar?this.dismissBarChromeExtension(e):(cl.setTrueInLocalStore(cl.getBizBarDismissKeyForApplication(this._id)),p.ULS.sendTraceTag(17109256,306,50,"AppBusinessBarDismissed"))},e.createWildFireBusinessBar=function(){var t=s.AFrameworkApplication.activeFrame.applicationInstance,n=(s.AFrameworkApplication.appSettingsManager,t.officeAppType),i=1===t.officeAppMode,r=cl.getWildFirePlatform(),a=t.saveAction(),o=new e(n,r,H.a.iPadOsVersion>8,i,(function(){return t.clientUrl}),a);return p.ULS.sendTraceTag(9208407,306,50,"AppBusinessBarDisplayed"),o},t=e,(n=[{key:"title",get:function(){return this._stringsDict.get_item("Headline")}},{key:"message",get:function(){return this._stringsDict.get_item("CallToAction")}},{key:"useTwoButton",get:function(){return this._useTwoButton}},{key:"buttonOneText",get:function(){return this._useTwoButton?this._stringsDict.get_item("InstallButton"):this._stringsDict.get_item("UseAppButton")}},{key:"buttonTwoText",get:function(){return this._useTwoButton?this._stringsDict.get_item("OpenAppButton"):""}},{key:"businessBarEntry",get:function(){return this._appLinkBar}},{key:"openUrl",get:function(){return this._openURL||(this._openURL=this._getURL()),this._openURL}}])&&wl(t.prototype,n),i&&wl(t,i),e}();function Il(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(kl,"WildFireBusinessBar",null,[]);var Fl=function(){function e(){}var t,n,i,a=e.prototype;return a.addBusinessBarEntry=function(e){var t=s.AFrameworkApplication.activeFrame.applicationInstance,n=!1;return e&&(e.createBusinessBarEntry(),e.businessBarEntry&&(n=t.addEntryToBusinessBar(e.businessBarEntry,!0))),n},a.createChromeExtensionBizBar=function(){var e=s.AFrameworkApplication.activeFrame.applicationInstance,t=(e.officeAppType,1===e.officeAppMode),n=new kl(e.officeAppType,cl.getWildFirePlatform(),!1,t);this.addBusinessBarEntry(n)&&p.ULS.sendTraceTag(17571982,306,50,"ChromeExtBannerDisplayed")},a.createWildFireBusinessBar=function(e,t,n,i,r,a,o){var s=new kl(t,i,r,n,a,o);this.addBusinessBarEntry(s)&&p.ULS.sendTraceTag(9208407,306,50,"AppBusinessBarDisplayed")},a.createWildFireWacUI=function(){var e=s.AFrameworkApplication.activeFrame.applicationInstance,t=s.AFrameworkApplication.appSettingsManager,n=e.officeAppType,i=1===e.officeAppMode;if(t.getBooleanAppSetting(cl.getWildFireConfigSettingName(n))){var r=cl.getWildFirePlatform(),a=H.a.iPadOsVersion>8;if(2!==n||2!==r||!i){document.body;var o=t.getBooleanAppSetting(cl.getWildFireFlightSettingName(n)),l=e.saveAction();o&&!cl.isLocalStorageValueTrue(cl.getBizBarDismissKeyForApplication(n))&&this.createWildFireBusinessBar(e,n,i,r,a,(function(){return e.clientUrl}),l)}}},a.init=function(){var e=s.AFrameworkApplication.appSettingsManager,t=e.getBooleanAppSetting("WildFireChromeExtensionEnabled"),n=e.getBooleanAppSetting("WildFireChromeExtensionBar")&&t;cl.shouldUseChromeBar&&n&&!cl.isLocalStorageValueTrue(cl.chomeExtensionBarDismissKey)?this.createChromeExtensionBizBar():(document.body&&cl.shouldShowWildFireUI&&this.createWildFireWacUI(),s.AFrameworkApplication.theActionManager.addAction(h.a.launchWildFireBusinessBar,ue.a.frame,Object(r.a)(this,this.launchWildFireBusinessBar,"launchWildFireBusinessBar")))},a.launchWildFireBusinessBar=function(e,t,n,i,r){if(1===n)return 32;if(!r)return 8;var a=r;return this.createWildFireBusinessBar(s.AFrameworkApplication.activeFrame.applicationInstance,a.app,a.mode,a.platform,a.useTwoButton,null,null),32},a.dispose=function(){},a.configure=function(e){},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.WildFire"}}])&&Il(t.prototype,n),i&&Il(t,i),e}();Object(i.a)(Fl,"PackageManager",null,[20,21]);var El=function(e,t,n){void 0===n&&(n=null),this.id=e.Id,n||(n=""),this.isRecommendation=t,this.recommendationText=n,this.sensitivityLabel=e};Object(i.a)(El,"AutoPolicyLabelData",null,[]);var Pl=function(e,t){this.applyLabelFlag=e,this.displayName=t};function Ol(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Pl,"PolicyLabelRequestState",null,[]);var Rl=function(){function e(){}var t,n,i;return t=e,i=[{key:"justificationDialogHtmlTemplate",get:function(){return e.justificationDialogHtmlTemplateFormat}}],(n=null)&&Ol(t.prototype,n),i&&Ol(t,i),e}();function Ml(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Dl(e,t){return(Dl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Rl.justificationDialogHtmlTemplateFormat="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>",Object(i.a)(Rl,"JustificationDialogHtml",null,[]);var xl=function(e){var t,n;function i(t,n){var r;return(r=e.call(this,!1,!1,i.useReactDialog)||this)._justificationList=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther],r._reactJustification=null,r._reactActionButtonEnabled=!1,r._selectedPolicyId=t,r._callback=n,r.dialogHtml=r.buildDialogHtml(),r.buttonsOption=1,r.dialogId=i.id,r.setButtonText(1,CommonUIStrings.l_DialogChange),r.setButtonState(1,!1),r.setDefaultButton(0),r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Dl(t,n);var a,o,l,c=i.prototype;return c.showJustificationDialog=function(){if(i.useReactDialog)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(r.a)(this,this.reactJustificationDialogHandler,"reactJustificationDialogHandler"),this.getReactDialogProps(this._reactActionButtonEnabled));else{for(var e={},t=0;t<this._justificationList.length;t++)e[i.radioBox+t]=!1;e[i.textJustification]="",this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(r.a)(this,this.justificationDialogHandler,"justificationDialogHandler"),e),this.registerFocusForRadioButtons(),Fe.a.addHandler($get(i.textJustification),f.a.input,Object(r.a)(this,this.textAreaHandler,"textAreaHandler"))}},c.validate=function(){if(i.useReactDialog)return this.validateJustificationString(this._reactJustification);var e=$get(i.textJustification);return!!e.disabled||this.validateJustificationString(e.value)},c.validateJustificationString=function(e){var t=e.length<2,n=e.length>500,i=new RegExp("[{|}|;|\\\\]").test(e),r=""===je.a.removeAllWhitespace(e);return!(t||n||i||r)},c.justificationDialogHandler=function(e,t){var n="";if(1===e)for(var r=0;r<this._justificationList.length;r++)if(t[i.radioBox+r]){n=r===this._justificationList.length-1?t[i.textJustification]:this._justificationList[r];break}this._callback(e,this._selectedPolicyId,n)},c.reactJustificationDialogHandler=function(e,t){var n="";1===e&&this._reactJustification&&(n=this._reactJustification),this._callback(e,this._selectedPolicyId,n)},c.onJustificationUpdated=function(e){this._reactJustification=e;var t=this.validate();this._reactActionButtonEnabled!==t&&(this._reactActionButtonEnabled=t,this.updateDialog(CommonUIStrings.l_SensitivityJustificationTitle,Object(r.a)(this,this.reactJustificationDialogHandler,"reactJustificationDialogHandler"),this.getReactDialogProps(this._reactActionButtonEnabled)))},c.getReactDialogProps=function(e){var t,n,i,a;return(a={}).id=this.dialogId,a.bodyControls=((n={}).choiceGroupProps={},n.textAreaProps=((t={}).placeholder=CommonUIStrings.l_SensitivityJustificationPlaceholder,t),n),a.actionButtonProps=((i={}).label=CommonUIStrings.l_DialogChange,i.disabled=!e,i),a.infoMessage=CommonUIStrings.l_SensitivityJustificationMessage,a.justificationIrrelevantLabel=CommonUIStrings.l_SensitivityJustificationNoLongerApplies,a.justificationIncorrectLabel=CommonUIStrings.l_SensitivityJustificationIncorrect,a.justificationOtherLabel=CommonUIStrings.l_SensitivityJustificationOther,a.onJustificationUpdated=Object(r.a)(this,this.onJustificationUpdated,"onJustificationUpdated"),a},c.textAreaHandler=function(e){e.target&&this.setButtonState(1,this.validate())},c.buildDialogHtml=function(){return Ei.a.formatHtml(i.justificationDialogHtmlTemplate,s.AFrameworkApplication.imageClusterPath,Pr.getImageClass(i.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this._justificationList[0],this._justificationList[1],this._justificationList[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)},c.registerFocusForRadioButtons=function(){for(var e=document.getElementsByName(i.listRadioBox),t=0;t<e.length;t++)Fe.a.addHandler(e[t],f.a.focus,Object(r.a)(this,this.radioButtonFocusHandler,"radioButtonFocusHandler")),Fe.a.addHandler(e[t],f.a.click,Object(r.a)(this,this.radioButtonFocusHandler,"radioButtonFocusHandler"))},c.radioButtonFocusHandler=function(e){var t=e.target;if(t){t.checked=!0;var n=$get(i.textJustification);t.id===i.radioBox+(this._justificationList.length-1)?(n.disabled=!1,Sys.UI.DomElement.setVisible(n,!0),n.focus()):(n.disabled=!0,t.focus()),this.setButtonState(1,this.validate())}},a=i,l=[{key:"useReactDialog",get:function(){return s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactJustificationDialogEnabled}}],(o=null)&&Ml(a.prototype,o),l&&Ml(a,l),i}(Ei.a);function Ll(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bl(e,t){return(Bl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}xl.justificationDialogHtmlTemplate=Rl.justificationDialogHtmlTemplate,xl.listRadioBox="ListRadioBox",xl.radioBox="radiobox",xl.textJustification="txtJustification",xl.iconName="Info_32x32x32",xl.id="JustificationDialog",Object(i.a)(xl,"JustificationDialog",Ei.a,[]);var Ul=function(e){var t,n;function i(t,n,i){var a,o,l,c,u,d;if(d=e.call(this,!1,!1,!0)||this,!t||!i)return p.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs"),Ll(d);var h=((a={}).id="MandatoryLabellingDialog",a);if(d._dialogResultCallback=i,d._learnMoreUrl=n,!s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||d._learnMoreUrl&&""!==d._learnMoreUrl){var g,m,f=((g={}).href=d._learnMoreUrl,g.target="_blank",g);h.learnMoreLink=((m={}).type="AppLinkProps",m.id="mandatoryLabellingLearnMoreLink",m.text=CommonUIStrings.l_LearnMore,m.handler=f,m.customTooltip=CommonUIStrings.L_LearnMoreTooltip,m)}var _=((o={}).id="mandatoryLabellingFlyoutMenuSection",o.controls=t,o),v=((l={}).sections=[],l.shouldAutoOpen=!1,l);Array.add(v.sections,_),h.labelFlyout=((c={}).type="AppFlyoutAnchorProps",c.id="mandatoryLabellingFyout",c.label="Pick a label",c.hideLabel=!1,c.hideChevron=!1,c.hideIcon=!0,c.menuDefinition=v,c);var y=((u={}).id="MandatoryLabellingDialog",u.bodyControls=h,u);return h.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText,h.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,d.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(r.a)(Ll(d),d.mandatoryLabellingDialogHandler,"mandatoryLabellingDialogHandler"),y),d}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Bl(t,n),i.prototype.mandatoryLabellingDialogHandler=function(e,t){if(1===e&&t.selectedLabel){var n=t.selectedLabel;if(""!==n)return void this._dialogResultCallback(n)}},i}(Ei.a);function Hl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Ul,"MandatoryLabellingDialog",Ei.a,[]);var Nl=function(){function e(){this._isReactDialogEnabled=!!s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled}var t,n,i;return e.prototype.createMandatoryLabellingDialog=function(e,t,n){return this._isReactDialogEnabled?new Ul(e,t,n):null},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(n=null)&&Hl(t.prototype,n),i&&Hl(t,i),e}();Nl._instance=null,Object(i.a)(Nl,"MandatoryLabellingDialogFactory",null,[258]);var Wl=function(){};Wl.statusBarProtectedImageClass="sbProtectForm14",Wl.statusBarUnprotectedImageClass="SBStatusBarMarkAsReadOnly14",Wl.learnMoreImageClass="Info_16x16x32",Wl.checkMarkImageClass="QuickSearchCompletedToday_16x16x32",Wl.reactCheckMarkImageClass="CommonControlCheckboxCheck_16",Wl.toggleButtonOn="On",Wl.visible="Visible",Wl.flyoutAnchorImageIsVisible="ImageIsVisible",Wl.sourceControlId="SourceControlId",Wl.menuItemId="MenuItemId",Wl.menu="Menu",Wl.appLockId="AppLockId",Wl.value="Value",Wl.labelText="LabelText",Wl.alt="Alt",Wl.image16by16="Image16by16",Wl.image16by16Class="Image16by16Class",Wl.statusBarProtectedIconName="SBProtectForm_16",Wl.statusBarUnprotectedIconName="SBStatusBarMarkAsReadOnly_16",Wl.icon="Icon",Wl.customTooltip="CustomTooltip",Object(i.a)(Wl,"PolicyConstants",null,[]);var jl=n(316),Vl=n(113),ql=n(73),Gl=n(240),Kl=n(220),zl=n(167),Xl=n(156),Jl=n(228),Ql=function(){function e(){}return e.initializeSubComponent=function(t,n){e.initializeSubComponents(t,[n])},e.initializeSubComponents=function(e,t){var n={};n.component=e,n.subComponents=t,Jl.a.dispatch("Wac-SubComponentsInit",n)},e.notifyFunctionallyReady=function(t,n,i){void 0===i&&(i=!1),e.notifyReady(t,n,"functionally-ready",i)},e.notifyVisuallyReady=function(t,n,i){void 0===i&&(i=!1),e.notifyReady(t,n,"visually-ready",i)},e.notifyUnused=function(t,n,i){void 0===i&&(i=!1),e.notifyReady(t,n,"unused",i)},e.notifyReady=function(e,t,n,i){void 0===i&&(i=!1);var r={};r.component=e,r.subComponent=t,r.state=n,r.ignoreNewSubComponents=i,Jl.a.dispatch("Wac-SubComponentSetLoadState",r)},e}();function Zl(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Yl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yl(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Yl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function $l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Ql,"RumTracker",null,[]);var ec,tc=function(){function e(e,t,n,i){this._labelTitle=null,this._labelDescription=null,this._defaultLabelSetAttempted=!1,this._mandatoryLabelSetAttempted=!1,this._isStandardLabelApplied=!1,this._isWaitingForFileExistsOnHost=!1,this._labelsData=null,this._parentToChild=null,this._idToSensitivityLabel=null,this._justification=null,this._autoPolicyLabelData=null,this._recommendedPolicyLabelData=null,this._currentRecommendedPolicyLabelId=null,this._currentAutoPolicyLabelId=null,this._awaitFileExistsOnHostRetryCount=0,this._blockSetSensitivityCall=null,this._isThisANewFile=null,this._fileExistsOnHost=null,this._actionManager=e,this._activeFrame=t,this._appSettingsManager=n,this._policyManager=i,this._menuItemToPolicyId={},this._policyIdToMenuItem={},this._mandatoryLabellingMenuItemToPolicyId={},this.isApplyManualPolicyLabelEnabled=n.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled"),this._clpKpiIsEnabled=n.getBooleanAppSetting("ClpKpiIsEnabled"),this._policyManager.value.add_setPolicyLabelHandler(Object(r.a)(this,this.processAutoSensitivityLabel,"processAutoSensitivityLabel")),this._policyManager.value.add_setPolicyLabelFailureHandler(Object(r.a)(this,this.processAutoSensitivityLabel,"processAutoSensitivityLabel")),this._policyManager.value.add_labelInfoUpdateHandler(Object(r.a)(this,this.onUpdateLabelInfo,"onUpdateLabelInfo")),n.getBooleanAppSetting("SupportsPolicies")&&n.getStringAppSetting("AppliedPolicyId")&&(this._labelTitle=n.getStringAppSetting("IrmPolicyTitle"),this._labelDescription=n.getStringAppSetting("IrmPolicyDescription")),this._protectedFile=n.getBooleanAppSetting("ProtectedFile"),this._awaitFileExistsOnHostMaxRetryCount=this._appSettingsManager.getIntAppSetting("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6),this._awaitFileExistsOnHostRetryDelayMs=this._appSettingsManager.getIntAppSetting("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5e3)}var t,n,i,a=e.prototype;return a.registerActions=function(){this._actionManager.addAction(h.a.openDocumentLabelPane,ue.a.frame,Object(r.a)(this,this.documentLabelPaneHandler,"documentLabelPaneHandler")),this._actionManager.addActionWithFlags(h.a.queryPolicyLabel,ue.a.frame,Object(r.a)(this,this.queryPolicyLabel,"queryPolicyLabel"),96),this._actionManager.addAction(h.a.toggleSensitivity,ue.a.frame,Object(r.a)(this,this.toggleSensitivity,"toggleSensitivity")),this._actionManager.addAction(h.a.populateSensitivityFlyout,ue.a.frame,Object(r.a)(this,this.populateSensitivityFlyout,"populateSensitivityFlyout")),this._actionManager.addAction(h.a.setSensitivity,ue.a.frame,Object(r.a)(this,this.setSensitivity,"setSensitivity")),this._actionManager.addActionWithFlags(h.a.querySensitivity,ue.a.frame,Object(r.a)(this,this.querySensitivity,"querySensitivity"),96),this._actionManager.addAction(h.a.querySensitivityToggleButton,ue.a.frame,Object(r.a)(this,this.querySensitivityToggleButton,"querySensitivityToggleButton")),this._actionManager.addAction(h.a.querySensitivitySubFlyout,ue.a.frame,Object(r.a)(this,this.querySensitivitySubFlyout,"querySensitivitySubFlyout")),this.actionHasFlags(h.a.toggleSensitivity)||this._actionManager.setActionFlags(h.a.toggleSensitivity,4),this.actionHasFlags(h.a.populateSensitivityFlyout)||this._actionManager.setActionFlags(h.a.populateSensitivityFlyout,4),this.actionHasFlags(h.a.setSensitivity)||this._actionManager.setActionFlags(h.a.setSensitivity,4),this.actionHasFlags(h.a.querySensitivityToggleButton)||this._actionManager.setActionFlags(h.a.querySensitivityToggleButton,4),this.actionHasFlags(h.a.querySensitivitySubFlyout)||this._actionManager.setActionFlags(h.a.querySensitivitySubFlyout,4),this._activeFrame.updateCommandUI()},a.unregisterActions=function(){this._actionManager.removeAction(h.a.openDocumentLabelPane,ue.a.frame,Object(r.a)(this,this.documentLabelPaneHandler,"documentLabelPaneHandler")),this._actionManager.removeAction(h.a.queryPolicyLabel,ue.a.frame,Object(r.a)(this,this.queryPolicyLabel,"queryPolicyLabel")),this._actionManager.removeAction(h.a.toggleSensitivity,ue.a.frame,Object(r.a)(this,this.toggleSensitivity,"toggleSensitivity")),this._actionManager.removeAction(h.a.populateSensitivityFlyout,ue.a.frame,Object(r.a)(this,this.populateSensitivityFlyout,"populateSensitivityFlyout")),this._actionManager.removeAction(h.a.setSensitivity,ue.a.frame,Object(r.a)(this,this.setSensitivity,"setSensitivity")),this._actionManager.removeAction(h.a.querySensitivity,ue.a.frame,Object(r.a)(this,this.querySensitivity,"querySensitivity")),this._actionManager.removeAction(h.a.querySensitivityToggleButton,ue.a.frame,Object(r.a)(this,this.querySensitivityToggleButton,"querySensitivityToggleButton")),this._actionManager.removeAction(h.a.querySensitivitySubFlyout,ue.a.frame,Object(r.a)(this,this.querySensitivitySubFlyout,"querySensitivitySubFlyout"))},a.toggleSensitivity=function(e,t,n,i,r){return 32},a.getAppToggleButtonProps=function(e){var t,n="mandatoryLabelling_"+e.Id;return this._mandatoryLabellingMenuItemToPolicyId[n]=e.Id,(t={}).type="AppToggleButtonProps",t.id=n,t.label=e.DisplayName,t.hideLabel=!1,t.customTooltip=e.Tooltip,t},a.getMandatoryLabellingDialogFlyoutProperties=function(){var e=[],t=this._parentToChild;for(var n in t){var i={key:n,value:t[n]},r=i.value,a=this._idToSensitivityLabel[i.key];if(a&&a.Enabled)if(r.count){for(var o,s,l,c,u=((o={}).sections=[],o.shouldAutoOpen=!1,o),d=((s={}).id="mandatoryLabelling_flyoutMenuSection_"+a.Id,s.controls=[],s),h=Zl(r);!(c=h()).done;){var p=c.value,g=this._idToSensitivityLabel[p];g&&g.Enabled&&Array.add(d.controls,this.getAppToggleButtonProps(g))}Array.add(u.sections,d);var m=((l={}).type="AppFlyoutAnchorProps",l.id="mandatoryLabelling_"+a.Id,l.label=a.DisplayName,l.hideLabel=!1,l.hideChevron=!1,l.hideIcon=!1,l.menuDefinition=u,l);Array.add(e,m)}else Array.add(e,this.getAppToggleButtonProps(a))}return e},a.populateSensitivityFlyout=function(e,t,n,i,r){if(1===n||!this._policyManager.value.areLabelsAvailableForDisplay())return 32;var a=r;return a.MenuItems=Object.assign(new Kl.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0}),Array.add(a.MenuItems.MenuSectionList,this.createMenuSection(!this.isReactRibbonEnabled())),this._labelsData.CustomUrl&&Array.add(a.MenuItems.MenuSectionList,this.createLearnMoreButton(this.isReactRibbonEnabled()?this._labelsData.CustomUrl:je.a.xmlEncode(this._labelsData.CustomUrl))),this.isReactRibbonEnabled()||(a.PopulationXML=ql.k(a.MenuItems)),32},a.querySensitivity=function(e,t,n,i,r){if(1===n||!r||!this.isApplyManualPolicyLabelEnabled)return 32;(this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._policyManager.value.areLabelsAvailableForDisplay())&&(r[Wl.visible]=!0,c.a("MipLabelsAvailable"));return 32},a.querySensitivityToggleButton=function(e,t,n,i,r){if(1===n||!r)return 32;var a,o,s=r;return s[Wl.toggleButtonOn]=!!(a=s[Wl.menuItemId])&&!!(o=this._menuItemToPolicyId[a])&&o===this._labelsData.AppliedPolicyId,32},a.querySensitivitySubFlyout=function(e,t,n,i,r){if(1===n||!r)return 32;var a,o,s,l=r,c=!!(a=l[Wl.sourceControlId])&&!!(o=this._menuItemToPolicyId[a])&&!!(s=this._parentToChild[o])&&s.contains(this._labelsData.AppliedPolicyId);return l[Wl.flyoutAnchorImageIsVisible]=c,l[Wl.toggleButtonOn]=c,32},a.setSensitivity=function(e,t,n,i,r){if(1===n||!r)return 32;var a=r,o=a[Wl.sourceControlId],s=this._menuItemToPolicyId[o];return this.setSensitivityByPolicyId(s,a,2)},a.triggerMandatoryLabellingIfNeeded=function(){var e=this;if(this._labelsData.MandatoryLabelingEnforced)if(this._labelsData&&this._labelsData.AreLabelsAvailable)if(s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled)if(this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WacMandatoryLabelingDesignChangeForCoauth",!1))if(""===this._labelsData.AppliedPolicyId){if(this._labelsData.DefaultLabelId&&(this._appSettingsManager.getBooleanAppSetting("DefaultLabelingExistingDocumentIsEnabled")||this.isNewFile))return void p.ULS.sendTraceTag(572601948,306,50,"Mandatory labelling not invoked b/c default label policy present!");this.enforceMandatoryLabeling()}else this.escapeMandatoryLabeling("");else{if(this._labelsData.AppliedPolicyId)return void p.ULS.sendTraceTag(572601947,306,50,"Mandatory labelling not invoked b/c document already has label!");if(this._labelsData.DefaultLabelId&&(this._appSettingsManager.getBooleanAppSetting("DefaultLabelingExistingDocumentIsEnabled")||this.isNewFile))return void p.ULS.sendTraceTag(562414017,306,50,"Mandatory labelling not invoked b/c default label policy present!");if(this._mandatoryLabelSetAttempted)return void p.ULS.sendTraceTag(572601949,306,50,"Mandatory labelling not invoked b/c already attempted in session!");this._mandatoryLabelSetAttempted=!0,s.AFrameworkApplication.isMandatoryLabellingMode=!0,p.ULS.sendTraceTag(570972053,306,50,"Mandatory labelling is invoked successfully."),this._policyManager.value.raiseMandatoryLabellingAppHandlerEvent("",1),this._policyManager.value.addMandatoryLabellingBusinessBarEntry(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,(function(t){e.mandatoryLabellingBusBarCallback()}))}else p.ULS.sendTraceTag(572641315,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!");else p.ULS.sendTraceTag(572601946,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!");else p.ULS.sendTraceTag(572601945,306,50,"Mandatory labelling not invoked b/c user did not have policy!")},a.enforceMandatoryLabeling=function(){var e=this;s.AFrameworkApplication.isMandatoryLabellingMode||this._mandatoryLabelSetAttempted||(s.AFrameworkApplication.isMandatoryLabellingMode=!0,this._mandatoryLabelSetAttempted=!0,p.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this._policyManager.value.raiseMandatoryLabellingAppHandlerEvent("",1),this._policyManager.value.addMandatoryLabellingBusinessBarEntry(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,(function(t){e.mandatoryLabellingBusBarCallback()})))},a.escapeMandatoryLabeling=function(e){s.AFrameworkApplication.isMandatoryLabellingMode&&(s.AFrameworkApplication.isMandatoryLabellingMode=!1,p.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this._policyManager.value.removeMandatoryLabellingBusinessBarEntry(),this._policyManager.value.raiseMandatoryLabellingAppHandlerEvent(e,2))},a.mandatoryLabellingBusBarCallback=function(){Nl.instance.createMandatoryLabellingDialog(this.getMandatoryLabellingDialogFlyoutProperties(),this._labelsData.CustomUrl,Object(r.a)(this,this.mandatoryLabellingDialogCallback,"mandatoryLabellingDialogCallback"))},a.mandatoryLabellingDialogCallback=function(e){this.escapeMandatoryLabeling(this._mandatoryLabellingMenuItemToPolicyId[e])},a.awaitFileExistsOnHostEnabled=function(){return this._appSettingsManager.getBooleanAppSetting("CoAuthForProtectedFilesEnabled")&&this._appSettingsManager.getBooleanAppSetting("SupportsOfficeClientCoauthoring")&&this._appSettingsManager.getBooleanAppSetting("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this._fileExistsOnHost&&this.isNewFile},a.setSensitivityByPolicyId=function(e,t,n){var i=this;this._clpKpiIsEnabled&&this._policyManager.value.raiseSetPolicyLabelTriggeredEvent(n);var r=2===n||8===n||16===n,a=e===this._labelsData.AppliedPolicyId;if(this._blockSetSensitivityCall&&this._blockSetSensitivityCall(e,r))p.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",n),this._activeFrame.updateCommandUI();else if(t&&Wl.appLockId in t&&this._policyManager.value.setLockId(t[Wl.appLockId]),e)if(this._policyManager.value.isSetPolicyLabelRequestInProgress()||this.awaitFileExistsOnHostEnabled()&&this._isWaitingForFileExistsOnHost)p.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",n),this._activeFrame.updateCommandUI(),r&&this.alertSetPolicyLabelFailed(n,e,!0,CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WacBlockNoEditRightsSetLabelIsEnabled",!1)&&!this._appSettingsManager.getBooleanAppSetting("HasDocumentEditRights"))p.ULS.sendTraceTag(558892739,306,15,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",n),this._activeFrame.updateCommandUI(),r&&this.alertSetPolicyLabelFailed(n,e,!0,CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);else if(this._policyManager.value.canSetPolicyLabelInCoauthSession(e))if(this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WacApplyMandatoryLabellingIsEnabled",!1)&&r&&this._labelsData.MandatoryLabelingEnforced&&a)p.ULS.sendTraceTag(570972054,306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",n),this.alertSetPolicyLabelFailed(n,"",!0,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else if(r&&this._appSettingsManager.getBooleanAppSetting("WacLabelingJustificationDialogIsEnabled")&&this._labelsData.RequiredDowngradeJustification&&(e===this._labelsData.AppliedPolicyId||this._idToSensitivityLabel[e].RequiredDowngradeJustification)&&!this._justification)p.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",n),this.showJustificationDialog(e);else{if(!this.awaitFileExistsOnHostEnabled()||this._fileExistsOnHost())return p.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",n),this.setPolicyLabel(a?"":e,this._justification,n),32;this._awaitFileExistsOnHostRetryCount<this._awaitFileExistsOnHostMaxRetryCount?(p.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this._awaitFileExistsOnHostRetryCount,n),this._isWaitingForFileExistsOnHost=!0,this._awaitFileExistsOnHostRetryCount++,pt.Task.delay(this._awaitFileExistsOnHostRetryDelayMs).continueWith((function(r){i._isWaitingForFileExistsOnHost=!1,i.setSensitivityByPolicyId(e,t,n)}))):(p.ULS.sendTraceTag(577356771,306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",n),1!==n&&this.alertSetPolicyLabelFailed(n))}else p.ULS.sendTraceTag(42796169,306,15,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",n),this._activeFrame.updateCommandUI(),r&&this.alertSetPolicyLabelFailed(n,e,!0,CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else p.ULS.sendTraceTag(42796167,306,50,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",n),this._activeFrame.updateCommandUI(),r&&this.alertSetPolicyLabelFailed(n);return this._policyManager.value.raiseSetPolicyLabelFailureEvent(0,n,!1),32},a.applyAutoPolicyLabel=function(t,n,i,r){void 0===i&&(i=null),void 0===r&&(r=!1),this._clpKpiIsEnabled||l.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null),this._appSettingsManager.getBooleanAppSetting("SupportsOfficeClientCoauthoring")&&this._appSettingsManager.getBooleanAppSetting("CoAuthForProtectedFilesIsEnabled")?(this._isStandardLabelApplied=!1,this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._labelsData&&!this._labelsData.AppliedPolicyId?this._isStandardLabelApplied=!0:this._labelsData&&this._labelsData.PolicyLabelAssignmentMethod&&(this._isStandardLabelApplied=Xl.c(this._labelsData.PolicyLabelAssignmentMethod)===Xl.c("standard"))):this._isStandardLabelApplied=r;var a=e.isNullOrEmpty(t)?null:this._idToSensitivityLabel[t],o=e.isNullOrEmpty(n)?null:this._idToSensitivityLabel[n];return o?this._recommendedPolicyLabelData=new El(o,!0,i):(this._policyManager.value.removeAutoPolicyBusinessBarEntry(29),this._currentRecommendedPolicyLabelId=null),a?this._autoPolicyLabelData=new El(a,!1):this._currentAutoPolicyLabelId=null,this.processAutoSensitivityLabel(null,null),32},a.applyMandatoryPolicyLabel=function(e,t){return void 0===t&&(t=!1),""!==this._labelsData.AppliedPolicyId&&t?(this._policyManager.value.raiseSetPolicyLabelFailureEvent(4,16,!0),8):this.setSensitivityByPolicyId(e,null,16)},a.setIdToSensitivityDictionary=function(){if(this._idToSensitivityLabel={},this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._labelsData)for(var e,t=Zl(this._labelsData.SensitivityLabels);!(e=t()).done;){var n=e.value;this._idToSensitivityLabel[n.Id]=n}},a.setParentToChildSensitivityLabelsDictionary=function(){if(this._parentToChild={},this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._labelsData){for(var e,t=Zl(this._labelsData.SensitivityLabels);!(e=t()).done;){var n=e.value;n.ParentId||(this._parentToChild[n.Id]=new z.a)}for(var i,r=Zl(this._labelsData.SensitivityLabels);!(i=r()).done;){var a=i.value;if(a.ParentId&&a.ParentId in this._parentToChild)this._parentToChild[a.ParentId].add(a.Id)}}},a.querySensitivityControl=function(){this.isApplyManualPolicyLabelEnabled&&this.isReactRibbonEnabled()?(this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._policyManager.value.areLabelsAvailableForDisplay()?(this.reportSensitivityControlBootStatus(!0),appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))):this.reportSensitivityControlBootStatus(!1)):this.reportSensitivityControlBootStatus(!1)},a.reportSensitivityControlBootStatus=function(e){e?(Ql.notifyVisuallyReady("ribbon","sensitivity"),Ql.notifyFunctionallyReady("ribbon","sensitivity")):Ql.notifyUnused("ribbon","sensitivity")},a.registerBlockSetSensitivityCall=function(e){this._blockSetSensitivityCall=e},a.registerIsANewFile=function(e){this._isThisANewFile=e},a.registerFileExistsOnHost=function(e){this._fileExistsOnHost=e},a.setDefaultLabelIfNeeded=function(){this._appSettingsManager.getBooleanAppSetting("WacApplyDefaultPolicyLabelIsEnabled")&&(this._defaultLabelSetAttempted||(this._defaultLabelSetAttempted=!0,this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._labelsData&&this._labelsData.DefaultLabelId&&!this._labelsData.AppliedPolicyId&&(p.ULS.sendTraceTag(593774211,306,50,"Default label configured, checking if this is a new file"),(this._appSettingsManager.getBooleanAppSetting("DefaultLabelingExistingDocumentIsEnabled")||this.isNewFile)&&(p.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this._labelsData.DefaultLabelId),this.setSensitivityByPolicyId(this._labelsData.DefaultLabelId,null,1)))))},a.processAutoSensitivityLabel=function(e,t){var n=this;if(!this._policyManager.value.isSetPolicyLabelRequestInProgress()){var i=this._idToSensitivityLabel[this._policyManager.value.getPolicyLabelsData().AppliedPolicyId];if(this._isStandardLabelApplied&&this._autoPolicyLabelData&&this._currentAutoPolicyLabelId!==this._autoPolicyLabelData.id&&(!i||i.Order<this._autoPolicyLabelData.sensitivityLabel.Order)){var r=this.setSensitivityByPolicyId(this._autoPolicyLabelData.id,{},4);if(32!==r)p.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+r);else if(this._currentAutoPolicyLabelId=this._autoPolicyLabelData.id,this._currentRecommendedPolicyLabelId){var a=this._idToSensitivityLabel[this._currentRecommendedPolicyLabelId];a&&a.Order<=this._autoPolicyLabelData.sensitivityLabel.Order&&(this._policyManager.value.removeAutoPolicyBusinessBarEntry(29),this._currentRecommendedPolicyLabelId=null)}}if(i=this._idToSensitivityLabel[this._policyManager.value.getPolicyLabelsData().AppliedPolicyId],this._recommendedPolicyLabelData&&this._currentRecommendedPolicyLabelId!==this._recommendedPolicyLabelData.id&&(!i||i.Order<this._recommendedPolicyLabelData.sensitivityLabel.Order)){var o=this._recommendedPolicyLabelData.id;this._policyManager.value.removeAutoPolicyBusinessBarEntry(29),this._policyManager.value.addAutoPolicyBusinessBarEntry(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.getParentChildSensitivityLabelText(this._recommendedPolicyLabelData.sensitivityLabel))+" "+this._recommendedPolicyLabelData.recommendationText,CommonUIStrings.l_PolicyLabelRecommendationButton,(function(e){n.setSensitivityByPolicyId(o,{},8)})),this._currentRecommendedPolicyLabelId=this._recommendedPolicyLabelData.id}this._autoPolicyLabelData=null,this._recommendedPolicyLabelData=null}},a.createAutoPolicyBusinessBarEntry=function(e,t,n,i){var r=new sl.a(e,t,null);return r.id=28,r.closeable=!0,r.image=3,r.addButton(n,i,n,!0),r},a.setPolicyLabel=function(e,t,n){void 0===n&&(n=2),this._justification=t,this._policyManager.value.setPolicyLabel(e),this._activeFrame.updateCommandUI();var i=this._idToSensitivityLabel[e],r=new Pl(n,this.getParentChildSensitivityLabelText(i));this._policyManager.value.setPolicyLabelRequestAsync(e,this._justification,r)},a.continueToSetPolicyLabel=function(e,t,n){1===e?this.setPolicyLabel(t===this._labelsData.AppliedPolicyId?"":t,n):this._activeFrame.updateCommandUI()},a.showJustificationDialog=function(e){new xl(e,Object(r.a)(this,this.continueToSetPolicyLabel,"continueToSetPolicyLabel")).showJustificationDialog()},a.alertSetPolicyLabelFailed=function(e,t,n,i,r){if(void 0===t&&(t=""),void 0===n&&(n=!1),void 0===i&&(i=""),void 0===r&&(r=""),n){var a=new Nn.StandardDialog;a.hasCloseGlyph=s.AFrameworkApplication.isCloseable,a.buttonsOption=0,a.setButtonText(1,CommonUIStrings.l_DialogClose),a.showWarning(i,r,null)}this._policyManager.value.raiseSetPolicyLabelFailureEvent(0,e,!n)},a.isReactRibbonEnabled=function(){return!!this._activeFrame&&!!this._activeFrame.applicationInstance&&this._activeFrame.applicationInstance.isReactRibbonEnvironmentEnabled},a.isReactStatusBarEnabled=function(){return!(!this._activeFrame||!this._activeFrame.applicationInstance)&&this._activeFrame.applicationInstance.isReactStatusBarEnabled},a.documentLabelPaneHandler=function(e,t,n,i,r){return 32},a.queryPolicyLabel=function(e,t,n,i,r){if(1===n)return 32;if(this._labelsData=this._policyManager.value.getPolicyLabelsData(),!this._labelsData||!r)return 32;var a=r;if(a[Wl.value]=null,a[Wl.labelText]=null,a[Wl.alt]=null,a[Wl.image16by16]=null,a[Wl.image16by16Class]=null,a[Wl.visible]=!1,this._labelsData.AreLabelsAvailable){if(this._labelsData.AppliedPolicyId){for(var o,l=null,c=Zl(this._labelsData.SensitivityLabels);!(o=c()).done;){var u=o.value;if(u.Id.toLowerCase()===this._labelsData.AppliedPolicyId.toLowerCase()){l=u;break}}l&&(a[Wl.value]=a[Wl.labelText]=this.getParentChildSensitivityLabelText(l),this.isReactStatusBarEnabled()?a[Wl.customTooltip]=l.Tooltip:a[Wl.alt]=l.Tooltip,this._protectedFile=s.AFrameworkApplication.protectedFile=l.IsEndpointProtectionEnabled)}}else{if(!this._labelTitle)return 32;a[Wl.value]=a[Wl.labelText]=this._labelTitle,this._labelDescription&&(this.isReactStatusBarEnabled()?a[Wl.customTooltip]=this._labelDescription:a[Wl.alt]=this._labelDescription)}return a[Wl.value]&&this.setLabelImage(this._protectedFile,a),32},a.getParentChildSensitivityLabelText=function(e){return e?this._idToSensitivityLabel?e.ParentId&&this._idToSensitivityLabel[e.ParentId]?this._idToSensitivityLabel[e.ParentId].DisplayName+"\\"+e.DisplayName:e.DisplayName:(p.ULS.sendTraceTag(4282e4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),e.DisplayName):""},a.setLabelImage=function(e,t){t[Wl.image16by16]=s.AFrameworkApplication.imageClusterPath,t[Wl.image16by16Class]=e?Pr.getImageClass(Wl.statusBarProtectedImageClass):Pr.getImageClass(Wl.statusBarUnprotectedImageClass),this.isReactStatusBarEnabled()&&(t[Wl.icon]=e?Wl.statusBarProtectedIconName:Wl.statusBarUnprotectedIconName),t[Wl.visible]=!0},a.createLearnMoreButton=function(e){var t=this.createMenuSectionProps("LearnMoreSection",!0),n="SensitivityLearnMore",i=Object.assign(new Vl.a,{Id:n,ExternalId:n,MenuItemId:e,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:s.AFrameworkApplication.imageClusterPath,Image16by16Class:Pr.getImageClass(Wl.learnMoreImageClass),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});return Array.add(t.ControlList,i),t},a.createCheckMarkToggleButtonProps=function(e,t,n,i,r,a,o,l){void 0===o&&(o=""),void 0===l&&(l=!1);var c="Toggle_"+o+"_"+t;c="Sensitivity_"+c;var u=l?je.a.xmlEncode(c):c,d=Object.assign(new jl.a,{Id:u,ExternalId:u,LabelText:l?je.a.xmlEncode(n):n,Command:"2935633379",MenuItemId:u,QueryCommand:"991261903",CheckedImage:s.AFrameworkApplication.imageClusterPath,Visible:!0,Alt:l?je.a.xmlEncode(i):i,IsChecked:r,AriaLabel:gr.a.ariaMenuItemRadioRole,KeyTip:a});return this.isReactRibbonEnabled()?(d.CheckedImageClass=Pr.getImageClass(Wl.reactCheckMarkImageClass),d.ExternalImageId=Wl.reactCheckMarkImageClass):d.CheckedImageClass=Pr.getImageClass(Wl.checkMarkImageClass),u=c,this._menuItemToPolicyId[u]=e,this._policyIdToMenuItem[e]=u,d},a.createMenuSectionProps=function(e,t){return void 0===t&&(t=!1),Object.assign(new zl.a,{Title:"",Id:e,DisplayMode:Wl.menu,ShowMenuSectionSeparator:t,ControlsId:"Ctrl_"+e,ControlList:[]})},a.createSubMenuSection=function(e,t,n){for(var i,r=this.createMenuSectionProps(e+"Sub"),a=1,o=Zl(t);!(i=o()).done;){var s=i.value,l=this._idToSensitivityLabel[s];l&&l.Enabled&&(Array.add(r.ControlList,this.createCheckMarkToggleButtonProps(l.Id,l.Name,l.DisplayName,l.Tooltip,l.Id===this._labelsData.AppliedPolicyId,a.toString(),e,n)),a++)}return r},a.createMenuSection=function(e){void 0===e&&(e=!1);var t=this.createMenuSectionProps("SensitivitySection"),n=1,i=this._parentToChild;for(var r in i){var a={key:r,value:i[r]},o=a.value,l=this._idToSensitivityLabel[a.key];if(l&&l.Enabled){if(o.count){var c="Sensitivity_"+l.Name,u=e?je.a.xmlEncode(c):c,d=Object.assign(new Gl.a,{Id:u,ExternalId:u,LabelText:e?je.a.xmlEncode(l.DisplayName):l.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new Kl.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:gr.a.ariaMenuItemRadioRole,KeyTip:n.toString()});this.isReactRibbonEnabled()?d.ExternalImageId=Wl.reactCheckMarkImageClass:(d.Image16by16=s.AFrameworkApplication.imageClusterPath,d.Image16by16Class=Pr.getImageClass(Wl.checkMarkImageClass)),Array.add(d.Menu.MenuSectionList,this.createSubMenuSection(c,o,e)),Array.add(t.ControlList,d),this._menuItemToPolicyId[d.Id]=l.Id,this._policyIdToMenuItem[l.Id]=d.Id}else Array.add(t.ControlList,this.createCheckMarkToggleButtonProps(l.Id,l.Name,l.DisplayName,l.Tooltip,l.Id===this._labelsData.AppliedPolicyId,n.toString(),void 0,e));n++}}return t},a.actionHasFlags=function(e){return!!this._actionManager.getActionMetadata(e)&&!!this._actionManager.getActionMetadata(e).flags&&!!this._actionManager.getActionMetadata(e).flags.length},a.onUpdateLabelInfo=function(e,t){if(t.onSuccess&&this._idToSensitivityLabel){var n=this._idToSensitivityLabel[this._policyManager.value.getPolicyLabelsData().AppliedPolicyId];if(n){if(this._currentRecommendedPolicyLabelId){var i=this._idToSensitivityLabel[this._currentRecommendedPolicyLabelId];i&&i.Order<=n.Order&&(this._policyManager.value.removeAutoPolicyBusinessBarEntry(29),this._currentRecommendedPolicyLabelId=null)}this._currentAutoPolicyLabelId&&this._currentAutoPolicyLabelId!==n.Id&&(this._policyManager.value.removeAutoPolicyBusinessBarEntry(28),this._currentAutoPolicyLabelId=null)}}},e.isNullOrEmpty=function(e){return!e||!e.length},t=e,(n=[{key:"isNewFile",get:function(){return s.AFrameworkApplication.isNewFile||!!this._isThisANewFile&&this._isThisANewFile()}}])&&$l(t.prototype,n),i&&$l(t,i),e}();function nc(e,t){return(nc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(tc,"PolicyActor",null,[230]),function(e){e[e.unknown=0]="unknown",e[e.boot=1]="boot",e[e.refresh=2]="refresh",e[e.selfSetPolicyLabel=3]="selfSetPolicyLabel"}(ec||(ec={})),Object(i.b)("GetPolicyLabelsReason",ec);var ic=function(e){var t,n;function i(t,n,i,r,a,o){var s;return(s=e.call(this)||this).businessBarId=t,s.title=n,s.message=i,s.buttonText=r,s.businessBarEntryHandler=a,s.isRecommended=o,s}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,nc(t,n),i}(Sys.EventArgs);function rc(e,t){return(rc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ic,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var ac,oc=function(e){var t,n;function i(t,n,i,r,a){var o;return(o=e.call(this)||this).businessBarId=t,o.title=n,o.message=i,o.buttonText=r,o.businessBarEntryHandler=a,o}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,rc(t,n),i}(Sys.EventArgs);function sc(e,t){return(sc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(oc,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]),function(e){e[e.none=0]="none",e[e.reasonDefaultLabel=1]="reasonDefaultLabel",e[e.reasonManual=2]="reasonManual",e[e.reasonAutomatic=4]="reasonAutomatic",e[e.reasonRecommended=8]="reasonRecommended",e[e.reasonMandatory=16]="reasonMandatory"}(ac||(ac={})),Object(i.b)("ApplyLabelFlags",ac);var lc=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).getPolicyLabelsReason=t,n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,sc(t,n),i}(Sys.EventArgs);function cc(e,t){return(cc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(lc,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);var uc=function(e){var t,n;function i(){return e.call(this)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,cc(t,n),i}(Sys.EventArgs);Object(i.a)(uc,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);var dc=function(){this.AreLabelsAvailable=!1,this.AppliedPolicyId=null,this.RequiredDowngradeJustification=!1,this.MandatoryLabelingEnforced=!1,this.DefaultLabelId=null,this.CustomUrl=null,this.PolicyLabelAssignmentMethod=null,this.PolicyLabelVersionToken=null,this.SensitivityLabels=null,this.AreLabelsAvailable=!1,this.AppliedPolicyId="",this.RequiredDowngradeJustification=!1,this.DefaultLabelId="",this.PolicyLabelAssignmentMethod="",this.PolicyLabelVersionToken="",this.SensitivityLabels=new Array(0),this.MandatoryLabelingEnforced=!1,this.CustomUrl=""};function hc(e,t){return(hc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(dc,"GetPolicyLabelsData",null,[]);var pc=function(e){var t,n;function i(t){var n;return void 0===t&&(t=!1),(n=e.call(this)||this).onSuccess=t,n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,hc(t,n),i}(Sys.EventArgs);function gc(e,t){return(gc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(pc,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);var mc=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this).mandatoryPolicyId=t,i.appMode=n,i}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,gc(t,n),i}(Sys.EventArgs);function fc(e,t){return(fc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(mc,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);var _c=function(e){var t,n;function i(t,n,i,r){var a;return(a=e.call(this)||this).title=t,a.policyText=n,a.buttonText=i,a.onButtonClickCallback=r,a}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,fc(t,n),i}(Sys.EventArgs);function vc(e,t){return(vc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(_c,"PolicyTipEventArgs",Sys.EventArgs,[]);var yc=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this).businessBarId=t,i.isRecommended=n,i}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,vc(t,n),i}(Sys.EventArgs);function Sc(e,t){return(Sc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(yc,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var bc=function(e){var t,n;function i(){return e.call(this)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Sc(t,n),i}(Sys.EventArgs);function Cc(e,t){return(Cc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(bc,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Ac=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this).policyLabelId=t,i.applyLabelFlag=n,i}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Cc(t,n),i}(Sys.EventArgs);function Tc(e,t){return(Tc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Ac,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);var wc=function(e){var t,n;function i(t,n,i){var r;return(r=e.call(this)||this).errorType=t,r.applyLabelFlags=n,r.showMessage=i,r}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Tc(t,n),i}(Sys.EventArgs);function kc(e,t){return(kc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(wc,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);var Ic=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).applyLabelFlags=t,n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,kc(t,n),i}(Sys.EventArgs);Object(i.a)(Ic,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);var Fc=function(e,t,n,i,r,a,o,s,l,c,u,d,h,p,g,m,f,_,v,y){void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=!1),void 0===u&&(u=null),void 0===d&&(d=null),void 0===h&&(h=null),void 0===p&&(p=null),void 0===g&&(g=!1),void 0===m&&(m=null),void 0===f&&(f=null),void 0===_&&(_=null),void 0===v&&(v=null),void 0===y&&(y=null),this.url=e,this.verb=t,this.body=n,this.headers=i,this.shouldSetResponseXml=r,this.priority=a,this.state=o,this.watchName=s,this.requestorId=l,this.isSynchronous=c,this.queueTimeoutMs=u,this.sentTimeoutMs=d,this.name=h,this.overwriteSessionId=p,this.forceSynchronousNotify=g,this.overwriteVersion=m,this.extraInfo=f,this.invokedCallback=_,this.responseHeadersToSet=v,this.hostAttributionInfo=y};Object(i.a)(Fc,"ClientRequest",null,[]);var Ec=n(241),Pc=n(183),Oc=n(39);function Rc(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Mc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mc(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Mc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Dc(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var xc=function(){function e(e,t,n,i,r,o){void 0===i&&(i=0),void 0===r&&(r=null),void 0===o&&(o=0),this._editorsTableManager=null,this._dataLossNavigateUrl=null,this._getPolicyCalls=0,this._getLabelPolicyCalls=0,this._setPolicyLabelCalls=0,this._appliedPolicyId="",this._lockId=null,this._amITheOnlyCoauthor=null,this._areAllCoauthorsInSessionClientMipTrusted=null,this._labelChangedByCoauthorCallback=null,this._policyCallTimeStopwatch=null,this._getLabelPolicyCallTimeStopwatch=null,this._setLabelPolicyCallTimeStopwatch=null,this._policyParseAndHandleResponseStopwatch=null,this._eventSource=new a.a,this._rtc=null,this.getPolicyLabelStartTime=null,this.setPolicyLabelStartTime=null,this._isAutoPolicyLabelHandlerEventRaised=!1,this._appSettingsManager=e,this._clientRequestManager=t,this._stopwatchBuilder=n,this._maxPolicyRetries=i,this._policyLabelsData=new dc,this._policyHandlerEndpointName=this._appSettingsManager.getStringAppSetting("PolicyHandlerEndpointName")||"PolicyHandler.ashx",this._applicationFeatureHelperFuture=r,this._officeAppType=o?this.officeAppTypeToString(o):this.officeAppTypeToString(s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType),this.isApplyManualPolicyLabelEnabled=e.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled"),this.isCoAuthForProtectedFilesEnabled=e.getBooleanAppSetting("CoAuthForProtectedFilesIsEnabled"),this.supportsOfficeClientCoauthoring=e.getBooleanAppSetting("SupportsOfficeClientCoauthoring"),this._clpKpiIsEnabled=e.getBooleanAppSetting("ClpKpiIsEnabled"),this.isSetPolicyLabelZeroByteFailureRetryEnabled=!1,this.setPolicyLabelZeroByteFailureRetryIntervalMs=3e4,this._taskManager=b.a.instance,e.getBooleanAppSetting("SupportsPolicies")&&c.a("MipSupportsPolicies"),this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&c.a("MipSupportsOfficeClientCoauthoring")}var t,n,i,o=e.prototype;return o.add_policyTipHandler=function(e){this._eventSource.addHandler("PolicyTipEvent",e)},o.remove_policyTipHandler=function(e){this._eventSource.removeHandler("PolicyTipEvent",e)},o.add_labelInfoUpdateHandler=function(e){this._eventSource.addHandler("LabelInfoUpdateEvent",e)},o.remove_labelInfoUpdateHandler=function(e){this._eventSource.removeHandler("LabelInfoUpdateEvent",e)},o.add_setPolicyLabelTriggeredHandler=function(e){this._eventSource.addHandler("SetPolicyLabelTriggeredEventKey",e)},o.remove_setPolicyLabelTriggeredHandler=function(e){this._eventSource.removeHandler("SetPolicyLabelTriggeredEventKey",e)},o.add_setPolicyLabelHandler=function(e){this._eventSource.addHandler("SetPolicyLabelEventKey",e)},o.remove_setPolicyLabelHandler=function(e){this._eventSource.removeHandler("SetPolicyLabelEventKey",e)},o.add_setPolicyLabelFailureHandler=function(e){this._eventSource.addHandler("SetPolicyLabelFailureEventKey",e)},o.remove_setPolicyLabelFailureHandler=function(e){this._eventSource.removeHandler("SetPolicyLabelFailureEventKey",e)},o.add_getPolicyLabelHandler=function(e){this._eventSource.addHandler("GetPolicyLabelEventKey",e)},o.remove_getPolicyLabelHandler=function(e){this._eventSource.removeHandler("GetPolicyLabelEventKey",e)},o.add_getPolicyLabelFailureHandler=function(e){this._eventSource.addHandler("GetPolicyLabelFailureEventKey",e)},o.remove_getPolicyLabelFailureHandler=function(e){this._eventSource.removeHandler("GetPolicyLabelFailureEventKey",e)},o.add_getAutoPolicyLabelHandler=function(e){this._eventSource.addHandler("GetAutoPolicyLabelEventKey",e),this.isAutoPolicyLabelHandlerEventRaised&&(p.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.raiseGetAutoPolicyLabelHandlerEvent(new lc(0)))},o.remove_getAutoPolicyLabelHandler=function(e){this._eventSource.removeHandler("GetAutoPolicyLabelEventKey",e)},o.add_addAutoPolicyBusinessBarEntryHandler=function(e){this._eventSource.addHandler("AddAutoPolicyBusinessBarEntryEventKey",e)},o.remove_addAutoPolicyBusinessBarEntryHandler=function(e){this._eventSource.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",e)},o.add_removeAutoPolicyBusinessBarEntryHandler=function(e){this._eventSource.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",e)},o.remove_removeAutoPolicyBusinessBarEntryHandler=function(e){this._eventSource.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",e)},o.add_addMandatoryLabellingBusinessBarHandler=function(e){this._eventSource.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",e)},o.remove_addMandatoryLabellingBusinessBarHandler=function(e){this._eventSource.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",e)},o.add_removeMandatoryLabellingBusinessBarHandler=function(e){this._eventSource.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",e)},o.remove_removeMandatoryLabellingBusinessBarHandler=function(e){this._eventSource.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",e)},o.add_mandatoryLabellingAppHandler=function(e){this._eventSource.addHandler("MandatoryLabellingAppHandlerEventKey",e)},o.remove_mandatoryLabellingAppHandler=function(e){this._eventSource.removeHandler("MandatoryLabellingAppHandlerEventKey",e)},o.initRtcBasicProvider=function(e){e&&this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&e.execute(Object(r.a)(this,this.awaitRtc,"awaitRtc"))},o.initEditorsTableManager=function(e){var t=this;e&&this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&e.continueWith((function(n){t._editorsTableManager=e.result}))},o.registerAreAllCoauthorsInSessionClientMipTrustedCheck=function(e){this._areAllCoauthorsInSessionClientMipTrusted=e},o.registerLabelChangedByCoauthorCallback=function(e){this._labelChangedByCoauthorCallback=e},o.getCurrentTime=function(){return(new Date).getTime()},o.awaitRtc=function(e){var t=this;if(!this.isRtcInitialized){var n=e.getInstanceAsRealtimeChannelBasicAsync();n.continueWith((function(e){t._rtc=n.result,t._rtc.add_updateNotificationReceived(Object(r.a)(t,t.onLabelChangeUpdateOverRtc,"onLabelChangeUpdateOverRtc"))}))}},o.onLabelChangeUpdateOverRtc=function(e,t){12===t.type&&(this._labelChangedByCoauthorCallback?this._labelChangedByCoauthorCallback():this.getDocumentPolicyLabelsRequestAsync(this._appliedPolicyId,2,this._amITheOnlyCoauthor,!0))},o.getDocumentPolicyRequestAsync=function(){this._stopwatchBuilder&&(this._policyCallTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","Call Get Policy Endpoint On Server"));var e=Pc.a.createForCurrentApp(1,1);if(this._appSettingsManager.getBooleanAppSetting("SendHostAttributionInfoForPolicyLabelEnabled")){var t=new Fc(this.getPolicyRequestUrl("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);this._clientRequestManager.send(t).registerCallbacks(Object(r.a)(this,this.onDataLossPolicySuccessCallback,"onDataLossPolicySuccessCallback"),Object(r.a)(this,this.onDataLossPolicyFailureCallback,"onDataLossPolicyFailureCallback"))}else this._clientRequestManager.addRequest(this.getPolicyRequestUrl("datalosspolicy"),1,null,null,!0,2,Object(r.a)(this,this.onDataLossPolicySuccessCallback,"onDataLossPolicySuccessCallback"),Object(r.a)(this,this.onDataLossPolicyFailureCallback,"onDataLossPolicyFailureCallback"),null);this._getPolicyCalls++,p.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this._policyHandlerEndpointName,this._getPolicyCalls)},o.getDocumentPolicyLabelsRequestAsync=function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=null),void 0===i&&(i=!1),this._clpKpiIsEnabled&&(l.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.getExtendedPropertiesForLogging(void 0,t)),this.getPolicyLabelStartTime=this.getCurrentTime());var r=this.createHostAttributionInfoFromGetPolicyLabelsReason(t);this.getDocumentPolicyLabelsRequestInternalAsync(e,r,n,i,t)},o.getPolicyLabelsData=function(){return this._policyLabelsData},o.onDataLossPolicySuccessCallback=function(e){var t;this.policyCallWatchStop();var n="";(t=this.tryGetResponseData(e,n),n=t.data,t).returnValue&&(p.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this._getPolicyCalls=0,this._stopwatchBuilder&&(this._policyParseAndHandleResponseStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("Task","Parse and Handle Get Policy Response")),this.parseAndHandlePolicyResponse(n),this._policyParseAndHandleResponseStopwatch&&(this._policyParseAndHandleResponseStopwatch.stop(),this._policyParseAndHandleResponseStopwatch=null))},o.onDataLossPolicyFailureCallback=function(e){this.policyCallWatchStop(),this._getPolicyCalls<=this._maxPolicyRetries?this.getDocumentPolicyRequestAsync():(p.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",e&&e.data?e.data.responseXml:null),this._getPolicyCalls=0)},o.isSetPolicyLabelRequestInProgress=function(){return this._setPolicyLabelCalls>0},o.setPolicyLabel=function(e){this._policyLabelsData.AppliedPolicyId=e},o.setPolicyLabelRequestAsync=function(e,t,n){void 0===n&&(n=null);var i=this.createHostAttributionInfoFromRequestState(n);this.setPolicyLabelRequestInternalAsync(e,t,i,n)},o.onSetPolicyLabelSuccessCallback=function(e){var t,n,i;this._setLabelPolicyCallTimeStopwatch&&(this._setLabelPolicyCallTimeStopwatch.stop(),this._setLabelPolicyCallTimeStopwatch=null);var r=this.getSetPolicyLabelDataFromHeader(e,n,i);n=r.selectedPolicyLabelId,i=r.setPolicyLabelJustification;var a=e.data.state,o=a?a.applyLabelFlag:2,s="";(t=this.tryGetResponseData(e,s),s=t.data,t).returnValue?(p.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",o),this._setPolicyLabelCalls=0,this.parseSetPolicyLabelDataResponse(s,n,i,a)):this.revertAppliedPolicyId(o)},o.raiseSetPolicyLabelTriggeredEvent=function(e){this._clpKpiIsEnabled&&(l.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.getExtendedPropertiesForLogging(e)),this.setPolicyLabelStartTime=this.getCurrentTime()),p.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event."),this._eventSource.raiseEvent("SetPolicyLabelTriggeredEventKey",new Ic(e))},o.notifyCoauthorsOfLabelChangeOverRtc=function(){this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&this.isRtcInitialized&&this._rtc.sendUpdateNotification(12,null,!0)},o.onSetPolicyLabelFailureCallback=function(e){var t,n;this._setLabelPolicyCallTimeStopwatch&&(this._setLabelPolicyCallTimeStopwatch.stop(),this._setLabelPolicyCallTimeStopwatch=null);var i=this.getSetPolicyLabelDataFromHeader(e,t,n);if(t=i.selectedPolicyLabelId,n=i.setPolicyLabelJustification,this._setPolicyLabelCalls<=this._maxPolicyRetries)this.setPolicyLabelRequestAsync(t,n);else{var r=e.data.state,a=r?r.applyLabelFlag:2;p.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",e&&e.data?e.data.responseXml:null,a),this._setPolicyLabelCalls=0,this.revertAppliedPolicyId(a)}},o.canSetPolicyLabelInCoauthSession=function(e){if(!e)return!1;for(var t,n=null,i=null,r=Rc(this._policyLabelsData.SensitivityLabels);!(t=r()).done;){var a=t.value;a.Id===e&&(n=a),a.Id===this._appliedPolicyId&&(i=a)}if(!n)return!1;if(this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring){if(this._areAllCoauthorsInSessionClientMipTrusted&&this._areAllCoauthorsInSessionClientMipTrusted()||this.isEveryCoauthorInSessionClientMipTrusted)return!0}else if(s.AFrameworkApplication.coauthManager&&s.AFrameworkApplication.coauthManager.getAmIAlone||this._amITheOnlyCoauthor&&this._amITheOnlyCoauthor())return!0;return n.IsEndpointProtectionEnabled===(!!i&&i.IsEndpointProtectionEnabled)},o.addAutoPolicyBusinessBarEntry=function(e,t,n,i,r){28===e?this.raiseAddAutoPolicyBusinessBarEntryHandlerEvent(new ic(e,t,n,i,r,!1)):this.raiseAddAutoPolicyBusinessBarEntryHandlerEvent(new ic(e,t,n,i,r,!0))},o.removeAutoPolicyBusinessBarEntry=function(e){28===e?this.raiseRemoveAutoPolicyBusinessBarEntryHandlerEvent(new yc(e,!1)):this.raiseRemoveAutoPolicyBusinessBarEntryHandlerEvent(new yc(e,!0))},o.raiseMandatoryLabellingAppHandlerEvent=function(e,t){var n=1===t?"Reading":"Edit";p.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+n+" switch event."),this._eventSource.raiseEvent("MandatoryLabellingAppHandlerEventKey",new mc(e,t))},o.addMandatoryLabellingBusinessBarEntry=function(e,t,n,i,r){37===e&&this.raiseAddMandatoryLabellingBusinessBarEntryHandlerEvent(new oc(37,t,n,i,r))},o.removeMandatoryLabellingBusinessBarEntry=function(){this.raiseRemoveMandatoryLabellingBusinessBarEntryHandlerEvent(new bc)},o.areLabelsAvailableForDisplay=function(){return!!this._policyLabelsData&&this._policyLabelsData.AreLabelsAvailable&&!!this._policyLabelsData.SensitivityLabels&&this._policyLabelsData.SensitivityLabels.length>0&&Ec.a.any(this._policyLabelsData.SensitivityLabels,(function(e){return!!e&&e.Enabled}))},o.onGetPolicyLabelsSuccessCallback=function(e){var t;this._getLabelPolicyCallTimeStopwatch&&(this._getLabelPolicyCallTimeStopwatch.stop(),this._getLabelPolicyCallTimeStopwatch=null);var n="";if((t=this.tryGetResponseData(e,n),n=t.data,t).returnValue){p.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this._getLabelPolicyCalls=0;var i=this.parseGetPolicyLabelDataResponse(n),r=this.getPolicyLabelsReasonFromRequestItem(e.data);this._clpKpiIsEnabled&&(l.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.getAdditionalValuesForLogging(void 0,r,this.getPolicyLabelStartTime)),this.getPolicyLabelStartTime=null);var a=new lc(r);this.raiseGetPolicyLabelHandlerEvent(a),!this.isAutoPolicyLabelHandlerEventRaised&&i&&this._appSettingsManager.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled")&&this.areAutoLabelingSensitiveTypesAvailable()&&(this.raiseGetAutoPolicyLabelHandlerEvent(a),this._isAutoPolicyLabelHandlerEventRaised=!0)}else this.raiseGetPolicyLabelFailureHandlerEvent()},o.onGetPolicyLabelsFailureCallback=function(e){var t=this.getPolicyLabelsReasonFromRequestItem(e.data);if(this._clpKpiIsEnabled&&(l.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.getAdditionalValuesForLogging(void 0,t,this.getPolicyLabelStartTime)),this.getPolicyLabelStartTime=null),this._getLabelPolicyCallTimeStopwatch&&(this._getLabelPolicyCallTimeStopwatch.stop(),this._getLabelPolicyCallTimeStopwatch=null),this._getLabelPolicyCalls<=this._maxPolicyRetries){if(this._appSettingsManager.getBooleanAppSetting("SendHostAttributionInfoForPolicyLabelEnabled")){var n=e.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in n&&n[Pc.a.scenarioParamName]&&"HostAttributionInfo.ScenarioTypeParamName"in n&&n[Pc.a.scenarioTypeParamName]){e.data.request.get_headers()[Pc.a.scenarioParamName],e.data.request.get_headers()[Pc.a.scenarioTypeParamName];var i=this.createHostAttributionInfoFromGetPolicyLabelsReason(t);return void this.getDocumentPolicyLabelsRequestInternalAsync(this._appliedPolicyId,i,this._amITheOnlyCoauthor,void 0,t)}}this.getDocumentPolicyLabelsRequestAsync(this._appliedPolicyId,t,this._amITheOnlyCoauthor)}else p.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",e&&e.data?e.data.responseXml:null),this.raiseGetPolicyLabelFailureHandlerEvent(),this._getLabelPolicyCalls=0},o.getPolicyLabelsReasonFromRequestItem=function(e){return e.state?e.state:0},o.getPolicyRequestUrl=function(e,t){void 0===t&&(t=!1);var n=this._appSettingsManager.getStringAppSetting("PolicyHandlerWebServiceBase")||s.AFrameworkApplication.activeFrame.applicationInstance.newAndOpenHandlerUrlPrefix,i=String.format("{0}{1}?action={2}&{3}",n,this._policyHandlerEndpointName,e,s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion);return"setpolicylabel"===e&&s.AFrameworkApplication.coauthManager&&s.AFrameworkApplication.coauthManager.isFileCoauthorable&&(i=Dt.a.addOrReplaceParameterValue(i,"sl","1")),t&&(i=Dt.a.addOrReplaceParameterValue(i,"cbd","1")),i},o.getSetPolicyLabelDataFromHeader=function(e,t,n){return t=n=null,e&&e.data&&e.data.request&&e.data.request.get_headers()&&(t=e.data.request.get_headers()[bo.a.selectedPolicyLabelIdHeaderName],n=e.data.request.get_headers()[bo.a.setPolicyLabelJustificationHeaderName]),{selectedPolicyLabelId:t,setPolicyLabelJustification:n}},o.tryGetResponseData=function(e,t){return(t=e&&e.data?e.data.responseData:null)&&t.length&&!this.isServiceUnavailableResponse(t)?{returnValue:!0,data:t}:(p.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,data:t})},o.parseAndHandlePolicyResponse=function(e){var t;try{t=B.b(e)}catch(e){return void p.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.")}if(t)if(t.IsPolicyTipAvailable)switch(t.IsPolicyTipAvailable.toLowerCase()){case"false":return void p.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");case"true":p.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document."),this._dataLossNavigateUrl=t.NavigateUrl,this.showPolicyTip(t.GeneralText,Object(r.a)(this,this.onDataLossPolicyOverrideButtonClick,"onDataLossPolicyOverrideButtonClick"));break;default:p.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",t.IsPolicyTipAvailable)}else p.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else p.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")},o.parseSetPolicyLabelDataResponse=function(e,t,n,i){var r,a,o=this,s=i?i.applyLabelFlag:2,d=0,h="",g="";if((r=B.d(e,a),a=r.deserialized,r).returnValue)if(a){g="Success";var m=this.createHostAttributionInfoFromGetPolicyLabelsReason(3);if(a.IsSuccessful)return this._clpKpiIsEnabled&&(l.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.getAdditionalValuesForLogging(s,void 0,this.setPolicyLabelStartTime)),this.setPolicyLabelStartTime=null),p.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",s),2===s&&this.removeAutoPolicyBusinessBarEntry(29),this.setSelectedPolicyId(t,s),this.notifyCoauthorsOfLabelChangeOverRtc(),this.removeAutoPolicyBusinessBarEntry(28),i&&4===s&&this.addAutoPolicyBusinessBarEntry(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,i.displayName),CommonUIStrings.l_DialogOk,(function(e){})),c.a("MipAppliedLabels",void 0,void 0,[Object.assign(new Oc.a,{name:"SetPolicyLabelApplyFlag",string:ac[s]})]),void this.getDocumentPolicyLabelsRequestInternalAsync(t,m,this._amITheOnlyCoauthor,void 0,3);if(p.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",s,a.FailureReason),h=a.FailureReason,"FileTooLarge"===a.FailureReason?d=1:"LabelNotSupported"===a.FailureReason?d=2:this._appSettingsManager.getBooleanAppSetting("ClpLabelDisabledErrorCodeIsEnabled")&&"LabelDisabled"===a.FailureReason&&(d=3),this.isSetPolicyLabelZeroByteFailureRetryEnabled&&a.FailureReason.indexOf("InvalidOperationOnZeroByteFile")>=0){var f=new u.a(2,1,this.setPolicyLabelZeroByteFailureRetryIntervalMs,(function(e){p.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",o._setPolicyLabelCalls),o._setPolicyLabelCalls<=o._maxPolicyRetries&&o.setPolicyLabelRequestAsync(t,n)}));this._taskManager.addTask(f)}this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&this.getDocumentPolicyLabelsRequestInternalAsync(this._policyLabelsData.AppliedPolicyId,m,this._amITheOnlyCoauthor,!0,3)}else g="setPolicyLabelData null.",p.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",s);else g="TryDeserialize failed.",p.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",s);if(this.revertAppliedPolicyId(s,d),this._clpKpiIsEnabled){var _=this.getAdditionalValuesForLogging(s,void 0,this.setPolicyLabelStartTime);this.setPolicyLabelStartTime=null,_.extendedProperties.set("SetPolicyLabelDataFailureReason",h.toString()),_.extendedProperties.set("SetPolicyLabelDataParseStatus",g.toString()),l.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,_)}},o.revertAppliedPolicyId=function(e,t){void 0===t&&(t=0),this.setPolicyLabel(this._appliedPolicyId),this.raiseLabelInfoUpdateEvent(new pc);var n=2===e||8===e||16===e;this.raiseSetPolicyLabelFailureEvent(t,e,n,!1)},o.setSelectedPolicyId=function(e,t){if(this.setPolicyLabel(this._appliedPolicyId=e),""===e)s.AFrameworkApplication.protectFile=!1,s.AFrameworkApplication.protectedFile=!1,s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("AddInsInSupportedIrmDocsIsEnabled")&&(s.AFrameworkApplication.enableMacrosForProtectedFile=!1);else for(var n,i=Rc(this._policyLabelsData.SensitivityLabels);!(n=i()).done;){var r=n.value;if(r.Id===e){s.AFrameworkApplication.protectFile=r.IsEndpointProtectionEnabled,s.AFrameworkApplication.protectedFile=r.IsEndpointProtectionEnabled;break}}this.raiseSetPolicyLabelEvent(new Ac(e,t))},o.parseGetPolicyLabelDataResponse=function(e){var t,n;return(t=B.d(e,n),n=t.deserialized,t).returnValue?n?!!n.AreLabelsAvailable&&(this._policyLabelsData=n,this._appliedPolicyId=n.AppliedPolicyId,this.areLabelsAvailableForDisplay()&&p.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call."),this.raiseLabelInfoUpdateEvent(new pc(!0)),!0):(p.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1):(p.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1)},o.areAutoLabelingSensitiveTypesAvailable=function(){if(!this.areLabelsAvailableForDisplay())return!1;for(var e,t=Rc(this._policyLabelsData.SensitivityLabels);!(e=t()).done;){var n=e.value;if(n&&n.AutoLabelingSensitiveTypeIds&&n.AutoLabelingSensitiveTypeIds.length>0)return!0}return!1},o.raiseLabelInfoUpdateEvent=function(e){p.ULS.sendTraceTag(35393610,306,50,"Raising label info update event."),this._eventSource.raiseEvent("LabelInfoUpdateEvent",e)},o.raiseGetPolicyLabelHandlerEvent=function(e){p.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event."),this._eventSource.raiseEvent("GetPolicyLabelEventKey",e)},o.raiseGetPolicyLabelFailureHandlerEvent=function(){this._eventSource.raiseEvent("GetPolicyLabelFailureEventKey",new uc)},o.raiseGetAutoPolicyLabelHandlerEvent=function(e){var t=this;this._applicationFeatureHelperFuture&&this._applicationFeatureHelperFuture.execute((function(n){var i=[n.isFeatureEnabled("MsoClpSpTwo",!0),n.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(i).then((function(n){return Ec.a.any(n,(function(e){return e}))&&(p.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),t._eventSource.raiseEvent("GetAutoPolicyLabelEventKey",e),c.a("MipAutoClassificationEnabled")),null}))}))},o.getExtendedPropertiesForLogging=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var n=new Map;return n.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString()),null!=e&&n.set("ApplyLabelFlags",ac[e]),null!=t&&n.set("GetPolicyLabelsReason",ec[t]),n},o.getAdditionalValuesForLogging=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null);var i=new V.a;return i.extendedProperties=this.getExtendedPropertiesForLogging(e,t),null!=n&&(i.durationMs=this.getCurrentTime()-n),i},o.raiseSetPolicyLabelEvent=function(e){p.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event."),this._eventSource.raiseEvent("SetPolicyLabelEventKey",e)},o.raiseAddAutoPolicyBusinessBarEntryHandlerEvent=function(e){p.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event."),e&&e.isRecommended&&c.a("MipRecommendations"),this._eventSource.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",e)},o.raiseRemoveAutoPolicyBusinessBarEntryHandlerEvent=function(e){p.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event."),this._eventSource.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",e)},o.raiseAddMandatoryLabellingBusinessBarEntryHandlerEvent=function(e){p.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event."),this._eventSource.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",e)},o.raiseRemoveMandatoryLabellingBusinessBarEntryHandlerEvent=function(e){p.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event."),this._eventSource.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",e)},o.showPolicyTip=function(e,t){void 0===t&&(t=null),p.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user."),this._eventSource.raiseEvent("PolicyTipEvent",new _c(CommonUIStrings.l_PolicyBusinessBarTitle,e,CommonUIStrings.l_PolicyOverrideButton,t))},o.raiseSetPolicyLabelFailureEvent=function(e,t,n,i){void 0===i&&(i=!0),p.ULS.sendTraceTag(42074656,306,i?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",t),this._eventSource.raiseEvent("SetPolicyLabelFailureEventKey",new wc(e,t,n))},o.setLockId=function(e){this._lockId=e},o.onDataLossPolicyOverrideButtonClick=function(e){this._dataLossNavigateUrl?(p.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),nt.a.followHyperlinkWithNoReferrer(this._dataLossNavigateUrl)):p.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")},o.isServiceUnavailableResponse=function(e){return!(!e.startsWith("<")||-1===e.indexOf("Error")&&-1===e.indexOf("Unavailable"))&&(p.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint."),!0)},o.policyCallWatchStop=function(){this._policyCallTimeStopwatch&&(this._policyCallTimeStopwatch.stop(),this._policyCallTimeStopwatch=null)},o.getActionSourceStringFromPolicyLabelRequestState=function(e){if(!e)return"manual";switch(e.applyLabelFlag){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";default:return"manual"}},o.getAssignmentMethodStringFromPolicyLabelRequestState=function(e){if(!e)return"privileged";var t=e.applyLabelFlag,n="privileged";return 4!==t&&1!==t||(n="standard"),n},o.officeAppTypeToString=function(e){switch(e){case 1:return"Excel";case 4:return"OneNote";case 2:return"PowerPoint";case 5:return"Visio";case 3:return"Word";case 0:default:return"Unknown"}},o.getDocumentPolicyLabelsRequestInternalAsync=function(e,t,n,i,a){if(void 0===n&&(n=null),void 0===i&&(i=!1),void 0===a&&(a=0),this._appSettingsManager.getBooleanAppSetting("WacLabelingGetPolicyLabelsIsEnabled")){this._appliedPolicyId=e,this._amITheOnlyCoauthor=n,this._stopwatchBuilder&&(this._getLabelPolicyCallTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","Call Get Policy Endpoint On Server"));var o={};if(o[bo.a.appliedPolicyIdHeaderName]=e,this._appSettingsManager.getBooleanAppSetting("SendHostAttributionInfoForPolicyLabelEnabled")){var s=new Fc(this.getPolicyRequestUrl("getpolicylabels",i),1,null,o,!0,2,a,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,t);this._clientRequestManager.send(s).registerCallbacks(Object(r.a)(this,this.onGetPolicyLabelsSuccessCallback,"onGetPolicyLabelsSuccessCallback"),Object(r.a)(this,this.onGetPolicyLabelsFailureCallback,"onGetPolicyLabelsFailureCallback"))}else this._clientRequestManager.addRequest(this.getPolicyRequestUrl("getpolicylabels",i),1,null,o,!0,2,Object(r.a)(this,this.onGetPolicyLabelsSuccessCallback,"onGetPolicyLabelsSuccessCallback"),Object(r.a)(this,this.onGetPolicyLabelsFailureCallback,"onGetPolicyLabelsFailureCallback"),a,void 0,void 0,void 0,void 0,"22");this._getLabelPolicyCalls++,p.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this._getLabelPolicyCalls)}},o.setPolicyLabelRequestInternalAsync=function(e,t,n,i){if(void 0===i&&(i=null),this.isApplyManualPolicyLabelEnabled){this._stopwatchBuilder&&(this._setLabelPolicyCallTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","Call Set Policy Endpoint On Server"));var a={};if(a[bo.a.selectedPolicyLabelIdHeaderName]=e,t&&(a[bo.a.setPolicyLabelJustificationHeaderName]=encodeURIComponent(t)),this._lockId&&(a[bo.a.appLockIdHeaderName]=this._lockId),i?(a[bo.a.setPolicyLabelActionSourceHeaderName]=this.getActionSourceStringFromPolicyLabelRequestState(i),a[bo.a.setPolicyLabelAssignmentMethodHeaderName]=this.getAssignmentMethodStringFromPolicyLabelRequestState(i)):(a[bo.a.setPolicyLabelActionSourceHeaderName]="manual",a[bo.a.setPolicyLabelAssignmentMethodHeaderName]="privileged"),this.supportsOfficeClientCoauthoring&&this._policyLabelsData&&(a[bo.a.policyLabelVersionTokenHeaderName]=this._policyLabelsData.PolicyLabelVersionToken),this._appSettingsManager.getBooleanAppSetting("SendHostAttributionInfoForPolicyLabelEnabled")){var o=new Fc(this.getPolicyRequestUrl("setpolicylabel",!0),1,null,a,!0,2,i,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,n);this._clientRequestManager.send(o).registerCallbacks(Object(r.a)(this,this.onSetPolicyLabelSuccessCallback,"onSetPolicyLabelSuccessCallback"),Object(r.a)(this,this.onSetPolicyLabelFailureCallback,"onSetPolicyLabelFailureCallback"))}else this._clientRequestManager.addRequest(this.getPolicyRequestUrl("setpolicylabel",!0),1,null,a,!0,2,Object(r.a)(this,this.onSetPolicyLabelSuccessCallback,"onSetPolicyLabelSuccessCallback"),Object(r.a)(this,this.onSetPolicyLabelFailureCallback,"onSetPolicyLabelFailureCallback"),i,void 0,void 0,void 0,void 0,"32");this._setPolicyLabelCalls++,p.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this._setPolicyLabelCalls)}else p.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")},o.createHostAttributionInfoFromGetPolicyLabelsReason=function(e){switch(e){case 1:return Pc.a.createForCurrentApp(1,1);case 2:return Pc.a.createForCurrentApp(7,1);case 3:return Pc.a.createForCurrentApp(8,1);case 0:default:return Pc.a.createForCurrentApp(7,0)}},o.createHostAttributionInfoFromRequestState=function(e){if(void 0===e&&(e=null),!e)return Pc.a.createForCurrentApp(8,0);switch(e.applyLabelFlag){case 1:case 16:return Pc.a.createForCurrentApp(1,1);case 4:case 2:case 8:return Pc.a.createForCurrentApp(8,1);case 0:default:return Pc.a.createForCurrentApp(8,0)}},t=e,(n=[{key:"isAutoPolicyLabelHandlerEventRaised",get:function(){return this._isAutoPolicyLabelHandlerEventRaised}},{key:"isEveryCoauthorInSessionClientMipTrusted",get:function(){if(!this._editorsTableManager)return!1;for(var e,t=Rc(this._editorsTableManager.getAllAuthors());!(e=t()).done;){var n=e.value;if(!n.Capabilities||!n.Capabilities.SupportsClientIsMipTrusted)return!1}return!0}},{key:"isRtcInitialized",get:function(){return!!this._rtc}}])&&Dc(t.prototype,n),i&&Dc(t,i),e}();function Lc(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(xc,"PolicyManager",null,[206]);var Bc=function(){function e(){this._policyManager=null,this._container=null,this._policyActor=null,this._businessBar=null,this._autoLabellingBusinessBarEntry=null,this._recommendedLabellingBusinessBarEntry=null,this._mandatoryLabellingBusinessBarEntry=null,this._policyTipBusinessBarEntry=null,this._setPolicyErrorBusinessBarEntry=null}var t,n,i,a=e.prototype;return a.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ShouldInitCommonPolicyPackage")&&(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsDataLossPreventionEnabledForUser")&&s.AFrameworkApplication.activeFrame&&(this._policyManager=this._container.resolve("Common.App.Policy.Contracts.IPolicyManager"),this._policyManager.add_policyTipHandler(Object(r.a)(this,this.showPolicyBusinessBar,"showPolicyBusinessBar")),p.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),Ot.a.get_instance().executeWhen(6,(function(){e._policyManager.getDocumentPolicyRequestAsync()}))),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WacLabelingPoliciesIsEnabled")&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SupportsPolicies")&&Ot.a.get_instance().executeWhen(6,Object(r.a)(this,this.onAfterRibbonBehaviorAttached,"onAfterRibbonBehaviorAttached")))},a.dispose=function(){},a.configure=function(e){e.register(206,"Common.App.Policy.Contracts.IPolicyManager").singleInstance().usingFactory((function(){return new xc(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager,s.AFrameworkApplication.activeFrame.theStopwatchBuilder,s.AFrameworkApplication.appSettingsManager.getIntAppSetting("MaxGetPolicyRetries",1),e.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType)})),e.register(tc,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").singleInstance().usingFactory((function(){return new tc(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.activeFrame,s.AFrameworkApplication.appSettingsManager,e.resolveLazy("Common.App.Policy.Contracts.IPolicyManager"))})),this._container=e},a.onAfterRibbonBehaviorAttached=function(){this._policyActor=this._container.resolve("Common.App.Policy.PolicyActor"),this._policyActor.registerActions(),this._businessBar=this._container.tryResolve("CommonUI.BusinessBar"),this._policyManager||(this._policyManager=this._container.resolve("Common.App.Policy.Contracts.IPolicyManager")),this._policyManager.add_labelInfoUpdateHandler(Object(r.a)(this,this.updateLabelInfo,"updateLabelInfo")),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled")&&(this._policyManager.add_setPolicyLabelFailureHandler(Object(r.a)(this,this.handleSetPolicyLabelFailure,"handleSetPolicyLabelFailure")),this._policyManager.add_addAutoPolicyBusinessBarEntryHandler(Object(r.a)(this,this.addAutoPolicyBusinessBarEntry,"addAutoPolicyBusinessBarEntry")),this._policyManager.add_removeAutoPolicyBusinessBarEntryHandler(Object(r.a)(this,this.removeAutoPolicyBusinessBarEntry,"removeAutoPolicyBusinessBarEntry")),this._policyManager.add_addMandatoryLabellingBusinessBarHandler(Object(r.a)(this,this.addMandatoryLabellingBusinessBarEntry,"addMandatoryLabellingBusinessBarEntry")),this._policyManager.add_removeMandatoryLabellingBusinessBarHandler(Object(r.a)(this,this.removeMandatoryLabellingBusinessBarEntry,"removeMandatoryLabellingBusinessBarEntry")))},a.updateLabelInfo=function(e,t){this._policyActor.setParentToChildSensitivityLabelsDictionary(),this._policyActor.setIdToSensitivityDictionary(),this._policyActor.querySensitivityControl(),!s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WacBlockNoEditRightsSetLabelIsEnabled",!1)||s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("HasDocumentEditRights")?(this._policyActor.setDefaultLabelIfNeeded(),s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WacApplyMandatoryLabellingIsEnabled",!1)&&t.onSuccess&&this._policyActor.triggerMandatoryLabellingIfNeeded()):p.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because the user doesn't have edit rights. HasDocumentEditRights: {0}",s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("HasDocumentEditRights")),s.AFrameworkApplication.activeFrame.updateCommandUI()},a.showPolicyBusinessBar=function(e,t){this._policyTipBusinessBarEntry&&this._businessBar.isEntryExistent(38)&&this._businessBar.removeEntry(this._policyTipBusinessBarEntry);var n=this.getPolicyBusinessBarEntry(t.title,t.policyText,38,null,t.onButtonClickCallback,t.buttonText);s.AFrameworkApplication.activeFrame.applicationInstance.addEntryToBusinessBar(n,!0)?(this._policyTipBusinessBarEntry=n,p.ULS.sendTraceTag(34174785,306,50,"Add entry to BusinessBar succeeded. Policy message is shown to user.")):p.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")},a.handleSetPolicyLabelFailure=function(e,t){if(t.showMessage){this._setPolicyErrorBusinessBarEntry&&this._businessBar.isEntryExistent(21)&&this._businessBar.removeEntry(this._setPolicyErrorBusinessBarEntry);var n=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle,i=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage;1===t.errorType?(n=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle,i=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage):2===t.errorType?(n=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle,i=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage):s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ClpLabelDisabledErrorCodeIsEnabled")&&3===t.errorType?(n=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle,i=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage):4===t.errorType&&(n=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle,i=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage);var r=this.getPolicyBusinessBarEntry(n,i,21);s.AFrameworkApplication.activeFrame.applicationInstance.addEntryToBusinessBar(r,!0)?(this._setPolicyErrorBusinessBarEntry=r,p.ULS.sendTraceTag(42074655,306,50,"Add entry to BusinessBar succeeded. CLP policy message is shown to user.")):p.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user.")}},a.removeAutoPolicyBusinessBarEntry=function(e,t){var n;(n=t.isRecommended?this._recommendedLabellingBusinessBarEntry:this._autoLabellingBusinessBarEntry)&&this._businessBar&&this._businessBar.isEntryExistent(t.businessBarId)&&this._businessBar.removeEntry(n)},a.addAutoPolicyBusinessBarEntry=function(e,t){if(this._businessBar){this._policyManager.removeAutoPolicyBusinessBarEntry(t.businessBarId);var n=new sl.a(t.title,t.message,null);n.id=t.businessBarId,n.closeable=!0,n.image=3,n.addButton(t.buttonText,t.businessBarEntryHandler,t.buttonText,!0),this._businessBar.addEntry(n,!1),t.isRecommended?this._recommendedLabellingBusinessBarEntry=n:this._autoLabellingBusinessBarEntry=n}},a.addMandatoryLabellingBusinessBarEntry=function(e,t){if(this._businessBar){var n=new sl.a(t.title,t.message,null);n.id=t.businessBarId,n.closeable=!1,n.image=3,n.addButton(t.buttonText,t.businessBarEntryHandler,t.buttonText,!1),this._businessBar.addEntry(n,!1),this._mandatoryLabellingBusinessBarEntry=n}},a.removeMandatoryLabellingBusinessBarEntry=function(e,t){var n=this._mandatoryLabellingBusinessBarEntry;n&&this._businessBar&&this._businessBar.isEntryExistent(n.id)&&this._businessBar.removeEntry(n)},a.getPolicyBusinessBarEntry=function(e,t,n,i,r,a){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null);var o=new sl.a(e,t,i);return o.id=n,o.closeable=!0,r&&o.addLinkWithHandler(a,r),o},e.main=function(){S.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.Policy"}}])&&Lc(t.prototype,n),i&&Lc(t,i),e}();Object(i.a)(Bc,"PackageManager",null,[20,21]);Type.registerNamespace("WELT"),Type.registerNamespace("WVAc"),Type.registerNamespace("WVCo"),Type.registerNamespace("WVHi"),Type.registerNamespace("WVSea"),Type.registerNamespace("WVSel"),Type.registerNamespace("Wac.Common"),Type.registerNamespace("Wac.Common.Actors"),Type.registerNamespace("Wac.Common.SendUsYourFile"),Type.registerNamespace("WordViewer.Embed"),Type.registerNamespace("WordViewer.SendUsYourFile"),Type.registerNamespace("Common.Comments"),Type.registerNamespace("Common.App.CommandUIActors"),Type.registerNamespace("Common.App.HostNotification"),w.main(),Type.registerNamespace("Common"),Type.registerNamespace("Common.App.ApplicationFeatureHelper"),ce.main(),Type.registerNamespace("Common.App.DisplayEnvironmentName"),me.main(),Type.registerNamespace("Common.App.GestureInput"),we.main(),Type.registerNamespace("Common.App.GestureManager"),Ze.main(),Type.registerNamespace("Common.App.SafeLinks"),Type.registerNamespace("Common.App.SafeLinks"),st.main(),Type.registerNamespace("Common.App.Embed"),Type.registerNamespace("Common.App.InProductMessaging"),Mt.main(),Type.registerNamespace("CNT"),Yt.main(),Type.registerNamespace("Common.App.NewAndOpen.Core"),S.a.instance.registerPackage(new Mn),Type.registerNamespace("Common.App.O365Shell"),Hn.main(),Type.registerNamespace("Common.App.OneDriveFilePickerApi"),ci.main(),Type.registerNamespace("Common.App.OpenInClient"),Type.registerNamespace("Common.App.SaveToCloudStorage"),wi.main(),Type.registerNamespace("Common.Search"),Type.registerNamespace("Common.App.SessionExpiration"),Type.registerNamespace("Common.App.SessionExpiration"),ar.main(),_a.main(),S.a.instance.registerPackage(new Ka),ro.main(),S.a.instance.registerPackage(new so),S.a.instance.registerPackage(new uo),Ns.main(),il.main(),Type.registerNamespace("Common.App.AppLoadStateTracker"),window.Common.App.AppLoadStateTracker.AppLoadStateTracker=rl,S.a.instance.registerPackage(new ol,7),Type.registerNamespace("Common.App.WildFire"),Fl.main(),Type.registerNamespace("Common.App.Policy"),Bc.main()},560:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(32);function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(){}var t,n,i;return e.prototype.getRegex=function(e,t){var n="g";return t.matchCase||t.matchWildCards||(n+="i"),(t.matchPrefix||t.matchWholeWord)&&(e="\\b"+e),(t.matchSuffix||t.matchWholeWord)&&(e+="\\b"),new RegExp(e,n)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(n=null)&&a(t.prototype,n),i&&a(t,i),e}();function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}o._instance=null,Object(i.a)(o,"FindUtils",null,[154]);var l=function(){function e(e,t,n,i){this._contextus=e,this._resultStart=t,this._resultEnd=n,this._resultType=i}var t,n,i;return t=e,(n=[{key:"contextus",get:function(){return this._contextus}},{key:"resultStart",get:function(){return this._resultStart}},{key:"resultEnd",get:function(){return this._resultEnd}},{key:"resultType",get:function(){return this._resultType}}])&&s(t.prototype,n),i&&s(t,i),e}();Object(i.a)(l,"SearchContext",null,[168]);var c=function(){function e(){}var t=e.prototype;return t.createSearchContext=function(e,t,n,i,r){var a,o,s=i-n;if(s>=100)a=n,o=i;else{var c;if(a=Math.max(0,n+Math.ceil(s/2)-50),o=Math.min(e.length,a+100),(a=Math.max(0,o-100))&&" "!==e.charAt(a-1)){c=Math.min(n,a+10);for(var u=a;u<c;++u)if(" "===e.charAt(u)){a=u+1;break}}if(o!==e.length&&" "!==e.charAt(o)){c=Math.max(i,o-10);for(var d=o-1;d>=c;--d)if(" "===e.charAt(d)){o=d;break}}}var h=e.substring(a,o);return new l(h,n-a,i-a,r)},t.createSearchContextFromFindResult=function(e){return this.createSearchContext(e.getOriginalText(),"",e.begin,e.end,"")},e}();Object(i.a)(c,"SearchContextFactory",null,[155]);var u=function(){function e(e){this.result=null,this.regExp=e}var t=e.prototype;return t.exec=function(e){return!!(this.result=this.regExp.exec(e))},t.getIndex=function(){return this.result.index},t.getLastIndex=function(){return this.regExp.lastIndex},e}();Object(i.a)(u,"RegularExpressionWrapper",null,[]);var d=n(11);function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p=function(){function e(){}var t,n,i,r=e.prototype;return r.preprocessQuery=function(e){var t=this.splitSearchQuery(e).join("");var n=new RegExp("(\\\\.\\\\.\\\\.)","g");return t.replace(n,"(\\.\\.\\.|\u2026)")},r.preprocessQueryWithQueryFilters=function(t){var n,i=t.text;if(n=t.matchWildCards?this.splitSearchQueryWithWildCardEnabled(i):this.splitSearchQuery(i),t.ignorePunct||t.ignoreSpace){var r="";t.ignoreSpace&&(r+="\\s"),t.ignorePunct&&(r+=e.punctuationCharacters),r="["+r+"]*";for(var a=1;a<n.length;a++)(!t.matchWildCards||"{"!==n[a].charAt(0)&&"@"!==n[a].charAt(0))&&(n[a]=r+n[a])}return n.join("")},r.parseQuery=function(e){return[e]},r.isValidWildCardStatement=function(e){for(var t=0;t<e.length;++t){var n=e.charAt(t),i=0;if("["===n){var r;if(!(r=this.isStartWithValidSpecialCharacterStatement(e.substr(t),i),i=r.endOfStatement,r).returnValue)return!1;t=i+t-1}else if("<"===n){if(!this.isStartWithValidBeginOfWordStatement(e.substr(t)))return!1}else if(">"===n){if(!t)return!1}else if("{"===n){var a;if(!t||!(a=this.isStartWithValidMultiOccurBraceStatement(e.substr(t),i),i=a.endOfStatement,a).returnValue)return!1;t=i+t-1}else if("@"===n){if(!t||!this.isStartWithValidMultiOccurAtStatement(e.substr(t)))return!1}else if("("===n){var o;if(!(o=this.isStartWithParenthesisSubStatement(e.substr(t),i),i=o.endOfStatement,o).returnValue)return!1;t=i+t-1}else if("}"===n||"]"===n||")"===n)return!1}return!0},r.findWildCardStatement=function(e,t,n,i){if(n=0,i=0,e.length<=t)return{returnValue:!1,endOfStatement:n,wildCardKind:i};var r=e.length,a=e.charAt(t);if("["===a)for(var o=t+1;o<r;o++){if("]"===e.charAt(o)&&o-t!=1)return{returnValue:!0,endOfStatement:n=o,wildCardKind:i=5}}else if("{"===a)for(var s=-1,l=t+1;l<r;l++){var c=e.charAt(l);if(","===c)s=l;else if("}"===c)return{returnValue:!0,endOfStatement:n=l,wildCardKind:i=-1===s?6:l-s!=1?7:8}}return{returnValue:!1,endOfStatement:n,wildCardKind:i}},r.turnAsteriskToRegEx=function(e,t,n,i){if(n=t,!t&&1===e.length)return{returnValue:this.turnWildCardToRegEx(e,i,!0),endOfStatement:n};switch(e.charAt(t+1)){case"{":var r,a="",o=-1,s=0;return(r=this.findWildCardStatement(e,t+1,o,s),o=r.endOfStatement,s=r.wildCardKind,r).returnValue?(a=this.turnWildCardToRegEx("*",i,!0)+this.turnWildCardToRegEx(e.substring(t+1,o+1),s),7!==s&&8!==s||(a+="?"),{returnValue:a,endOfStatement:n=o}):{returnValue:this.turnWildCardToRegEx("*",i,!1),endOfStatement:n};case"@":return n=t+1,{returnValue:this.turnWildCardToRegEx("*",i,!0),endOfStatement:n};case"*":if(!t){for(n++;"*"===e.charAt(n);)n++;return n===e.length?{returnValue:this.turnWildCardToRegEx("*",i,!0),endOfStatement:n}:{returnValue:this.turnWildCardToRegEx("*",i,!1),endOfStatement:n}}return{returnValue:this.turnWildCardToRegEx("*",i,!1),endOfStatement:n};default:return{returnValue:this.turnWildCardToRegEx("*",i,!1),endOfStatement:n}}},r.turnWildCardToRegEx=function(e,t,n){void 0===n&&(n=!1);var i=e.length;switch(t){case 5:return"!"===e.charAt(1)&&i>2?"([^"+this.preprocessStringInSquareBrackets(e.substr(2,i-3))+"]\u0640*)":"(["+this.preprocessStringInSquareBrackets(e.substr(1,i-2))+"]\u0640*)";case 6:case 7:return e;case 9:return"+?";case 8:return e;case 3:case 4:return"\\b";case 1:return".";case 2:return n?"(.+?)":"(.*?)";case 10:return e}return null},r.getWildCardKind=function(e){switch(e){case"?":return 1;case"*":return 2;case"<":return 3;case">":return 4;case"@":return 9}return 0},r.preProcessChar=function(e){return"["===e||"]"===e||"\\"===e||"("===e||")"===e?String.format("\\{0}",e):"'"===e||"\u2018"===e||"\u2019"===e||'"'===e||"\u201c"===e||"\u201d"===e||d.a.isWhitespaceUnicode(e)?this.processApostraphyQuoteHyphen(e):e},r.preprocessStringInSquareBrackets=function(e){for(var t=[],n=0;n<e.length;++n){var i=e.charAt(n);t[n]=this.preProcessChar(i)}return t.join("")},r.isStartWithValidSpecialCharacterStatement=function(e,t){t=-1;var n=new u(new RegExp("\\[.+?\\]","g"));if(!n.exec(e))return{returnValue:!1,endOfStatement:t};if(n.getIndex())return{returnValue:!1,endOfStatement:t};if(t=n.getLastIndex(),new u(new RegExp("(\\(\\))|(.+?!)","g")).exec(e.substring(1,t-1)))return{returnValue:!1,endOfStatement:t};var i=new u(new RegExp("[^!\\[]-[^\\]]","g"));for(e.substring(0,t);i.exec(e.substring(0,t));){var r=i.getIndex(),a=i.getLastIndex(),o=new RegExp("[-]","g"),s=e.substring(r,a).split(o);if(s[0].charAt(0)>s[1].charAt(0))return{returnValue:!1,endOfStatement:t}}return{returnValue:!0,endOfStatement:t}},r.isStartWithValidBeginOfWordStatement=function(e){return!new u(new RegExp("\\<(\\{|\\@|\\>|\\<|\\}|\\))","g")).exec(e)},r.isStartWithValidMultiOccurBraceStatement=function(e,t){t=-1;if(new u(new RegExp("(\\}\\{)|(\\}\\@)","g")).exec(e))return{returnValue:!1,endOfStatement:t};var n=new u(new RegExp("\\{\\d+(,|(,\\d+))?\\}","g"));if(!n.exec(e))return{returnValue:!1,endOfStatement:t};if(n.getIndex())return{returnValue:!1,endOfStatement:t};t=n.getLastIndex();var i=new RegExp("[{,}]","g"),r=e.substring(0,t).split(i);return 4===r.length&&Number.parseInvariant(r[1])>=Number.parseInvariant(r[2])?{returnValue:!1,endOfStatement:t}:{returnValue:!0,endOfStatement:t}},r.isStartWithValidMultiOccurAtStatement=function(e){return!new u(new RegExp("\\@\\{","g")).exec(e)},r.isStartWithParenthesisSubStatement=function(e,t){t=-1;var n=-1,i=new u(new RegExp("\\(([^\\[\\]]*?(\\[.+?\\])?)+?\\)","g"));if(i.exec(e)){if(n=i.getIndex(),t=i.getLastIndex(),n)return{returnValue:!1,endOfStatement:t};if(!this.isValidWildCardStatement(e.substring(1,t-1)))return{returnValue:!1,endOfStatement:t}}return{returnValue:!0,endOfStatement:t}},r.splitSearchQueryWithWildCardEnabled=function(e){for(var t=[],n=e.length,i=0;i<n;++i){var r,a=e.charAt(i),o=0,s=0;if("["===a||"\\"===a||"^"===a||"$"===a||"."===a||"|"===a||"+"===a||"("===a||")"===a||"?"===a||"*"===a||"<"===a||">"===a||"@"===a||"?"===a||"{"===a)if("["!==a&&"{"!==a||!(r=this.findWildCardStatement(e,i,o,s),o=r.endOfStatement,s=r.wildCardKind,r).returnValue)if("?"===a||"<"===a||">"===a||"@"===a)s=this.getWildCardKind(a),t[i]=this.turnWildCardToRegEx(a,s);else if("*"===a){var l;s=this.getWildCardKind(a),t[i]=(l=this.turnAsteriskToRegEx(e,i,o,s),o=l.endOfStatement,l).returnValue,i=o}else"("===a||")"===a?(s=10,t[i]=this.turnWildCardToRegEx(a,s)):t[i]=String.format("\\{0}",a);else t[i]=this.turnWildCardToRegEx(e.substr(i,o+1-i),s),i=o;else"'"===a||"\u2018"===a||"\u2019"===a||'"'===a||"\u201c"===a||"\u201d"===a||"-"===a||"\u2013"===a||"\u2014"===a||d.a.isWhitespaceUnicode(a)?t[i]="["+this.processApostraphyQuoteHyphen(a)+"]":t[i]="\u2026"===a?"\\.\\.\\.":a;""===t[i]||s||(i<e.length-1&&("@"===e.charAt(i+1)||"{"===e.charAt(i+1))?t[i]="("+t[i]+"\u0640*)":t[i]+="\u0640*")}return t},r.splitSearchQuery=function(e){for(var t=[],n=0;n<e.length;++n){var i=e.charAt(n);"["===i||"\\"===i||"^"===i||"$"===i||"."===i||"|"===i||"+"===i||"("===i||")"===i||"?"===i||"*"===i?t[n]=String.format("\\{0}",i):"'"===i||"\u2018"===i||"\u2019"===i||'"'===i||"\u201c"===i||"\u201d"===i||"-"===i||"\u2013"===i||"\u2014"===i||d.a.isWhitespaceUnicode(i)?t[n]="["+this.processApostraphyQuoteHyphen(i)+"]":t[n]="\u2026"===i?"\\.\\.\\.":i,""!==t[n]&&(t[n]+="\u0640*")}return t},r.processApostraphyQuoteHyphen=function(t){return"'"===t||"\u2018"===t||"\u2019"===t?"'\u2018\u2019":'"'===t||"\u201c"===t||"\u201d"===t?'"\u201c\u201d':"-"===t||"\u2013"===t||"\u2014"===t?"-\u2013\u2014":d.a.isWhitespaceUnicode(t)?e.unicodeWhitespaceCharacters:t},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(n=null)&&h(t.prototype,n),i&&h(t,i),e}();p._instance=null,p.unicodeWhitespaceCharacters=" \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000",p.punctuationCharacters='-\u2013.,:;/?!"\u3002\uff0c\uff1a\uff1b\u3001\uff1f\uff01\u201d\u201c',Object(i.a)(p,"WordQueryProcessor",null,[156]);var g=n(1),m=n(23),f=n(19),_=n(4),v=n(2),y=n(14),S=n(36),b=n(561),C=n(567),A=n(574),T=function(){};T.textboxFindId="TextBoxFind",T.buttonFindMatchCaseId="ButtonFindMatchCase",T.buttonFindMatchWholeWordId="ButtonFindMatchWholeWord",T.searchBoxDropDownId="SearchBoxDropDown",T.searchBoxFrameId="SearchBoxFrame",T.searchBoxSplitButtonId="FindSplitButton",T.searchUIAreaId="SearchUIArea",T.cancelSearchMenuId="CancelSearchMenu",Object(i.a)(T,"SearchBoxControls",null,[]);var w=function(){};w.checkedImageName="QuickSearchCompletedToday_16x16x32",w.splitButtonArrow="SplitButtonArrow_5x3x32",w.splitButtonArrow8by8="SplitButtonArrow_8x8x32",w.splitButtonSearchIcon="Search_16x16x32",w.splitButtonCancelIcon="ClosePaneGlyph_16x16x32",Object(i.a)(w,"SearchBoxIcons",null,[]);var k=function(){function e(e,t){this._resultDom=e,this._resultHit=t}var t=e.prototype;return t.dispose=function(){this._resultDom=null,this._resultHit=null},t.getOffsetTop=function(){return this._resultDom.offsetTop},t.getOffsetHeight=function(){return this._resultDom.offsetHeight},t.select=function(){Sys.UI.DomElement.addCssClass(this._resultDom,"WACSelectedResult"),Sys.UI.DomElement.addCssClass(this._resultHit,"WACActiveContext")},t.deselect=function(){this._resultDom&&Sys.UI.DomElement.removeCssClass(this._resultDom,"WACSelectedResult"),this._resultHit&&Sys.UI.DomElement.removeCssClass(this._resultHit,"WACActiveContext")},e}();Object(i.a)(k,"SearchPaneItem",null,[199,4]);var I=function(){function e(t){this._resultsScroller=t,this._sampleResult=e.createSearchResult(),this._lastResultBox=null}var t=e.prototype;return t.dispose=function(){this._resultsScroller=null,this._lastResultBox=null,this._sampleResult=null},t.addResult=function(t,n,i){if(n){var r=b.b("div",null,e._wacResultDividerClassName);this._resultsScroller.appendChild(r)}var a=this.resultBoxFromContext(t,n,i);this._resultsScroller.appendChild(a),this._lastResultBox=a},t.clearAllResults=function(){for(;this._resultsScroller.hasChildNodes();)this._resultsScroller.removeChild(this._resultsScroller.lastChild);this._resultsScroller.parentNode&&(this._resultsScroller.parentNode.className=e._wacEmptyPaneClassName),this._lastResultBox=null},t.getSearchPaneItem=function(t){var n=document.getElementById(t+e._wacResultOutlineSuffix);if(!n)return null;var i=e.getDomFromSearchResult(n,3);return new k(n,i)},t.getSearchPaneIndex=function(e){var t=e.id;return parseInt(t)},t.goToResult=function(e,t,n){t+1===n&&(e.scrollTop=this._resultsScroller.offsetHeight),t||(e.scrollTop=0);var i=this.getSearchPaneItem(t),r=i.getOffsetTop(),a=e.scrollTop,o=r+i.getOffsetHeight(),s=a+e.offsetHeight;return r<e.scrollTop?e.scrollTop=r:o>s&&(e.scrollTop=o-e.offsetHeight),i},t.getLastResultBoxOffsetTop=function(){return this._lastResultBox?this._lastResultBox.offsetTop:Number.NaN},t.resultBoxFromContext=function(e,t,n){var i=this._sampleResult.cloneNode(!0);return this.updateResultBoxFromContext(i,e,t,n),i},t.updateResultBoxFromContext=function(t,n,i,r){var a=n.contextus,o=n.resultType,s=n.resultStart,l=n.resultEnd;t.id=i+e._wacResultOutlineSuffix;var c=e.getDomFromSearchResult(t,0);c.id=i+e._wacSearchResultSuffix,r&&(c.title=r);var u=e.getDomFromSearchResult(t,1);u.id=i+e._resultTypeSuffix,u.innerText=o;var d=e.getDomFromSearchResult(t,2);d.id=i+e._preResultSuffix,d.innerText=a.substring(0,s);var h=e.getDomFromSearchResult(t,3);h.id=i+e._resultSuffix,h.innerText=a.substring(s,l);var p=e.getDomFromSearchResult(t,4);p.id=i+e._postResultSuffix,p.innerText=a.substring(l,a.length)},e.createSearchResult=function(){var t=b.b("div",null,e._wacResultOutlineSuffix),n=b.b("div",null,e._wacSearchResultSuffix),i=b.b("span",null,"WACResultType"),r=b.b("span",null,null),a=b.b("span",null,"WACContext"),o=b.b("span",null,null);return n.appendChild(i),n.appendChild(r),n.appendChild(a),n.appendChild(o),t.appendChild(n),t},e.getDomFromSearchResult=function(e,t){switch(t){case 0:return e.firstChild;case 1:return e.firstChild.childNodes[0];case 2:return e.firstChild.childNodes[1];case 3:return e.firstChild.childNodes[2];case 4:return e.firstChild.childNodes[3]}return null},e}();I._wacResultOutlineSuffix="WACResultOutline",I._wacResultDividerClassName="ResultDivider",I._wacEmptyPaneClassName="WACSearchResultsPaneEmpty",I._wacSearchResultSuffix="WACSearchResult",I._resultTypeSuffix="resultType",I._preResultSuffix="preResult",I._resultSuffix="Result",I._postResultSuffix="postResult",I._selectedResultStyle="WACSelectedResult",Object(i.a)(I,"SearchResultsDom",null,[188,4]);var F=function(){function e(){}return e.prototype.createSearchResultsDom=function(e){return new I(e)},e}();Object(i.a)(F,"SearchResultsDomFactory",null,[167]);var E=n(33),P=n(52),O=n(53),R=n(70),M=n(3),D=n(16),x=n(24),L=n(18),B=n(75),U=n(314),H=n(9),N=n(176),W=n(72),j=n(7),V=n(6),q=n(15);function G(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var K=function(){function e(e,t,n,i){this.registeredChangeEvent=null,this._form=null,this._inputMode=0,this._valueChangedHandler=null,this._submitHandler=null,this._textElement=null,this._id=e,this._className=t,this._placeholderText=n,this._keyInputManager=i,this.createPlaceholderControl(),this.showPlaceholderText()}var t,n,i,a=e.prototype;return a.enable=function(){this.textElement.removeAttribute("disabled")},a.disable=function(){this.textElement.setAttribute("disabled","true")},a.reset=function(){this.showUserInput()},a.setMaxInputLength=function(e){this.textElement.setAttribute("maxLength",String.format("{0}",e))},a.setFocus=function(){var e=this;window.setTimeout((function(){e.textElement.focus()}),0)},a.setTooltip=function(e){this.textElement.title=e},a.registerValueChangedHandler=function(e,t){this._valueChangedHandler=e,this.registeredChangeEvent=t,this._keyInputManager.registerHandler(this.registeredChangeEvent,this.textElement,this._valueChangedHandler)},a.registerSubmitHandler=function(e){this._submitHandler=e},a.createPlaceholderControl=function(){this._textElement=document.createElement("input"),this.textElement.id=this._id,this.textElement.className=this._className,this.textElement.type="text",this.textElement.setAttribute("Autocomplete","off"),this.textElement.setAttribute("data-lpignore","true"),V.a.setAriaAttribute(this.textElement,V.a.ariaRoleAttribute,V.a.ariaTextboxAttribute),Sys.UI.DomElement.addCssClass(this.textElement,"UIFont"),this.addPlaceholderCapabilityToTextbox(),this._form=document.createElement("form"),this._form.appendChild(this.textElement),D.a.addHandler(this._form,"submit",Object(r.a)(this,this.onSubmit,"onSubmit"))},a.addPlaceholderCapabilityToTextbox=function(){D.a.addHandler(this.textElement,"focus",Object(r.a)(this,this.onFocus,"onFocus")),D.a.addHandler(this.textElement,"blur",Object(r.a)(this,this.onBlur,"onBlur"))},a.onFocus=function(e){document.activeElement===this.textElement&&(this.applyFocussedStyle(),this._inputMode||this.showUserInput())},a.onBlur=function(e){this.removeFocussedStyle(),1===this._inputMode&&""===this.textElement.value&&this.showPlaceholderText()},a.onSubmit=function(e){this._submitHandler&&this._submitHandler(),e.preventDefault()},a.showUserInput=function(){this.textElement.value="",this._inputMode=1,this.removePlaceholderStyle()},a.showPlaceholderText=function(){this.textElement.value=this._placeholderText,this._inputMode=0,this.applyPlaceholderStyle()},a.applyPlaceholderStyle=function(){Sys.UI.DomElement.addCssClass(this.textElement,"PlaceholderText")},a.removePlaceholderStyle=function(){Sys.UI.DomElement.removeCssClass(this.textElement,"PlaceholderText")},a.applyFocussedStyle=function(){Sys.UI.DomElement.addCssClass(this.textElement,"PlaceholderFocus")},a.removeFocussedStyle=function(){Sys.UI.DomElement.removeCssClass(this.textElement,"PlaceholderFocus")},a.dispose=function(){D.a.removeHandler(this.textElement,"focus",Object(r.a)(this,this.onFocus,"onFocus")),D.a.removeHandler(this.textElement,"blur",Object(r.a)(this,this.onBlur,"onBlur")),this._valueChangedHandler&&(this._keyInputManager.unregisterHandler(this.registeredChangeEvent,this.textElement,this._valueChangedHandler),this._valueChangedHandler=null),D.a.removeHandler(this._form,"submit",Object(r.a)(this,this.onSubmit,"onSubmit")),this._submitHandler=null},t=e,(n=[{key:"textElement",get:function(){return this._textElement}},{key:"rootElement",get:function(){return this._form}},{key:"value",get:function(){return this.isUserInput?this.textElement.value:""},set:function(e){this.showUserInput(),this.textElement.value=e,e&&q.a.selectAllTextInInput(this.textElement)}},{key:"placeholderText",get:function(){return this._placeholderText},set:function(e){this._placeholderText=e,this._inputMode||this.showPlaceholderText()}},{key:"isUserInput",get:function(){return 1===this._inputMode}}])&&G(t.prototype,n),i&&G(t,i),e}();Object(i.a)(K,"PlaceholderInput",null,[200,4]);var z=function(){};z.searchBoxStyle="SearchBox",z.searchBoxFrameStyle="SearchBoxButtonFrame",z.searchUIAreaStyle="SearchUIArea",z.splitButtonStyle="SearchSplitButton",Object(i.a)(z,"SearchBoxStyles",null,[]);var X=n(73);function J(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Q=function(){function e(e,t,n,i,r,a){void 0===a&&(a=M.a.keyUp),this._placeholderInput=null,this._element=null,this._parent=e,this._queryChangedHandler=t,this._keyInputManager=n,this._searchBoxControlUser=i,this._stringsProvider=r,this._cachedQuery="",this.createSearchBox(),this.refreshControls(),this.registerQueryChangedHandler(a)}var t,n,i,a=e.prototype;return a.registerQueryChangedHandler=function(e){this._placeholderInput.registerValueChangedHandler(Object(r.a)(this,this.onQueryChanged,"onQueryChanged"),e)},a.refreshControls=function(){this._searchBoxControlUser.refreshControls()},a.createSearchBox=function(){var e=document.createElement("div");e.id=T.searchUIAreaId,e.className=z.searchUIAreaStyle,this._parent.appendChild(e);var t=document.createElement("div");t.id=T.searchBoxFrameId,t.className=z.searchBoxFrameStyle,e.appendChild(t),this._placeholderInput=new K(T.textboxFindId,z.searchBoxStyle,this._stringsProvider.getString(0),this._keyInputManager),this._placeholderInput.setTooltip(this._stringsProvider.getString(1)),this._element=this._placeholderInput.textElement,t.appendChild(this._placeholderInput.rootElement),H.a.isInternetExplorer8&&(this.element.style.lineHeight="175%"),this.buildSearchSplitButton(t)},a.buildSearchSplitButton=function(e){var t=this.createSplitButtonXml(),n=this.getSplitButtonDomElement(t);n&&(Sys.UI.DomElement.addCssClass(n,z.splitButtonStyle),V.a.setAriaAttribute(n,V.a.ariaRoleAttribute,V.a.ariaPresentationRole),this._stringsProvider.contains(7)&&V.a.setAriaAttribute(n,V.a.ariaRoleDescription,this._stringsProvider.getString(7)),e.appendChild(n))},a.getSplitButtonDomElement=function(e){return this._searchBoxControlUser.getSplitButtonDomElement(e,T.searchBoxDropDownId)},a.createSplitButtonXml=function(){var e=[X.b(T.buttonFindMatchCaseId,"","2398455418","1369572530",this._stringsProvider.getString(2)),X.b(T.buttonFindMatchWholeWordId,"","1783557000","3914542000",this._stringsProvider.getString(3))],t=X.c("msFindSearch_Controls",e),n=X.d("msFindSearch",t,null),i=[X.a(T.cancelSearchMenuId,"241072808",this._stringsProvider.getString(4),w.splitButtonCancelIcon,"","",this._stringsProvider.getString(4),"","","")],r=X.c("msCancelSearch_Controls",i),a=[n,X.d(T.cancelSearchMenuId,r,null)];return X.h(T.searchBoxSplitButtonId,j.a.clearSearch,j.a.queryClearSearch,this._stringsProvider.getString(6),w.splitButtonSearchIcon,a)},a.onQueryChanged=function(t){var n=e.isEnterKey(t);return this._placeholderInput.isUserInput?!(this.element.value===this._cachedQuery&&!n)&&(this.triggerSearch(n),!0):(this.element.value=this._placeholderInput.placeholderText,!0)},a.triggerSearch=function(e){this._cachedQuery=this.element.value,this._queryChangedHandler(this._cachedQuery,!e)},a.updateControl=function(e){this._searchBoxControlUser.updateControl(e)},a.enable=function(){this._placeholderInput.enable(),this.updateControl(T.searchBoxSplitButtonId)},a.disable=function(){this._placeholderInput.disable(),this.updateControl(T.searchBoxSplitButtonId)},a.reset=function(){this._placeholderInput.reset()},a.setMaxInputLength=function(e){this._placeholderInput.setMaxInputLength(e)},a.setFocus=function(){this._placeholderInput.setFocus()},a.dispose=function(){this._element=null,this._placeholderInput&&(this._placeholderInput.dispose(),this._placeholderInput=null),this._searchBoxControlUser&&(this._searchBoxControlUser.dispose(),this._searchBoxControlUser=null)},e.isEnterKey=function(e){return e.innerEvent.keyCode===x.a.vK_Enter},t=e,(n=[{key:"value",get:function(){return this._placeholderInput.value},set:function(e){this._placeholderInput.value=e}},{key:"placeholderText",get:function(){return this._placeholderInput.placeholderText},set:function(e){this._placeholderInput.placeholderText=e}},{key:"element",get:function(){return this._element}}])&&J(t.prototype,n),i&&J(t,i),e}();Object(i.a)(Q,"SearchBox",null,[187,4]);var Z=n(197),Y=n(198),$=function(){function e(){var e=new Y.a;e.ImageDownArrow=g.AFrameworkApplication.imageClusterPath,e.ImageDownArrowClass=P.getImageClass(w.splitButtonArrow),e.ImageCheckMark=g.AFrameworkApplication.imageClusterPath,e.ImageCheckMarkClass=P.getImageClass(w.checkedImageName),e.TextDirection=g.AFrameworkApplication.isRtl?"rtl":"ltr",this._root=new Z.a("SearchBoxRoot",e),this._root.rootUser=y.App.get_activeAppFrame().ribbonUser}var t=e.prototype;return t.dispose=function(){this._root&&(this._root.dispose(),this._root=null)},t.refreshControls=function(){this._root.pollForStateAndUpdate()},t.getSplitButtonDomElement=function(e,t){return this._root.addControl(t,e)?this._root.getDOMElementForControlDisplayMode(t,"Small"):(v.ULS.sendTraceTag(4523030,313,15,"Failed to add SearchBox splitbutton, continuing"),null)},t.updateControl=function(e){this._root.updateControl(e)},e}();Object(i.a)($,"SearchBoxControlUser",null,[186,4]);var ee=function(){function e(){this._initialized=!1,this._strings={}}var t=e.prototype;return t.getString=function(e){return this.ensureStringsAdded(),this.get(e)},t.contains=function(e){return this.ensureStringsAdded(),e.toString()in this._strings},t.ensureStringsAdded=function(){this._initialized||(this.addStrings(),this._initialized=!0)},t.addString=function(e,t){this._strings[e.toString()]=t},t.get=function(e){return this._strings[e.toString()]},e}();function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ee,"AIntlHelper",null,[]);var ne=function(e){var t,n;function i(){return e.call(this)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,te(t,n),i.prototype.addStrings=function(){this.addString(0,WordViewerIntl.WordViewerStrings.l_SearchBoxValue),this.addString(1,WordViewerIntl.WordViewerStrings.l_FindPlaceholderTooltip),this.addString(2,WordViewerIntl.WordViewerStrings.l_MatchCase),this.addString(3,WordViewerIntl.WordViewerStrings.l_MatchWholeWord),this.addString(4,WordViewerIntl.WordViewerStrings.l_ClearSearch),this.addString(5,WordViewerIntl.WordViewerStrings.l_SearchButtonTitleEnd),this.addString(6,WordViewerIntl.WordViewerStrings.l_SearchButtonTitleBegin)},i}(ee);function ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ne,"SearchBoxIntl",ee,[]);var re=function(){function e(){}var t,n,i;return e.prototype.createSearchBox=function(e,t){return new Q(e,t,L.KeyInputManager.instance,new $,new ne)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(n=null)&&ie(t.prototype,n),i&&ie(t,i),e}();re._instance=null,Object(i.a)(re,"SearchBoxFactory",null,[166]);var ae=n(566),oe=n(401),se=n(149),le=n(17),ce=function(){function e(t){var n=this;this._resultsScroller=null,this._resultsInfo=null,this._searchBox=null,this._searchBoxInput=null,this._progress=null,this._findResultsString=null,this._searchResultsDomFactory=null,this._searchResultsDom=null,this._nextResultButton=null,this._nextResultButtonFlag=0,this._prevResultButton=null,this._prevResultButtonFlag=0,this._closeButton=null,this._filtersDiv=null,this._isAutoFind=!1,this._nextButtonEnterHandler=null,this._prevButtonEnterHandler=null,this._closeButtonKeyEventHandler=null,this.matchWholeWord=!1,this.matchCase=!1;var i=g.AFrameworkApplication.isRtl,a=B.a.instance,o=R.a.instance,s=L.KeyInputManager.instance,l=O.a.instance;this._actionManager=g.AFrameworkApplication.theActionManager,this._actionManager.addActionWithFlags(j.a.queryClearSearch,S.a.application,Object(r.a)(this,this.queryClearSearch,"queryClearSearch"),97),this._actionManager.addAction(j.a.clearSearch,S.a.application,Object(r.a)(this,this.clearSearch,"clearSearch")),this._actionManager.addAction(j.a.clearSearchFromSearchMenu,S.a.application,Object(r.a)(this,this.clearSearchFromSearchMenu,"clearSearchFromSearchMenu")),this._actionManager.addAction(j.a.findMatchCase,S.a.application,Object(r.a)(this,this.updateFilters,"updateFilters")),this._actionManager.addAction(j.a.findWholeWord,S.a.application,Object(r.a)(this,this.updateFilters,"updateFilters")),this._actionManager.addActionWithFlags(j.a.queryFindMatchCase,S.a.application,Object(r.a)(this,this.queryFindMatchCase,"queryFindMatchCase"),97),this._actionManager.addActionWithFlags(j.a.queryFindWholeWord,S.a.application,Object(r.a)(this,this.queryFindWholeWord,"queryFindWholeWord"),97),this._pane=b.b("div","WACSearchPane","FindPane");var c=this.createHeaderDom(i,o,s),u=this.createControlsDom(i,a,o,s);this._results=this.createResultsDom(o,l),this._pane.appendChild(c),this._pane.appendChild(u),this._pane.appendChild(this._results),t.appendChild(this._pane),this._sampleResult=e.createSearchResult();var d=m.FocusManager.instance().getScope(oe.a.searchFocusID);d.bindAction(L.KeyInputManager.hashKey(x.a.vK_UpArrow,0),le.a.previousSearchResult),d.bindAction(L.KeyInputManager.hashKey(x.a.vK_DownArrow,0),le.a.nextSearchResult),d.parent=E.AFrame.appFocusId,d.addSetFocus((function(){n._searchBoxInput?n._searchBoxInput.focus():v.ULS.shipAssertTag(4318920,321,!1)})),R.a.instance.addFocusEvent(oe.a.searchFocusID,this._searchBoxInput),g.AFrameworkApplication.activeFrame.theF6Manager.addF6KeyBindings(oe.a.searchFocusID),y.App.get_activeAppFrame().add_onResize(Object(r.a)(this,this.positionSearchPane,"positionSearchPane")),this._actionManager.addAction(le.a.hideSearchPane,S.a.application,Object(r.a)(this,this.hideSearchPane,"hideSearchPane")),this._actionManager.addAction(le.a.nextSearchResult,S.a.application,Object(r.a)(this,this.nextSearchResult,"nextSearchResult")),this._actionManager.addAction(le.a.previousSearchResult,S.a.application,Object(r.a)(this,this.previousSearchResult,"previousSearchResult")),this._actionManager.addActionWithFlags(le.a.queryToggleSearchPane,S.a.application,Object(r.a)(this,this.queryToggleSearchPane,"queryToggleSearchPane"),96),this.positionSearchPane()}var t=e.prototype;return t.dispose=function(){this.clearAllResults();var e=B.a.instance,t=R.a.instance,n=L.KeyInputManager.instance,i=O.a.instance;t.unregisterHandler(M.a.click,this._closeButton,Object(r.a)(this,this.onClosePaneClickEvent,"onClosePaneClickEvent")),n.unregisterHandlerForAllKeyEvents(this._closeButton,this._closeButtonKeyEventHandler),t.unregisterHandler(M.a.click,this._results,Object(r.a)(this,this.resultClickedEvent,"resultClickedEvent")),H.a.isIPad||(e.unregisterHandler(M.a.mouseOver,this._nextResultButton,Object(r.a)(this,this.enterNextResultButtonEvent,"enterNextResultButtonEvent")),e.unregisterHandler(M.a.mouseOut,this._nextResultButton,Object(r.a)(this,this.exitNextResultButtonEvent,"exitNextResultButtonEvent")),e.unregisterHandler(M.a.mouseDown,this._nextResultButton,Object(r.a)(this,this.mouseDownNextResultButtonEvent,"mouseDownNextResultButtonEvent")),e.unregisterHandler(M.a.mouseUp,this._nextResultButton,Object(r.a)(this,this.mouseUpNextResultButtonEvent,"mouseUpNextResultButtonEvent"))),t.unregisterHandler(M.a.click,this._nextResultButton,Object(r.a)(this,this.clickNextResultButtonEvent,"clickNextResultButtonEvent")),H.a.isIPad||(e.unregisterHandler(M.a.mouseOver,this._prevResultButton,Object(r.a)(this,this.enterPrevResultButtonEvent,"enterPrevResultButtonEvent")),e.unregisterHandler(M.a.mouseOut,this._prevResultButton,Object(r.a)(this,this.exitPrevResultButtonEvent,"exitPrevResultButtonEvent")),e.unregisterHandler(M.a.mouseDown,this._prevResultButton,Object(r.a)(this,this.mouseDownPrevResultButtonEvent,"mouseDownPrevResultButtonEvent")),e.unregisterHandler(M.a.mouseUp,this._prevResultButton,Object(r.a)(this,this.mouseUpPrevResultButtonEvent,"mouseUpPrevResultButtonEvent"))),t.unregisterHandler(M.a.click,this._prevResultButton,Object(r.a)(this,this.clickPrevResultButtonEvent,"clickPrevResultButtonEvent")),i.unregisterHandler(M.a.scroll,this._results,Object(r.a)(this,this.onScroll,"onScroll")),D.a.removeHandler(this._prevResultButton.firstChild,"focus",Object(r.a)(this,this.focusPrevResultButtonEvent,"focusPrevResultButtonEvent")),D.a.removeHandler(this._prevResultButton.firstChild,"blur",Object(r.a)(this,this.blurPrevResultButtonEvent,"blurPrevResultButtonEvent")),D.a.removeHandler(this._nextResultButton.firstChild,"focus",Object(r.a)(this,this.focusNextResultButtonEvent,"focusNextResultButtonEvent")),D.a.removeHandler(this._nextResultButton.firstChild,"blur",Object(r.a)(this,this.blurNextResultButtonEvent,"blurNextResultButtonEvent")),D.a.removeHandler(this._prevResultButton.parentNode,M.a.keyUp,this._prevButtonEnterHandler),D.a.removeHandler(this._nextResultButton.parentNode,M.a.keyUp,this._nextButtonEnterHandler),this._progress&&(this._progress.dispose(),this._progress=null),this._sampleResult=null,this._resultsScroller=null,this._resultsInfo=null,this._searchBox&&(this._searchBox.dispose(),this._searchBox=null),this._results=null,this._pane=null,this._nextResultButton=null,this._prevResultButton=null,this._closeButton=null},t.createHeaderDom=function(e,t,n){var i=b.b("div","","FindPaneHeader"),a=b.b("span","WACSearchHeaderText","PaneTitle FindPaneTitle UIFontLight");return a.innerText=WordViewerIntl.WordViewerStrings.l_HeaderText,this._closeButton=C.a.createButton("FindPaneCloseButton","FindPaneCloseButton",WordViewerIntl.WordViewerStrings.L_Close,"ClosePaneGlyph_16x16x32",!1),e?Sys.UI.DomElement.addCssClass(this._closeButton,"FloatLeft"):Sys.UI.DomElement.addCssClass(this._closeButton,"FloatRight"),t.registerHandler(M.a.click,this._closeButton,Object(r.a)(this,this.onClosePaneClickEvent,"onClosePaneClickEvent")),this._closeButtonKeyEventHandler=n.registerHandlerForAllKeyEvents(this._closeButton,Object(r.a)(this,this.onClosePaneClickEvent,"onClosePaneClickEvent"),x.a.vK_Enter),i.appendChild(a),i.appendChild(this._closeButton),i},t.createControlsDom=function(e,t,n,i){var r=b.b("div","WACSearchControls","WACSearchControls"),a=this.createSearchBoxDom(e,t,n,i),o=this.createProgressAndNavigationDom(e,t,n);return r.appendChild(a),r.appendChild(o),r},t.createResultsDom=function(e,t){var n=b.b("div","WACSearchResultsPane","WACSearchResultsPane");return this._resultsScroller=b.b("div","WACSearchResultsScroller","WACSearchResultsScroller"),this._resultsScroller.innerText=WordViewerIntl.WordViewerStrings.l_SearchText,t.registerHandler(M.a.scroll,n,Object(r.a)(this,this.onScroll,"onScroll")),e.registerHandler(M.a.click,n,Object(r.a)(this,this.resultClickedEvent,"resultClickedEvent")),this._searchResultsDomFactory=new F,this._searchResultsDom=this._searchResultsDomFactory.createSearchResultsDom(this._resultsScroller),n.appendChild(this._resultsScroller),n},t.createSearchBoxDom=function(e,t,n,i){var a=b.b("div","","");this._searchBox=re.instance.createSearchBox(a,Object(r.a)(this,this.queryChangedHandler,"queryChangedHandler")),this._searchBox.setMaxInputLength(255),this._searchBoxInput=this._searchBox.element,this._filtersDiv=b.b("div","","FiltersLabel"),e?Sys.UI.DomElement.addCssClass(this._filtersDiv,"FloatLeft"):Sys.UI.DomElement.addCssClass(this._filtersDiv,"FloatRight"),a.appendChild(this._filtersDiv);var o=document.createElement("div");return Sys.UI.DomElement.addCssClass(o,"ClearFloat"),a.appendChild(o),a},t.createProgressAndNavigationDom=function(t,i,a){var o=t?"FloatLeft":"FloatRight",s=b.b("div","WACInfoAndNavigation","WACInfoAndNavigation"),l=b.b("span","WACSearchProgressSpan"," "),c=b.b("div","WACResultNavigationDiv","FindPaneNavigationControls "+o);return this._resultsInfo=b.b("div","WACResultsInfo","WACResultsInfo"),this._resultsInfo.innerText="",Sys.UI.DomElement.addCssClass(l,"WACSearchProgressSpan"),this._progress=new U.a(""),this._progress.isSmall=!0,this._progress.text=WordViewerIntl.WordViewerStrings.l_ProgressTextSearching,this._progress.element.style.display="none",l.appendChild(this._progress.element),this._findResultsString=b.b("span","WACSearchMatchesText","WACSearchMatchesText"),this._findResultsString.style.display="none",l.appendChild(this._findResultsString),this._prevResultButton=P.createClusteredImage(17,14,"","WACResultNavigation ",!0,WordViewerIntl.WordViewerStrings.l_PrevButtonTitle),this._prevResultButton.id="WACPrevResultButtonSpan",this._prevResultButtonFlag=1,e.setButton(this._prevResultButton,this._prevResultButtonFlag,"ReorderUp","_17x14x24"),this._nextResultButton=P.createClusteredImage(17,14,"","WACResultNavigation ",!0,WordViewerIntl.WordViewerStrings.l_NextButtonTitle),this._nextResultButton.id="WACNextResultButtonSpan",this._nextResultButtonFlag=1,e.setButton(this._nextResultButton,this._nextResultButtonFlag,"ReorderDown","_17x14x24"),H.a.isIPad||(i.registerHandler(M.a.mouseOver,this._nextResultButton,Object(r.a)(this,this.enterNextResultButtonEvent,"enterNextResultButtonEvent")),i.registerHandler(M.a.mouseOut,this._nextResultButton,Object(r.a)(this,this.exitNextResultButtonEvent,"exitNextResultButtonEvent")),i.registerHandler(M.a.mouseDown,this._nextResultButton,Object(r.a)(this,this.mouseDownNextResultButtonEvent,"mouseDownNextResultButtonEvent")),i.registerHandler(M.a.mouseUp,this._nextResultButton,Object(r.a)(this,this.mouseUpNextResultButtonEvent,"mouseUpNextResultButtonEvent"))),a.registerHandler(M.a.click,this._nextResultButton,Object(r.a)(this,this.clickNextResultButtonEvent,"clickNextResultButtonEvent")),H.a.isIPad||(i.registerHandler(M.a.mouseOver,this._prevResultButton,Object(r.a)(this,this.enterPrevResultButtonEvent,"enterPrevResultButtonEvent")),i.registerHandler(M.a.mouseOut,this._prevResultButton,Object(r.a)(this,this.exitPrevResultButtonEvent,"exitPrevResultButtonEvent")),i.registerHandler(M.a.mouseDown,this._prevResultButton,Object(r.a)(this,this.mouseDownPrevResultButtonEvent,"mouseDownPrevResultButtonEvent")),i.registerHandler(M.a.mouseUp,this._prevResultButton,Object(r.a)(this,this.mouseUpPrevResultButtonEvent,"mouseUpPrevResultButtonEvent"))),a.registerHandler(M.a.click,this._prevResultButton,Object(r.a)(this,this.clickPrevResultButtonEvent,"clickPrevResultButtonEvent")),this.createNavigationButtonFrame(c,this._prevResultButton),this.createNavigationButtonFrame(c,this._nextResultButton),this.showHideNavigationButtons(!1),this._nextButtonEnterHandler=e.getNavigationButtonKeyUpHandler((function(){n(560).SearchManager.instance.goToNextResult()})),this._prevButtonEnterHandler=e.getNavigationButtonKeyUpHandler((function(){n(560).SearchManager.instance.goToPrevResult()})),D.a.addHandler(this._prevResultButton.parentNode,M.a.keyUp,this._prevButtonEnterHandler),D.a.addHandler(this._nextResultButton.parentNode,M.a.keyUp,this._nextButtonEnterHandler),Sys.UI.DomElement.addCssClass(this._prevResultButton,"WACNavigationButton"),Sys.UI.DomElement.addCssClass(this._nextResultButton,"WACNavigationButton"),t?(Sys.UI.DomElement.addCssClass(this._prevResultButton.parentNode,"FloatRight"),Sys.UI.DomElement.addCssClass(this._nextResultButton.parentNode,"FloatLeft")):(Sys.UI.DomElement.addCssClass(this._prevResultButton.parentNode,"FloatLeft"),Sys.UI.DomElement.addCssClass(this._nextResultButton.parentNode,"FloatRight")),D.a.addHandler(this._prevResultButton.firstChild,"focus",Object(r.a)(this,this.focusPrevResultButtonEvent,"focusPrevResultButtonEvent")),D.a.addHandler(this._prevResultButton.firstChild,"blur",Object(r.a)(this,this.blurPrevResultButtonEvent,"blurPrevResultButtonEvent")),D.a.addHandler(this._nextResultButton.firstChild,"focus",Object(r.a)(this,this.focusNextResultButtonEvent,"focusNextResultButtonEvent")),D.a.addHandler(this._nextResultButton.firstChild,"blur",Object(r.a)(this,this.blurNextResultButtonEvent,"blurNextResultButtonEvent")),s.appendChild(c),s.appendChild(l),s.appendChild(this._resultsInfo),s},t.createNavigationButtonFrame=function(e,t){var n=b.b("div",null,"WACNavigationButtonFrame");n.tabIndex=0,e.appendChild(n),n.appendChild(t)},t.foundResult=function(t,n){if(this._searchResultsDom.addResult(t.context,n,String.format(WordViewerIntl.WordViewerStrings.l_ResultToolTip,t.page)),n||this.showHideNavigationButtons(!0),1===n){if(!this._isAutoFind){var i=m.FocusManager.instance();i.currentScope&&i.currentScope.name===oe.a.searchFocusID&&m.FocusManager.tryFocus(this._nextResultButton.parentNode),this._searchBoxInput&&m.FocusManager.tryBlur(this._searchBoxInput)}this._nextResultButtonFlag&=-2,e.setButton(this._nextResultButton,this._nextResultButtonFlag,"ReorderDown","_17x14x24"),this._prevResultButtonFlag&=-2,e.setButton(this._prevResultButton,this._prevResultButtonFlag,"ReorderUp","_17x14x24")}},t.showHideNavigationButtons=function(e){var t=e?"inline-block":"none";this._prevResultButton&&this._prevResultButton.parentNode&&(this._prevResultButton.parentNode.style.display=t),this._nextResultButton&&this._nextResultButton.parentNode&&(this._nextResultButton.parentNode.style.display=t)},t.goToResult=function(e,t){return this._searchResultsDom.goToResult(this._results,e,t)},t.startSearch=function(){this._progress.element.style.display="inline-block",this._findResultsString.style.display="none",this._resultsScroller.innerText="",this._resultsInfo.innerText=String.format(WordViewerIntl.WordViewerStrings.l_ResultsInfoText,y.App.instance.theDocument.pageCount),this.clearAllResults(),this._resultsScroller.parentNode.className="WACSearchResultsPane",this.updateSearchBoxState()},t.updateSearchBoxState=function(){this._searchBox&&(this._searchBox.updateControl(T.searchBoxSplitButtonId),this._searchBox.updateControl(T.cancelSearchMenuId))},t.reset=function(){this._progress.element.style.display="none",this._findResultsString.style.display="none",this._resultsInfo.innerText="",this.clearAllResults(),this._resultsScroller.innerText=WordViewerIntl.WordViewerStrings.l_SearchText,this._searchBox.reset(),this.updateSearchBoxState(),this._resultsScroller.parentNode.className="WACSearchResultsPaneEmpty"},t.resumeSearch=function(){this._progress.element.style.display="inline-block",this._findResultsString.style.display="none"},t.doneSearch=function(e){this._progress.element.style.display="none",this._findResultsString.style.display="inline-block",this._findResultsString.innerText=e?1===e?WordViewerIntl.WordViewerStrings.l_ProgressTextOneResult:String.format(WordViewerIntl.WordViewerStrings.l_ProgressTextManyResults,e):WordViewerIntl.WordViewerStrings.l_ProgressTextNoResults},t.doneSearchingPage=function(e){this._resultsInfo.innerText=String.format(WordViewerIntl.WordViewerStrings.l_NumberOfSearchedPages,e,y.App.instance.theDocument.pageCount)},t.canPauseSearch=function(){var e=this._searchResultsDom.getLastResultBoxOffsetTop();return!isNaN(e)&&this._results.scrollTop+this._results.offsetHeight<e},t.clearAllResults=function(){this._searchResultsDom.clearAllResults(),this._prevResultButtonFlag|=1,e.setButton(this._prevResultButton,this._prevResultButtonFlag,"ReorderUp","_17x14x24"),this._nextResultButtonFlag|=1,e.setButton(this._nextResultButton,this._nextResultButtonFlag,"ReorderDown","_17x14x24"),this.showHideNavigationButtons(!1)},t.nextSearchResult=function(e,t,i,r,a){var o=n(560).SearchManager;return 1===i?y.App.isReadyForRibbon()?32:8:(y.App.get_activeAppFrame().isSearchPaneVisible&&o.instance.totalResults&&o.instance.goToNextResult(),32)},t.previousSearchResult=function(e,t,i,r,a){var o=n(560).SearchManager;return 1===i?y.App.isReadyForRibbon()?32:8:(y.App.get_activeAppFrame().isSearchPaneVisible&&o.instance.totalResults&&o.instance.goToPrevResult(),32)},t.enterNextResultButtonEvent=function(t){return 1!==this._nextResultButtonFlag&&Sys.UI.DomElement.addCssClass(this._nextResultButton.parentNode,"WACNavigationButtonFrameHover"),e.enterEvent(this._nextResultButton,this._nextResultButtonFlag,"ReorderDown","_17x14x24")},t.focusNextResultButtonEvent=function(t){1!==this._nextResultButtonFlag&&Sys.UI.DomElement.addCssClass(this._nextResultButton.parentNode,"WACNavigationButtonFrameHover"),e.enterEvent(this._nextResultButton,this._nextResultButtonFlag,"ReorderDown","_17x14x24")},t.exitNextResultButtonEvent=function(t){return Sys.UI.DomElement.removeCssClass(this._nextResultButton.parentNode,"WACNavigationButtonFrameHover"),e.exitEvent(this._nextResultButton,this._nextResultButtonFlag,"ReorderDown","_17x14x24")},t.blurNextResultButtonEvent=function(t){Sys.UI.DomElement.removeCssClass(this._nextResultButton.parentNode,"WACNavigationButtonFrameHover"),e.exitEvent(this._nextResultButton,this._nextResultButtonFlag,"ReorderDown","_17x14x24")},t.mouseDownNextResultButtonEvent=function(t){return e.mouseDownEvent(this._nextResultButton,this._nextResultButtonFlag,"ReorderDown","_17x14x24")},t.mouseUpNextResultButtonEvent=function(t){return e.mouseUpEvent(this._nextResultButton,this._nextResultButtonFlag,"ReorderDown","_17x14x24")},t.clickNextResultButtonEvent=function(e){var t=n(560).SearchManager;return 1&this._nextResultButtonFlag||t.instance.goToNextResult(),!0},t.enterPrevResultButtonEvent=function(t){return 1!==this._prevResultButtonFlag&&Sys.UI.DomElement.addCssClass(this._prevResultButton.parentNode,"WACNavigationButtonFrameHover"),e.enterEvent(this._prevResultButton,this._prevResultButtonFlag,"ReorderUp","_17x14x24")},t.focusPrevResultButtonEvent=function(t){1!==this._prevResultButtonFlag&&Sys.UI.DomElement.addCssClass(this._prevResultButton.parentNode,"WACNavigationButtonFrameHover"),e.enterEvent(this._prevResultButton,this._prevResultButtonFlag,"ReorderUp","_17x14x24")},t.exitPrevResultButtonEvent=function(t){return Sys.UI.DomElement.removeCssClass(this._prevResultButton.parentNode,"WACNavigationButtonFrameHover"),e.exitEvent(this._prevResultButton,this._prevResultButtonFlag,"ReorderUp","_17x14x24")},t.blurPrevResultButtonEvent=function(t){Sys.UI.DomElement.removeCssClass(this._prevResultButton.parentNode,"WACNavigationButtonFrameHover"),e.exitEvent(this._prevResultButton,this._prevResultButtonFlag,"ReorderUp","_17x14x24")},t.mouseDownPrevResultButtonEvent=function(t){return e.mouseDownEvent(this._prevResultButton,this._prevResultButtonFlag,"ReorderUp","_17x14x24")},t.mouseUpPrevResultButtonEvent=function(t){return e.mouseUpEvent(this._prevResultButton,this._prevResultButtonFlag,"ReorderUp","_17x14x24")},t.clickPrevResultButtonEvent=function(e){var t=n(560).SearchManager;return 1&this._prevResultButtonFlag||t.instance.goToPrevResult(),!0},t.resultClickedEvent=function(e){var t=n(560).SearchManager;m.FocusManager.tryBlur(this._searchBoxInput),m.FocusManager.tryFocus(y.App.get_activeAppFrame().workspace.appBaseDom);var i=e.sourceElement;var r=this._searchResultsDom.getSearchPaneIndex(i);if(isNaN(r)){if(!t.instance.totalResults)return!1;m.FocusManager.instance().setScope(oe.a.searchFocusID)}else t.instance.setCurrentResult(r);return!0},t.onClosePaneClickEvent=function(e){return g.AFrameworkApplication.theActionManager.processAction(le.a.hideSearchPane,2),!0},t.onScroll=function(e){var t=n(560).SearchManager.instance;return t.isSearchComplete||t.isSearchActive()||this.canPauseSearch()||t.resumeSearch(),!1},t.positionSearchPane=function(){var e=!0,t=null;y.App.get_activeAppFrame().isSearchPaneVisible?(this._pane.style.visibility="visible",y.App.get_activeAppFrame().isSearchPaneTouchMode?Sys.UI.DomElement.addCssClass(this._pane,E.AFrame.dynamicTouchModeCssClass):Sys.UI.DomElement.removeCssClass(this._pane,E.AFrame.dynamicTouchModeCssClass),t=Object(r.a)(this,this.onAfterSearchPaneShow,"onAfterSearchPaneShow")):(e=!1,t=Object(r.a)(this,this.onAfterSearchPaneHide,"onAfterSearchPaneHide"));var n=y.App.instance.theConfig.searchPaneWidth,i=y.App.get_activeAppFrame().workspace.getHeight();this._results.style.height=i>this._results.offsetTop?i-this._results.offsetTop+"px":"0px",this._pane.style.width=n+"px",se.a.animateFindPane(this._pane,e,t)},t.onAfterSearchPaneShow=function(e){this._pane.style.visibility="visible",ae.a.instance.calculateOffset()},t.onAfterSearchPaneHide=function(e){this._pane.style.visibility="hidden",ae.a.instance.calculateOffset()},t.queryChangedHandler=function(e,t){var i=n(560).SearchManager;e&&e.length?(this._isAutoFind=t,this.startNewSearch(e)):i.instance.stopSearch()},t.startNewSearch=function(e){var t=n(560).SearchManager;if(e&&e.length){var i=this.createQuery(e);i&&t.instance.startSearch(i)}},t.createQuery=function(e){var t=0;return this.matchCase&&(t|=1),this.matchWholeWord&&(t|=2),A.a.createQuery(e,t)},t.showSearchPane=function(e,t,i,r,a){var o=n(560).SearchManager;if(1===i)return y.App.isReadyForRibbon()?32:8;if(!y.App.get_activeAppFrame().isSearchPaneVisible){ae.a.instance.hideSelection();var s=0;if(a)s=a.inputMethod;o.instance.clearQuery(),y.App.get_activeAppFrame().showSearchPane(s)}this._resultsScroller.children.length||(this._resultsScroller.parentNode.className="WACSearchResultsPaneEmpty"),g.AFrameworkApplication.activeFrame.theF6Manager.activateFocus(oe.a.searchFocusID),m.FocusManager.instance().setScope(oe.a.searchFocusID);var l=y.App.get_activeAppFrame().ribbonUser;return l&&l.poll(),32},t.hideSearchPane=function(e,t,i,r,a){var o=n(560).SearchManager;if(1===i)return 32;var s=y.App.get_activeAppFrame();s.isSearchPaneVisible&&(ae.a.instance.hideSelection(),s.hideSearchPane(),o.instance.stopSearch());var l=m.FocusManager.instance();l.currentScope&&(l.currentScope.name===oe.a.searchFocusID&&l.setScope(l.defaultScopeName));g.AFrameworkApplication.activeFrame.theF6Manager.deactivateFocus(oe.a.searchFocusID);var c=y.App.get_activeAppFrame().ribbonUser;return c&&c.poll(),32},t.toggleSearchPane=function(e,t,n,i,r){return y.App.get_activeAppFrame().isSearchPaneVisible?this.hideSearchPane(e,t,n,i,r):this.showSearchPane(e,t,n,i,r)},t.queryToggleSearchPane=function(e,t,n,i,r){return 1===n||(r[W.a.On]=y.App.get_activeAppFrame().isSearchPaneVisible),32},t.queryClearSearch=function(e,t,n,i,r){var a=r,o=!this._searchBox||""===this._searchBox.value;return a[N.a.Image16by16Class]=o?P.getImageClass(w.splitButtonSearchIcon):P.getImageClass(w.splitButtonCancelIcon),a[N.a.LabelText]=o?WordViewerIntl.WordViewerStrings.l_SearchButtonTitleBegin:WordViewerIntl.WordViewerStrings.l_SearchButtonTitleEnd,a[N.a.On]=!1,32},t.clearSearch=function(e,t,i,r,a){var o=n(560).SearchManager;return 1===i||o.instance.stopSearch(),32},t.clearSearchFromSearchMenu=function(e,t,i,r,a){var o=n(560).SearchManager;return 1===i?!this._searchBox||""===this._searchBox.value?8:32:(o.instance.stopSearch(),this._searchBox&&this._searchBox.setFocus(),32)},t.updateFilters=function(e,t,n,i,r){if(1===n)return 32;switch(e){case j.a.findMatchCase:this.toggleMatchCaseFilter();break;case j.a.findWholeWord:this.toggleMatchWholeWordFilter()}return this.startNewSearch(this._searchBox.value),32},t.queryFindMatchCase=function(e,t,n,i,r){return r[W.a.On]=this.matchCase,32},t.queryFindWholeWord=function(e,t,n,i,r){return r[W.a.On]=this.matchWholeWord,32},t.toggleMatchWholeWordFilter=function(){this.matchWholeWord=!this.matchWholeWord,this._searchBox&&this._searchBox.updateControl(T.buttonFindMatchWholeWordId),this.updateFiltersLabel(),this._searchBox&&this._searchBox.setFocus()},t.toggleMatchCaseFilter=function(){this.matchCase=!this.matchCase,this._searchBox&&this._searchBox.updateControl(T.buttonFindMatchCaseId),this.updateFiltersLabel(),this._searchBox&&this._searchBox.setFocus()},t.updateFiltersLabel=function(){var e=this.matchCase||this.matchWholeWord;this._filtersDiv.style.display=e?"block":"none",e&&(this._filtersDiv.innerText=this.getFiltersLabel())},t.getFiltersLabel=function(){var e="";return this.matchCase&&this.matchWholeWord?e=String.format(WordViewerIntl.WordViewerStrings.l_FindMultipleFiltersLabelText,WordViewerIntl.WordViewerStrings.l_MatchCase,WordViewerIntl.WordViewerStrings.l_MatchWholeWord):this.matchCase?e=String.format(WordViewerIntl.WordViewerStrings.l_FindFilterLabelText,WordViewerIntl.WordViewerStrings.l_MatchCase):this.matchWholeWord&&(e=String.format(WordViewerIntl.WordViewerStrings.l_FindFilterLabelText,WordViewerIntl.WordViewerStrings.l_MatchWholeWord)),e},e.getNavigationButtonKeyUpHandler=function(e){return function(t){var n=t.keyCode;n!==x.a.vK_Enter&&n!==x.a.vK_Space||e()}},e.createSearchResult=function(){var e=b.b("div",null,"WACResultOutline"),t=b.b("div",null,"WACSearchResult"),n=b.b("span",null,null),i=b.b("span",null,"WACContext"),r=b.b("span",null,null);return t.appendChild(n),t.appendChild(i),t.appendChild(r),e.appendChild(t),e},e.enterEvent=function(t,n,i,r){return n|=4,e.setButton(t,n,i,r),!0},e.exitEvent=function(t,n,i,r){return n&=-13,e.setButton(t,n,i,r),!0},e.mouseDownEvent=function(t,n,i,r){return n|=8,e.setButton(t,n,i,r),!0},e.mouseUpEvent=function(t,n,i,r){return n&=-9,n|=4,e.setButton(t,n,i,r),!0},e.setButton=function(e,t,n,i){var r=e.firstChild;if(4&t&&"Search"!==n&&!(1&t)&&(n+="Hover"),2&t&&(n="cancel"+n),1&t)return r.className=P.getImageClass(n+"Disabled"+i),void(r.style.cursor="default");r.className=P.getImageClass(n+i)},e}();Object(i.a)(ce,"SearchPane",null,[4]);var ue=n(43),de=n(569),he=n(94);function pe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ge=function(){function e(e,t,n,i,r){this._zoomControl=null,this._scrollControl=null,this._context=e,this._page=t,this._hitOnPage=n,this._textrunIdOfContainingParagraph=r,this._location=i}var t,n,i,r=e.prototype;return r.dispose=function(){this._location=null},r.getScrollTop=function(){var e=this.zoomControl.currentZoom,t=he.a.instance.getPageTopAtZoom(this._page,e),n=this.scrollControl.getScrollTop(),i=t+this._location.top*e;if(i<n)return Math.round(i-e*(this._location.height*y.App.instance.theConfig.searchResultVerticalMultiplier));var r=this.scrollControl.getClientHeight(),a=n+r,o=i+this._location.height*e;return o>a?Math.round(o+this._location.height*y.App.instance.theConfig.searchResultVerticalMultiplier*e-r):Number.NaN},r.getScrollLeft=function(){var e=this.zoomControl.currentZoom,t=this.scrollControl.getScrollLeft(),n=this.scrollControl.getWidth(),i=t+n;if(g.AFrameworkApplication.isRtl){var r=he.a.instance.getDistanceOfPageLeftFromScrollerRightEdge(this._page,e),a=r-this._location.left*e,o=r-(this._location.left+this._location.width)*e;if(o>(t=Math.abs(t)))return Math.round(a-y.App.instance.theConfig.searchResultHorizontalBuffer);if(a<t)return Math.round(o-y.App.instance.theConfig.searchResultHorizontalBuffer)}else{var s=he.a.instance.getPageLeftAtZoom(this._page,e,!1)+this._location.left*e,l=s+this._location.width*e;if(s<t)return Math.round(s-y.App.instance.theConfig.searchResultHorizontalBuffer);if(l>i)return Math.round(l-n+y.App.instance.theConfig.searchResultHorizontalBuffer)}return Number.NaN},t=e,(n=[{key:"context",get:function(){return this._context}},{key:"zoomControl",get:function(){return this._zoomControl||(this._zoomControl=f.a.instance.resolve("WordViewer.Controls.IZoomControl"))}},{key:"scrollControl",get:function(){return this._scrollControl||(this._scrollControl=f.a.instance.resolve("WordViewer.Controls.IScrollControl"))}},{key:"id",get:function(){return String.format("{0}-{1}",this._page,this._hitOnPage)}},{key:"page",get:function(){return this._page}},{key:"paragraphTextrunId",get:function(){return this._textrunIdOfContainingParagraph}}])&&pe(t.prototype,n),i&&pe(t,i),e}();Object(i.a)(ge,"SearchResult",null,[4]);var me=n(570),fe=n(27);function _e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ve=function(){function e(e){this._isPaused=!0,this._nextSearchTask=null,this._pageBeingSearched=0,this._countHitsOnPage=0,this._isComplete=!0,this._paragraphXmls=null,this._paragraphBeingSearched=0,this._searchResults=[],this._countRunCharacters=0,this._countRunParagraphs=0,this._searchContextFactory=e}var t,i,a,o=e.prototype;return o.startSearch=function(){this.reset(),this._isComplete=!1,this._isPaused=!1,this._countHitsOnPage=0,this.getNextPage()},o.reset=function(){this.stopSearchTask(),this.clearSearchResults(),this._isPaused=!0,this._pageBeingSearched=0,this._isComplete=!0,this._paragraphXmls=null},o.resumeSearch=function(){n(560).SearchManager;this._pageBeingSearched&&(this._isPaused=!1,g.AFrameworkApplication.theWsaClient.incrementDw(89406,1),this.getNextPage())},o.getNextPage=function(){this._pageBeingSearched++,y.App.get_activeAppFrame().thePageInfoCache.updateSearchCache(this._pageBeingSearched),this._nextSearchTask=new ue.a(3,1,y.App.instance.theConfig.searchTaskDelay,Object(r.a)(this,this.waitOnNextPage,"waitOnNextPage")),g.AFrameworkApplication.theTaskManager.addTask(this._nextSearchTask)},o.waitOnNextPage=function(e){var t=y.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(this._pageBeingSearched);if(t){if(this._paragraphXmls=t.selectNodes("descendant::P"),this._paragraphBeingSearched=0,!this._paragraphXmls.length)return void this.getNextPage();this._nextSearchTask=new ue.a(3,1,y.App.instance.theConfig.searchTaskDelay,Object(r.a)(this,this.parseParagraphXmlTask,"parseParagraphXmlTask"))}else 0;g.AFrameworkApplication.theTaskManager.addTask(this._nextSearchTask)},o.parseParagraphXmlTask=function(e){this._countRunCharacters=0,this._countRunParagraphs=0;for(var t=y.App.instance.theConfig;this._paragraphBeingSearched<this._paragraphXmls.length&&this._countRunCharacters<t.minCharactersToSearchBeforePausing&&this._countRunParagraphs<t.maxParagraphsToSearchBeforePausing;)this.parseParagraphXml();if(this._paragraphBeingSearched<this._paragraphXmls.length)g.AFrameworkApplication.theTaskManager.addTask(this._nextSearchTask);else{var i=y.App.get_activeAppFrame().workspace,r=n(560).SearchManager.instance;r.doneSearchingPage(this._pageBeingSearched),this._countHitsOnPage=0;var a=he.a.instance.pageCount;this._pageBeingSearched===a?(this._nextSearchTask=null,this._isComplete=!0,r.doneSearch(this._searchResults.length)):!(this._pageBeingSearched%y.App.instance.theConfig.searchPageIncrement)&&this._pageBeingSearched>=i.getLastCachedPage()&&r.canPauseSearch()?(this._isPaused=!0,this._nextSearchTask=null,g.AFrameworkApplication.theWsaClient.incrementDw(89405,1)):this.getNextPage()}},o.parseParagraphXml=function(){var e=this._paragraphXmls[this._paragraphBeingSearched];if(!e.selectSingleNode("ancestor::P")){var t=e.selectNodes("descendant::T/text()"),n=me.a(t);t.length&&this.grepTheText(n,t),this._countRunParagraphs++,this._countRunCharacters+=n.length}this._paragraphBeingSearched++},o.grepTheText=function(e,t){for(var i,r,a,o=n(560).SearchManager.instance,s=o.regex,l=parseInt(t[0].selectSingleNode("ancestor::Page").attributes.getNamedItem("id").nodeValue),c=0,u=0;a=s.exec(e);){i=a.index,r=s.lastIndex;for(var d=0,h=this._searchContextFactory.createSearchContext(e,a[0],i,r,""),p=null;c<t.length;++c){if(d=u+t[c].data.length,u<r&&d>i){0,p=de.a.instance.estimatedBoundingBox(t[c].parentNode,i-u,Math.min(d-u,r-u));break}u=d}var g=parseInt(fe.a.parseXmlAttribute(t[0].parentNode,"id")),m=new ge(h,l,this._countHitsOnPage,p,g);this._searchResults[this._searchResults.length]=m,this._countHitsOnPage++,o.foundResult(m,this._searchResults.length-1),1===this._searchResults.length&&o.foundFirstSearchResult()}},o.stopSearchTask=function(){this._nextSearchTask&&(g.AFrameworkApplication.theTaskManager.deleteTask(this._nextSearchTask),this._nextSearchTask=null),y.App.get_activeAppFrame().thePageInfoCache&&y.App.get_activeAppFrame().thePageInfoCache.removeSearchCache()},o.clearSearchResults=function(){for(var e=0;e<this._searchResults.length;++e)this._searchResults[e].dispose(),this._searchResults[e]=null;Array.clear(this._searchResults),this._searchResults=[]},o.pageCacheChanged=function(e){var t=n(560).SearchManager;e>=this._pageBeingSearched&&t.instance.resumeSearch()},o.getResult=function(e){return this._searchResults[e]},o.dispose=function(){this.reset(),this._searchResults=null,this._searchContextFactory=null},e.createInstanceWithResolvedDependencies=function(t){return new e(t)},e.createInstance=function(t){return e.createInstanceWithResolvedDependencies(t)},t=e,(i=[{key:"pageBeingSearched",get:function(){return this._pageBeingSearched}},{key:"complete",get:function(){return this._isComplete}},{key:"paused",get:function(){return this._isPaused}},{key:"totalResults",get:function(){return this._searchResults.length}}])&&_e(t.prototype,i),a&&_e(t,a),e}();function ye(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ve,"SearchWorker",null,[4]),n.d(t,"SearchManager",(function(){return Se}));var Se=function(){function e(t,i,a){var o;this._originalQuery=null,this._regex=null;var s=n(577).HighlightWorker,l=n(575).CurrentResult;this._searchWorker=ve.createInstance(e.getSearchContextFactory()),this._highlightWorker=s.createInstance(i),this._currentResult=new l,this._searchPane=new ce(t),v.ULS.sendTraceTag(4575576,313,50,"{0}",((o={}).SearchPaneCreation=!!this._searchPane,o)),this._queryProcessor=p.instance,this._findUtils=a,this._currentQueryString="",g.AFrameworkApplication.theActionManager.addActionWithFlags(le.a.pageCacheChanged,S.a.application,Object(r.a)(this,this.pageCacheChanged,"pageCacheChanged"),96)}var t,i,a,s=e.prototype;return s.isSearchActive=function(){return!this._searchWorker.paused},s.dispose=function(){v.ULS.sendTraceTag(4575577,313,50,"SearchManagerDispose"),this._currentResult&&(this._currentResult.dispose(),this._currentResult=null),this._highlightWorker&&(this._highlightWorker.dispose(),this._highlightWorker=null),this._searchPane&&(this._searchPane.dispose(),this._searchPane=null),this._searchWorker&&(this._searchWorker.dispose(),this._searchWorker=null)},s.foundFirstSearchResult=function(){this._currentResult.reset(),this._highlightWorker.setupHighlighting(),this.setCurrentResult(0)},s.startSearch=function(e){g.AFrameworkApplication.theWsaClient.incrementDw(8813,1);var t=this._queryProcessor.preprocessQuery(e.text);if(t){var n=this.currentQueryString,i=this._originalQuery;if(i&&i.matchCase===e.matchCase&&i.matchWholeWord===e.matchWholeWord&&t.length===n.length)if((i.matchCase?new RegExp(t):new RegExp(t,"i")).exec(n))return;this._currentQueryString=t,this._originalQuery=e,this._regex=this._findUtils.getRegex(this.currentQueryString,this._originalQuery),this._searchPane.startSearch(),this._searchWorker.startSearch(),this._highlightWorker.reset()}},s.stopSearch=function(){this._currentResult.reset(),this._searchWorker.reset(),this._highlightWorker.reset(),this._searchPane.reset(),this.clearQuery()},s.doneSearch=function(e){g.AFrameworkApplication.theWsaClient.addToAverage(89404,e),g.AFrameworkApplication.theWsaClient.setIfMax(89528,e),g.AFrameworkApplication.theWsaClient.setIfMin(89529,e),this._searchPane.doneSearch(e)},s.resumeSearch=function(){this._searchWorker.paused&&!this._searchWorker.complete&&(this._searchWorker.resumeSearch(),this._searchPane.resumeSearch())},s.goToNextResult=function(){var e=this._currentResult.resultNumber,t=this.totalResults;this.setCurrentResult(e<t-1?e+1:0)},s.goToPrevResult=function(){var e=this._currentResult.resultNumber;this.setCurrentResult(e>0?e-1:this.totalResults-1)},s.clearQuery=function(){this._originalQuery=null,this._currentQueryString="",this._regex=null},s.setCurrentResult=function(e){var t=this.totalResults;if(!(e<0||e>=t)){var n=this._searchWorker.getResult(e),i=this._searchPane.goToResult(e,t);this._currentResult.setCurrentResult(n,i,e),m.FocusManager.instance().setScope(oe.a.searchFocusID)}},s.pageCacheChanged=function(e,t,n,i,r){var a=r;if(2===a.length&&a[0]&&a[1]){var o=a[0],s=a[1];this._highlightWorker.pageCacheChanged(o,s),this._searchWorker.pageCacheChanged(s)}return 32},s.doneSearchingPage=function(e){this._searchPane.doneSearchingPage(e)},s.canPauseSearch=function(){return this._searchPane.canPauseSearch()},s.foundResult=function(e,t){this._searchPane.foundResult(e,t)},s.foundCurrentResult=function(e){this._currentResult.foundCurrentResult(e)},s.lookForCurrentResult=function(e,t,n){this._highlightWorker.lookForCurrentResult(e,t,n)},s.clearCurrentResultHighlight=function(){this._currentResult.clearCurrentResultHighlight()},s.getHighlightsByPage=function(e){return this._highlightWorker.getHighlightsByPage(e)},s.showSearchPane=function(e,t,n,i,r){return _.c(this._searchPane)?(v.ULS.sendTraceTag(4575578,313,10,"InconsistentShowSearchState"),16):this._searchPane.showSearchPane(e,t,n,i,r)},s.toggleSearchPane=function(e,t,n,i,r){return _.c(this._searchPane)?(v.ULS.sendTraceTag(4575579,313,10,"InconsistentToggleSearchState"),16):this._searchPane.toggleSearchPane(e,t,n,i,r)},e.getSearchContextFactory=function(){return new c},t=e,a=[{key:"instance",get:function(){return e._instance||e._initializing||y.App.instance.isSmallView||g.AFrameworkApplication.isNoChrome||!y.App.get_activeAppFrame().workspace.initialized||(e._initializing=!0,e._instance=new e(y.App.get_activeAppFrame().workspace.appBaseDom,f.a.instance.resolve("WordViewer.Controls.IScrollControl").scroller,o.instance),e._initializing=!1),e._instance}}],(i=[{key:"pageBeingSearched",get:function(){return this._searchWorker.pageBeingSearched}},{key:"isSearchComplete",get:function(){return this._searchWorker.complete}},{key:"totalResults",get:function(){return this._searchWorker.totalResults}},{key:"currentSelectedResult",get:function(){return this._currentResult}},{key:"currentQueryString",get:function(){return this._currentQueryString}},{key:"regex",get:function(){return this._regex}}])&&ye(t.prototype,i),a&&ye(t,a),e}();Se._instance=null,Se._initializing=!1,Object(i.a)(Se,"SearchManager",null,[4])},561:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));var i=function(e,t,n){var i=document.createElement(e);return t&&(i.id=t),n&&(i.className=n),i},r=function(e,t,n){var r=i(e,t,n);return r.setAttribute("Unselectable","on"),r}},562:function(e,t,n){"use strict";var i=n(0),r=n(19),a=n(14),o=n(1),s=n(30),l=n(149),c=n(94);function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(e,t,n,i,r,a){this._box=e,this._style=t,this._id=n,this._page=i,this._domElem=document.createElement("div"),this._domElem.id=n,this._zoom=1,this._isRtl=r,this._documentDataUtils=a,this.addStyle(t)}var t,n,i,r=e.prototype;return r.addStyle=function(e){switch(this._style=e,e){case 1:Sys.UI.DomElement.addCssClass(this._domElem,"CommonHighlight WACHighlight");break;case 2:Sys.UI.DomElement.addCssClass(this._domElem,"WACActiveHighlight");break;case 3:Sys.UI.DomElement.addCssClass(this._domElem,"CommonHighlight WACCommentHighlight");break;case 0:default:Sys.UI.DomElement.addCssClass(this._domElem,"WACSelection")}},r.removeStyle=function(e){switch(e===this._style&&2===e?this._style=1:this._style=-1,e){case 1:Sys.UI.DomElement.removeCssClass(this._domElem,"CommonHighlight WACHighlight");break;case 2:Sys.UI.DomElement.removeCssClass(this._domElem,"WACActiveHighlight");break;case 3:Sys.UI.DomElement.removeCssClass(this._domElem,"CommonHighlight WACCommentHighlight");break;case 0:default:Sys.UI.DomElement.removeCssClass(this._domElem,"WACSelection")}},r.setPosition=function(e,t,n){this._page=t,this._zoom=n,this._box=this.box,this.reposition()},r.cloneHighlight=function(){return s.WacAirSpace.cloneElement(this.domElem,!1,!0)},r.hideHighlight=function(){l.a.animateHideHighlight(this.domElem)},r.showHighlight=function(){this.reposition(),l.a.animateShowHighlight(this.domElem)},r.reposition=function(){this._isRtl?this._domElem.style.right=this._documentDataUtils.getDistanceOfPageLeftFromScrollerRightEdge(this._page,this._zoom)-(Math.round(this._box.left*this._zoom)+Math.round(this._box.width*this._zoom))+"px":this._domElem.style.left=this._documentDataUtils.getPageLeftAtZoom(this._page,this._zoom,!1)+Math.round(this._box.left*this._zoom)+"px",this._domElem.style.top=this._documentDataUtils.getPageTopAtZoom(this._page,this._zoom)+Math.round(this._box.top*this._zoom)+"px",this._domElem.style.width=Math.round(this._box.width*this._zoom)+"px",this._domElem.style.height=Math.round(this._box.height*this._zoom)+"px"},e.createAnInstance=function(t,n,i,r){return new e(t,n,i,r,o.AFrameworkApplication.isRtl,c.a.instance)},t=e,(n=[{key:"left",get:function(){return this._box.left},set:function(e){this._box.left=e}},{key:"top",get:function(){return this._box.top},set:function(e){this._box.top=e}},{key:"width",get:function(){return this._box.width},set:function(e){this._box.width=e}},{key:"height",get:function(){return this._box.height},set:function(e){this._box.height=e}},{key:"box",get:function(){return this._box},set:function(e){this._box=e}},{key:"style",get:function(){return this._style},set:function(e){this._style=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"page",get:function(){return this._page},set:function(e){this._page=e}},{key:"domElem",get:function(){return this._domElem},set:function(e){this._domElem=e}}])&&u(t.prototype,n),i&&u(t,i),e}();Object(i.a)(d,"HighlightRectanglePng",null,[205]);var h=n(569);function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(e,t){this._parent=e,this._highlightUtils=t}var t,n,i,r=e.prototype;return r.removeFromParent=function(e){e&&this._parent.removeChild(e.domElem)},r.drawRectangle=function(e,t,n,i){var r=d.createAnInstance(e,t,n,i);return this._parent.appendChild(r.domElem),r},r.isPageLoaded=function(e){return!0},r.computeBoundingBoxForTextRun=function(e,t,n){var i,r,o=a.App.instance.theConfig.dpiAspectRatio,s=parseFloat(e.attributes.getNamedItem("l").nodeValue),l=parseFloat(e.attributes.getNamedItem("t").nodeValue),c=parseFloat(e.attributes.getNamedItem("w").nodeValue),u=parseFloat(e.attributes.getNamedItem("h").nodeValue),d=e.attributes.getNamedItem("a")?parseInt(e.attributes.getNamedItem("a").nodeValue):0,h=!!e.attributes.getNamedItem("rtl"),p=!!e.attributes.getNamedItem("gr"),g="";if(!e.attributes.getNamedItem("cw"))return this._highlightUtils.estimatedBoundingBox(e,t,n);g=e.attributes.getNamedItem("cw").nodeValue;var m=0,f=0;e.childNodes[0].data.length;var _=Number.NaN,v=Number.NaN;h||d?270===d&&!h||90===d&&h?(_=(s+c)/o,v=(l+u)/o):90===d&&!h||270===d&&h?(_=s/o,v=l/o):isNaN(_)&&(_=(s+c)/o,v=(l+u)/o):(_=s/o,v=l/o);var y=g.split(";"),S=[];Array.addRange(S,y),Array.removeAt(S,S.length-1);var b=t-0,C=c/o,A=0,T=0,w=(i=this._highlightUtils.calculateWidth(p,b,C,S,A,T,!1),A=i.positionInIndicies,T=i.positionInCharRun,i).returnValue;p?m=v+w:d?270===d&&!h||90===d&&h?m=v-w:(90===d&&!h||270===d&&h)&&(m=v+w):m=h?_-w:_+w;var k=n-0,I=(r=this._highlightUtils.calculateWidth(p,k,C,S,A,T,!0),A=r.positionInIndicies,T=r.positionInCharRun,r).returnValue;return p?f=m+I:d?270===d&&!h||90===d&&h?f=m-I:(90===d&&!h||270===d&&h)&&(f=m+I):f=h?m-I:m+I,this._highlightUtils.drawHitBox(d,h,p,s,l,c,u,m,f,e,t,n)},e.createAnInstance=function(t){return new e(t,h.a.instance)},t=e,(n=[{key:"parent",get:function(){return this._parent},set:function(e){this._parent=e}},{key:"needsManualRepositioning",get:function(){return!0}}])&&p(t.prototype,n),i&&p(t,i),e}();function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(g,"HighlightManagerPng",null,[189]),n.d(t,"a",(function(){return f}));var f=function(){function e(){}var t,n,i;return e.getHighlightManagerWithResolvedDependencies=function(){return e.createHighlightManager(0,r.a.instance.resolve("WordViewer.Controls.IScrollControl").scroller)},e.createHighlightManager=function(e,t){switch(e){case 0:return g.createAnInstance(t);default:0}return null},t=e,i=[{key:"instance",get:function(){return e._instance||e._initializing||(e._initializing=!0,e._instance=e.getHighlightManagerWithResolvedDependencies(),e._initializing=!1),e._instance}}],(n=null)&&m(t.prototype,n),i&&m(t,i),e}();f._initializing=!1,f._instance=null,Object(i.a)(f,"HighlightManager",null,[])},563:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(0),r=function(){function e(){}return e.prototype.getSelectionXmlNodeWrapper=function(e){var t=n(576).XmlNodeWrapper;return e?new t(e):null},e}();Object(i.a)(r,"XmlNodeWrapperFactory",null,[204])},564:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(565),a=n(32),o=n(572),s=n(561),l=n(567),c=n(33),u=n(1),d=n(41),h=n(52),p=n(53),g=n(70),m=n(3),f=n(23),_=n(24),v=n(18),y=n(43),S=n(6),b=n(20),C=n(15),A=n(9),T=n(7);function w(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var F=function(){function e(e){this.minimumTextboxRows=4,this._previousTextLength=0,this._cancelCommentButton=null,this._content=null,this._container=null,this._deleteButton=null,this._doneButton=null,this._doneButtonImage=null,this._replyButton=null,this._saveButton=null,this._footerRow=null,this._footerControls=null,this._footerAddNewControls=null,this._statusIconContainer=null,this._headerRow=null,this._textEntryBox=null,this._textMeasurementContainer=null,this._textMeasurementBox=null,this._saveButtonKeyEventHandler=null,this._doneButtonKeyEventHandler=null,this._replyButtonKeyEventHandler=null,this._cancelButtonKeyEventHandler=null,this._deleteButtonKeyEventHandler=null,A.a.isInternetExplorer8&&(this.minimumTextboxRows=6),this._comment=e,this._escapeKeyHash=v.KeyInputManager.hashKey(_.a.vK_Escape,0),this.render()}var t,n,i,r=e.prototype;return r.dispose=function(){var e=u.AFrameworkApplication.activeFrame.theClickInputManager,t=u.AFrameworkApplication.activeFrame.theKeyInputManager;if(e.unregisterHandler(m.a.click,this._container,Object(a.a)(this,this.onContainerClick,"onContainerClick")),e.unregisterHandler(m.a.doubleClick,this._container,Object(a.a)(this,this.onContainerDoubleClick,"onContainerDoubleClick")),t.unregisterHandler(m.a.keyUp,this._container,Object(a.a)(this,this.onContainerKeyPress,"onContainerKeyPress")),this._deleteButton&&(e.unregisterHandler(m.a.click,this._deleteButton,Object(a.a)(this,this.onDeleteButtonClick,"onDeleteButtonClick")),t.unregisterHandlerForAllKeyEvents(this._deleteButton,this._deleteButtonKeyEventHandler)),this._doneButton&&(e.unregisterHandler(m.a.click,this._doneButton,Object(a.a)(this,this.onDoneButtonClick,"onDoneButtonClick")),t.unregisterHandlerForAllKeyEvents(this._doneButton,this._doneButtonKeyEventHandler)),this._saveButton&&(e.unregisterHandler(m.a.click,this._saveButton,Object(a.a)(this,this.onSaveButtonClick,"onSaveButtonClick")),t.unregisterHandlerForAllKeyEvents(this._saveButton,this._saveButtonKeyEventHandler)),this._cancelCommentButton&&(e.unregisterHandler(m.a.click,this._cancelCommentButton,Object(a.a)(this,this.onCancelButtonClick,"onCancelButtonClick")),t.unregisterHandlerForAllKeyEvents(this._cancelCommentButton,this._cancelButtonKeyEventHandler)),this._replyButton&&(e.unregisterHandler(m.a.click,this._replyButton,Object(a.a)(this,this.onReplyButtonClick,"onReplyButtonClick")),t.unregisterHandlerForAllKeyEvents(this._replyButton,this._replyButtonKeyEventHandler)),this._textEntryBox){if(t.unregisterHandler(m.a.keyPress,this._textEntryBox,Object(a.a)(this,this.onKeyEvent,"onKeyEvent")),t.unregisterHandler(m.a.keyUp,this._textEntryBox,Object(a.a)(this,this.onKeyEvent,"onKeyEvent")),A.a.isIPad){var n=u.AFrameworkApplication.activeFrame.theCompositionEventManager;n.unregisterHandler(m.a.compositionStart,this._textEntryBox,Object(a.a)(this,this.onCompositionEvent,"onCompositionEvent")),n.unregisterHandler(m.a.compositionEnd,this._textEntryBox,Object(a.a)(this,this.onCompositionEvent,"onCompositionEvent")),n.unregisterHandler(m.a.compositionUpdate,this._textEntryBox,Object(a.a)(this,this.onCompositionEvent,"onCompositionEvent"))}p.a.instance.unregisterHandler(m.a.paste,this._textEntryBox,Object(a.a)(this,this.onPaste,"onPaste"))}this._container=null,this._deleteButton=null,this._replyButton=null,this._doneButton=null,this._doneButtonImage=null,this._saveButton=null,this._cancelCommentButton=null,this._textEntryBox=null,this._textMeasurementContainer=null,this._textMeasurementBox=null,this._footerRow=null,this._headerRow=null},r.focus=function(){f.FocusManager.instance().scopeChanged(c.AFrame.commentPaneFocusId),this._container.focus(),this._comment.commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(this._container)},r.focusOnTextbox=function(){f.FocusManager.instance().scopeChanged(o.a.commentPaneTextboxFocusId),this._textEntryBox.focus(),this._comment.commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(this._textEntryBox),2===this._comment.commentType&&this._textEntryBox.value&&this._textEntryBox.value.length>0&&C.a.selectAllTextInInput(this._textEntryBox);var e=this._comment.commentManager.pane.paneSurface,t=C.a.getRelativeLocation(e,this._container);t.y+this._container.clientHeight>e.scrollTop+e.clientHeight&&(e.scrollTop=t.y+this._container.clientHeight-e.clientHeight)},r.finishedCreatingOrEditingComment=function(){if(Sys.UI.DomElement.removeCssClass(this._container,"NewOrEditComment"),this._cancelCommentButton.style.display="none",this._textEntryBox.style.display="none",f.FocusManager.tryBlur(this._textEntryBox),f.FocusManager.tryBlur(this._saveButton),f.FocusManager.instance().getScope(o.a.commentPaneTextboxFocusId).unBindAction(this._escapeKeyHash),f.FocusManager.instance().removeScope(o.a.commentPaneTextboxFocusId),v.KeyInputManager.instance.unregisterHandler(m.a.keyPress,this._textEntryBox,Object(a.a)(this,this.onKeyEvent,"onKeyEvent")),v.KeyInputManager.instance.unregisterHandler(m.a.keyUp,this._textEntryBox,Object(a.a)(this,this.onKeyEvent,"onKeyEvent")),A.a.isIPad){var e=u.AFrameworkApplication.activeFrame.theCompositionEventManager;e.unregisterHandler(m.a.compositionStart,this._textEntryBox,Object(a.a)(this,this.onCompositionEvent,"onCompositionEvent")),e.unregisterHandler(m.a.compositionEnd,this._textEntryBox,Object(a.a)(this,this.onCompositionEvent,"onCompositionEvent")),e.unregisterHandler(m.a.compositionUpdate,this._textEntryBox,Object(a.a)(this,this.onCompositionEvent,"onCompositionEvent"))}p.a.instance.unregisterHandler(m.a.paste,this._textEntryBox,Object(a.a)(this,this.onPaste,"onPaste")),this._content.removeChild(this._textEntryBox),this._content.removeChild(this._textMeasurementContainer),this._textEntryBox=null,this._textMeasurementContainer=null,this._textMeasurementBox=null,this.updateRenderedText(),this.updateRenderedState(),this.focus()},r.updateRenderedState=function(){this.renderState(this._statusIconContainer,this._footerControls,this._footerAddNewControls,this._doneButton,this._doneButtonImage,this._container)},r.render=function(){var t=s.a("a",this.makeId("cc"),"CommentContainer");S.a.setAriaAttribute(t,S.a.ariaDescribedByAttribute,o.a.commentTabHelp),t.tabIndex=0,this._comment.replyToId&&(t.className+=" Reply1");var n=s.a("div",this.makeId("ch"),"CommentHeaderRow"),i=s.a("span",this.makeId("ca"),"CommentAuthor UIFontBold");i.innerText=this._comment.author,n.appendChild(i);var r=s.a("span",this.makeId("ct"),"CommentDate");r.innerText=e.dateToString(this._comment.date,this._comment.commentManager.dateFormat,this._comment.commentManager.timeFormat),Sys.UI.DomElement.addCssClass(r,u.AFrameworkApplication.isRtl?"FloatLeft":"FloatRight"),n.appendChild(r);var c=s.a("span",this.makeId("ci"),"CommentStatusIcon");n.appendChild(c);var d=null;this._comment.isCommentBeingCreatedOrEdited&&(d=l.a.createButton(this.makeId("cl"),o.a.commentCancelButtonClassName,CommonUIStrings.l_CommentCancelButton,"ClosePaneGlyph_16x16x32",!1),Sys.UI.DomElement.addCssClass(d,u.AFrameworkApplication.isRtl?"FloatLeft":"FloatRight"),d.tabIndex=0,n.appendChild(d)),this._content=s.a("div",this.makeId("cn"),"CommentContent");var h=null,g=null,f=null;this._comment.isCommentBeingCreatedOrEdited?((h=s.a("textarea",this.makeId("ce"),o.a.commentTextEntryClassName+" UIFont")).rows=this.minimumTextboxRows,h.cols=50,h.tabIndex=0,S.a.setAriaAttribute(h,"title",CommonUIStrings.l_CommentContent),this._content.appendChild(h),g=s.a("div","","CommentTextMeasurementContainer"),(f=s.a("textarea","",o.a.commentTextEntryClassName+" UIFont")).rows=1,f.cols=50,f.style.visibility="hidden",f.spellcheck=!1,g.appendChild(f),this._content.appendChild(g),2===this._comment.commentType&&(h.value=this._comment.text.join("\n")+"\n")):this.updateRenderedText();var v=s.a("div","","CommentFooterRow"),y=s.a("span",this.makeId("cf"),""),b=l.a.createButton(this.makeId("cr"),o.a.commentReplyButtonClassName+" CommentFooterButton",CommonUIStrings.l_CommentReplyButton,"CommentReply_16x16x32",!1);b.tabIndex=0,b.setAttribute(S.a.ariaRoleAttribute,S.a.ariaButtonRole),y.appendChild(b);var C=l.a.createButton(this.makeId("cd"),"CommentDoneButton CommentFooterButton",CommonUIStrings.l_CommentDoneButton,"CheckboxUnchecked_16x16x32",!1);C.tabIndex=0;var T=C.childNodes[0].childNodes[0];y.appendChild(C);var w=l.a.createButton(this.makeId("cx"),o.a.commentDeleteButtonClassName+" CommentFooterButton",CommonUIStrings.l_CommentDeleteButton,"Delete_16x16x32",!1);C.tabIndex=0,y.appendChild(w),v.appendChild(y);var k=s.a("span",this.makeId("cfa"),""),I=l.a.createButton(this.makeId("cs"),o.a.commentSaveButtonClassName,CommonUIStrings.l_CommentSaveCommentButton,null);l.a.setButtonEnabledState(I,!1),I.tabIndex=0,k.appendChild(I),v.appendChild(k),this.renderState(c,y,k,C,T,t),this._comment.commentManager.copyingEnabled||(i.setAttribute("Unselectable","on"),r.setAttribute("Unselectable","on")),t.appendChild(n),t.appendChild(this._content),t.appendChild(v),this._container=t,this._doneButton=C,this._doneButtonImage=T,this._deleteButton=w,this._replyButton=b,this._saveButton=I,this._textEntryBox=h,this._textMeasurementContainer=g,this._textMeasurementBox=f,this._cancelCommentButton=d,this._footerRow=v,this._footerControls=y,this._footerAddNewControls=k,this._statusIconContainer=c,this._headerRow=n;var F=u.AFrameworkApplication.activeFrame.theClickInputManager,E=u.AFrameworkApplication.activeFrame.theKeyInputManager;if(F.registerHandler(m.a.click,this._container,Object(a.a)(this,this.onContainerClick,"onContainerClick")),F.registerHandler(m.a.doubleClick,this._container,Object(a.a)(this,this.onContainerDoubleClick,"onContainerDoubleClick")),E.registerHandler(m.a.keyUp,this._container,Object(a.a)(this,this.onContainerKeyPress,"onContainerKeyPress")),this._doneButton&&(F.registerHandler(m.a.click,this._doneButton,Object(a.a)(this,this.onDoneButtonClick,"onDoneButtonClick")),this._doneButtonKeyEventHandler=E.registerHandlerForAllKeyEvents(this._doneButton,Object(a.a)(this,this.onDoneButtonClick,"onDoneButtonClick"),_.a.vK_Enter)),this._replyButton&&(F.registerHandler(m.a.click,this._replyButton,Object(a.a)(this,this.onReplyButtonClick,"onReplyButtonClick")),this._replyButtonKeyEventHandler=E.registerHandlerForAllKeyEvents(this._replyButton,Object(a.a)(this,this.onReplyButtonClick,"onReplyButtonClick"),_.a.vK_Enter)),this._saveButton&&(F.registerHandler(m.a.click,this._saveButton,Object(a.a)(this,this.onSaveButtonClick,"onSaveButtonClick")),this._saveButtonKeyEventHandler=E.registerHandlerForAllKeyEvents(this._saveButton,Object(a.a)(this,this.onSaveButtonClick,"onSaveButtonClick"),_.a.vK_Enter)),this._deleteButton&&(F.registerHandler(m.a.click,this._deleteButton,Object(a.a)(this,this.onDeleteButtonClick,"onDeleteButtonClick")),this._deleteButtonKeyEventHandler=E.registerHandlerForAllKeyEvents(this._deleteButton,Object(a.a)(this,this.onDeleteButtonClick,"onDeleteButtonClick"),_.a.vK_Enter)),this._cancelCommentButton&&(F.registerHandler(m.a.click,this._cancelCommentButton,Object(a.a)(this,this.onCancelButtonClick,"onCancelButtonClick")),this._cancelButtonKeyEventHandler=E.registerHandlerForAllKeyEvents(this._cancelCommentButton,Object(a.a)(this,this.onCancelButtonClick,"onCancelButtonClick"),_.a.vK_Enter)),h){if(E.registerHandler(m.a.keyPress,h,Object(a.a)(this,this.onKeyEvent,"onKeyEvent")),E.registerHandler(m.a.keyUp,h,Object(a.a)(this,this.onKeyEvent,"onKeyEvent")),A.a.isIPad){var P=u.AFrameworkApplication.activeFrame.theCompositionEventManager;P.registerHandler(m.a.compositionStart,h,Object(a.a)(this,this.onCompositionEvent,"onCompositionEvent"),null),P.registerHandler(m.a.compositionEnd,h,Object(a.a)(this,this.onCompositionEvent,"onCompositionEvent"),null),P.registerHandler(m.a.compositionUpdate,h,Object(a.a)(this,this.onCompositionEvent,"onCompositionEvent"),null)}p.a.instance.registerHandler(m.a.paste,h,Object(a.a)(this,this.onPaste,"onPaste")),this.setupTextboxFocus()}},r.setSaveCommentButtonState=function(e){l.a.setButtonEnabledState(this._saveButton,e)},r.makeId=function(e){return e+"_"+this._comment.id},r.renderState=function(e,t,n,i,r,a){switch(this._comment.saveState){case 0:case 1:this.showStatusIcon(e,0);break;case 2:case 4:e.style.display="none";break;case 3:Sys.UI.DomElement.addCssClass(a,"SaveFailure"),Sys.UI.DomElement.addCssClass(a,"NoReply"),this.showStatusIcon(e,1);break;default:0}this._comment.done?(Sys.UI.DomElement.addCssClass(a,"CommentIsDone"),r.className=h.getImageClass("CheckboxChecked_16x16x32")):(Sys.UI.DomElement.removeCssClass(a,"CommentIsDone"),r.className=h.getImageClass("CheckboxUnchecked_16x16x32")),this._comment.isCommentBeingCreatedOrEdited?(Sys.UI.DomElement.addCssClass(a,"NewOrEditComment"),Sys.UI.DomElement.addCssClass(a,"SelectedComment"),e.style.display="none",t.style.display="none",n.style.display="inline",this._comment.commentManager.mode||(this.setSaveCommentButtonState(!1),l.a.setButtonEnabledState(this._cancelCommentButton,!1))):1===this._comment.selectionState?(Sys.UI.DomElement.addCssClass(a,"SelectedComment"),Sys.UI.DomElement.removeCssClass(a,"SelectedParentComment"),1!==this._comment.commentManager.mode||3===this._comment.saveState||this._comment.isLocked?t.style.display="none":t.style.display="inline",n.style.display="none"):2===this._comment.selectionState?(Sys.UI.DomElement.removeCssClass(a,"SelectedComment"),Sys.UI.DomElement.addCssClass(a,"SelectedParentComment"),t.style.display="inline",n.style.display="none"):(Sys.UI.DomElement.removeCssClass(a,"SelectedComment"),Sys.UI.DomElement.removeCssClass(a,"SelectedParentComment"),t.style.display="inline",n.style.display="none")},r.showStatusIcon=function(e,t){switch(b.a.clearElement(e),t){case 0:var n=document.createElement("img");n.alt=CommonUIStrings.l_CommentProgressTooltip,n.src=d.a.commonImage("progress16.gif"),e.appendChild(n);break;case 1:var i=h.createClusteredImage(16,16,"Risks_16x16x32","",!0,CommonUIStrings.l_CommentFailTooltip);e.appendChild(i);break;default:0}e.style.display="inline-block"},r.updateRenderedText=function(){b.a.clearElementHtml(this._content);var e=this._comment.text;1===e.length&&e[0]&&(e=e[0].split("\n"));for(var t,n=w(e);!(t=n()).done;){var i=t.value,r=s.a("p","","CommentContentPara");r.innerText=i||"\xa0",this._comment.commentManager.copyingEnabled||r.setAttribute("Unselectable","on"),this._content.appendChild(r)}},r.setupTextboxFocus=function(){var e=f.FocusManager.instance().getScope(o.a.commentPaneTextboxFocusId);e.parent=c.AFrame.commentPaneFocusId,g.a.instance.addFocusEvent(o.a.commentPaneTextboxFocusId,this._textEntryBox),e.bindAction(v.KeyInputManager.hashKey(_.a.VK_S,2),T.a.doNothing),e.bindAction(this._escapeKeyHash,T.a.commentCancelled),e.bindAction(v.KeyInputManager.hashKey(_.a.vK_UpArrow,0),T.a.doBrowserDefault),e.bindAction(v.KeyInputManager.hashKey(_.a.vK_DownArrow,0),T.a.doBrowserDefault),e.unBindAction(f.FocusManager.instance()._tabInput),e.unBindAction(f.FocusManager.instance()._tabShiftInput)},r.onContainerClick=function(e){return this._comment.isCommentBeingCreatedOrEdited&&e.innerEvent.target===this._textEntryBox||this._comment.onSelect(),!0},r.onContainerDoubleClick=function(e){return this._comment.onEdit(),!0},r.onContainerKeyPress=function(e){var t=!1;return e.innerEvent.keyCode===_.a.vK_Enter&&(this._comment.selectionState?this._comment.onEdit():this._comment.onSelect(),t=!0),t},r.onDeleteButtonClick=function(e){return this._deleteButton.disabled||this._comment.onDelete(),!0},r.onDoneButtonClick=function(e){return this._doneButton.disabled||this._comment.onToggleDone(),!0},r.onReplyButtonClick=function(e){return this._replyButton.disabled||this._comment.onReply(),!0},r.onSaveButtonClick=function(e){return this._saveButton.disabled||this._comment.onSave(this._textEntryBox.value),!0},r.onCancelButtonClick=function(e){return this._cancelCommentButton.disabled||this._comment.onCancel(),!0},r.onCancelDeleteKeyEvent=function(e){return(e.innerEvent.keyCode===_.a.vK_Enter||e.innerEvent.keyCode===_.a.vK_Space)&&(e.eventName===m.a.keyUp&&(e.sourceElement===this._deleteButton?this._comment.onDelete():e.sourceElement===this._cancelCommentButton&&this._comment.onCancel()),!0)},r.onKeyEvent=function(e){if(e.innerEvent.ctrlKey&&e.innerEvent.keyCode===_.a.vK_Enter)return this._textEntryBox.value.length>0&&this.onSaveButtonClick(null),!0;if(e.innerEvent.keyCode===_.a.vK_Escape)return!0;var t=e.eventName===m.a.keyPress&&e.innerEvent.charCode===_.a.vK_Enter;return this.onTextEntered(t),!1},r.onCompositionEvent=function(e){return this.onTextEntered(!1),!1},r.onPaste=function(e){var t=this,n=new y.a(0,1,0,(function(e){t.onTextEntered(!1)}),1);return u.AFrameworkApplication.theTaskManager.addTask(n),!1},r.onTextEntered=function(e){if(this._comment.commentManager.mode&&(this.setSaveCommentButtonState(this._textEntryBox.value.length>0),!A.a.isInternetExplorer8)){if(this._textMeasurementContainer.clientWidth!==this._textEntryBox.clientWidth&&(this._textMeasurementContainer.style.width=this._textEntryBox.clientWidth+"px"),this._textMeasurementBox.value=this._textEntryBox.value+"___",this._previousTextLength>this._textEntryBox.value.length&&(this._textMeasurementBox.rows=1),A.a.isInternetExplorer8)this._textMeasurementBox.scrollHeight;for(var t=0,n=Number.MAX_VALUE;1<=(t=this._textMeasurementBox.scrollHeight-this._textMeasurementBox.clientHeight)&&t<n;)if(n=t,this._textMeasurementBox.rows++,A.a.isInternetExplorer8)this._textMeasurementBox.scrollHeight;this._textMeasurementBox.rows<this.minimumTextboxRows?this._textEntryBox.rows=this.minimumTextboxRows:(e&&this._textMeasurementBox.rows++,this._textEntryBox.rows=this._textMeasurementBox.rows),this._previousTextLength=this._textEntryBox.value.length}},e.dateToString=function(e,t,n){if(!e||isNaN(e.getDate()))return"";var i=n,r=new Date;return r.getFullYear()===e.getFullYear()&&r.getMonth()===e.getMonth()&&r.getDate()===e.getDate()||(i=String.format(CommonUIStrings.l_CommentLongDateFormat,t,n)),e.localeFormat(i)},t=e,(n=[{key:"containerElement",get:function(){return this._container}},{key:"deleteButtonElement",get:function(){return this._deleteButton}},{key:"saveButtonElement",get:function(){return this._saveButton}}])&&I(t.prototype,n),i&&I(t,i),e}();Object(i.a)(F,"CommentViewObject",null,[4,137]);var E=n(116);function P(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"Comment",(function(){return O}));var O=function(){function e(e,t,n,i,a,o,s,l,c,u,d,h){void 0===c&&(c=!1),void 0===u&&(u=null),void 0===d&&(d=null),void 0===h&&(h=null),this._anchorStartId=null,this._anchorEndId=null,this._selectedState=0,this._saveState=2,this._commentType=0,this._viewObject=null,this._draftConfiguration=null,this.isNewComment=!1,this.objectId=null,this.isLocked=!1,this._id=e,this._guardId=t,this._author=n,this._date=i,this._replyToId=a,this._done=o,this._paragraphs=s,this._groupNumber=l,this.contentCanBeLostOnEditing=c,this._authorId=u,this._authorIdProvider=d,this.usersByReactionType=h,this._commentManager=r.a.instance}var t,n,i,a=e.prototype;return a.dispose=function(){this._viewObject&&(this._viewObject.dispose(),this._viewObject=null)},a.render=function(){return this._viewObject=new F(this),this._viewObject.containerElement},a.modeChanged=function(){this._viewObject&&this._viewObject.updateRenderedState()},a.focus=function(){this.onSelect(),this._viewObject.focus(),this.isCommentBeingCreatedOrEdited&&this._viewObject.focusOnTextbox()},a.toString=function(){var e="[null]";return this._paragraphs&&this._paragraphs.length>0&&(e=this._paragraphs[0].length>30?this._paragraphs[0].substr(0,30)+"...":this._paragraphs[0]),String.format('I:{0} A:{1} T:{2} R:{3} D:{4} "{5}"',this._id||"[null]",this._author||"[null]",this._date?this._date.toString():"[null]",this._replyToId||"[null]",this._done,e)},a.onSelect=function(){2!==this.commentManager.mode&&3!==this.commentManager.mode?(f.FocusManager.instance().scopeChanged(c.AFrame.commentPaneFocusId),1!==this._selectedState&&this.commentManager.selectComment(this._id)):this.isCommentBeingCreatedOrEdited&&this._viewObject.focusOnTextbox()},a.onEdit=function(){this.commentManager.supportEdit&&!this._commentType&&(f.FocusManager.instance().scopeChanged(c.AFrame.commentPaneFocusId),this._commentType=2,this._saveState=0,this.commentManager.editComment(this,null))},a.onEditCancelled=function(){3===this.commentManager.mode&&(f.FocusManager.instance().scopeChanged(c.AFrame.commentPaneFocusId),this._commentType=0,this._saveState=2,this.commentManager.cancelEditingComment(this))},a.onDelete=function(){f.FocusManager.instance().scopeChanged(c.AFrame.commentPaneFocusId),this.commentManager.deleteComment(this)},a.onToggleDone=function(){this.commentManager.changeDoneStatus(this,!this._done)},a.onReply=function(){if(2!==this.commentManager.mode){0,f.FocusManager.instance().scopeChanged(c.AFrame.commentPaneFocusId);var e=this._replyToId||this._id;this.commentManager.addReply(e,null)}},a.onSave=function(e){f.FocusManager.instance().scopeChanged(c.AFrame.commentPaneFocusId),this._paragraphs=new Array(1),this._paragraphs[0]=e,1===this._commentType?this.commentManager.commitNewComment(this):this.commentManager.commitEditComment(this)},a.onCancel=function(){f.FocusManager.instance().scopeChanged(c.AFrame.commentPaneFocusId),this.commentManager.pane.paneSurface&&this.commentManager.pane.paneSurface.focus(),1===this._commentType?(this.commentManager.deleteComment(this),this.commentManager.selectAfterRemoval(this.replyToId)):this.onEditCancelled()},e.createCommentForEditing=function(t,n,i,r){var a=E.a.create().toString(),o=u.AFrameworkApplication.appSettingsManager.getStringAppSetting("PresenceUserId"),s=u.AFrameworkApplication.appSettingsManager.getStringAppSetting("PresenceProvider"),l=new e(a,e.guardIdInvalid,t,new Date,n,!1,new Array(0),i,!1,o,s);return l._commentType=1,l._saveState=0,l._draftConfiguration=r,l},t=e,(n=[{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"author",get:function(){return this.isScrubbed?CommonUIStrings.l_RemovedAuthorName:this._author}},{key:"authorId",get:function(){return this._authorId}},{key:"authorIdProvider",get:function(){return this._authorIdProvider}},{key:"date",get:function(){return this.isScrubbed?null:this._date},set:function(e){this._date=e}},{key:"done",get:function(){return this._done},set:function(e){this._done!==e&&(this._done=e,this._viewObject&&this._viewObject.updateRenderedState())}},{key:"groupNumber",get:function(){return this._groupNumber},set:function(e){this._groupNumber=e}},{key:"replyToId",get:function(){return this._replyToId},set:function(e){this._replyToId=e}},{key:"text",get:function(){return this._paragraphs},set:function(e){this._paragraphs=e,this._viewObject&&this._viewObject.updateRenderedText()}},{key:"guardId",get:function(){return this._guardId},set:function(e){this._guardId=e}},{key:"anchorStartId",get:function(){return this._anchorStartId},set:function(e){this._anchorStartId=e}},{key:"anchorEndId",get:function(){return this._anchorEndId},set:function(e){this._anchorEndId=e}},{key:"selectionState",get:function(){return this._selectedState},set:function(e){this._selectedState!==e&&(this._selectedState=e,this._viewObject&&this._viewObject.updateRenderedState())}},{key:"saveState",get:function(){return this._saveState},set:function(e){if(this._saveState!==e){if(!this._saveState&&2===e)return;if(3===this._saveState)return;this._saveState=e,this._viewObject&&this._viewObject.updateRenderedState()}}},{key:"commentType",get:function(){return this._commentType},set:function(e){if(this._commentType!==e){var t=this.isCommentBeingCreatedOrEdited&&!e;this._commentType=e,t&&this._viewObject&&this._viewObject.finishedCreatingOrEditingComment()}}},{key:"isCommentBeingCreatedOrEdited",get:function(){return 1===this._commentType||2===this._commentType}},{key:"isScrubbed",get:function(){return!!this._commentManager&&this._commentManager.removePersonalInformation}},{key:"containerElement",get:function(){return this._viewObject?this._viewObject.containerElement:null}},{key:"commentManager",get:function(){return this._commentManager}},{key:"commentViewObject",get:function(){return this._viewObject}},{key:"draftConfiguration",get:function(){return this._draftConfiguration},set:function(e){this._draftConfiguration=e}}])&&P(t.prototype,n),i&&P(t,i),e}();O.guardIdInvalid=null,O.pageNumberUnknown=-1,Object(i.a)(O,"Comment",null,[4,127])},565:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var i=n(0),r=n(32),a=n(571),o=n(33),s=n(1),l=n(68),c=n(81),u=n(309),d=n(311),h=n(236),p=n(310),g=n(87),m=n(59),f=n(37),_=n(7);function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var y=function(){function e(e){this._commentPane=null,this._commentModel=null,this._hintManager=null,this._currentMode=0,this._focusManager=null,this._eventHost=null,this._commentPendingDeleteConfirmation=null,this._sharedCommentsEnabled=!1,this._commentHighlightEnabled=!1,this._commentDoesNotExistNotificationId=null,this.copyingEnabled=!0,this._actionManager=e,this.registerActions()}var t,n,i,y=e.prototype;return y.dispose=function(){this._commentPane&&(this._commentPane.dispose(),this._commentPane=null),this._commentModel&&(this._commentModel.dispose(),this._commentModel=null),this._hintManager&&(this._hintManager.dispose(),this._hintManager=null),this.endCommentingSession()},y.selectComment=function(e,t){void 0===t&&(t=1);var n=this._commentModel.getComment(e);n&&(2===this.mode&&1!==n.commentType||(this._commentModel.selectComment(n),this._hintManager.highlightComment(n,!0),this._commentPane.selectComment(n,t),1===t&&this.sharedCommentsEnabled&&this._eventHost.selectComment(e)))},y.selectNextComment=function(){var e=this._commentModel.selectNextComment();e&&(this._hintManager.highlightComment(e,!0),this._commentPane.selectComment(e),this.sharedCommentsEnabled&&this._eventHost.selectComment(e.id))},y.selectPrevComment=function(){var e=this._commentModel.selectPrevComment();e&&(this._hintManager.highlightComment(e,!0),this._commentPane.selectComment(e),this.sharedCommentsEnabled&&this._eventHost.selectComment(e.id))},y.selectAfterRemoval=function(e){e?this.selectComment(e,0):this._commentPane.newCommentButton&&this.getCommentPaneFocusRegion().listing.trySetCurrentElement(this._commentPane.newCommentButton)},y.clearSelection=function(){this._commentModel.clearSelection(),this.sharedCommentsEnabled&&this._eventHost.selectComment(null),this._hintManager.clearHighlighting()},y.paneClosing=function(){if(!this.discreteHostedCommentsEnabled)if(2===this._currentMode){this.clearSelection();var e=this._commentModel.inProgressComment;0,this.deleteComment(e)}else this.clearSelection()},y.addNewComment=function(e){var t;if(1===this.mode){var n,i=a.a.createNewComment(e),r=(t=this._hintManager.createAnchorForSelectedParagraphs(i,n),n=t.anchor,t).returnValue;if(!n||r){var o;switch(r){case 1:o=CommonUIStrings.l_NewCommentError;break;case 2:o=CommonUIStrings.l_NewCommentInvalidContent;break;case 0:default:0,o=CommonUIStrings.l_NewCommentError}var s=new m.StandardDialog;return s.buttonsOption=0,void s.showInformation(CommonUIStrings.l_DefaultDialogTitle,o,null)}this.addComment(i,n)}},y.addComment=function(e,t){this.mode&&(this._commentModel.addCommentToModel(e,t),this._commentPane.renderNewComment(e),e.commentType&&this.selectComment(e.id),this._actionManager.processAction(_.a.commentNewCreated,2))},y.editComment=function(e,t){1===this.mode&&e&&(this._commentModel.editCommentInModel(e,t),this._commentPane.renderEditingComment(e),this.selectComment(e.id))},y.cancelEditingComment=function(e){this._commentModel.cancelEditingCommentInModel(e),this._commentPane.renderEditingComment(e)},y.addReply=function(e,t){if(1===this.mode){var n=this._commentModel.createAndAddReplyToModel(e,t);this._hintManager.createAnchorForReply(n),this._commentPane.renderNewComment(n),this.selectComment(n.id,0),this._actionManager.processAction(_.a.commentReply,2)}},y.onHighlightChange=function(e,t){},y.deleteComment=function(e){if(1!==this.mode){if(2!==this.mode)return void 0;if(1!==e.commentType)return void 0;this.mode=1}if(this.showConfirmDeleteDialog&&1!==e.commentType){this._commentPendingDeleteConfirmation=e;var t=new m.StandardDialog;return t.buttonsOption=4,t.setDefaultButton(2),void t.showQuestion(CommonUIStrings.l_DefaultDialogTitle,this.deleteCommentConfirmMessage,Object(r.a)(this,this.deleteDialogHandler,"deleteDialogHandler"))}this.deleteCommentConfirmed(e)},y.registerActions=function(){var e=this;this._actionManager.addActionWithFlags(_.a.commentBeginRefresh,f.a.frame,l.ActionManager.doNothingButReportHandler,64),this._actionManager.addActionWithFlags(_.a.commentBeginRefreshRefused,f.a.frame,l.ActionManager.doNothingButReportHandler,64),this._actionManager.addActionWithFlags(_.a.commentBeginSucceeded,f.a.frame,l.ActionManager.doNothingButReportHandler,64),this._actionManager.addAction(_.a.commentCancelled,f.a.frame,l.ActionManager.doNothingButReportHandler),this._actionManager.addAction(_.a.commentDelete,f.a.frame,l.ActionManager.doNothingButReportHandler),this._actionManager.addAction(_.a.commentDone,f.a.frame,l.ActionManager.doNothingButReportHandler),this._actionManager.addActionWithFlags(_.a.commentDownloadFailed,f.a.frame,l.ActionManager.doNothingButReportHandler,64),this._actionManager.addActionWithFlags(_.a.commentDownloadSucceeded,f.a.frame,l.ActionManager.doNothingButReportHandler,64),this._actionManager.addAction(_.a.commentNewCreated,f.a.frame,l.ActionManager.doNothingButReportHandler),this._actionManager.addAction(_.a.commentNewSaved,f.a.frame,l.ActionManager.doNothingButReportHandler),this._actionManager.addAction(_.a.commentReply,f.a.frame,l.ActionManager.doNothingButReportHandler),this._actionManager.addActionWithFlags(_.a.commentSaveNetworkError,f.a.frame,l.ActionManager.doNothingButReportHandler,64),this._actionManager.addActionWithFlags(_.a.commentSaveSucceeded,f.a.frame,l.ActionManager.doNothingButReportHandler,64),this._actionManager.addActionWithFlags(_.a.commentSaveRetry,f.a.frame,l.ActionManager.doNothingButReportHandler,64),this._actionManager.addAction(_.a.commentUndone,f.a.frame,l.ActionManager.doNothingButReportHandler),this._actionManager.addAction(_.a.notifyCommentDoesNotExist,f.a.frame,(function(t,n,i,r,a){return e.notifyCommentDoesNotExist(),32}))},y.deleteDialogHandler=function(e,t){1===e?this.deleteCommentConfirmed(this._commentPendingDeleteConfirmation):(this._commentPendingDeleteConfirmation&&this.selectComment(this._commentPendingDeleteConfirmation.id),this._commentPendingDeleteConfirmation=null)},y.deleteCommentConfirmed=function(e){var t=e.replyToId;1===e.commentType?this._actionManager.processAction(_.a.commentCancelled,2):this._actionManager.processAction(_.a.commentDelete,2),this._commentPendingDeleteConfirmation=null,this.sharedCommentsEnabled||this.clearSelection();var n=this._commentModel.deleteComment(e);this._commentPane.removeCommentsFromPane(n),this._hintManager.commentsDeleted(n);for(var i=0;i<n.length;i++)n[i].dispose();this.selectAfterRemoval(t)},y.changeDoneStatus=function(e,t){this.mode&&(this._actionManager.processAction(t?_.a.commentDone:_.a.commentUndone,2),this._commentModel.changeDoneStatus(e,t))},y.commitNewComment=function(e){this._commentModel.commitNewComment(e),this.mode=1,this._actionManager.processAction(_.a.commentNewSaved,2)},y.commitEditComment=function(e){this._commentModel.commitEditComment(e),this.mode=1},y.commitTaskChanges=function(e,t){this._commentModel.recordTaskChanges(e,t)},y.initiateCommentingSession=function(){},y.endCommentingSession=function(){},y.selectCommentByNavigationId=function(e,t){},y.showCommentPane=function(e,t,n,i,r){return this._commentPane.showCommentPane(e,t,n,i,r)},y.toggleCommentPane=function(e,t,n,i,r){return this._commentPane.toggleCommentPane(e,t,n,i,r)},y.getCommentPaneFocusRegion=function(){var e=this,t=this._focusManager.getRegion(o.AFrame.commentPaneFocusId);if(!t){var n=this._focusManager.getScope(o.AFrame.commentPaneFocusId),i=new c.DOMFocusListing((function(){return e.pane.paneSurface}));i.rememberFirstElement=!0,i.addValidTag(3),i.addValidTag(2),i.addValidTag(4),i.addValidTag(1),i.addValidTag(6),i.addValidTag(5),this._focusManager.buildRegionWithDelegate((function(){return e.pane.paneSurface}),n,i),(t=this._focusManager.getRegion(o.AFrame.commentPaneFocusId)).rememberFocusStealers(),t.looped=!0,t.contained=!0,n.unBindAction(this._focusManager._tabInput),n.unBindAction(this._focusManager._tabShiftInput)}return t},y.addCommentReaction=function(e,t){this.mode&&this._commentModel.addCommentReaction(e,t)},y.removeCommentReaction=function(e,t){this.mode&&this._commentModel.removeCommentReaction(e,t)},y.notifyCommentDoesNotExist=function(){var e=this;g.UISurfaces.getNotificationsAPIAsync().then((function(t){var n=Object.assign(new u.a,{target:'[data-unique-id~="ShowCommentsTopBar"]',showCloseIcon:!0,content:CommonUIStrings.l_DeepLinkedCommentDoesNotExistNotification,calloutProps:Object.assign(new p.a,{directionalHint:6,gapSpace:4,isBeakVisible:!1})}),i=t.callout(n),a=Object.assign(new h.a,{expirationOptions:Object.assign(new d.a,{displayTimeoutSeconds:10,onExpire:Object(r.a)(e,e.dismiss,"dismiss")})});e._commentDoesNotExistNotificationId=t.addNotification(i,a)}))},y.dismiss=function(){var e=this;g.UISurfaces.getNotificationsAPIAsync().then((function(t){return t.removeNotification(e._commentDoesNotExistNotificationId),e._commentDoesNotExistNotificationId=null,null}))},t=e,i=[{key:"instance",get:function(){return e._instance||(e.factory?e._instance=e.factory():null)},set:function(t){e._instance=t}}],(n=[{key:"pane",get:function(){return this._commentPane}},{key:"model",get:function(){return this._commentModel}},{key:"hintManager",get:function(){return this._hintManager}},{key:"dateFormat",get:function(){return s.AFrameworkApplication.shortDateFormat}},{key:"timeFormat",get:function(){return s.AFrameworkApplication.shortTimeFormat}},{key:"deleteCommentConfirmMessage",get:function(){return CommonUIStrings.l_DeleteCommentConfirm}},{key:"supportEdit",get:function(){return!1}},{key:"discreteHostedCommentsEnabled",get:function(){return!1}},{key:"eventHost",get:function(){return this._eventHost},set:function(e){this._eventHost=e}},{key:"mode",get:function(){return this._currentMode},set:function(e){if(e!==this._currentMode){if(this._currentMode=e,-1===this._currentMode)return;this._commentPane.modeChanged(),this._commentModel.modeChanged(),this._currentMode||this.endCommentingSession()}}},{key:"sharedCommentsEnabled",get:function(){return this._sharedCommentsEnabled},set:function(e){this._sharedCommentsEnabled=e}},{key:"commentHighlightEnabled",get:function(){return this._commentHighlightEnabled},set:function(e){this._commentHighlightEnabled=e}},{key:"removePersonalInformation",get:function(){return!1}},{key:"showConfirmDeleteDialog",get:function(){return!0}}])&&v(t.prototype,n),i&&v(t,i),e}();y._instance=null,y.factory=null,Object(i.a)(y,"CommentManager",null,[18,19,4])},566:function(e,t,n){"use strict";var i=n(0),r=n(32),a=n(1),o=n(15),s=n(9),l=n(2);function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var u=function(){function e(e,t){this._dialogHandler=e,this._clipboardAccessExtensionLink=t}var t,n,i,r=e.prototype;return r.extensionLinkHandler=function(e){l.ULS.sendTraceTag(8716421,307,50,null),o.a.safelyOpenWindow(this.clipboardAccessExtensionLink,"_blank",void 0,"ClipboardAccessExtensionLink")},r.resolveCopyPasteShortcut=function(e,t){var n=s.a.isMac;return a.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CcpFixIPadShortcutStringsIsEnabled")&&(n=s.a.isIPad||n),n?String.format(t,"\u2318"):e},r.dispose=function(){this._dialogHandler=null},r.reactCopyPasteShortcutDialogHandler=function(e,t){this.copyPasteShortcutDialogHandler(e)},r.legacyCopyPasteShortcutDialogHandler=function(e,t){this.copyPasteShortcutDialogHandler(e)},r.copyPasteShortcutDialogHandler=function(e){this._dialogHandler&&this._dialogHandler(e)},t=e,(n=[{key:"titleText",get:function(){return CommonUIStrings.l_ClipboardUseShortcutTitle}},{key:"forwardElementText",get:function(){return CommonUIStrings.l_ClipboardUseShortcutMessage}},{key:"cutText",get:function(){return CommonUIStrings.l_ClipboardCut}},{key:"macCutText",get:function(){return CommonUIStrings.l_ClipboardCut_Mac}},{key:"copyText",get:function(){return CommonUIStrings.l_ClipboardCopy}},{key:"macCopyText",get:function(){return CommonUIStrings.l_ClipboardCopy_Mac}},{key:"pasteText",get:function(){return CommonUIStrings.l_ClipboardPaste}},{key:"macPasteText",get:function(){return CommonUIStrings.l_ClipboardPaste_Mac}},{key:"pasteTextOnly",get:function(){return CommonUIStrings.l_ClipboardPasteText}},{key:"macPasteTextOnly",get:function(){return CommonUIStrings.l_ClipboardPasteText_Mac}},{key:"clipboardAccessExtensionLink",get:function(){return this._clipboardAccessExtensionLink}},{key:"clipboardExtensionLinkText",get:function(){return CommonUIStrings.l_ClipboardExtensionLink}},{key:"clipboardExtensionSuggestionText",get:function(){return CommonUIStrings.l_ClipboardExtensionSuggestion}}])&&c(t.prototype,n),i&&c(t,i),e}();u.id="CopyPasteShortcutDialog",u.textElementId="CopyPasteText",Object(i.a)(u,"ACopyPasteShortcutDialog",null,[4]);var d=n(16),h=n(59);function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){var t,n;function i(t,n,i){var a;a=e.call(this,t,n)||this;var o=document.createElement("span");o.className="WACCopyPasteShortcutDialogTextPanel";var c=document.createElement("span");c.id=u.textElementId;var g=document.createElement("span");g.innerText=a.forwardElementText;var m=document.createElement("span");m.className="UIFontBold",m.innerText=a.resolveCopyPasteShortcut(a.cutText,a.macCutText);var f=document.createElement("span");f.className="UIFontBold",f.innerText=a.resolveCopyPasteShortcut(a.copyText,a.macCopyText);var _=document.createElement("span");if(_.className="UIFontBold",_.innerText=a.resolveCopyPasteShortcut(a.pasteText,a.macPasteText),c.appendChild(g),c.appendChild(document.createElement("br")),c.appendChild(m),c.appendChild(f),c.appendChild(_),i.getBooleanAppSetting("PasteTextOnlyShortcutDialogIsEnabled")&&(s.a.isChrome||s.a.isFirefox)){var v=document.createElement("span");v.className="UIFontBold",v.innerText=a.resolveCopyPasteShortcut(a.pasteTextOnly,a.macPasteTextOnly),c.appendChild(v)}if(o.appendChild(c),a.clipboardAccessExtensionLink){l.ULS.sendTraceTag(8716420,307,50,null);var y=document.createElement("span"),S=document.createElement("a");S.href="#",S.innerText=a.clipboardExtensionLinkText,d.a.addHandler(S,"click",Object(r.a)(p(a),a.extensionLinkHandler,"extensionLinkHandler")),y.appendChild(S);var b=a.clipboardExtensionSuggestionText.indexOf("{0}");if(-1!==b){var C=a.clipboardExtensionSuggestionText.substring(0,b),A=a.clipboardExtensionSuggestionText.substring(b+3,a.clipboardExtensionSuggestionText.length),T=document.createTextNode(C),w=document.createTextNode(A);y.insertBefore(T,S),y.appendChild(w)}o.appendChild(document.createElement("br")),o.appendChild(y)}else l.ULS.sendTraceTag(8716422,307,50,null);var k=new h.StandardDialog;return k.buttonsOption=0,k.dialogId=u.id,k.messageBox(a.titleText,null,0,Object(r.a)(p(a),a.legacyCopyPasteShortcutDialogHandler,"legacyCopyPasteShortcutDialogHandler"),o),k.setDescribedByForDialog(u.textElementId),a}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,g(t,n),i}(u);Object(i.a)(m,"CopyPasteShortcutDialog",u,[]);var f=n(77);function _(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(e){var t,n,i,a,o;function s(t,n){var i,a,o,s={};o=(a=e.call(this,t,n)||this).installTitleText,s.extensionStartText=a.extensionStartText,s.extensionLink=null,s.extensionEndText=null,s.shortcutsMessageText=a.shortcutsMessageText,s.cutText=a.resolveCopyPasteShortcut(a.cutText,a.macCutText),s.copyText=a.resolveCopyPasteShortcut(a.copyText,a.macCopyText),s.pasteText=a.resolveCopyPasteShortcut(a.pasteText,a.macPasteText),s.pasteTextOnly=a.resolveCopyPasteShortcut(a.pasteTextOnly,a.macPasteTextOnly);var l=((i={}).id="CopyPasteInstallDialog",i.bodyControls=s,i),c=new f.a(!1,!1,!0);return c.dialogId="CopyPasteInstallDialog",c.buttonsOption=0,c.setButtonText(1,a.installText),c.setDefaultButton(1),c.initializeAndShow(o,Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(a),a.reactCopyPasteShortcutDialogHandler,"reactCopyPasteShortcutDialogHandler"),l),a}return n=e,(t=s).prototype=Object.create(n.prototype),t.prototype.constructor=t,v(t,n),s.shouldUseInstallDialog=function(e){return!!e&&new RegExp("^https:\\/\\/((.*?(word-edit|powerpoint|onenote|excel|visio)\\.(officeapps\\.live\\.com|partner\\.officewebapps\\.cn|gov\\.online\\.office365\\.us|dod\\.online\\.office365\\.us))|(project\\.microsoft\\.com))$","g").test(e)},i=s,(a=[{key:"shortcutsMessageText",get:function(){return CommonUIStrings.l_ClipboardInstallDialogShortcutsMessage}},{key:"installText",get:function(){return CommonUIStrings.l_ClipboardInstallDialogInstallButton}},{key:"installTitleText",get:function(){return CommonUIStrings.l_ClipboardInstallDialogTitle}},{key:"extensionStartText",get:function(){return CommonUIStrings.l_ClipboardInstallDialogExtensionMessage}}])&&_(i.prototype,a),o&&_(i,o),s}(u);function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(y,"ReactCopyPasteInstallDialog",u,[]);var b=function(e){var t,n;function i(t,n,i){var a,o;o=e.call(this,t,n)||this;var c={};if(c.forwardElementText=o.forwardElementText,c.cutText=o.resolveCopyPasteShortcut(o.cutText,o.macCutText),c.copyText=o.resolveCopyPasteShortcut(o.copyText,o.macCopyText),c.pasteText=o.resolveCopyPasteShortcut(o.pasteText,o.macPasteText),i.getBooleanAppSetting("PasteTextOnlyShortcutDialogIsEnabled")&&(s.a.isChrome||s.a.isFirefox)&&(c.pasteTextOnly=o.resolveCopyPasteShortcut(o.pasteTextOnly,o.macPasteTextOnly)),o.clipboardAccessExtensionLink){var d;l.ULS.sendTraceTag(40726914,307,50,null);c.extensionLink=((d={}).type="AppLinkProps",d.id="extensionLink",d.text=o.clipboardExtensionLinkText,d.handler=function(e){o.extensionLinkHandler(e)},d);var h=o.clipboardExtensionSuggestionText.indexOf("{0}");-1!==h&&(c.suggestionPrefixElement=o.clipboardExtensionSuggestionText.substring(0,h),c.suggestionSuffixElement=o.clipboardExtensionSuggestionText.substring(h+3,o.clipboardExtensionSuggestionText.length))}else l.ULS.sendTraceTag(40726915,307,50,null);var p=((a={}).id=u.id,a.bodyControls=c,a),g=new f.a(!1,!1,!0);return g.buttonsOption=0,g.dialogId=u.id,g.initializeAndShow(o.titleText,Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o),o.reactCopyPasteShortcutDialogHandler,"reactCopyPasteShortcutDialogHandler"),p),o}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,S(t,n),i}(u);function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(b,"ReactCopyPasteShortcutDialog",u,[]);var A=function(){function e(){this._isReactDialogEnabled=!!a.AFrameworkApplication.activeFrame&&a.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled}var t,n,i;return e.prototype.createCopyPasteShortcutDialog=function(e,t,n){return void 0===n&&(n=!1),l.ULS.sendTraceTag(594882645,307,50,String.format("_isReactDialogEnabled={0}, useInstallDialog={1}",this._isReactDialogEnabled,n)),this._isReactDialogEnabled?n?new y(e,t):new b(e,t,a.AFrameworkApplication.appSettingsManager):new m(e,t,a.AFrameworkApplication.appSettingsManager)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(n=null)&&C(t.prototype,n),i&&C(t,i),e}();A._instance=null,Object(i.a)(A,"CopyPasteShortcutDialogFactory",null,[335]);var T=n(33),w=n(3),k=n(23),I=n(24),F=n(18),E=n(43),P=n(20),O=n(11),R=n(19),M=n(14),D=n(36),x=n(402),L=n(160),B=n(562),U=n(68),H=function(e,t){this.cp=e,this.wordBreakType=t};Object(i.a)(H,"WordBreak",null,[]);var N=n(312),W=function(){this.wordCount=0,this.browserWordBreakCount=0};function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(W,"WordCountFromWordBreaksResult",null,[]);var V=function(){function e(){e._punctuationCheck=null}var t,n,i,r=e.prototype;return r.getForwardBreakByWord=function(e,t,n){void 0===n&&(n=!1);var i=this.getForwardBreak(e,t,n);return i&&(i.wordBreakType||(i=this.getForwardBreak(e,i.cp,n)))?i.cp:e.length},r.getBackwardBreakByWord=function(e,t,n){void 0===n&&(n=!1);var i=this.getBackwardBreak(e,t,n);return i&&(i.wordBreakType||(i=this.getBackwardBreak(e,i.cp,n)))?i.cp:0},r.getForwardBreak=function(e,t,n){return void 0===n&&(n=!1),this.getForwardBreakInternal(e,t,e.length,n)},r.getBackwardBreak=function(e,t,n){return void 0===n&&(n=!1),this.getBackwardBreakInternal(e,t,n)},r.getTextStartWordBreak=function(e){return this.getTextWordBreak(e,0)},r.getTextWordBreak=function(e,t){return new H(t,this.getWordBreakType(e,t))},r.getBreaks=function(e){var t=this.getBreaksForRange(e,0,e.length);return e.length&&Array.insert(t,0,this.getTextStartWordBreak(e)),t},r.getBreaksForRange=function(e,t,n){var i=[];if(""===e)return i;for(var r=t,a=!1;!a;){var o=this.getForwardBreakInternal(e,r,n);if(o)if(4===o.wordBreakType)if((r=o.cp+1)>=n)a=!0;else{var s=this.getWordBreakType(e,o.cp),l=this.getWordBreakType(e,r);s!==l&&Array.add(i,new H(r,l))}else Array.add(i,o),r=o.cp;else a=!0}return i},r.getWordCount=function(e,t){return this.getWordCountFromWordBreaks(e,t).wordCount},r.getWordCountInRange=function(e,t,n){var i=this.getBreaksForRange(e,t,n);return Array.insert(i,0,this.getTextWordBreak(e,t)),this.getWordCount(i,e)},r.getWordCountFromWordBreaks=function(e,t){for(var n=new W,i=0;i<e.length;i++){var r=e[i];3===r.wordBreakType||2===r.wordBreakType?(2===r.wordBreakType&&n.browserWordBreakCount++,this.shouldCountAlphaBreak(i,e,t)&&n.wordCount++):1!==r.wordBreakType&&5!==r.wordBreakType||this.shouldCountPuncuationBreak(i,e,t)&&n.wordCount++}return n},r.shouldCountAlphaBreak=function(e,t,n){if(!e)return!0;var i=t[e];if(!i.cp)return!0;var r=t[e-1];if(O.a.isEastAsianCharExtended(n.charCodeAt(i.cp))||O.a.isEastAsianCharExtended(n.charCodeAt(r.cp)))return!0;var a=!0;if(1===r.wordBreakType)for(var o=!1,s=r.cp;s<i.cp;s++){var l=n.charAt(s);if("-"===l){if(o)return!0;o=!0}else o=!1;if(a=this.doesPunctuationIndiciateNewWord(l))return!0}else if(2===r.wordBreakType)return!1;return(2!==i.wordBreakType||!r.wordBreakType)&&a},r.shouldCountPuncuationBreak=function(e,t,n){var i=t[e];if(this.doesPunctuationIndiciateNewWord(n.charAt(i.cp)))return!1;if(!e)return!0;if(!i.cp)return!1;var r=t[e-1];return!!O.a.isEastAsianCharExtended(n.charCodeAt(r.cp))||(!r.wordBreakType||6===r.wordBreakType)},r.doesPunctuationIndiciateNewWord=function(e){return"\u2013"===e||"\u2014"===e},r.getForwardBreakInternal=function(t,n,i,r){if(void 0===r&&(r=!1),n>=i-1)return null;for(var a=n;a<i;){var o=this.getWordBreakType(t,a);switch(o){case 2:var s=this.getBrowserNextWordBreak(t,n,!0);return s?s.cp>=i?null:s:null;case 3:case 1:case 0:case 5:case 6:if(a>=i-1)return null;var l=a+1,c=this.getWordBreakType(t,l);if(o!==c&&this.shouldCreateBreakOnNextWordBreak(o,c,r)&&(2!==c||!e.supportsBrowserWordBreaking))return new H(l,c);break;default:0}a+=1}return null},r.getBackwardBreakInternal=function(t,n,i){if(void 0===i&&(i=!1),1>=n)return null;for(var r=n;0<r;){var a=this.getWordBreakType(t,r-1);switch(a){case 2:var o=this.getBrowserNextWordBreak(t,n,!1);return o||null;case 3:case 1:case 0:case 5:case 6:if(1>=r)return null;var s=r-1,l=this.getWordBreakType(t,s-1);if(a!==l&&this.shouldCreateBreakOnNextWordBreak(a,l,i)&&(2!==l||!e.supportsBrowserWordBreaking))return new H(s,a);break;default:0}r-=1}return null},r.shouldCreateBreakOnNextWordBreak=function(e,t,n){return void 0===n&&(n=!1),n?!(3===e&&1===t||1===e&&3===t):5===e&&3!==t||3===e&&5!==t||(1===e||6===e)||!e},r.ensureBrowserWordBreakSurface=function(){e._browserWordBreakingSurface||(e._browserWordBreakingSurface=N.a.getScratchPad("WordBreakUtils"),e._browserWordBreakingSurface.className="WACWordBreakSurface")},r.updateCurrentText=function(t){e._currentText!==t&&(e._browserWordBreakingSurface.innerText=t,e._currentText=t)},r.setNoBrowserWordBreaker=function(){e._noBrowserWordBreakerCount++},r.removeNoBrowserWordBreaker=function(){e._noBrowserWordBreakerCount--},r.getBrowserNextWordBreak=function(t,n,i){this.ensureBrowserWordBreakSurface(),this.updateCurrentText(t);var r=-1;var a=!1;s.a.supportsTextRange?n!==(r=this.textRangeWordBreak(n,i))&&(a=!0):s.a.supportsWordBreakingRange&&n!==(r=this.rangeWordBreak(n,i))&&(a=!0),a||(r=this.noSupportWordBreak(n,i));var o=-1;return i?r>=e._currentText.length?r=-1:r===n?o=4:r<n&&(r=-1):(r<=0&&(r=-1),r>=n&&(r=-1)),-1===r?null:(-1===o&&(o=this.getWordBreakType(t,r)),new H(r,o))},r.textRangeWordBreak=function(t,n){a.AFrameworkApplication.theWsaClient.incrementDw(e.DATAID_WACWORDBREAKINGFROMBROWSER,1),e._textRangeObject||(e._textRangeObject=document.body.createTextRange()),e._textRangeObject.moveToElementText(e._browserWordBreakingSurface),e._textRangeObject.collapse(),e._textRangeObject.move("character",t),n?e._textRangeObject.moveEnd("word",1):e._textRangeObject.moveStart("word",-1);var i=e._textRangeObject.text.length,r=n?t+i:t-i;return(r<0||r>e._currentText.length)&&(r=t),r=this.correctBrowerWordBreak(t,r,n)},r.rangeWordBreak=function(t,n){a.AFrameworkApplication.theWsaClient.incrementDw(e.DATAID_WACWORDBREAKINGFROMBROWSER,1),N.a.beginScratchPadUse();var i=e._browserWordBreakingSurface.firstChild,r=e._browserWordBreakingSurface.ownerDocument.createRange();r.setStart(i,t),r.setEnd(i,t),r.expand("word");var o=n?r.endOffset:r.startOffset;return o===t&&!n&&t>0&&(r.setStart(i,t-1),r.setEnd(i,t-1),r.expand("word"),o=r.startOffset),o=this.correctBrowerWordBreak(t,o,n),N.a.endScratchPadUse(),o},r.correctBrowerWordBreak=function(e,t,n){return e===t?t:n?this.correctForwardHelper(e,t):this.correctBackwardHelper(e,t)},r.correctForwardHelper=function(t,n){for(var i=!1,r=t;r<n;r++){var o=this.getWordBreakType(e._currentText,r);if(i){if(1===o||!o)return a.AFrameworkApplication.theWsaClient.incrementDw(e.DATAID_WACWORDBREAKINGOVERRIDEBROWSER,1),r}else 2===o&&(i=!0)}return n},r.correctBackwardHelper=function(t,n){for(var i=!1,r=t-1;r>=n;r--){var o=this.getWordBreakType(e._currentText,r);if(i){if(1===o||!o)return a.AFrameworkApplication.theWsaClient.incrementDw(e.DATAID_WACWORDBREAKINGOVERRIDEBROWSER,1),r+1}else 2===o&&(i=!0)}return n},r.noSupportWordBreak=function(e,t){return t?this.noSupportWordBreakForward(e):this.noSupportWordBreakBackward(e)},r.noSupportWordBreakForward=function(t){for(var n=t;n<e._currentText.length&&2===this.getWordBreakType(e._currentText,n)&&!O.a.isEastAsianCharExtended(O.a.charCodeAt(e._currentText,n));)n++;return n===t&&(n++,this.isCpInMiddleOfSurrogatePair(n)&&n++),n},r.noSupportWordBreakBackward=function(t){for(var n=t;n>0&&2===this.getWordBreakType(e._currentText,n-1)&&!O.a.isEastAsianCharExtended(O.a.charCodeAt(e._currentText,n-1));)n--;return n===t&&(n--,this.isCpInMiddleOfSurrogatePair(n)&&n--),n},r.isCpInMiddleOfSurrogatePair=function(t){return O.a.isLowSurrogateCharAt(e._currentText,t-1)},r.getWordBreakType=function(e,t){var n=e.charAt(t).toString();return this.isAlphaNumeric(n)?3:this.isWhiteSpace(n)?0:this.isPunctuation(n)?1:this.isPunctuationWithoutBreak(n)?5:this.isFootnoteEndnotePunctuation(n)?6:2},r.isAlphaNumeric=function(e){return O.a.isAlphaNum(e.charAt(0))},r.isWhiteSpace=function(t){return e._whiteSpaceCheck||(e._whiteSpaceCheck=new RegExp("[\\u0000-\\u001F]|\\u0020|[\\u007F-\\u009F]|\\u00A0|[\\u2000-\\u200B]|\\u202F|\\u205F|\\u2420|[\\u2422-\\u2424]|\\u3000|\\uFF02")),e._whiteSpaceCheck.test(t)},r.isPunctuation=function(t){return e._punctuationCheck||(e._punctuationCheck=new RegExp("[!-&]|[\\(-\\.]|/|[:-@]|[\\[-`]|[{-~]|\xa1|\xa6|\xa7|\xa9|\xab|\xac|\xae|\xb0|\xb1|[\xb4-\xb7]|\xbb|\xbf|\xd7|\xf7|\u01c3|\u037e|[\u2012-\u2015]|[\u201a-\u2022]|[\u2024-\u2026]|\\u202F|\u2030|\u2039|\u203a|\u203c|\u203d|\u2048|\u2049|\\u2060|\u2103|\u2105|\u2106|\u2109|\u2116|\u2122|\u2211|\u2212|\u221a|\u221e|\u222b|\u2248|\u2260|\u2264|\u2265|\\u25A1|\\u25AA|\\u25AB|\u25ca|\u25cf|\u25e6|[\u2639-\u263b]|\u2762|\\uFEFF|\uff01|\uff0e|\uff1b|\uff1f|\uff61")),e._punctuationCheck.test(t)},r.isPunctuationWithoutBreak=function(e){return"'"===e||"\u2018"===e||"\u2019"===e},r.isFootnoteEndnotePunctuation=function(e){return"\ue000"===e},t=e,i=[{key:"supportsBrowserWordBreaking",get:function(){return s.a.supportsTextRange||s.a.supportsWordBreakingRange}},{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}],(n=null)&&j(t.prototype,n),i&&j(t,i),e}();V.DATAID_WACWORDBREAKINGOVERRIDEBROWSER=10265,V.DATAID_WACWORDBREAKINGFROMBROWSER=10266,V._whiteSpaceCheck=null,V._punctuationCheck=null,V._browserWordBreakingSurface=null,V._currentText="",V._textRangeObject=null,V._callback=null,V._noBrowserWordBreakerCount=0,V._instance=null,Object(i.a)(V,"WordBreakUtils",null,[193]);var q=n(563),G=n(568),K=n(27);function z(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return X(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function J(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Q=function(){function e(e,t,n,i){this._dpiAspectRatio=e,this._isRtl=t,this._xmlNodeWrapperFactory=n,this._wordBreakUtils=i}var t,n,i,r=e.prototype;return r.getRectanglePosition=function(t){return e.getRectanglePositionInternal(this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(t))},r.getSelectionBoundingBox=function(t,n,i,r,a,o,s){var c;if(!t||!n||!i)return e._loggedNullValueForBoundingBox||(l.ULS.sendTraceTag(20557894,301,50,"Can't get bounding box due to null value"),e._loggedNullValueForBoundingBox=!0),null;if(!t.firstChild||!t.firstChild.nodeValue)return this.getRectanglePosition(t);var u=n.characterPosition,d=i.characterPosition;return-1===u||-1===d?c=this.getRectanglePosition(t):n.id===i.id?(c=B.a.instance.computeBoundingBoxForTextRun(t,u,d),e.fixBoundingBoxDimensionsIfImagePresent(c,n.selectionPosition.x,i.selectionPosition.x,n.imagesInlineWithText),e.logBoxIfInvalid(c)):!a&&t.firstChild&&o?(c=B.a.instance.computeBoundingBoxForTextRun(t,u,t.firstChild.nodeValue.length),e.fixBoundingBoxDimensionsIfImagePresent(c,n.selectionPosition.x,Number.MAX_VALUE,n.imagesInlineWithText),e.logBoxIfInvalid(c)):a===r&&t.firstChild&&s?(c=B.a.instance.computeBoundingBoxForTextRun(t,0,d),e.fixBoundingBoxDimensionsIfImagePresent(c,0,i.selectionPosition.x,i.imagesInlineWithText),e.logBoxIfInvalid(c)):c=this.getRectanglePosition(t),c},r.getImagesInlineWithText=function(e,t){return this.getImagesInlineWithTextInternal(this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(e),this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(t))},r.getImagesInlineWithTextInternal=function(t,n){var i,r;if(!t||!n)return null;if(!(i=this.tryGetCharacterWidthArray(t,r),r=i.charWidths,i).returnValue)return null;for(var a,o=n.selectNodes("Image[@type='Figure']/boundingRect"),s=0,l=z(r);!(a=l()).done;){s+=a.value}s=Math.round(s*this._dpiAspectRatio());for(var c=e.getRectanglePositionInternal(t),u=[],d=0;d<o.length;d++){var h=o.get_item(d),p=e.getRectanglePositionInternal(h);this.areBoxesIntersecting(c,p)&&(Math.abs(c.width-s)>Math.abs(c.width-(s+p.width))&&(Array.add(u,h),s+=p.width))}return u},r.areBoxesIntersecting=function(e,t){return!(!e||!t)&&(!(e.left>t.left+t.width||t.left>e.left+e.width)&&!(e.top>t.top+t.height||t.top>e.top+e.height))},r.getCharacterPosition=function(e,t,n){var i=this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(t);return this.getCharacterPositionInternal(e,i,n)},r.getCharacterPositionInternal=function(t,n,i){var r,a;if(!(r=this.tryGetCharacterWidthArray(n,a),a=r.charWidths,r).returnValue)return-1;if(!n.attributes.getNamedItem("l"))return e._loggedMissingLeftOffset||(l.ULS.sendTraceTag(20557895,301,50,"CharSelection failed: missing left offset"),e._loggedMissingLeftOffset=!0),-1;var o=parseFloat(n.attributes.getNamedItem("l").nodeValue);if(isNaN(o))return e._loggedLeftOffsetNaN||(l.ULS.sendTraceTag(20557896,301,50,"CharSelection failed: left offset NaN"),e._loggedLeftOffsetNaN=!0),-1;if(t.x<o)return 0;var s,c=0,u=0,d=0;if(i&&i.length)for(s=0;s<i.length;s++){var h,p=i[s],g=void 0,m=void 0;(h=e.tryGetXCoordinatesForXmlNode(p,g,m),g=h.x1,m=h.x2,h).returnValue&&(m<t.x?u+=m-g:g<t.x&&t.x<=m&&(u+=t.x-g,d=1))}for(s=0;s<a.length;s++)if((c+=a[s])*this._dpiAspectRatio()+o+u>t.x)return s+d;return s},r.tryGetCharacterWidthArray=function(t,n){return null,this._isRtl?(e._loggedApplicationRtl||(l.ULS.sendTraceTag(20557900,301,50,"CharSelection failed: App RTL"),e._loggedApplicationRtl=!0),{returnValue:!1,charWidths:null}):t?t.attributes?t.attributes.getNamedItem("a")?(e._loggedAngle||(l.ULS.sendTraceTag(20557902,301,50,"CharSelection failed: angled text"),e._loggedAngle=!0),{returnValue:!1,charWidths:null}):t.attributes.getNamedItem("rtl")?(e._loggedTextRtl||(l.ULS.sendTraceTag(20557903,301,50,"CharSelection failed: text RTL"),e._loggedTextRtl=!0),{returnValue:!1,charWidths:null}):t.attributes.getNamedItem("gr")?(e._loggedRotated||(l.ULS.sendTraceTag(20557904,301,50,"CharSelection failed: rotated text"),e._loggedRotated=!0),{returnValue:!1,charWidths:null}):t.firstChild&&t.firstChild.nodeValue?this.tryParseWidths(t,null):(e._loggedNullValue||(l.ULS.sendTraceTag(20557897,301,50,"CharSelection failed: null node/FirstChild"),e._loggedNullValue=!0),{returnValue:!1,charWidths:null}):(e._loggedNullValue||(l.ULS.sendTraceTag(20557901,301,50,"CharSelection failed: null attributes"),e._loggedNullValue=!0),{returnValue:!1,charWidths:null}):{returnValue:!1,charWidths:null}},r.tryParseWidths=function(t,n){if(n=null,!t.attributes.getNamedItem("cw"))return e._loggedNullValue||(l.ULS.sendTraceTag(21002058,301,50,"CharSelection failed: null cw attribute"),e._loggedNullValue=!0),{returnValue:!1,charWidths:n};var i=t.attributes.getNamedItem("cw").nodeValue,r=(i=i.substring(1,i.length-1)).split(e.characterWidthDelimiter);if(r.length!==t.firstChild.nodeValue.length)return e._loggedCharWidthParseFailedWrongLength||(l.ULS.sendTraceTag(20557898,301,50,"CharSelection failed: char width array length [cwLength:{0}] [textLength:{1}]",r.length,t.firstChild.nodeValue.length),e._loggedCharWidthParseFailedWrongLength=!0),{returnValue:!1,charWidths:n};n=new Array(r.length);for(var a=0;a<r.length;a++){var o=parseFloat(r[a]);if(isNaN(o))return e._loggedCharWidthParseFailedInvalidWidths||(l.ULS.sendTraceTag(20557899,301,50,"CharSelection failed: char width NaN [width:{0}]",r[a]),e._loggedCharWidthParseFailedInvalidWidths=!0),{returnValue:!1,charWidths:n};n[a]=o}return{returnValue:!0,charWidths:n}},r.tryGetWordStart=function(e,t,n,i){var r,a;n=null;var o=(r=this.tryGetWordStartInternal(this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(e),t,a,i),a=r.startNode,i=r.startPosition,r).returnValue;return a&&(n=a.backingNode),{returnValue:o,startNode:n,startPosition:i}},r.tryGetWordStartInternal=function(e,t,n,i){var r,a;if(i=-1,n=null,!(r=this.tryGetCharacterWidthArray(e,a),a=r.charWidths,r).returnValue)return{returnValue:!1,startNode:n,startPosition:i};var o=e.firstChild.nodeValue,s=this._wordBreakUtils.getBackwardBreak(o,t);n=e;for(var c=0;!s&&c<1e6;){var u,d=n.previousSibling;if((u=this.tryGetCharacterWidthArray(d,a),a=u.charWidths,u).returnValue){var h=d.firstChild.nodeValue;(s=this._wordBreakUtils.getBackwardBreak(h,h.length))?s=new H(0,-1):n=d}else s=new H(0,-1);c++}return s&&n?{returnValue:!0,startPosition:i=s.cp,startNode:n}:(l.ULS.sendTraceTag(20820181,301,15,"TryGetWordEnd returning unexpected output [InfiniteLoop:{0}]",!s),{returnValue:!1,startNode:n,startPosition:i})},r.tryGetWordEnd=function(e,t,n,i){var r,a;n=null;var o=(r=this.tryGetWordEndInternal(this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(e),t,a,i),a=r.endNode,i=r.endPosition,r).returnValue;return a&&(n=a.backingNode),{returnValue:o,endNode:n,endPosition:i}},r.tryGetWordEndInternal=function(e,t,n,i){var r,a;if(n=null,i=-1,!(r=this.tryGetCharacterWidthArray(e,a),a=r.charWidths,r).returnValue)return{returnValue:!1,endNode:n,endPosition:i};var o=e.firstChild.nodeValue,s=this._wordBreakUtils.getForwardBreak(o,t);n=e;for(var c=0;!s&&c<1e6;){var u,d=n.nextSibling;(u=this.tryGetCharacterWidthArray(d,a),a=u.charWidths,u).returnValue?(n=d,s=this._wordBreakUtils.getForwardBreak(n.firstChild.nodeValue,0)):s=new H(n.firstChild.nodeValue.length,-1),c++}return s&&n?{returnValue:!0,endPosition:i=s.cp,endNode:n}:(l.ULS.sendTraceTag(20820182,301,15,"TryGetWordEnd returning unexpected output [InfiniteLoop:{0}]",!s),{returnValue:!1,endNode:n,endPosition:i})},e.getInstanceWithResolvedDependencies=function(){return new e((function(){return M.App.instance.theConfig.dpiAspectRatio}),a.AFrameworkApplication.isRtl,new q.a,V.instance)},e.buildXPathForPageSelection=function(e,t){var n;t.id<e.id&&(n=e,e=t,t=n);return String.format("descendant::P[@storyId='{0}']/T[@id>={1} and @id<={2}]",e.storyId,e.id,t.id)},e.buildXPathFromPosition=function(e,t,n,i){var r=String.format("/Pages/Page[@id='{0}']/descendant::P[@storyId='{1}']/T[@l<={2} and (@l + @w)>={2}",e,t,i.x);return r+=n?String.format(" and (@t + @h)>={0}]",i.y):String.format(" and @t<={0}]",i.y)},e.getRectanglePositionInternal=function(t){var n=Math.round(parseFloat(t.attributes.getNamedItem("l").nodeValue)),i=Math.round(parseFloat(t.attributes.getNamedItem("t").nodeValue)),r=Math.round(parseFloat(t.attributes.getNamedItem("w").nodeValue)),a=Math.round(parseFloat(t.attributes.getNamedItem("h").nodeValue)),o=new G.a(n,i,r,a);return e.logBoxIfInvalid(o),o},e.fixBoundingBoxDimensionsIfImagePresent=function(t,n,i,r){if(t&&r)for(var a=0;a<r.length;a++){var o,s=r[a],l=void 0,c=void 0;(o=e.tryGetXCoordinatesForXmlNode(s,l,c),l=o.x1,c=o.x2,o).returnValue&&(l+5>i||(c-5<n?t.left=t.left+(c-l):t.width=t.width+(c-l)))}},e.tryGetXCoordinatesForXmlNode=function(e,t,n){if(t=n=0,!e||!e.attributes)return{returnValue:!1,x1:t,x2:n};var i=e.attributes.getNamedItem("l"),r=e.attributes.getNamedItem("w");return i&&r?(n=(t=parseFloat(i.nodeValue))+parseFloat(r.nodeValue),isNaN(t)||isNaN(n)?{returnValue:!1,x1:t,x2:n}:{returnValue:!0,x1:t,x2:n}):{returnValue:!1,x1:t,x2:n}},e.logBoxIfInvalid=function(e){(e.left<=0&&e.top<=0&&e.width<=0&&e.height<=0||e.width<0||e.height<0)&&l.ULS.sendTraceTag(4792668,301,50,"It seems like the user is not going to see a selection. L={0} T={1} W={2} H={3}",e.left,e.top,e.width,e.height)},e.getXmlNodeAtPosition=function(e,t,n){if(!n)return null;var i=M.App.instance.theConfig.selectionTolerance,r=String.format("/Pages/Page[@id='{0}']/descendant::P/T[@l<={1} and (@l + @w)>={2} and @t<={3} and (@t + @h)>={4}]",t,e.x+i,e.x-i,e.y+i,e.y-i);return n.selectSingleNode(r)},e.getXmlLinkNodeAtPosition=function(e,t,n){if(!n)return null;var i=String.format("/Pages/Page[@id='{0}']/descendant::L[@l<={1} and (@l + @w)>={2} and @t<={3} and (@t + @h)>={4}]",t,e.x,e.x,e.y,e.y);return n.selectSingleNode(i)},e.nodeHasDimensions=function(e){return!!e&&!!parseInt(e.attributes.getNamedItem("w").nodeValue)&&!!parseInt(e.attributes.getNamedItem("h").nodeValue)},e.getCopyableHtmlElementsForRegion=function(t,n){for(var i=e.buildXPath(t,n),r=[],a=-1,o=t.page;o<=n.page;o++){var s=K.a.getPageSetXmlFromPage(o);if(s!==a){var l=M.App.get_activeAppFrame().thePageInfoCache.getCopyableHtmlElementsForQuery(i,o,t.characterPosition,n.characterPosition);l&&Array.addRange(r,l),a=s}}return r},e.buildXPath=function(e,t){var n;t.id<e.id&&(n=e,e=t,t=n);return String.format("/Pages/Page[@id>={0} and @id<={1}]/descendant::P[@storyId='{2}']/T[@id>={3} and @id<={4}]",e.page,t.page,e.storyId,e.id,t.id)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getInstanceWithResolvedDependencies())}}],(n=null)&&J(t.prototype,n),i&&J(t,i),e}();Q._loggedCharWidthParseFailedWrongLength=!1,Q._loggedCharWidthParseFailedInvalidWidths=!1,Q._loggedApplicationRtl=!1,Q._loggedNullValue=!1,Q._loggedAngle=!1,Q._loggedTextRtl=!1,Q._loggedRotated=!1,Q._loggedMissingLeftOffset=!1,Q._loggedLeftOffsetNaN=!1,Q._loggedNullValueForBoundingBox=!1,Q.characterWidthDelimiter=";,",Q._instance=null,Object(i.a)(Q,"SelectionUtils2",null,[]);var Z=n(17);function Y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var $=function(){function e(e){this._start=null,this._end=null,this._copyFrameLoaded=!1,this._setFocusExceptionLogged=!1,this._copyFrame=document.createElement("iFrame"),this._copyFrame.className="WACCopyFrame",this._copyFrame.title=WordViewerIntl.WordViewerStrings.l_NonUserFacingFrameTitle,k.FocusManager.instance().getScope(T.AFrame.documentFocusID).addOnFocus(Object(r.a)(this,this.documentScopeOnFocus,"documentScopeOnFocus")),d.a.addHandler(this._copyFrame,"load",Object(r.a)(this,this.onCopyFrameLoad,"onCopyFrameLoad")),e.appendChild(this._copyFrame),this._copyFrame.id="WACCopyFrame",a.AFrameworkApplication.theActionManager.addActionWithFlags(Z.a.buildClipboard,D.a.application,M.App.instance.copyingEnabled?Object(r.a)(this,this.buildClipboard,"buildClipboard"):U.ActionManager.doNothingHandler,96)}var t,n,i,o=e.prototype;return o.documentScopeOnFocus=function(e,t){this.setFocus()},o.initKeyInputManager=function(){this._copyFrame.contentWindow.document.body.id="WACCopyFrameBody",M.App.get_activeAppFrame().theKeyInputManager.initializeForElement(this._copyFrame.contentWindow.document.body),M.App.get_activeAppFrame().theContextMenuInputManager.registerHandler(this._copyFrame.contentWindow.document.body,Object(r.a)(this,this.contextMenuHandler,"contextMenuHandler")),M.App.get_activeAppFrame().theKeyInputManager.registerHandler(w.a.keyPress,this._copyFrame.contentWindow.document.body,Object(r.a)(M.App.get_activeAppFrame(),M.App.get_activeAppFrame().showViewerWarningBusinessBar,"showViewerWarningBusinessBar")),M.App.get_activeAppFrame().theCompositionEventManager.registerHandler(w.a.compositionStart,this._copyFrame.contentWindow.document.body,Object(r.a)(M.App.get_activeAppFrame(),M.App.get_activeAppFrame().showViewerWarningBusinessBar,"showViewerWarningBusinessBar"),null)},o.buildClipboard=function(e,t,n,i,r){var a=Q.getCopyableHtmlElementsForRegion(this._start,this._end);return this.placeCopyElementsInIFrame(a),32},o.contextMenuHandler=function(e){return x.a.showFromKey(e),!0},o.onCopyFrameLoad=function(e){this._copyFrame.contentWindow.document.title=String.format("{0} {1}",WordViewerIntl.WordViewerStrings.l_CopyIframeTitle,CommonUIStrings.l_AccHelpShortcutAnnouncement),this.initKeyInputManager(),this._copyFrameLoaded=!0},o.setContentEditable=function(e){this._copyFrame.contentWindow.document.body.setAttribute("contentEditable",e?"true":"false")},o.clearCopy=function(){var e=!1,t=Number.MAX_VALUE,n=Number.MIN_VALUE;this._start&&this._end&&(e=!0,t=this._start.page,n=this._end.page),this.clearCopyIframe(),this._start=null,this._end=null,e&&M.App.get_activeAppFrame().thePageInfoCache.removeFromCache(t,n)},o.updateCopy=function(e,t){if(M.App.instance.copyingEnabled&&e&&t){if(e.id>t.id){var n=e;e=t,t=n}this._start=e,this._end=t;for(var i=M.App.get_activeAppFrame().thePageInfoCache,r=!0,o=this._start.page;o<=this._end.page;o++)if(!i.getPage(o)){r=!1;break}r?a.AFrameworkApplication.theActionManager.processAction(Z.a.buildClipboard,2):M.App.get_activeAppFrame().thePageInfoCache.addToCache(this._start.page,this._end.page)}},o.clearCopyIframe=function(){this.forceCompatibility();var e=this._copyFrame.contentWindow.document.body;P.a.clearElementHtml(e),k.FocusManager.instance().setScope(T.AFrame.documentFocusID)},o.placeCopyElementsInIFrame=function(e){if(e.length,M.App.instance.copyingEnabled){0,this.forceCompatibility();var t=this._copyFrame.contentWindow.document.body;if(t){P.a.clearElementHtml(t);for(var n=0;n<e.length;n++)t.appendChild(e[n]);k.FocusManager.instance().setScope(T.AFrame.documentFocusID),e.length>0&&this.setFocus()}}},o.setFocus=function(){if(this._copyFrame.contentWindow){0;try{this._copyFrame.contentWindow.focus()}catch(e){l.ULS.sendTraceTag(4792863,301,10,"Cannot focus the copy frame's window. Exception: {0}. Copy frame load status = {1}.",e.message,this._copyFrameLoaded)}try{if(s.a.supportsDomL2Selection){var e=this._copyFrame.contentWindow.getSelection();e.removeAllRanges(),e.selectAllChildren(this._copyFrame.contentWindow.document.body)}else this._copyFrame.contentWindow.document.execCommand("SelectAll")}catch(e){this._setFocusExceptionLogged||(l.ULS.sendTraceTag(6362266,301,50,"Selection failed: Message: {0}, stacktrace: {1}, _setFocusExceptionLogged = {2}",e.message,e.stack,this._setFocusExceptionLogged),this._setFocusExceptionLogged=!0)}}else l.ULS.sendTraceTag(4792862,301,10,"Cannot focus the copy frame's window, because it's null. Copy frame load status = {0}.",this._copyFrameLoaded)},o.forceCompatibility=function(){if(s.a.isFirefox){var e=this._copyFrame.contentWindow;window.self.__loadCompat&&!e.attachEvent&&(__loadCompat(e),_loadMozillaCompat(e))}},o.dispose=function(){d.a.removeHandler(this._copyFrame,"load",Object(r.a)(this,this.onCopyFrameLoad,"onCopyFrameLoad")),this._start&&(this._start.dispose(),this._start=null),this._end&&(this._end.dispose(),this._end=null),this._copyFrame.contentWindow&&this._copyFrame.contentWindow.document&&this._copyFrame.contentWindow.document.body&&(this._copyFrameLoaded||l.ULS.sendTraceTag(4032355,301,50,"It seems like the OnLoad handler for _copyFrame has not been run - the event may have not been fired by the browser; Expected=WACCopyFrameBody Actual={0}",this._copyFrame.contentWindow.document.body.id||"null"),M.App.get_activeAppFrame().theKeyInputManager.unregisterHandler(w.a.keyPress,this._copyFrame.contentWindow.document.body,Object(r.a)(M.App.get_activeAppFrame(),M.App.get_activeAppFrame().showViewerWarningBusinessBar,"showViewerWarningBusinessBar")),M.App.get_activeAppFrame().theCompositionEventManager.unregisterHandler(w.a.compositionStart,this._copyFrame.contentWindow.document.body,Object(r.a)(M.App.get_activeAppFrame(),M.App.get_activeAppFrame().showViewerWarningBusinessBar,"showViewerWarningBusinessBar")),M.App.get_activeAppFrame().theKeyInputManager.deinitializeForElement(this._copyFrame.contentWindow.document.body),M.App.get_activeAppFrame().theContextMenuInputManager.unregisterHandler(this._copyFrame.contentWindow.document.body,Object(r.a)(this,this.contextMenuHandler,"contextMenuHandler"))),this._copyFrameLoaded=!1,this._copyFrame=null,this._setFocusExceptionLogged=!1},t=e,(n=[{key:"copyFrame",get:function(){return this._copyFrame}}])&&Y(t.prototype,n),i&&Y(t,i),e}();Object(i.a)($,"ClipboardManager",null,[4]);var ee=function(e,t){this.eventArgs=e,this.selectionFlag=t};Object(i.a)(ee,"EventDataForSelection",null,[]);var te=n(573),ne=function(e,t){this.cursorY=e,this.directionUp=t};function ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ne,"SelectionData",null,[]);var re,ae=function(){function e(e){this._start=new Sys.UI.Point(-1,-1),this._position=new Sys.UI.Point(-1,-1),this._scrollPosition=new Sys.UI.Point(-1,-1),this._startFlag=0,this._currentlyScrolling=!1,this._scrollTimeoutId=0,this._aLongTimeAgo=new Date(0).getTime(),this._scrollControl=null,this._region=e,this._lastScrolltime=this._aLongTimeAgo}var t,n,i,o=e.prototype;return o.setStart=function(e){if(-1===this._start.y){this._start=e;var t=M.App.get_activeAppFrame().workspace.getHeight();this._start.y<=M.App.instance.theConfig.scrollZone?this._startFlag=0:t-this._start.y<M.App.instance.theConfig.scrollZone?this._startFlag=2:this._startFlag=1}},o.update=function(e){var t=M.App.instance.theConfig.scrollZone,n=Math.round(t*M.App.instance.theConfig.scrollOffset/100);this._scrollPosition=new Sys.UI.Point(e.x,e.y),this._startFlag?2===this._startFlag&&(this._start.y<e.y-n?this._scrollPosition.y=this._region.clientHeight+e.y-t-this._start.y-n:this.stopScrolling()):e.y+n<this._start.y?this._scrollPosition.y=t+n+e.y-this._start.y:this.stopScrolling(),this._scrollPosition.y<t||this._region.offsetHeight-this._scrollPosition.y<t?(this._position=e,this._currentlyScrolling||(-1===this._start.y&&(this._start=e),this._currentlyScrolling=!0,this._scrollTimeoutId=window.setTimeout(Object(r.a)(this,this.forceScroll,"forceScroll"),M.App.instance.theConfig.scrollDelay))):this.stopScrolling()},o.stopScrolling=function(){this._currentlyScrolling&&(this._region.style.cursor="",this._currentlyScrolling=!1,this._lastScrolltime=this._aLongTimeAgo,window.clearTimeout(this._scrollTimeoutId))},o.resetScroller=function(){this.stopScrolling(),this._scrollPosition=new Sys.UI.Point(-1,-1),this._position=new Sys.UI.Point(-1,-1),this._start=new Sys.UI.Point(-1,-1)},o.forceScroll=function(){if(this._currentlyScrolling&&-1!==this._position.y&&-1!==this._start.y&&-1!==this._scrollPosition.y){var e=!1,t=this._lastScrolltime!==this._aLongTimeAgo,n=(new Date).getTime(),i=n-this._lastScrolltime;if(this._lastScrolltime=n,t&&(this._scrollPosition.y<M.App.instance.theConfig.scrollZone?this._start.y<this._position.y?t=!1:e=!0:this._start.y>this._position.y&&(t=!1)),t){var o=Math.floor(i/1e3*M.App.instance.theConfig.scrollMagnitudePerSecond);0,e&&(o*=-1),a.AFrameworkApplication.theActionManager.processActionWithData(Z.a.repositionScrollerWithoutAnimation,2,new L.a(Math.round(this.scrollControl.getScrollTop()+o),Number.NaN)),a.AFrameworkApplication.theActionManager.processActionWithData(Z.a.selectFromScroll,2,new ne(this._position.y,e)),this._region.style.cursor="text"}this._scrollTimeoutId=window.setTimeout(Object(r.a)(this,this.forceScroll,"forceScroll"),M.App.instance.theConfig.scrollDelay)}},o.dispose=function(){this._region=null},t=e,(n=[{key:"scrollControl",get:function(){return this._scrollControl||(this._scrollControl=R.a.instance.resolve("WordViewer.Controls.IScrollControl"))}}])&&ie(t.prototype,n),i&&ie(t,i),e}();Object(i.a)(ae,"ScrollHandler",null,[4]),function(e){e[e.beginSelection=0]="beginSelection",e[e.moveSelection=1]="moveSelection",e[e.endSelection=2]="endSelection",e[e.clickSelection=3]="clickSelection",e[e.hover=4]="hover",e[e.doubleClickSelection=5]="doubleClickSelection",e[e.checkClickInSelection=6]="checkClickInSelection",e[e.checkClickInPage=7]="checkClickInPage"}(re||(re={})),Object(i.b)("SelectionFlag",re);var oe=n(94),se=n(242);function le(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"a",(function(){return ce}));var ce=function(){function e(){if(this._clicking=!1,this._offset=new Sys.UI.Point(0,0),this._eventPosition=new Sys.UI.Point(0,0),this._selected={},this._externalLinkOnClickRegistered=!1,this._safeLinksManager=null,this._scrollControl=null,this._zoomControl=null,this._start=null,this._end=null,this._previousSelectionStart=null,this._previousSelectionEnd=null,this._selectionCopier=null,this._waitingOnReposition=!1,this._loggedWordSelectionFailed=!1,M.App.get_activeAppFrame().workspace&&M.App.get_activeAppFrame().workspace.initialized){if(this._newEmbedModeIsEnabled=a.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("NewEmbedModeIsEnabled"),this._surface=this.scrollControl.container,this.calculateOffset(),this._selectionScroller=new ae(this._surface),this._externalLinkAnchor=document.createElement("a"),this._externalLinkDiv=document.createElement("div"),this._externalLinkDiv.className="WACLink",this._externalLinkAnchor.appendChild(this._externalLinkDiv),this._externalLinkAnchor.target="_blank",this._externalLinkAnchor.setAttribute("rel","noreferrer noopener"),!M.App.instance.isAccessiblePdfMode&&(M.App.instance.copyingEnabled&&(this._selectionCopier=new $(this._surface)),!M.App.instance.isSmallView||this._newEmbedModeIsEnabled)){M.App.get_activeAppFrame().theDragInputManager.registerDragAdapter(this._surface,this),M.App.get_activeAppFrame().theClickInputManager.registerHandler(w.a.doubleClick,this._surface,Object(r.a)(this,this.onDoubleClick,"onDoubleClick")),M.App.get_activeAppFrame().theClickInputManager.registerHandler(w.a.click,this._surface,Object(r.a)(this,this.onClick,"onClick"));var e=M.App.get_activeAppFrame().theMouseInputManager;e.registerHandler(w.a.mouseDown,this._surface,Object(r.a)(this,this.onMouseDown,"onMouseDown"),null),e.registerHandler(w.a.mouseMove,this._surface,Object(r.a)(this,this.onMouseMove,"onMouseMove"),null)}this._repositionAllSelectionsTask=new E.a(3,1,10,Object(r.a)(this,this.repositionAllSelectionsTask,"repositionAllSelectionsTask")),this._clearPreviousSelectionTask=new E.a(3,1,1e3,Object(r.a)(this,this.clearPreviousSelectionTask,"clearPreviousSelectionTask")),this.actionManager.addActionWithFlags(Z.a.onContainerResizeForSelection,D.a.application,Object(r.a)(this,this.onContainerResize,"onContainerResize"),96),this.actionManager.addActionWithFlags(Z.a.xmlPageDownloaded,D.a.application,Object(r.a)(this,this.xmlPageDownloaded,"xmlPageDownloaded"),97),this.actionManager.addActionWithFlags(Z.a.updateSelection,D.a.application,Object(r.a)(this,this.updateSelection,"updateSelection"),96),this.actionManager.addActionWithFlags(Z.a.selectFromScroll,D.a.application,Object(r.a)(this,this.selectFromScroll,"selectFromScroll"),97),this.actionManager.addAction(Z.a.browserCopied,D.a.application,Object(r.a)(this,this.browserCopied,"browserCopied")),this.actionManager.addAction(Z.a.copy,D.a.application,Object(r.a)(this,this.copy,"copy")),this.actionManager.addAction(Z.a.showContextMenuInDocument,D.a.application,Object(r.a)(this,this.showContextMenuInDocument,"showContextMenuInDocument")),this.actionManager.addAction(Z.a.showContextMenuFromKey,D.a.application,Object(r.a)(this,this.contextMenuFromKey,"contextMenuFromKey")),this.actionManager.addAction(Z.a.beginSelection,D.a.application,Object(r.a)(this,this.selection,"selection")),this.actionManager.addAction(Z.a.endSelection,D.a.application,Object(r.a)(this,this.selection,"selection")),this.actionManager.addAction(Z.a.doubleClickSelection,D.a.application,Object(r.a)(this,this.selection,"selection")),k.FocusManager.instance().getScope(T.AFrame.documentFocusID).bindAction(F.KeyInputManager.hashKey(I.a.VK_C,F.KeyInputManager.commandKeyModifier),Z.a.browserCopied)}}var t,n,i,c=e.prototype;return c.firstPage=function(){return this._start&&this._end?Math.min(this._start.page,this._end.page):Number.MAX_VALUE},c.lastPage=function(){return this._start&&this._end?Math.max(this._start.page,this._end.page):Number.MIN_VALUE},c.dispose=function(){var e=this._selected;for(var t in e){({key:t,value:e[t]}).value.dispose()}if(this.teardownExternalLinkAnchor(),this._externalLinkAnchor=null,this._externalLinkDiv=null,this._selectionCopier&&(this._selectionCopier.dispose(),this._selectionCopier=null),this._selectionScroller&&(this._selectionScroller.dispose(),this._selectionScroller=null),this._waitingOnReposition&&(a.AFrameworkApplication.theTaskManager.deleteTask(this._repositionAllSelectionsTask),this._waitingOnReposition=!1),(!M.App.instance.isSmallView||this._newEmbedModeIsEnabled)&&!M.App.instance.isAccessiblePdfMode&&this._surface){M.App.get_activeAppFrame().theDragInputManager.unregisterDragAdapter(this._surface,this),M.App.get_activeAppFrame().theClickInputManager.unregisterHandler(w.a.click,this._surface,Object(r.a)(this,this.onClick,"onClick")),M.App.get_activeAppFrame().theClickInputManager.unregisterHandler(w.a.doubleClick,this._surface,Object(r.a)(this,this.onDoubleClick,"onDoubleClick"));var n=M.App.get_activeAppFrame().theMouseInputManager;n.unregisterHandler(w.a.mouseDown,this._surface,Object(r.a)(this,this.onMouseDown,"onMouseDown")),n.unregisterHandler(w.a.mouseMove,this._surface,Object(r.a)(this,this.onMouseMove,"onMouseMove"))}this._surface=null,this._selected=null},c.selection=function(e,t,n,i,r){var a=r,o=!1;if(!a||!a.eventArgs)return 8;try{o=this.eventHandler(a.eventArgs,a.selectionFlag)}catch(e){l.ULS.sendTraceTag(24151193,301,10,"Drag event failed for '{0}': {1}",re[a.selectionFlag],e.message)}return o?32:8},c.xmlPageDownloaded=function(e,t,n,i,r){var a,o=r,s=o.firstPage,l=o.lastPage,c=M.App.get_activeAppFrame().thePageInfoCache;if(!this._start||!this._end)return 32;for(var u=s;u<=l;u++)a=c.getPage(s),this.selectPage(a,this._start,this._end,u===s,u===l);return 32},c.updateSelection=function(e,t,n,i,r){return this.repositionAllSelections(),32},c.selectFromScroll=function(e,t,n,i,r){if(!this._start)return 32;this._end||(this._end=this._start);var o=r,s=o.directionUp,l=o.cursorY,c=this.zoomControl.currentZoom,u=this.scrollControl.getScrollTop()+l,d=oe.a.instance.getPageFromScrollTop(u,c),h=new Sys.UI.Point(0,0);a.AFrameworkApplication.isRtl?h.x=oe.a.instance.getDistanceOfPageLeftFromScrollerRightEdge(d,c)-this._eventPosition.x:h.x=this._eventPosition.x-oe.a.instance.getPageLeftAtZoom(d,c,!1),h.y=u-oe.a.instance.getPageTopAtZoom(d,c);var p=Q.buildXPathFromPosition(d,this._start.storyId,s,h),g=M.App.get_activeAppFrame().thePageInfoCache.getPage(d);if(!g)return 32;for(var m,f=g.selectNodes(p),_=null,v=null,y=Number.MIN_VALUE,S=Number.MAX_VALUE,b=0;b<f.length;b++)(m=parseInt(f[b].attributes.getNamedItem("id").nodeValue))<S&&(S=m,v=f[b]),m>y&&(y=m,_=f[b]);var C,A=-1;return s?(C=Q.instance.getImagesInlineWithText(v,g),A=Q.instance.getCharacterPosition(h,v,C),this.updateSelectionNode(v,A,h,C)):(C=Q.instance.getImagesInlineWithText(_,g),A=Q.instance.getCharacterPosition(h,_,C),this.updateSelectionNode(_,A,h,C)),32},c.browserCopied=function(e,t,n,i,r){return a.AFrameworkApplication.theWsaClient.incrementDw(8812,1),4},c.contextMenuFromKey=function(e,t,n,i,r){if(!this._start||!this._end)return 32;var a=0,o=0;if(void 0!==this._start&&null!==this._start&&void 0!==this._start.node&&null!==this._start.node){var s=this._start.node.attributes,l=Math.round(parseFloat(s.getNamedItem("l").nodeValue)),c=Math.round(parseFloat(s.getNamedItem("t").nodeValue));a=l+Math.round(parseFloat(s.getNamedItem("w").nodeValue))/2,o=c+Math.round(parseFloat(s.getNamedItem("h").nodeValue))/2}var u=this.scrollControl.scroller.offsetLeft,d=(M.App.get_activeAppFrame().workspace,this.scrollControl.getScrollTop()),h=this.zoomControl.currentZoom,p=this._start.page,g=Math.round(oe.a.instance.getPageTopAtZoom(p,h)/h),m=new Sys.UI.Point(a+u,g-d+o);return x.a.ensureContextMenuCreated(),x.a.contextMenuUser.showContextMenuAt("mnuSelectionViewer",m,2),32},c.copy=function(t,n,i,r,a){if(!this._start||!this._end)return 8;if(1===i)return M.App.isReadyForRibbon()?32:8;var o;try{this._selectionCopier.updateCopy(this.selectionStart,this.selectionEnd),o=e.executeBrowserCopyCommand(this._selectionCopier.copyFrame.contentWindow.document)}catch(e){l.ULS.shipAssertTag(4792664,301,s.a.isFirefox,"We failed to copy to the system clipboard, even though we thought we had access!"),o=!1}return o?(this._selectionCopier.setFocus(),32):(this.handleBlockedAccessAttempt(),8)},c.showContextMenuInDocument=function(e,t,n,i,r){var a=r;return this.eventHandler(a,7)?(this._start&&this._end||this.eventHandler(a,3),x.a.contextMenuUser.showContextMenuAt("mnuSelectionViewer",a.clientPoint,a.inputSource),32):8},c.handleBlockedAccessAttempt=function(){if(a.AFrameworkApplication.wacCopyPasteShortcutDialogIsEnabled)A.instance.createCopyPasteShortcutDialog(Object(r.a)(this,this.closeHandler,"closeHandler"),null);else{var e=new h.StandardDialog;e.buttonsOption=0,e.showWarning(CommonUIStrings.l_ClipboardAccessDeniedTitle,CommonUIStrings.l_ClipboardAccessDenied,Object(r.a)(this,this.standardDialogCloseHandler,"standardDialogCloseHandler"))}},c.closeHandler=function(e){this.sharedCloseHandler()},c.standardDialogCloseHandler=function(e,t){this.sharedCloseHandler()},c.sharedCloseHandler=function(){this._selectionCopier.setFocus()},c.eventHandler=function(t,n){var i=t.innerEvent.rawEvent.shiftKey,r=M.App.get_activeAppFrame().workspace,s=this.scrollControl.getScrollLeft(),c=this.scrollControl.getScrollTop(),u=new Sys.UI.Point(0,0);a.AFrameworkApplication.isRtl?u.x=this.scrollControl.getWidth()+this._offset.x+Math.abs(s)-t.clientPoint.x:u.x=t.clientPoint.x+s-this._offset.x,u.y=t.clientPoint.y+c-this._offset.y;var d=this.zoomControl.currentZoom,h=oe.a.instance.getPageFromScrollTop(u.y,d);this._eventPosition=new Sys.UI.Point(u.x-s,u.y-c),this._clicking&&this._selectionScroller.update(this._eventPosition);var p=new Sys.UI.Point(0,0);if(a.AFrameworkApplication.isRtl){var g=oe.a.instance.getDistanceOfPageLeftFromScrollerRightEdge(h,d);p.x=Math.round((g-u.x)/d)}else{var m=oe.a.instance.getPageLeftAtZoom(h,d,!1);p.x=Math.round((u.x-m)/d)}p.y=Math.round((u.y-oe.a.instance.getPageTopAtZoom(h,d))/d);var f=M.App.get_activeAppFrame().thePageInfoCache,_=null,v=null,y=-1,S=null;if(f&&(_=Q.getXmlNodeAtPosition(p,h,f.getPage(h)),S=Q.instance.getImagesInlineWithText(_,f.getPage(h)),y=Q.instance.getCharacterPosition(p,_,S),v=Q.getXmlLinkNodeAtPosition(p,h,f.getPage(h))),4===n)return e.isValidIntLinkNode(v)?this._surface.style.cursor="pointer":e.isValidExtLinkNode(v)?(this._surface.style.cursor="pointer",this.setupExternalLinkAnchor(v,c,h,d)):(this.teardownExternalLinkAnchor(),this._surface.style.cursor=Q.nodeHasDimensions(_)?"text":""),!1;if(3===n&&e.isValidExtLinkNode(v)&&this.isHyperlinkLaunchEvent(t)){try{var b=e.returnScreenedLink(v.text);this.safeLinksManager&&this.safeLinksManager.tryNavigate(b)||o.a.followHyperlinkWithNoReferrer(b)}catch(e){e.message;l.ULS.sendTraceTag(39965912,301,50,"Error thrown when opening the link with protocol '{0}'",this.getLinkProtocol(v.text))}return!0}if(3===n&&e.isValidIntLinkNode(v)&&this.isHyperlinkLaunchEvent(t))return this.navigatepublicLink(v),!0;switch(n){case 0:this._selectionScroller.setStart(this._eventPosition),this.beginSelection(_,i,y,p,S);break;case 1:this.moveSelection(_,y,p,S);break;case 2:this.endSelection();break;case 3:if(3===t.inputSource)this.checkIfClickIsInSelection(p.x,p.y)?M.App.get_activeAppFrame().contextMenuControl.show(t):this.selectParagraph(_);else _&&i?(this.beginSelection(_,i,y,p,S),this.moveSelection(_,y,p,S),this.endSelection()):"contextmenu"!==t.eventName&&this.clearSelection();break;case 5:this.selectWordAtPosition(_,y,p,S);break;case 6:return this.checkIfClickIsInSelection(p.x,p.y);case 7:var C=a.AFrameworkApplication.isRtl?M.App.get_activeAppFrame().isCommentPaneVisible?M.App.instance.theConfig.commentPaneWidth:0:M.App.get_activeAppFrame().isSearchPaneVisible?M.App.instance.theConfig.searchPaneWidth:0;return!(p.x<0||p.x>oe.a.instance.getPageWidthAtZoom(h,d)/d||t.clientPoint.x-C>this.scrollControl.getWidth())&&!(p.y<0||p.y>oe.a.instance.getPageHeightAtZoom(h,d)/d||t.clientPoint.y-r.appBaseDom.offsetTop>r.getHeight());default:0,l.ULS.sendTraceTag(4792667,301,15,"Invalid Selection Code {0}",n)}return!0},c.isHyperlinkLaunchEvent=function(e){return 2!==e.inputSource||(!e.innerEvent.button||e.innerEvent.button===Sys.UI.MouseButton.middleButton)},c.getLinkProtocol=function(e){if(!e)return"NULL";if(!e.length)return"EMPTY";var t=e.indexOf("://");return-1===t?"UNKNOWN":e.substring(0,t)},c.checkIfClickIsInSelection=function(e,t){if(!this._start||!this._end)return!1;var n=this._selected;for(var i in n){var r={key:i,value:n[i]}.value.rectangle;if(e>=r.left&&e<=r.left+r.width&&t>=r.top&&t<=r.top+r.height)return!0}return!1},c.setupExternalLinkAnchor=function(t,n,i,o){var s=e.returnScreenedLink(t.text);if(s){this._externalLinkAnchor.href=s;var l=Math.round(parseFloat(t.attributes.getNamedItem("t").nodeValue)),c=Math.round(parseFloat(t.attributes.getNamedItem("l").nodeValue)),u=n-oe.a.instance.getPageTopAtZoom(i,o);if(this._externalLinkDiv.style.top=n+l*o-u+"px",a.AFrameworkApplication.isRtl){var d=Math.round(parseFloat(t.attributes.getNamedItem("w").nodeValue));this._externalLinkDiv.style.right=oe.a.instance.getDistanceOfPageLeftFromScrollerRightEdge(i,o)-(d+c)*o+"px"}else this._externalLinkDiv.style.left=oe.a.instance.getPageLeftAtZoom(i,o,!1)+c*o+"px";this._externalLinkDiv.style.width=Math.round(parseFloat(t.attributes.getNamedItem("w").nodeValue)*o)+"px",this._externalLinkDiv.style.height=Math.round(parseFloat(t.attributes.getNamedItem("h").nodeValue)*o)+"px",this._externalLinkDiv.title=s;var h=new E.a(2,1,1e3,Object(r.a)(this,this.setupExternalLinkAnchorInternal,"setupExternalLinkAnchorInternal"));return a.AFrameworkApplication.theTaskManager.addTask(h),!0}return!1},c.setupExternalLinkAnchorInternal=function(e){this._externalLinkOnClickRegistered||(M.App.get_activeAppFrame().theClickInputManager.registerHandler(w.a.click,this._externalLinkAnchor,Object(r.a)(this,this.linkOnClick,"linkOnClick")),this._externalLinkOnClickRegistered=!0),this._surface.appendChild(this._externalLinkAnchor)},c.teardownExternalLinkAnchor=function(){P.a.removeElement(this._externalLinkAnchor),this._externalLinkOnClickRegistered&&(M.App.get_activeAppFrame().theClickInputManager.unregisterHandler(w.a.click,this._externalLinkAnchor,Object(r.a)(this,this.linkOnClick,"linkOnClick")),this._externalLinkOnClickRegistered=!1)},c.navigatepublicLink=function(e){if(e.hasChildNodes()){0;var t=e.selectSingleNode("LT"),n=t.attributes.getNamedItem("p"),i=t.attributes.getNamedItem("t"),r=parseInt(n.nodeValue),o=parseInt(i.nodeValue),s=this.zoomControl.currentZoom,l=oe.a.instance.getPageTopAtZoom(r,s);l+=o*s;var c=parseInt(this._surface.offsetHeight);a.AFrameworkApplication.theActionManager.processActionWithData(Z.a.repositionScroller,2,new L.a(l-.2*c,0))}},c.beginSelection=function(e,t,n,i,r){this._clicking=!0;var a=null;e&&(a=new te.a(null,e,n,i,r)),t&&this._end&&this._start?this.updateSelectionNode(e,n,i,r):(this.clearSelection(),this._selectionCopier&&this._selectionCopier.clearCopy(),this._start=a)},c.moveSelection=function(e,t,n,i){this.updateSelectionNode(e,t,n,i)},c.endSelection=function(){this._selectionScroller.resetScroller(),this._clicking&&this._selectionCopier&&this._selectionCopier.updateCopy(this._start,this._end),this._surface.style.cursor="",this._clicking=!1},c.clearSelection=function(){var e,t=this._selected;for(var n in t){e={key:n,value:t[n]}.value.rectangle,B.a.instance.removeFromParent(e)}this._previousSelectionStart=this._start,this._previousSelectionEnd=this._end,a.AFrameworkApplication.theTaskManager.addTask(this._clearPreviousSelectionTask),this._selected={},this._start=null,this._end=null},c.clearPreviousSelectionTask=function(e){this._previousSelectionStart||this._previousSelectionEnd,this._previousSelectionStart=null,this._previousSelectionEnd=null},c.unselectRange=function(e,t){var n;t<e&&(n=e,e=t,t=n);var i,r,a=[],o=this._selected;for(var s in o){var l={key:s,value:o[s]};i=l.value.rectangle,(r=parseInt(i.id))>=e&&r<=t&&(B.a.instance.removeFromParent(i),Array.add(a,l.key));for(var c=0;c<a.length;c++)delete this._selected[a[c]]}},c.updateSelectionNode=function(e,t,n,i){if(this._end||(this.selectRange(this._start,this._start),this._end=this._start),e){var r=new te.a(null,e,t,n,i);if(r.storyId===this._start.storyId&&(1===r.storyId||r.page===this._start.page)){var a=this._end.page,o=M.App.get_activeAppFrame().thePageInfoCache;this._end.id===r.id?(this.unselectRange(this._end.id,this._end.id),this.selectRange(this._start,r),this._end=r):this._start.id<r.id?this._end.id<this._start.id?(this.unselectRange(this._end.id,this._start.id-1),this.selectRange(this._start,r),this._end=r,o.removeFromCache(a,this._start.page)):this._end.id<r.id?(this.unselectRange(this._end.id,this._end.id),this.selectRange(this._start,r),this._end=r):r.id<this._end.id&&(this.unselectRange(r.id+1,this._end.id),this._end=r,o.removeFromCache(r.page,a)):r.id<this._start.id?this._start.id<this._end.id?(this.unselectRange(this._start.id+1,this._end.id),this.selectRange(r,this._start),this._end=r,o.removeFromCache(this._start.page,a)):r.id<this._end.id?(this.unselectRange(this._end.id,this._end.id),this.selectRange(this._start,r),this._end=r):this._end.id<r.id&&(this.unselectRange(this._end.id,r.id-1),this._end=r,o.removeFromCache(a,r.page)):r.id===this._start.id&&this._end.id!==this._start.id&&(this._end.id<this._start.id?(this.unselectRange(this._end.id,this._start.id-1),this._end=r,o.removeFromCache(a,r.page)):(this.unselectRange(this._start.id+1,this._end.id),this._end=r,o.removeFromCache(r.page,a)))}}},c.selectRange=function(e,t){var n;(t.id<e.id||e.id===t.id&&t.characterPosition<e.characterPosition)&&(n=e,e=t,t=n);for(var i,r=M.App.get_activeAppFrame().thePageInfoCache,a=e.page;a<=t.page;a++)i=r.getPage(a),this.selectPage(i,e,t,a===e.page,a===t.page)},c.selectWordAtPosition=function(e,t,n,i){var r,a,o,s,c,u,d=(r=Q.instance.tryGetWordStart(e,t,o,c),o=r.startNode,c=r.startPosition,r).returnValue,h=(a=Q.instance.tryGetWordEnd(e,t,s,u),s=a.endNode,u=a.endPosition,a).returnValue;d&&h?(this.beginSelection(o,!1,c,n,i),this.updateSelectionNode(s,u,n,i),this.endSelection()):(this._loggedWordSelectionFailed||(l.ULS.sendTraceTag(20557893,301,50,"Unable to select word"),this._loggedWordSelectionFailed=!0),this.selectParagraph(e))},c.selectParagraph=function(e){if(e){var t=e.selectSingleNode("ancestor::P");if(t){var n=t.selectNodes("descendant::T");n&&n.length&&(this.beginSelection(n[0],!1,-1,null,null),this.updateSelectionNode(n[n.length-1],-1,null,null),this.endSelection())}}else this.clearSelection()},c.selectPage=function(e,t,n,i,r){if(e){var a=Q.buildXPathForPageSelection(t,n),o=e.selectNodes(a);if(o.length){var s,l,c,u=o[0].selectSingleNode("ancestor::Page");0;for(var d=parseInt(u.selectSingleNode("@id").text),h=0;h<o.length;h++)if(l=(s=o[h]).attributes.getNamedItem("id").nodeValue,!this._selected[l]&&Q.nodeHasDimensions(s)){var p=this.zoomControl.currentZoom,g=Q.instance.getSelectionBoundingBox(s,t,n,o.length-1,h,i,r),m=B.a.instance.drawRectangle(g,0,l,K.a.getPageFromXmlLine(s));m.setPosition(m.box,d,p),c=new te.a(m,s),this._selected[m.id]=c}}}},c.repositionAllSelections=function(){this._waitingOnReposition||(this._waitingOnReposition=!0,a.AFrameworkApplication.theTaskManager.addTask(this._repositionAllSelectionsTask))},c.repositionAllSelectionsTask=function(e){var t,n=this.zoomControl.currentZoom,i=this._selected;for(var r in i){t={key:r,value:i[r]}.value;var a=Q.instance.getRectanglePosition(t.node);t.rectangle.setPosition(a,K.a.getPageFromXmlLine(t.node),n)}this.showSelection(),this._waitingOnReposition=!1},c.calculateOffset=function(){this._offset=se.a(this._surface),a.AFrameworkApplication.isRtl&&(s.a.isInternetExplorerNonEdge||s.a.isChromeOrIEEdge)&&(this._offset.x+=this.scrollControl.verticalScrollBarWidth)},c.onContainerResize=function(e,t,n,i,r){return this.repositionAllSelections(),this.calculateOffset(),32},c.hideSelection=function(){var e=this._selected;for(var t in e){({key:t,value:e[t]}).value.rectangle.hideHighlight()}},c.showSelection=function(){var e=this._selected;for(var t in e){({key:t,value:e[t]}).value.rectangle.showHighlight()}},c.isDragPossible=function(e){return 2===e.inputSource&&!e.mouseButton},c.onDragStart=function(e){return!!this.isDragPossible(e)&&this.executeDragOrClickEventForSelection(e,Z.a.beginSelection,0)},c.onDragMove=function(e){return!!this._start&&this.eventHandler(e,1)},c.onDragEnd=function(e){e.mouseButton||this.executeDragOrClickEventForSelection(e,Z.a.endSelection,2)},c.onDragCancel=function(e){this.endSelection()},c.linkOnClick=function(e){return e.innerEvent.stopPropagation(),!1},c.onClick=function(e){return this.eventHandler(e,3)},c.onDoubleClick=function(e){return this.executeDragOrClickEventForSelection(e,Z.a.doubleClickSelection,5)},c.onMouseDown=function(e){return k.FocusManager.usable()&&k.FocusManager.instance().setScope(T.AFrame.documentFocusID),document.body.focus(),!1},c.onMouseMove=function(e){return this._clicking||this.eventHandler(e,4),!1},c.executeDragOrClickEventForSelection=function(e,t,n){return 32===this.actionManager.processActionWithData(t,2,new ee(e,n))},e.executeBrowserCopyCommand=function(e){return e.execCommand("copy",!1,null)},e.returnScreenedLink=function(e){var t=["javascript:","vbscript:"];if(!e)return null;for(var n=O.a.toLower(e),i=t.length,r=0;r<i;++r)if(O.a.startsWith(n,t[r]))return null;return O.a.isLinkable(e)?e:"BLOCKED:"+e},e.isValidExtLinkNode=function(e){return!!e&&!(1!==e.childNodes.length||3!==e.childNodes[0].nodeType||!Q.nodeHasDimensions(e))},e.isValidIntLinkNode=function(e){if(!e)return!1;var t=e.selectSingleNode("LT");return!!t&&!!(t.attributes.getNamedItem("p")&&t.attributes.getNamedItem("l")&&t.attributes.getNamedItem("t"))},t=e,i=[{key:"instance",get:function(){return e._instance||e._initializing||(e._initializing=!0,M.App.get_activeAppFrame()&&(e._instance=new e),e._initializing=!1),e._instance}}],(n=[{key:"actionManager",get:function(){return a.AFrameworkApplication.theActionManager}},{key:"safeLinksManager",get:function(){return this._safeLinksManager||(this._safeLinksManager=R.a.instance.tryResolve("Common.App.SafeLinks.ISafeLinksManager"))}},{key:"zoomControl",get:function(){return this._zoomControl||(this._zoomControl=R.a.instance.resolve("WordViewer.Controls.IZoomControl"))}},{key:"scrollControl",get:function(){return this._scrollControl||(this._scrollControl=R.a.instance.resolve("WordViewer.Controls.IScrollControl"))}},{key:"selectionStart",get:function(){return this._start?this._end&&this._start.id>this._end.id?this._end:this._start:null}},{key:"surface",get:function(){return this._surface}},{key:"selectionEnd",get:function(){return this._end?this._start&&this._start.id>this._end.id?this._start:this._end:null}},{key:"previousSelectionStart",get:function(){return this._previousSelectionStart?this._previousSelectionEnd?this._previousSelectionStart.id>this._previousSelectionEnd.id?this._previousSelectionEnd:this._previousSelectionStart:this._start:null}},{key:"previousSelectionEnd",get:function(){return this._previousSelectionEnd?this._previousSelectionStart?this._previousSelectionStart.id>this._previousSelectionEnd.id?this._previousSelectionStart:this._previousSelectionEnd:this._end:null}}])&&le(t.prototype,n),i&&le(t,i),e}();ce._initializing=!1,ce._instance=null,Object(i.a)(ce,"SelectionManager",null,[169,4])},567:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(0),r=n(561),a=n(52),o=n(6),s=function(){function e(){}return e.prototype.dispose=function(){},e.createButton=function(e,t,n,i,s){void 0===s&&(s=!0);var l=s?"":n;var c=r.a("a",e,"StandardButton "+t);c.title=l,c.tabIndex=0;var u=null;if(i?((u=a.createClusteredImage(16,16,i,"StandardButtonImage",!0,null)).setAttribute(o.a.ariaRoleAttribute,o.a.ariaPresentationRole),c.appendChild(u)):Sys.UI.DomElement.addCssClass(c,"StandardButtonNoImage"),s){var d=r.a("span",null,"StandardButtonLabel");d.innerText=n,c.appendChild(d)}else Sys.UI.DomElement.addCssClass(u,"StandardButtonImageNoText");return c.setAttribute(o.a.ariaRoleAttribute,o.a.ariaButtonRole),c},e.setButtonEnabledState=function(e,t){var n;null!=e&&(e.disabled=!t,t?(n=o.a.ariaFalseValue,Sys.UI.DomElement.removeCssClass(e,"DisabledButton"),Sys.UI.DomElement.removeCssClass(e,"cui-disabled")):(n=o.a.ariaTrueValue,Sys.UI.DomElement.containsCssClass(e,"DisabledButton")||Sys.UI.DomElement.addCssClass(e,"DisabledButton"),Sys.UI.DomElement.containsCssClass(e,"cui-disabled")||Sys.UI.DomElement.addCssClass(e,"cui-disabled")),o.a.setAriaAttribute(e,o.a.ariaDisabledAttribute,n))},e}();Object(i.a)(s,"SimpleButtonFactory",null,[4])},568:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(0);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(e,t,n,i){this._left=e,this._top=t,this._width=n,this._height=i}var t,n,i;return t=e,(n=[{key:"height",get:function(){return this._height},set:function(e){this._height=e}},{key:"left",get:function(){return this._left},set:function(e){this._left=e}},{key:"top",get:function(){return this._top},set:function(e){this._top=e}},{key:"width",get:function(){return this._width},set:function(e){this._width=e}}])&&r(t.prototype,n),i&&r(t,i),e}();Object(i.a)(a,"Box",null,[])},569:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(0),r=n(14),a=n(568);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(){function e(){}var t,n,i,s=e.prototype;return s.estimatedBoundingBox=function(e,t,n){var i,r=e.firstChild.data.length,o=parseFloat(e.attributes.getNamedItem("l").nodeValue),s=parseFloat(e.attributes.getNamedItem("t").nodeValue),l=parseFloat(e.attributes.getNamedItem("w").nodeValue),c=parseFloat(e.attributes.getNamedItem("h").nodeValue),u=0,d=0,h=0;return e.attributes.getNamedItem("a")&&(d=parseInt(e.attributes.getNamedItem("a").nodeValue)),e.attributes.getNamedItem("rtl")&&(h=parseInt(e.attributes.getNamedItem("rtl").nodeValue)),d?(i=c/r*(n-t),270===d&&1!==h||90===d&&1===h?(s=s+c-c/r*t-i,new a.a(o,s,l,i)):90===d&&1!==h||270===d&&1===h?(s+=c/r*t,new a.a(o,s,l,i)):new a.a(o,s,l,c)):(u=l/r*(n-t),1!==h?o+=l/r*t:o=o+l-l/r*t-u,new a.a(o,s,u,c))},s.drawHitBox=function(e,t,n,i,o,s,l,c,u,d,h,p){var g=r.App.instance.theConfig.dpiAspectRatio;return n?(o=c*g,l=Math.abs(u-c)*g-o):e?270===e&&!t||90===e&&t?(o=u*g,l=Math.abs(u-c)*g):(90===e&&!t||270===e&&t)&&(o=c*g,l=Math.abs(u-c)*g):(i=t?u*g:c*g,s=Math.abs(u-c)*g),i<0||o<0||s<0||l<0||isNaN(i)||isNaN(o)||isNaN(s)||isNaN(l)?this.estimatedBoundingBox(d,h,p):new a.a(i,o,s,l)},s.calculateWidth=function(e,t,n,i,r,a,o){for(var s=new RegExp("\\(\\d:\\d\\)"),l=0;a<t;){var c=1,u=1,d=i[r],h=s.exec(d);if(h){for(var p=h[0].split(new RegExp("[\\(|\\:|\\)]")),g=0;!p[g]&&g<p.length;)g++;for(c=parseInt(p[g]),g++;!p[g]&&g<p.length;)g++;u=parseInt(p[g])}if(a+c>t&&!o)return{returnValue:l,positionInIndicies:r,positionInCharRun:a};for(var m=0;m<u;m++){var f=i[r].split(",");e?l=r?n-parseFloat(f[3]):n:l+=parseFloat(f[1]),r++}a+=c}return{returnValue:l,positionInIndicies:r,positionInCharRun:a}},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(n=null)&&o(t.prototype,n),i&&o(t,i),e}();s._instance=null,Object(i.a)(s,"HighlightUtils",null,[170])},570:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return r}));var i=function(e,t,n){e&&e.setPosition(e.box,t,n)},r=function(e){for(var t,n=[],i=0;i<e.length;++i)t=e[i],n[i]=t.data;return n.join("")}},571:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(0),r=n(1);function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(){this._commentManager=null,this._comments=[],this._changes=[],this._selected=null,this._selectedParent=null,this._inProgress=null}var t,i,o,s=e.prototype;return s.initialize=function(e){this._commentManager=e},s.dispose=function(){for(var e=this._comments.length,t=0;t<e;t++)this._comments[t].dispose();this._comments=[]},s.modeChanged=function(){this._selected&&this._selected.modeChanged(),this._selectedParent&&this._selectedParent.modeChanged()},s.selectComment=function(e){if(this.clearSelection(),e.selectionState=1,this._selected=e,e.replyToId){0;for(var t=Array.indexOf(this._comments,e)-1;t>=0;t--){var n=this._comments[t];if(n.id===e.replyToId){n.selectionState=2,this._selectedParent=n;break}}0}},s.selectNextComment=function(){if(!this._comments.length)return null;var e=null;return e=this._selected?this.getCommentAfter(this._selected,!0):this._comments[0],this.selectComment(e),e},s.selectPrevComment=function(){if(!this._comments.length)return null;var e=null;return e=this._selected?this.getCommentBefore(this._selected,!0):this._comments[this._comments.length-1],this.selectComment(e),e},s.clearSelection=function(){this._selected&&(this._selected.selectionState=0,this._selected=null),this._selectedParent&&(this._selectedParent.selectionState=0,this._selectedParent=null)},s.editCommentInModel=function(e,t){this._commentManager.mode=3,e.commentType=2,e.saveState=0,e.draftConfiguration=t,this._inProgress=e},s.cancelEditingCommentInModel=function(e){this._inProgress=null,this._commentManager.mode=1},s.createAndAddReplyToModel=function(e,t){var i=this.getComment(e);this._commentManager.mode=2;var a=n(564).Comment.createCommentForEditing(r.AFrameworkApplication.userName,e,i.groupNumber,t);this._inProgress=a;for(var o=this._comments.length-1;o>=0;o--){var s=this._comments[o];if(s.replyToId===a.replyToId||s.id===a.replyToId){Array.insert(this._comments,o+1,a),!0;break}}return a},s.commitNewComment=function(e){this.commitNewOrEditComment(e,2)},s.commitEditComment=function(e){this.commitNewOrEditComment(e,4)},s.deleteComment=function(e){var t=[];for(var n=Array.indexOf(this._comments,e);n<this._comments.length;){var i=this._comments[n];if(i.id!==e.id&&i.replyToId!==e.id)break;Array.removeAt(this._comments,n),Array.add(t,i)}return this._commentManager.sharedCommentsEnabled,this.recordChanges(t,3),Array.indexOf(t,this._inProgress)>-1&&(this._inProgress=null,this._commentManager.mode=1),t},s.changeDoneStatus=function(e,t){var n=[];for(var i=Array.indexOf(this._comments,e);i<this._comments.length;){var r=this._comments[i];if(r.id!==e.id&&r.replyToId!==e.id)break;r.done=t,Array.add(n,r),i++}this.recordChanges(n,t?0:1)},s.getAllComments=function(){return Array.clone(this._comments)},s.hasComments=function(){return!!this._comments&&!!this._comments.length},s.getComment=function(e){for(var t=0;t<this._comments.length;t++){var n=this._comments[t];if(n.id===e)return n}return null},s.getCommentAfter=function(e,t){var n=Array.indexOf(this._comments,e);return n===this._comments.length-1?t?this._comments[0]:null:this._comments[n+1]},s.getFirstCommentAfter=function(e,t,n){void 0===n&&(n=!1);var i=Array.indexOf(this._comments,e);var r=i;do{if(r===this._comments.length-1&&!t)return null;if(r=r===this._comments.length-1?0:r+1,!n||!this._comments[r].done)return this._comments[r]}while(r!==i);return this._comments[i]},s.getCommentBefore=function(e,t){var n=Array.indexOf(this._comments,e);return n?this._comments[n-1]:t?this._comments[this._comments.length-1]:null},s.getFirstCommentBefore=function(e,t,n){void 0===n&&(n=!1);var i=Array.indexOf(this._comments,e);var r=i;do{if(!r&&!t)return null;if(r=r?r-1:this._comments.length-1,!n||!this._comments[r].done)return this._comments[r]}while(r!==i);return this._comments[i]},s.dumpChanges=function(){for(var e="",t=0;t<this._changes.length;t++)e+=this._changes[t].toString()+"\n\n";return e},s.addCommentReaction=function(e,t){},s.removeCommentReaction=function(e,t){},s.commitNewOrEditComment=function(e,t){var n=[];e.commentType=0,Array.add(n,e),this.recordChanges(n,t),this._inProgress=null},e.createNewComment=function(e){return n(564).Comment.createCommentForEditing(r.AFrameworkApplication.userName,null,n(564).Comment.pageNumberUnknown,e)},e.dateToLocalTime=function(e){return e.getTime()-60*e.getTimezoneOffset()*1e3},t=e,(i=[{key:"selectedComment",get:function(){return this._selected}},{key:"inProgressComment",get:function(){return this._inProgress}}])&&a(t.prototype,i),o&&a(t,o),e}();Object(i.a)(o,"CommentModel",null,[4,116])},572:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(0),r=function(){};r.commentPaneTextboxFocusId="CommentPaneTextbox",r.commentPaneData="CommentPaneData",r.commentPaneID="CommentPane",r.commentDeleteButtonClassName="CommentDeleteButton",r.commentSaveButtonClassName="CommentSaveButton",r.commentReplyButtonClassName="CommentReplyButton",r.commentCancelButtonClassName="CommentCancelButton",r.commentTextEntryClassName="CommentTextEntry",r.commentTaskPaneCloseClassName="TaskPaneClose",r.commentPaneCloseButtonClassName="CommentPaneCloseButton",r.commentPaneWidth=300,r.commentTabHelp="CommentTabHelp",Object(i.a)(r,"CommentManagerConstants",null,[])},573:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(0);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(e,t,n,i,r){if(void 0===n&&(n=-1),void 0===i&&(i=null),void 0===r&&(r=null),this._id=0,this._storyId=0,this._page=0,this._rectangle=e,this._xmlNode=t,this._characterPosition=n,this._selectionPosition=i,this._imagesInlineWithText=r,this._xmlNode){this._id=parseInt(this._xmlNode.attributes.getNamedItem("id").nodeValue);var a=this._xmlNode.parentNode;this._storyId=parseInt(a.attributes.getNamedItem("storyId").nodeValue);var o=a.selectSingleNode("ancestor::Page");this._page=parseInt(o.attributes.getNamedItem("id").nodeValue)}}var t,n,i;return e.prototype.dispose=function(){this._rectangle=null},t=e,(n=[{key:"rectangle",get:function(){return this._rectangle},set:function(e){this._rectangle=e}},{key:"id",get:function(){return this._id}},{key:"node",get:function(){return this._xmlNode}},{key:"page",get:function(){return this._page}},{key:"storyId",get:function(){return this._storyId}},{key:"characterPosition",get:function(){return this._characterPosition}},{key:"selectionPosition",get:function(){return this._selectionPosition}},{key:"imagesInlineWithText",get:function(){return this._imagesInlineWithText}}])&&r(t.prototype,n),i&&r(t,i),e}();Object(i.a)(a,"LineInfo",null,[4])},574:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(0);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(e,t){this._text=e,this._filters=t}var t,n,i;return e.prototype.isQueryFilterSet=function(e){return(this._filters&e)===e},e.createQuery=function(t,n){return new e(t,n)},t=e,(n=[{key:"text",get:function(){return this._text}},{key:"matchCase",get:function(){return this.isQueryFilterSet(1)}},{key:"matchWholeWord",get:function(){return this.isQueryFilterSet(2)}},{key:"matchWildCards",get:function(){return this.isQueryFilterSet(4)}},{key:"matchPrefix",get:function(){return this.isQueryFilterSet(8)}},{key:"matchSuffix",get:function(){return this.isQueryFilterSet(16)}},{key:"ignorePunct",get:function(){return this.isQueryFilterSet(32)}},{key:"ignoreSpace",get:function(){return this.isQueryFilterSet(64)}}])&&r(t.prototype,n),i&&r(t,i),e}();Object(i.a)(a,"Query",null,[139])},575:function(e,t,n){"use strict";n.r(t),n.d(t,"CurrentResult",(function(){return h}));var i=n(0),r=n(1),a=n(14),o=n(298),s=n(160),l=n(560),c=n(149),u=n(17);function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var h=function(){function e(){this._resultNumber=0,this._currentResultItem=null,this._currentSearchResultHighlights=[],this._currentResult=null}var t,n,i,h=e.prototype;return h.dispose=function(){this._currentResultItem&&(Array.clear(this._currentSearchResultHighlights),this._currentResultItem=null)},h.reset=function(){this._resultNumber=Number.NaN,this._currentResult=null,this._currentResultItem&&(this._currentResultItem.deselect(),this._currentResultItem=null),Array.clear(this._currentSearchResultHighlights)},h.setCurrentResult=function(e,t,n){this._resultNumber=n,this._currentResult=e;var i=e.id;this.clearCurrentResultHighlight(),this._currentResultItem&&this._currentResultItem.deselect(),this._currentResultItem=t,this._currentResultItem.select(),this.searchForCurrentResult(i),l.SearchManager.instance.lookForCurrentResult(e.page,i,this._currentSearchResultHighlights.length>0);var c=e.getScrollTop(),d=e.getScrollLeft();if(!isNaN(c)||!isNaN(d)){var h=new s.a(c,d);r.AFrameworkApplication.theActionManager.processActionWithData(u.a.repositionScroller,2,h),a.App.instance.isBroadcastMode&&r.AFrameworkApplication.theActionManager.processActionWithData(u.a.broadcastOnScroll,2,new o.a(e.page,h,2))}},h.searchForCurrentResult=function(e){var t,n,i=0,r=new RegExp("(\\d+)-(\\d+)").exec(e);t=Number.parseInvariant(r[1]),n=Number.parseInvariant(r[2]);var a=l.SearchManager.instance,o=a.getHighlightsByPage(t);if(o){var s=o[n];if(s)for(var c=s.highlightRectangles[i];c;)this.foundCurrentResult(c),i++,c=(s=(o=a.getHighlightsByPage(t))[n]).highlightRectangles[i]}},h.foundCurrentResult=function(e){this._currentSearchResultHighlights[this._currentSearchResultHighlights.length]=e;var t=e.cloneHighlight();if(e.addStyle(2),t){var n=e.domElem;c.a.animateFoundCurrentResultHighlight(t,n)}},h.clearCurrentResultHighlight=function(){if(this._currentSearchResultHighlights){for(var e=0;e<this._currentSearchResultHighlights.length;++e){var t=this._currentSearchResultHighlights[e],n=t.cloneHighlight();if(t.removeStyle(2),n){var i=t.domElem;c.a.animateClearCurrentResultHighlight(n,i)}}Array.clear(this._currentSearchResultHighlights)}},t=e,(n=[{key:"resultNumber",get:function(){return this._resultNumber}},{key:"result",get:function(){return this._currentResult}}])&&d(t.prototype,n),i&&d(t,i),e}();Object(i.a)(h,"CurrentResult",null,[4])},576:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(563),a=function(){function e(e){this._xmlNodeWrapperFactory=new r.a,this._xmlNamedNodeMap=e}return e.prototype.getNamedItem=function(e){return this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(this._xmlNamedNodeMap.getNamedItem(e))},e}();Object(i.a)(a,"XmlNamedNodeMapWrapper",null,[271]);var o=function(){function e(){}return e.prototype.getSelectionXmlNamedNodeMapWrapper=function(e){return e?new a(e):null},e}();function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(o,"XmlNamedNodeMapWrapperFactory",null,[252]);var l=function(){function e(e){this._xmlnodeWrapperFactory=new r.a,this._list=e}var t,n,i;return e.prototype.get_item=function(e){return this._xmlnodeWrapperFactory.getSelectionXmlNodeWrapper(this._list[e])},t=e,(n=[{key:"length",get:function(){return this._list.length}}])&&s(t.prototype,n),i&&s(t,i),e}();Object(i.a)(l,"XmlNodeListWrapper",null,[268]);var c=function(){function e(){}return e.prototype.getXmlNodeListWrapper=function(e){return e?new l(e):null},e}();function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(c,"XmlNodeListWrapperFactory",null,[251]),n.d(t,"XmlNodeWrapper",(function(){return d}));var d=function(){function e(e){this._xmlNodeWrapperFactory=new r.a,this._xmlNamedNodeMapWrapperFactory=new o,this._xmlNodeListWrapperFactory=new c,this._node=e}var t,n,i,a=e.prototype;return a.selectSingleNode=function(e){return this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(this._node.selectSingleNode(e))},a.selectNodes=function(e){return this._xmlNodeListWrapperFactory.getXmlNodeListWrapper(this._node.selectNodes(e))},t=e,(n=[{key:"backingNode",get:function(){return this._node}},{key:"firstChild",get:function(){return this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(this._node.firstChild)}},{key:"previousSibling",get:function(){return this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(this._node.previousSibling)}},{key:"nextSibling",get:function(){return this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(this._node.nextSibling)}},{key:"nodeValue",get:function(){return this._node.nodeValue}},{key:"attributes",get:function(){return this._xmlNamedNodeMapWrapperFactory.getSelectionXmlNamedNodeMapWrapper(this._node.attributes)}}])&&u(t.prototype,n),i&&u(t,i),e}();Object(i.a)(d,"XmlNodeWrapper",null,[228])},577:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(32),a=n(1),o=n(43),s=n(19),l=n(14),c=n(36),u=n(562);function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var h=function(){function e(e){this._page=e,this._highlightRectangles=[]}var t,n,i,r=e.prototype;return r.dispose=function(){for(var e=0;e<this._highlightRectangles.length;++e)this._highlightRectangles[e]&&(u.a.instance.removeFromParent(this._highlightRectangles[e]),null)},r.addHighlightRectangle=function(e){this._highlightRectangles[this._highlightRectangles.length]=e},t=e,(n=[{key:"highlightRectangles",get:function(){return this._highlightRectangles}},{key:"page",get:function(){return this._page}}])&&d(t.prototype,n),i&&d(t,i),e}();Object(i.a)(h,"HighlightResult",null,[4]);var p=n(560),g=n(570),m=n(17);function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"HighlightWorker",(function(){return _}));var _=function(){function e(e){this._nextHighlightTask=null,this._pageBeingHighlighted=0,this._countHitsOnPage=0,this._waitingOnReposition=!1,this._countRunParagraphs=0,this._countRunCharacters=0,this._paragraphXmls=null,this._paragraphBeingHighlighted=0,this._firstPageToHighlight=Number.NaN,this._lastPageToHighlight=Number.NaN,this._currentResultPage=Number.NaN,this._currentResultId=null,this._currentResultFound=!0,this._oldCurrentPage=Number.NaN,this._zoomControl=null,this._target=e,a.AFrameworkApplication.theActionManager.addActionWithFlags(m.a.updateSearchHighlight,c.a.application,Object(r.a)(this,this.updateHighlight,"updateHighlight"),96),l.App.get_activeAppFrame().add_onResize(Object(r.a)(this,this.onResize,"onResize")),this._highlights={},this._repositionAllHighlightsTask=new o.a(3,1,10,Object(r.a)(this,this.repositionAllHighlightsTask,"repositionAllHighlightsTask"))}var t,n,i,d=e.prototype;return d.dispose=function(){this.reset(),this._highlights=null,this._paragraphXmls=null,this._target=null,this._repositionAllHighlightsTask=null},d.onResize=function(){this.repositionAllHighlights()},d.updateHighlight=function(e,t,n,i,r){return this.repositionAllHighlights(),32},d.reset=function(){this._waitingOnReposition&&(a.AFrameworkApplication.theTaskManager.deleteTask(this._repositionAllHighlightsTask),this._waitingOnReposition=!1),this.clearAllHighlights(),this._paragraphXmls=null,this._firstPageToHighlight=Number.NaN,this._lastPageToHighlight=Number.NaN,this._currentResultFound=!0,this._currentResultPage=Number.NaN,this._currentResultId=null},d.stopHighlightTask=function(){this._nextHighlightTask&&(a.AFrameworkApplication.theTaskManager.deleteTask(this._nextHighlightTask),this._nextHighlightTask=null)},d.setupHighlighting=function(){var e=l.App.get_activeAppFrame().workspace;this._firstPageToHighlight=e.getFirstCachedPage(),this._lastPageToHighlight=e.getLastCachedPage(),this.beginHighlighting()},d.beginHighlighting=function(){this.clearAllHighlights(),this._pageBeingHighlighted=l.App.get_activeAppFrame().workspace.getCurrentPage(),this._countHitsOnPage=0,this._nextHighlightTask=new o.a(3,1,l.App.instance.theConfig.highlightTaskDelay,Object(r.a)(this,this.waitOnNewPage,"waitOnNewPage")),this.waitOnNewPage(null)},d.clearAllHighlights=function(){this.stopHighlightTask();var e=this._highlights;for(var t in e){var n={key:t,value:e[t]};this.clearHighlightsOnPage(n.key)}this._highlights={}},d.clearHighlightsOnPage=function(e){if(this._highlights[e]){for(var t=this._highlights[e],n=0;n<t.length;++n)t[n].dispose(),t[n]=null;Array.clear(t),delete this._highlights[e],e===this._currentResultPage&&(this._currentResultFound=!1,p.SearchManager.instance.clearCurrentResultHighlight())}},d.waitOnNewPage=function(e){var t;l.App.get_activeAppFrame().workspace;u.a.instance.isPageLoaded(this._pageBeingHighlighted)&&(t=l.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(this._pageBeingHighlighted))?(this._paragraphXmls=t.selectNodes("descendant::P"),this._paragraphBeingHighlighted=0,this._nextHighlightTask=new o.a(3,1,l.App.instance.theConfig.highlightTaskDelay,Object(r.a)(this,this.parseParagraphXmlTask,"parseParagraphXmlTask")),a.AFrameworkApplication.theTaskManager.addTask(this._nextHighlightTask)):a.AFrameworkApplication.theTaskManager.addTask(this._nextHighlightTask)},d.parseParagraphXmlTask=function(e){this._countRunCharacters=0,this._countRunParagraphs=0;var t=l.App.instance.theConfig,n=this._highlights[this._pageBeingHighlighted];for(n||(n=[],this._highlights[this._pageBeingHighlighted]=n);this._paragraphBeingHighlighted<this._paragraphXmls.length&&this._countRunCharacters<t.minCharactersToSearchBeforePausing&&this._countRunParagraphs<t.maxParagraphsToSearchBeforePausing;)this.parseParagraphXml();this._paragraphBeingHighlighted<this._paragraphXmls.length?a.AFrameworkApplication.theTaskManager.addTask(this._nextHighlightTask):this.highlightNextPage()},d.highlightNextPage=function(){var e=this._lastPageToHighlight-this._firstPageToHighlight+1,t=0,n=l.App.get_activeAppFrame().workspace.getCurrentPage();for(n!==this._oldCurrentPage&&(this._pageBeingHighlighted=n,this._oldCurrentPage=n);t!==e&&this._highlights[this._pageBeingHighlighted];)t++,this._pageBeingHighlighted=this._pageBeingHighlighted===this._lastPageToHighlight?this._firstPageToHighlight:this._pageBeingHighlighted+1;t===e?this._nextHighlightTask=null:(this._countHitsOnPage=0,this._nextHighlightTask=new o.a(3,1,l.App.instance.theConfig.highlightTaskDelay,Object(r.a)(this,this.waitOnNewPage,"waitOnNewPage")),a.AFrameworkApplication.theTaskManager.addTask(this._nextHighlightTask))},d.parseParagraphXml=function(){var e=this._paragraphXmls[this._paragraphBeingHighlighted];if(!e.selectSingleNode("ancestor::P")){var t=e.selectNodes("descendant::T/text()"),n=g.a(t);t.length&&this.grepTheText(n,t),this._countRunParagraphs++,this._countRunCharacters+=n.length}this._paragraphBeingHighlighted++},d.grepTheText=function(e,t){var n,i,r,a=0,o=0,s=p.SearchManager.instance,l=s.regex,c=this.zoomControl.currentZoom,d=this._highlights[this._pageBeingHighlighted];for(d||(d=[],this._highlights[this._pageBeingHighlighted]=d);r=l.exec(e);){var m=!this._currentResultFound&&this._pageBeingHighlighted===this._currentResultPage;n=r.index,i=l.lastIndex;for(var f=0,_=new h(this._pageBeingHighlighted),v=void 0,y=null;a<t.length;++a){if(f=o+t[a].data.length,o<i&&f>n){var S=t[a].parentNode,b=Math.max(0,n-o),C=Math.min(f-o,i-o);v=u.a.instance.computeBoundingBoxForTextRun(S,b,C),y||(y=String.format("{0}-{1}",this._pageBeingHighlighted,this._countHitsOnPage),this._countHitsOnPage++,m&&y===this._currentResultId&&(this._currentResultFound=!0));var A=u.a.instance.drawRectangle(v,1,y,this._pageBeingHighlighted);g.b(A,this._pageBeingHighlighted,c),_.addHighlightRectangle(A),this._currentResultFound&&m&&s.foundCurrentResult(A)}if(f>=i)break;o=f}d[d.length]=_}},d.lookForCurrentResult=function(e,t,n){this._currentResultPage=e,this._currentResultId=t,this._currentResultFound=n},d.pageCacheChanged=function(e,t){if(""!==p.SearchManager.instance.currentQueryString&&(this._firstPageToHighlight!==e||this._lastPageToHighlight!==t)){if(this._nextHighlightTask&&(this._pageBeingHighlighted<e||this._pageBeingHighlighted>t)&&(a.AFrameworkApplication.theTaskManager.deleteTask(this._nextHighlightTask),this._nextHighlightTask=null),isNaN(this._firstPageToHighlight)||isNaN(this._lastPageToHighlight)||e>this._lastPageToHighlight||t<this._firstPageToHighlight)return this._firstPageToHighlight=e,this._lastPageToHighlight=t,void this.beginHighlighting();for(var n=this._firstPageToHighlight;n<e;++n)this.clearHighlightsOnPage(n);for(var i=t+1;i<=this._lastPageToHighlight;++i)this.clearHighlightsOnPage(i);this._firstPageToHighlight=e,this._lastPageToHighlight=t,this._nextHighlightTask||(this._paragraphBeingHighlighted=Number.NaN,this.highlightNextPage())}},d.repositionAllHighlights=function(){this._waitingOnReposition||(this._waitingOnReposition=!0,a.AFrameworkApplication.theTaskManager.addTask(this._repositionAllHighlightsTask))},d.repositionAllHighlightsTask=function(e){for(var t,n=l.App.get_activeAppFrame().workspace,i=this.zoomControl.currentZoom,r=n.getCurrentPage(),a=n.getFirstCachedPage(),o=n.getLastCachedPage(),s=r;s<=o;++s)this.repositionHighlightsOnPage(this._highlights[s],i);for(var c=a;c<r;++c)this.repositionHighlightsOnPage(this._highlights[c],i);var u=this._highlights;for(var d in u){var h={key:d,value:u[d]};((t=h.key)<a||t>o)&&this.repositionHighlightsOnPage(h.value,i)}this._waitingOnReposition=!1},d.repositionHighlightsOnPage=function(e,t){if(e)for(var n,i,r,a=0;a<e.length;++a){i=(n=e[a]).highlightRectangles,r=n.page;for(var o=0;o<i.length;++o)g.b(i[o],r,t)}},d.getHighlightsByPage=function(e){return this._highlights[e]},e.createInstanceWithResolvedDependencies=function(t){return new e(t)},e.createInstance=function(t){return e.createInstanceWithResolvedDependencies(t)},t=e,(n=[{key:"zoomControl",get:function(){return this._zoomControl||(this._zoomControl=s.a.instance.resolve("WordViewer.Controls.IZoomControl"))}}])&&f(t.prototype,n),i&&f(t,i),e}();Object(i.a)(_,"HighlightWorker",null,[4])},578:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(0),r=n(579),a=n(1),o=n(21),s=n(19);function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(e,t,n,i,r,a){this._onDialogDismissed=e,this._onLaunchDownload=t,this._iHaveOfficeHandler=n,this._callbackData=i,this._dialogCause=r,this._application=a}var t,n,i,c=e.prototype;return c.reactOICErrorDialogWithTrialHandler=function(e,t){this.oicErrorDialogWithTrialHandler(e)},c.legacyOICErrorDialogWithTrialHandler=function(e,t){this.oicErrorDialogWithTrialHandler(e)},c.oicErrorDialogWithTrialHandler=function(e){var t=10;1===e?(s.a.instance.resolve("Common.IOfficeTrialExperience").launchOffer(this._application),t=3):2===e&&(this._iHaveOfficeHandler&&!this._iHaveOfficeHandler(this._callbackData)||this._onLaunchDownload&&r.a.instance.createOICErrorDialogWithDownload(this._onLaunchDownload,this._onDialogDismissed,this._callbackData),t=5);e&&1!==e||this._onDialogDismissed&&this._onDialogDismissed(this._callbackData),a.AFrameworkApplication.reportErrorWithCauseAndResolution(o.a.openInClientWithC2RFailed,this._dialogCause,t),this.dispose()},c.dispose=function(){this._onDialogDismissed=null,this._onLaunchDownload=null,this._callbackData=null},t=e,(n=[{key:"showHelpLink",get:function(){return!this._onLaunchDownload&&!this._iHaveOfficeHandler}},{key:"offerString",get:function(){return 2===this._application?CommonUIStrings.l_OICErrorC2ROneNoteOffer:CommonUIStrings.l_OICErrorC2ROffer}},{key:"id",get:function(){return"OICErrorDialogWithTrial"}},{key:"errorMessageNoOffice",get:function(){return CommonUIStrings.l_OICErrorMessageNoOffice}},{key:"iHaveOfficeButtonText",get:function(){return CommonUIStrings.l_OICErrorIHaveOfficeButton}},{key:"helpLinkText",get:function(){return CommonUIStrings.l_OICErrorHelpLink}},{key:"helpLinkContentId",get:function(){return"OICFailure"}},{key:"icon",get:function(){return 3}},{key:"actionButtonText",get:function(){return 2===this._application?CommonUIStrings.l_OICErrorC2RInstallOneNoteButton:CommonUIStrings.l_OICErrorC2RInstallButton}},{key:"dialogTitle",get:function(){return CommonUIStrings.l_DefaultDialogTitle}}])&&l(t.prototype,n),i&&l(t,i),e}();Object(i.a)(c,"AOICErrorDialogWithTrial",null,[4])},579:function(e,t,n){"use strict";var i=n(0),r=n(32),a=n(1),o=n(21),s=n(95),l=n(19),c=n(2);function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(e,t,n,i){this._macOfficeOffer=null,this._dialogCause=i,this._onDialogDismissed=e,this._onLaunchDownload=t,this._callbackData=n,this._shouldOfferMacOfficeTrial=this.macOfficeOffer.shouldOfferMacOfficeTrialInErrorDialog;var r=CommonUIStrings.l_OICErrorMacOfficeOffer.split("{0}");this._macOfficePreLinkText=r[0],this._macOfficePostLinkText=r[1]}var t,n,i,r=e.prototype;return r.reactOICErrorDialogHandler=function(e,t){this.oicErrorDialogHandler(e)},r.legacyOICErrorDialogHandler=function(e,t){this.oicErrorDialogHandler(e)},r.oicErrorDialogHandler=function(e){var t=10;this._onLaunchDownload&&1===e&&(this._onLaunchDownload(this._callbackData),t=1),this._onDialogDismissed&&this._onDialogDismissed(this._callbackData),this.reportError(t)},r.oicErrorHelpLinkHandler=function(e){s.Redirect.showHelp("OICFailure"),this.reportError(2)},r.oicErrorMacOfferLinkHandler=function(e){this.macOfficeOffer.launchMacOfficeTrialWindow(),this.reportError(4)},r.reportError=function(e){c.ULS.sendTraceTag(18715410,211,10,"Report OICErrorDialog. Dialog cause: {0}, solution: {1}",this._dialogCause,e),a.AFrameworkApplication.reportErrorWithCauseAndResolution(o.a.openInClientFailed,this._dialogCause,e)},r.dispose=function(){this._onLaunchDownload=null,this._onDialogDismissed=null,this._callbackData=null},t=e,(n=[{key:"macOfficeOffer",get:function(){return this._macOfficeOffer||(this._macOfficeOffer=l.a.instance.resolve("Common.IMacOfficeOffer"))}},{key:"id",get:function(){return"OICErrorDialog"}},{key:"errorMessage",get:function(){return CommonUIStrings.l_OICErrorMessage}},{key:"helpLinkText",get:function(){return CommonUIStrings.l_OICErrorHelpLink}},{key:"shouldOfferMacOfficeTrial",get:function(){return this._shouldOfferMacOfficeTrial}},{key:"macOfficePreLinkText",get:function(){return this._macOfficePreLinkText}},{key:"macOfficePostLinkText",get:function(){return this._macOfficePostLinkText}},{key:"macOfficeLinkText",get:function(){return CommonUIStrings.l_OICErrorMacOFficeLink}},{key:"icon",get:function(){return this._shouldOfferMacOfficeTrial?3:2}},{key:"errorFileDownloadOffer",get:function(){return CommonUIStrings.l_OICErrorFileDownloadOffer}},{key:"containsOnLaunchDownload",get:function(){return!!this._onLaunchDownload}},{key:"errorNoOfficeDownloadButtonText",get:function(){return CommonUIStrings.l_OICErrorNoOfficeDownloadButton}},{key:"dialogTitle",get:function(){return CommonUIStrings.l_DefaultDialogTitle}}])&&u(t.prototype,n),i&&u(t,i),e}();Object(i.a)(d,"AOICErrorDialog",null,[4]);var h=n(16),p=n(59);function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){var t,n;function i(t,n,i,a){var o;(o=e.call(this,t,n,i,a)||this)._helpLink=null,o._macOfferLink=null;var l=document.createElement("span");l.id="errorMessageText",l.innerText=o.errorMessage,s.Redirect.isHelpAvailable()&&(l.appendChild(document.createElement("br")),l.appendChild(document.createElement("br")),o._helpLink=document.createElement("a"),o._helpLink.href="#",o._helpLink.innerText=o.helpLinkText,l.appendChild(o._helpLink),h.a.addHandler(o._helpLink,"click",Object(r.a)(g(o),o.oicErrorHelpLinkHandler,"oicErrorHelpLinkHandler")));var c=new p.StandardDialog;if(c.dialogId=o.id,o.shouldOfferMacOfficeTrial){var u=document.createElement("span"),d=document.createElement("span");u.innerText=o.macOfficePreLinkText,d.innerText=o.macOfficePostLinkText,o._macOfferLink=document.createElement("a"),o._macOfferLink.href="#",o._macOfferLink.innerText=o.macOfficeLinkText,l.appendChild(document.createElement("br")),l.appendChild(u),l.appendChild(o._macOfferLink),l.appendChild(d),h.a.addHandler(o._macOfferLink,"click",Object(r.a)(g(o),o.oicErrorMacOfferLinkHandler,"oicErrorMacOfferLinkHandler"))}else if(o.containsOnLaunchDownload){l.appendChild(document.createElement("br")),l.appendChild(document.createElement("br"));var m=document.createElement("span");m.innerText=o.errorFileDownloadOffer,l.appendChild(m)}return o.containsOnLaunchDownload?(c.buttonsOption=1,c.setButtonText(1,o.errorNoOfficeDownloadButtonText)):c.buttonsOption=0,c.messageBox(o.dialogTitle,null,o.icon,Object(r.a)(g(o),o.legacyOICErrorDialogHandler,"legacyOICErrorDialogHandler"),l),c.setDescribedByForDialog("errorMessageText"),o}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,m(t,n),i.prototype.dispose=function(){this._helpLink&&(h.a.removeHandler(this._helpLink,"click",Object(r.a)(this,this.oicErrorHelpLinkHandler,"oicErrorHelpLinkHandler")),this._helpLink=null),this._macOfferLink&&(h.a.removeHandler(this._macOfferLink,"click",Object(r.a)(this,this.oicErrorMacOfferLinkHandler,"oicErrorMacOfferLinkHandler")),this._macOfferLink=null),e.prototype.dispose.call(this)},i}(d);function _(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(f,"OICErrorDialog",d,[]);var v=function(){function e(e,t,n){this._onDialogDismissed=t,this._onLaunchDownload=e,this._callbackData=n}var t,n,i,r=e.prototype;return r.reactOICErrorDialogHandler=function(e,t){this.oicErrorDialogHandler(e)},r.legacyOICErrorDialogHandler=function(e,t){this.oicErrorDialogHandler(e)},r.oicErrorDialogHandler=function(e){var t=10;1===e&&(this._onLaunchDownload(this._callbackData),t=1),this._onDialogDismissed&&this._onDialogDismissed(this._callbackData),this.reportError(t)},r.oicErrorHelpLinkHandler=function(e){s.Redirect.showHelp("OICFailure"),this.reportError(2)},r.reportError=function(e){a.AFrameworkApplication.reportErrorWithCauseAndResolution(o.a.openInClientSecondaryFailed,3,e)},r.dispose=function(){this._onDialogDismissed=null,this._onLaunchDownload=null,this._callbackData=null},t=e,(n=[{key:"id",get:function(){return"OICErrorDialogWithDownload"}},{key:"errorMessageNoOfficeDetected",get:function(){return CommonUIStrings.l_OICErrorNoOfficeDetected}},{key:"helpLinkText",get:function(){return CommonUIStrings.l_OICErrorHelpLink}},{key:"errorFileDownloadOffer",get:function(){return CommonUIStrings.l_OICErrorFileDownloadOffer}},{key:"errorNoOfficeDownloadButtonText",get:function(){return CommonUIStrings.l_OICErrorNoOfficeDownloadButton}},{key:"icon",get:function(){return 2}},{key:"dialogTitle",get:function(){return CommonUIStrings.l_DefaultDialogTitle}}])&&_(t.prototype,n),i&&_(t,i),e}();function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(v,"AOICErrorDialogWithDownload",null,[4]);var b=function(e){var t,n;function i(t,n,i){var a;(a=e.call(this,t,n,i)||this)._helpLink=null;var o=document.createElement("span");o.id="errorMessageText",o.innerText=a.errorMessageNoOfficeDetected,s.Redirect.isHelpAvailable()&&(o.appendChild(document.createElement("br")),o.appendChild(document.createElement("br")),a._helpLink=document.createElement("a"),a._helpLink.href="#",a._helpLink.innerText=a.helpLinkText,o.appendChild(a._helpLink),h.a.addHandler(a._helpLink,"click",Object(r.a)(y(a),a.oicErrorHelpLinkHandler,"oicErrorHelpLinkHandler"))),o.appendChild(document.createElement("br")),o.appendChild(document.createElement("br"));var l=document.createElement("span");l.innerText=a.errorFileDownloadOffer,o.appendChild(l);var c=new p.StandardDialog;return c.dialogId=a.id,c.buttonsOption=1,c.setButtonText(1,a.errorNoOfficeDownloadButtonText),c.messageBox(a.dialogTitle,null,a.icon,Object(r.a)(y(a),a.legacyOICErrorDialogHandler,"legacyOICErrorDialogHandler"),o),c.setDescribedByForDialog("errorMessageText"),a}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,S(t,n),i.prototype.dispose=function(){this._helpLink&&(h.a.removeHandler(this._helpLink,"click",Object(r.a)(this,this.oicErrorHelpLinkHandler,"oicErrorHelpLinkHandler")),this._helpLink=null),e.prototype.dispose.call(this)},i}(v);Object(i.a)(b,"OICErrorDialogWithDownload",v,[]);var C=n(77);function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var T=function(e){var t,n;function i(t,n,i,a){var o,l,c;c=e.call(this,t,n,i,a)||this;var u=((o={}).errorMessage=c.errorMessage,o);if(s.Redirect.isHelpAvailable()){var d;u.helpLink=((d={}).type="AppLinkProps",d.id="helpLink",d.text=c.helpLinkText,d.handler=function(e){c.oicErrorHelpLinkHandler(e)},d)}if(c.shouldOfferMacOfficeTrial){var h;u.macOfficePreLinkText=c.macOfficePreLinkText;u.macOfficeLink=((h={}).type="AppLinkProps",h.id="macOfficeLink",h.text=c.macOfficeLinkText,h.handler=function(e){c.oicErrorMacOfferLinkHandler(e)},h),u.macOfficePostText=c.macOfficePostLinkText}else c.containsOnLaunchDownload&&(u.errorFileDownloadOffer=c.errorFileDownloadOffer);var p=new C.a(!1,!1,!0);c.containsOnLaunchDownload?(p.buttonsOption=1,p.setButtonText(1,c.errorNoOfficeDownloadButtonText)):p.buttonsOption=0,p.dialogId=c.id;var g=((l={}).id=c.id,l.dialogIcon=c.icon,l.bodyControls=u,l);return p.initializeAndShow(c.dialogTitle,Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(c),c.reactOICErrorDialogHandler,"reactOICErrorDialogHandler"),g),c}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,A(t,n),i}(d);function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(T,"ReactOICErrorDialog",d,[]);var k=function(e){var t,n;function i(t,n,i){var a,o,l;l=e.call(this,t,n,i)||this;var c=((a={}).errorMessage=l.errorMessageNoOfficeDetected,a.errorFileDownloadOffer=l.errorFileDownloadOffer,a);if(s.Redirect.isHelpAvailable()){var u;c.helpLink=((u={}).type="AppLinkProps",u.id="helpLink",u.text=l.helpLinkText,u.handler=function(e){l.oicErrorHelpLinkHandler(e)},u)}var d=new C.a(!1,!1,!0);d.buttonsOption=1,d.setButtonText(1,l.errorNoOfficeDownloadButtonText),d.dialogId=l.id;var h=((o={}).id=l.id,o.dialogIcon=l.icon,o.bodyControls=c,o);return d.initializeAndShow(l.dialogTitle,Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(l),l.reactOICErrorDialogHandler,"reactOICErrorDialogHandler"),h),l}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,w(t,n),i}(v);function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(k,"ReactOICErrorDialogWithDownload",v,[]),n.d(t,"a",(function(){return F}));var F=function(){function e(){this._isReactDialogEnabled=!!a.AFrameworkApplication.activeFrame&&a.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled}var t,i,r,o=e.prototype;return o.createOICErrorDialog=function(e,t,n,i){return this._isReactDialogEnabled?new T(e,t,n,i):new f(e,t,n,i)},o.createOICErrorDialogWithDownload=function(e,t,n){return this._isReactDialogEnabled?new k(e,t,n):new b(e,t,n)},o.createOICErrorDialogWithTrial=function(e,t,i,r,a,o){var s=n(581).ReactOICErrorDialogWithTrial,l=n(582).OICErrorDialogWithTrial;return this._isReactDialogEnabled?new s(e,t,i,r,a,o):new l(e,t,i,r,a,o)},t=e,r=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(i=null)&&I(t.prototype,i),r&&I(t,r),e}();F._instance=null,Object(i.a)(F,"OICErrorDialogFactory",null,[277])},581:function(e,t,n){"use strict";n.r(t),n.d(t,"ReactOICErrorDialogWithTrial",(function(){return c}));var i=n(0),r=n(32),a=n(578),o=n(95),s=n(77);function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){var t,n;function i(t,n,i,a,l,c){var u,d,h;h=e.call(this,t,n,i,a,l,c)||this;var p=((u={}).errorMessage=h.errorMessageNoOffice,u.offerString=h.offerString,u),g=new s.a(!1,!1,!0);if(h.showHelpLink){var m;g.buttonsOption=1;p.helpLink=((m={}).type="AppLinkProps",m.id="helpLink",m.text=h.helpLinkText,m.handler=function(e){o.Redirect.showHelp(h.helpLinkContentId)},m)}else g.buttonsOption=4,g.setButtonText(2,h.iHaveOfficeButtonText);g.setButtonText(1,h.actionButtonText),g.dialogId=h.id;var f=((d={}).id=h.id,d.dialogIcon=h.icon,d.bodyControls=p,d);return g.initializeAndShow(h.dialogTitle,Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(h),h.reactOICErrorDialogWithTrialHandler,"reactOICErrorDialogWithTrialHandler"),f),h}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,l(t,n),i}(a.a);Object(i.a)(c,"ReactOICErrorDialogWithTrial",a.a,[])},582:function(e,t,n){"use strict";n.r(t),n.d(t,"OICErrorDialogWithTrial",(function(){return l}));var i=n(0),r=n(32),a=n(578),o=n(59);function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){var t,n;function i(t,n,i,a,s,l){var c;c=e.call(this,t,n,i,a,s,l)||this;var u=document.createElement("span");u.innerText=c.errorMessageNoOffice,u.appendChild(document.createElement("br")),u.appendChild(document.createElement("br"));var d=document.createElement("span");d.innerText=c.offerString,u.appendChild(d);var h=new o.StandardDialog;return c.showHelpLink?(h.buttonsOption=1,h.addHelpLink(c.helpLinkText,c.helpLinkContentId)):(h.buttonsOption=4,h.setButtonText(2,c.iHaveOfficeButtonText)),h.setButtonText(1,c.actionButtonText),h.dialogId=c.id,h.messageBox(c.dialogTitle,null,c.icon,Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(c),c.legacyOICErrorDialogWithTrialHandler,"legacyOICErrorDialogWithTrialHandler"),u),c}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,s(t,n),i}(a.a);Object(i.a)(l,"OICErrorDialogWithTrial",a.a,[])}}]);
//# sourceMappingURL=https://wordwebclientbuilds.blob.core.windows.net/ooui/7fd51c3eda7f2cc24ae8ce8147c54a7a41d85c31/WordViewerDS.dll1.js.map